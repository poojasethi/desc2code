#include<cstdio>
#include<algorithm>
#define fo(i,a,b) for(i=a;i<=b;++i)
#define fd(i,a,b) for(i=a;i>=b;--i)
using namespace std;
const int dx[4]={0,1,0,-1},dy[4]={1,0,-1,0},bi[11]={1,2,4,8,16,32,64,128,256,512,1024};
const int mn=210,ml=3001000,inf=1<<30;
int f[mn][mn],fa[mn][mn],x1[mn][mn],x2[mn][mn];
int a[mn][mn],n,m,k;
int q[ml],qz[ml],l,r;
bool vis[mn][mn],g[mn][mn];
int pos(int x,int y){return (x-1)*m+y;}
void dfs(int r,int z)
{
    if(!r)return;
	vis[(r-1)/m+1][(r-1)%m+1]=1;
	if(!x1[r][z]){dfs(fa[r][z],z);return;}
	dfs(fa[r][z],x1[r][z]);
	dfs(fa[r][z],x2[r][z]);
}
int main()
{
	scanf("%d%d%d",&n,&m,&k);
    int i,j,x,y,z,u,v,ans=inf,t,p;
    fo(i,1,n)
        fo(j,1,m)
			scanf("%d",&a[i][j]);
    fill(&f[0][0],&f[mn-1][mn-1],inf);
    fo(i,1,k)
	{
        scanf("%d%d",&x,&y);
        t=pos(x,y);
		q[++r]=t,qz[r]=bi[i-1];
		f[t][bi[i-1]]=a[x][y];
 //       g[t][bi[i-1]]=1;
	}
    l=1;
	while(l<=r)
	{
        x=(q[l]-1)/m+1,y=(q[l]-1)%m+1,z=qz[l];
        t=pos(x,y);
        fo(i,0,bi[k]-1)
		{
			if(f[t][z]+f[t][i]-a[x][y]<f[t][z|i])
			{
				f[t][z|i]=f[t][z]+f[t][i]-a[x][y];
                fa[t][z|i]=t;
                x1[t][z|i]=z,x2[t][z|i]=i;
                if(!g[t][z|i])
                {
				    q[++r]=t,qz[r]=z|i;
                   // g[t][z|i]=1;
                }
			}
		}
        fo(i,0,3)
		{
			u=x+dx[i],v=y+dy[i];
            if(u<1||u>n||v<1||v>m)continue;
            p=pos(u,v);
			if(f[t][z]+a[u][v]<f[p][z])
			{
                f[p][z]=f[t][z]+a[u][v];
                fa[p][z]=t;
				x1[p][z]=x2[p][z]=0;
                if(!g[p][z])
                {
				    q[++r]=p,qz[r]=z;
                  //  g[p][z]=1;
                }
			}
		}
   //     g[q[r]][z]=0;
        ++l;
	}
    fo(i,1,n*m)
		if(f[i][bi[k]-1]<ans)ans=f[i][bi[k]-1],x=i;
	dfs(x,bi[k]-1);
    printf("%d\n",ans);
    fo(i,1,n)
	{
        fo(j,1,m)printf("%c",vis[i][j]?'X':'.');
        printf("\n");
	}
	return 0;
}