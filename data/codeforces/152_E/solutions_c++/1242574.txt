#include<cstdio>
#include<cstring>
#include<algorithm>
using namespace std;
int n,m,num,t1,t2,c[101][101],ans,inf=1000000000,dx[]={0,1,0,-1},dy[]={1,0,-1,0};
struct ss{
    int c,k,i,j;
    ss(){c=inf;}
    ss(int _c,int _k,int _i,int _j){c=_c;k=_k;i=_i;j=_j;}
}f[129][101][101];
char a[101][101];
void go(int st,int i,int j){
    a[i][j]='X';
    if(!f[st][i][j].k)return;
    if(f[st][i][j].k==1){
        go(f[st][i][j].i,i,j);
        go(f[st][i][j].j,i,j);
    }
    else go(st,f[st][i][j].i,f[st][i][j].j);
}
int main(){
    scanf("%d%d%d",&n,&m,&num);
    for(int i=1;i<=n;++i)
        for(int j=1;j<=m;++j){
            scanf("%d",&c[i][j]);
            a[i][j]='.';
        }
    for(int x,y,i=0;i<num;++i){
        scanf("%d%d",&x,&y);
        f[1<<i][x][y]=ss(c[x][y],1,0,0);
    }
    for(int i=1;i<(1<<num);++i){
        for(int j=1;j<=n;++j)
            for(int k=1;k<=m;++k)
                 for(int sub=i;sub;sub=i&(sub-1))
                    if(f[sub][j][k].c+f[i^sub][j][k].c-c[j][k]<f[i][j][k].c)
                        f[i][j][k]=ss(f[sub][j][k].c+f[i^sub][j][k].c-c[j][k],1,sub,i^sub);
        for(int l=1;l<n*m;++l)
            for(int j=1;j<=n;++j)
                for(int k=1;k<=m;++k)
                    for(int dir=0;dir<4;++dir){
                        int nx=j+dx[dir],ny=k+dy[dir];
                        if(0<nx&&nx<=n&&0<ny&&ny<=m)
                            if(f[i][j][k].c+c[nx][ny]<f[i][nx][ny].c)
                                f[i][nx][ny]=ss(f[i][j][k].c+c[nx][ny],2,j,k);
                    }
    }
    ans=inf;
    for(int i=1;i<=n;++i)
        for(int j=1;j<=m;++j)
            if(f[(1<<num)-1][i][j].c<ans){
                ans=f[(1<<num)-1][i][j].c;
                t1=i;t2=j;
            }
    printf("%d\n",ans);
    go((1<<num)-1,t1,t2);
    for(int i=1;i<=n;++i){
        for(int j=1;j<=m;++j)
            printf("%c",a[i][j]);
        printf("\n");
    }
    return 0;
} 
