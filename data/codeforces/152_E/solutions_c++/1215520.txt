#include<iostream>
#include<algorithm>
#include<cstdlib>
#include<cstring>
#include<string>
#define mp make_pair
#define x_ first
#define y_ second
using namespace std;
int n,m,k,ans=0x7FFFFFFF;
int a[200][200],b[200][200],op,ed=-1;
pair<unsigned int,int> f[40000][128],l[4000000];

bool In[40000][128],done[200][200];
//pair<value,n*m+bit|<n>
void get(int pos,int sta,int val,int fro)
{
	if(!f[pos][sta].x_||f[pos][sta].x_>val)
	{
		f[pos][sta]=mp(val,fro);
		if(!In[pos][sta])In[pos][sta]=1,l[++ed]=mp(pos,sta);//,cout<<pos/m+1<<' '<<pos%m+1<<' '<<sta<<' '<<val<<' '<<fro<<endl;
	}
}

void Go(int pos,int sta)
{
	done[pos/m][pos%m]=1;
	if(f[pos][sta].y_==-1)return;
	if(f[pos][sta].y_>=n*m)Go(pos,sta-f[pos][sta].y_+n*m),Go(pos,f[pos][sta].y_-n*m);
	else Go(f[pos][sta].y_,sta-((1<<b[pos/m][pos%m])>>1));
}

int main()
{
	#ifndef ONLINE_JUDGE
		freopen("cf.in","rb",stdin);
		freopen("cf.out","wb",stdout);
	#endif
	cin>>n>>m>>k;
	for(int i=0;i<n;++i)
		for(int j=0;j<m;++j)
			cin>>a[i][j];
	for(int i=1,x,y;i<=k;++i)
	{
		cin>>x>>y;
		b[--x][--y]=i;
		get(x*m+y,((1<<i)>>1),a[x][y],-1);
	}
	for(;op<=ed;++op)
	{
		int pos=l[op].x_,sta=l[op].y_,nx,ny;
		for(int j=0;j<=1;++j)
			for(int i=-1;i<=1;i+=2)
			{
				nx=pos/m+j*i;
				ny=pos%m+(1-j)*i;
				if(nx<0||nx>=n||ny<0||ny>=m)continue;
				get(nx*m+ny,sta|((1<<b[nx][ny])>>1),f[pos][sta].x_+a[nx][ny],pos);
			}
		for(int i=0;i<(1<<k);++i)if(f[pos][i].x_)
			get(pos,sta|i,f[pos][i].x_+f[pos][sta].x_-a[pos/m][pos%m],i+n*m);
		In[pos][sta]=0;
	}
	for(int i=0;i<n*m;++i)
		if(f[i][(1<<k)-1].x_&&f[i][(1<<k)-1].x_<ans)ans=f[i][(1<<k)-1].x_;
	for(int i=0;i<n*m;++i)
		if(f[i][(1<<k)-1].x_==ans)
		{
			Go(i,(1<<k)-1);
			break;
		}
	cout<<ans<<endl;
	for(int i=0;i<n;++i,cout<<endl)
		for(int j=0;j<m;++j)
			if(done[i][j])cout<<'X';else cout<<'.';
	return 0;
}
