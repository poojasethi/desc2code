#include<stdio.h>
#include<string.h>
#include<algorithm>
using namespace std;
int n,m,k;
struct pp{
    int sta,u;
}pre[(1<<7)+5][210];
int dp[(1<<7)+5][210];
int a[210],g[210];
char ans[210][210];
int mx[4]={1,0,-1,0};
int my[4]={0,1,0,-1};
int q[310],l,r,vis[310];
const int mod=300;
void updata(int st,int sta,int u,int v,int z){
    dp[st][u]=z;
    pre[st][u].sta=sta;
    pre[st][u].u=v;
}
void dfs(int st,int v){
    int x,y,sta,u;
    if (st<0||v<0) return;
    x=v/m;y=v%m;
    ans[x][y]='X';
    sta=pre[st][v].sta;
    u=pre[st][v].u;
    if (sta==st) dfs(sta,u);
    else {dfs(sta,u);dfs(st^sta,u);}
}
void solve(){
    int i,j,maxn,u,v,st;
    int x,y;
    maxn=1<<k;
    for (i=1;i<maxn;i++){
        for (u=0;u<n*m;u++){
            for (st=0;st<i;st++){
                if (dp[st][u]>=0&&dp[i^st][u]>=0){
                    if (dp[i][u]==-1||dp[i][u]>dp[st][u]+dp[i^st][u]-a[u])
                        updata(i,st,u,u,dp[st][u]+dp[i^st][u]-a[u]);
                }
            }
        }
        l=r=0;
        memset(vis,0,sizeof(vis));
        for (u=0;u<n*m;u++) if (dp[st][u]>=0) {vis[u]=1;q[++r]=u;}
        while (l!=r){
            l=(l+1)%mod;
            u=q[l];
            vis[u]=0;
            x=u/m;y=u%m;
            for (j=0;j<4;j++){
                int tx=x+mx[j];
                int ty=y+my[j];
                if (tx<0||tx>=n||ty<0||ty>=m) continue;
                v=tx*m+ty;
                if (dp[i][v]==-1||dp[i][v]>dp[i][u]+a[v]){
                    updata(i,i,v,u,dp[i][u]+a[v]);
                    if (!vis[v]){
                        r=(r+1)%mod;
                        q[r]=v;
                        vis[v]=1;
                    }
                }
            }
        }
    }
    for (i=0;i<n;i++)
        for (j=0;j<m;j++) ans[i][j]='.';
    int mn=-1;
    for (i=0;i<n*m;i++){
        if (dp[maxn-1][i]==-1) continue;
        if (mn>dp[maxn-1][i]||mn<0){
            mn=dp[maxn-1][i];
            j=i;
        }
    }
    printf("%d\n",mn);
    dfs(maxn-1,j);
}
int main(){
   // freopen("e.in","r",stdin);
    int i,j,s,x,y;
    scanf("%d%d%d",&n,&m,&k);
    s=0;
    for (i=0;i<n;i++)
        for (j=0;j<m;j++) scanf("%d",&a[s++]);
    memset(pre,-1,sizeof(pre));
    memset(dp,-1,sizeof(dp));
    memset(g,-1,sizeof(g));
    j=0;
    for (i=0;i<k;i++){
        scanf("%d%d",&x,&y);
        x--;y--;
        s=x*m+y;
        g[s]=j++;
    }
    for (i=0;i<n*m;i++){
        if (g[i]<0) dp[0][i]=a[i];
        else dp[1<<g[i]][i]=a[i];
    }
    solve();
    for (i=0;i<n;i++) printf("%s\n",ans[i]);
    return 0;
}
