#include<bits/stdc++.h>
using namespace std;
const int N=100005;
int f[N],r[N];
int ff[N];
void init() {
    for(int i=0;i<N;i++) {
        f[i]=i;
        r[i]=0;
    }
}
int find(int x) {
    if(x!=f[x]) {
        f[x]=find(f[x]);
    }
    return f[x];
}
int main() {
    #ifndef ONLINE_JUDGE
    freopen("in.txt","r",stdin);
    #endif
    init();
    int n,m;
    cin>>n>>m;
    int op;
    int u,v;
    vector<pair<int,int> > p;
    for(int i=0;i<m;i++) {
        cin>>op;
        if(op==1) {
            cin>>u>>v;
            f[u]=v;
            ff[u]=v;
        }else if(op==2) {
            cin>>u;
            int pu=find(u);
            p.push_back(make_pair(u,pu));
        }else {
            cin>>u>>v;
            int id=v-1;
            int x=p[id].first;
            int y=p[id].second;
            while(x!=y) {
                if(x==u) break;
                x=ff[x];
            }
            if(x==u) cout<<"YES"<<endl;
            else cout<<"NO"<<endl;
        }
    }
    return 0;
}
