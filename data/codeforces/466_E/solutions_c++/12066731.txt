#include <iostream>
#include <cstdio>
#include <cstring>
#include <algorithm>
#include <cassert>
using namespace std ;

const int N = 1e5 + 11 ;

int fa[N] , boss[N] ;
int rang[N][2] ;
int n , m ;

int find(int x) {
	if(fa[x] != x) {
		fa[x] = find(fa[x]) ;
	}
	return fa[x] ;
}

int main() {
    //freopen("data.in", "r" , stdin);
	while(scanf("%d %d" ,&n ,&m)==2) {
		for(int i = 1 ; i <= n ; ++i) fa[i] = boss[i] = i ;
		int op , a , b ;
		int cnt = 0 ;
		while(m--) {
			scanf("%d" , &op) ;
			if(op == 1) {
				scanf("%d %d" ,&a ,&b) ;
				boss[a] = b ;
				int a1 = find(a) ;
				fa[a1] = b ;
			}else if(op == 2) {
				scanf("%d" ,&a) ;
				++cnt ;
				rang[cnt][0] = a ;
				rang[cnt][1] = find(a) ;
			}else if(op == 3) {
				scanf("%d %d" ,&a, &b) ;
				bool mark = false ;
				int begin = rang[b][0] , end = rang[b][1] ;
				while(begin != end) {
					if(begin == a) {mark = true ;break ;}
					begin = boss[begin] ;
				}
				if(end == a) mark = true ;
				if(mark) printf("YES\n") ;
				else printf("NO\n") ;
			}
		}
	}
}

 		    	 		 			 	  		 		 		 		