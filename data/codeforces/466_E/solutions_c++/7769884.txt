#include <cstdio>
#include <cstring>
struct belong
{
    int to;
    int time;
}b[100005];
struct pack
{
    int id;
    int time;
}p[100005];
int tot;
int get(int x,int y)
{

}
int main(void)
{
    int i,j,k;
    int n,m;
    int t,x,y;
    scanf("%d%d",&n,&m);
    for (i=1;i<=n;i++)
    {
        b[i].to=i;
        b[i].time=0;
    }
    tot=0;
    for (i=1;i<=m;i++)
    {
        scanf("%d",&t);
        if (t==1)
        {
            scanf("%d%d",&x,&y);
            b[x].to=y;
            b[x].time=i;
        }
        else
        if (t==2)
        {
            scanf("%d",&x);
            tot++;
            p[tot].id=x;
            p[tot].time=i;
        }
        else
        {
            int flag=0,tmp;
            scanf("%d%d",&x,&y);
            tmp=p[y].id;
            if (tmp==x)
                flag=1;
            while (b[tmp].time<p[y].time&&b[tmp].to!=tmp)
            {
                tmp=b[tmp].to;
                if (tmp==x)
                {
                    flag=1;
                    break;
                }
            }
            if (flag)
                printf("YES\n");
            else
                printf("NO\n");
        }
    }
    return 0;
}
