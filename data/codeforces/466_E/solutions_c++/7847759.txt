#include<stdio.h>
#include<algorithm>
using namespace std;
const int maxn=500050,maxb=20;
int n,m;
char ans[2][5]={"NO","YES"};
int es=0,he[maxn],to[maxn],ne[maxn];
int f[maxn];
int deg[maxn],fa[maxn][maxb],dep[maxn];
int doc[maxn][2],ds=0;
int que[maxn][2],qs=0;
inline int find(int x) { return f[x]==x?x:f[x]=find(f[x]); }
void ins(int x,int y)
{
	to[++es]=y,ne[es]=he[x],he[x]=es;
}
void dfs(int x,int d,int f0)
{
	int i;
	dep[x]=d;
	fa[x][0]=f0;
	for(i=0;fa[x][i];i++)
		fa[x][i+1]=fa[fa[x][i]][i];
	for(i=he[x];i;i=ne[i])
		dfs(to[i],d+1,x);
}
int LCA(int x,int y)
{
	int i;
	if(dep[x]<dep[y]) swap(x,y);
	for(i=maxb-1;i>=0;i--)
		if(dep[x]-dep[y]>=(1<<i))
			x=fa[x][i];
	for(i=maxb-1;i>=0;i--)
		if(fa[x][i]!=fa[y][i])
			x=fa[x][i],y=fa[y][i];
	return x!=y?fa[x][0]:x;
}
int main()
{
#ifndef ONLINE_JUDGE
	freopen("data.in","r",stdin);
#endif
	int i,j;
	scanf("%d%d",&n,&m);
	for(i=1;i<=n;i++)
		f[i]=i;
	for(i=0;i<m;i++)
	{
		int o,x,y;
		scanf("%d%d",&o,&x);
		if(o==2)
			++ds,doc[ds][0]=x,doc[ds][1]=find(x);
		else
		{
			scanf("%d",&y);
			if(o==1) ins(y,x),f[x]=y,deg[x]++;
			else que[qs][0]=x,que[qs][1]=y,qs++;
		}
	}
	for(i=1;i<=n;i++)
		if(!deg[i]) dfs(i,1,0);
	for(i=0;i<qs;i++)
	{
		int x=que[i][0],d=que[i][1],l=doc[d][0],r=doc[d][1];
		//printf("%d %d %d %d %d\n",x,d,l,r,LCA(x,l));
		printf("%s\n",ans[LCA(x,l)==x&&dep[x]>=dep[r]]);
	}
	return 0;
}
