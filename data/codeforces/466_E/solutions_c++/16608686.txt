#include<bits/stdc++.h>
#define st first
#define nd second
#define mp make_pair
#define pb push_back
#define endl '\n'
#define endll puts("")
#define mod 1000000007
#define mp3(x,y,z) mp(x,mp(y,z))
#define pii pair< int , int > 
#define orta ((bas+son)/2)
#define sol (root+root)
#define sag (root+root+1)
using namespace std;
typedef long long ll;
const int N = 1e5+3;
int n,m,i,j,k,l,sa,sb,t,d,u,ii,jj,x,y,z,hh[N],f[N],b[N],ata[N];
vector<int> V[N];
vector< pii > v[N];
pair<int,pii >a[N];
int fa(int x){return (x==ata[x])?x:ata[x]=fa(ata[x]);}
void dfs(int x)
{
	if(b[x])return;
   b[x]=++t;
	for(int i=0;i<V[x].size();i++)
		dfs(V[x][i]);
	f[x]=t;
}
int main()
{
	cin>>n>>m;for(i=1;i<=n;i++)ata[i]=i;
	for(i=1;i<=m;i++)
	{
		scanf("%d",&x);
		if(x==1)
		{scanf("%d%d",&y,&z);V[y].pb(z);V[z].pb(y);a[i]=mp3(x,y,z);ata[fa(y)]=fa(z);}
		else if(x==2)
		{scanf("%d",&y);a[i]=mp3(x,y,0);}
		else
		{scanf("%d%d",&y,&z);v[z].pb(mp(y,++sb));a[i]=mp3(x,y,z);}
	}
	for(i=1;i<=n;i++)
		if (fa(i)==i)
			dfs(i);
	
	for(i=1;i<=n;i++) ata[i]=i;
	for(i=1;i<=m;i++)
	{
		if(a[i].st==3)continue;
		if(a[i].st==1)
			ata[fa(a[i].nd.st)]=fa(a[i].nd.nd);
		else
		{
			u=v[++sa].size();
			for(j=0;j<u;j++)
				if(fa(a[i].nd.st)==fa(v[sa][j].st) and b[a[i].nd.st]>=b[v[sa][j].st] and f[a[i].nd.st]<=f[v[sa][j].st])
					hh[v[sa][j].nd]=1;
		}
	}
	for(i=1;i<=sb;i++)
		printf( hh[i]?"YES\n":"NO\n" );
}
