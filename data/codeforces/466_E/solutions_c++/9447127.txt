#include <bits/stdc++.h>

using namespace std;
int fa[112345],nxt[112345];
int L[112345],R[112345];
int find(int x)
{
	if(fa[x]==x)return x;
	return fa[x]=find(fa[x]);
}
int main()
{
	int n,m,op,cnt=1;
	cin>>n>>m;
	for(int i=0;i<=n+99;i++)fa[i]=nxt[i]=i;
	for(int i=0;i<m;i++)
	{
		cin>>op;
		if(op==1)
		{
			int x,y;
			cin>>x>>y;
			nxt[x]=y;
			fa[x]=y;
		}
		else if(op==2)
		{
			int x;cin>>x;
			L[cnt]=find(x);
			R[cnt++]=x;
		}
		else
		{
			int x,y;cin>>x>>y;
			int l=L[y],r=R[y];
			bool ff=0;
			while(r!=l)
			{
				if(r==x)
				{
					cout<<"YES"<<endl;
					ff=1;
					break;
				}
				r=nxt[r];
			}
			if(l==x){cout<<"YES"<<endl;
					ff=1;}
			if(!ff)cout<<"NO"<<endl;
		}
	}
	return 0;
}

 			    	 	 	 	 	 				 				  	