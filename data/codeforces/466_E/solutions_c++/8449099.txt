#include<cstdio>
#include<vector>
#define nn 100010
using namespace std;
vector<int>q[nn];
struct dege{int end,next;
}g[nn];

struct node{int id,x,y,f;
}a[nn];

int st[nn],fa[nn],ok[nn],ans[nn],f[nn],ed[nn];
int i,n,m,j,t,now,u,id,tot;

int get(int w){return (f[w]==w)?w:(f[w]=get(f[w]));}

void add(int a,int b)
 {g[++tot].end=b;g[tot].next=fa[a];fa[a]=tot;
 }

void dfs(int w)
 {st[w]=++t;
  for (int i=fa[w];i;i=g[i].next)dfs(g[i].end);
  ed[w]=t;  
 }
int main()
{
 scanf("%d%d",&n,&m);
 for (i=1;i<=m;i++)
   {scanf("%d",&a[i].f);a[i].id=i;
    if (a[i].f==1){
	scanf("%d%d",&a[i].x,&a[i].y);
	add(a[i].y,a[i].x);ok[a[i].x]=1;
		          }
	else if (a[i].f==2)scanf("%d",&a[i].x);
	
	else if (a[i].f==3)
	scanf("%d%d",&a[i].x,&a[i].y),
	q[a[i].y].push_back(i);
   }
 for (i=1;i<=n;i++)if (!ok[i])dfs(i);
 for (i=1;i<=n;i++)f[i]=i;
 for (i=1;i<=m;i++)
  {if (a[i].f==1){f[a[i].x]=a[i].y;continue;}
  if  (a[i].f==3){puts((ans[i])?"YES":"NO");continue;}
   
   ++now;
   for (j=0;j<q[now].size();j++){
   u=a[q[now][j]].x;id=q[now][j];
   if ((get(a[i].x)==get(u))&&
   (st[a[i].x]<=ed[u])&&(st[a[i].x]>=st[u]))
   ans[id]=1;
                                }
  }
 return 0;
}
