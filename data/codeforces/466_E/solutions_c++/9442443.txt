#include <iostream>
#include <cstring>
#include <cstdio>
#include <algorithm>
using namespace std;
int n,m,color;
int root[100010];
int leaf[100010];
int fa[100010];
int pre[100010];
int get_root(int x){
    if (x==fa[x]) return x;
    return fa[x]=get_root(fa[x]);
}
int main(){
    scanf("%d%d",&n,&m);
    for (int i=1;i<=n;i++) fa[i]=i,root[i]=0;
    color=0;
    while (m--){
        int k;
        scanf("%d",&k);
        if (k==1){
            int x,y;
            scanf("%d%d",&x,&y);
            fa[x]=y;
            pre[x]=y;
        } else if (k==2) {
            int x;
            scanf("%d",&x);
            leaf[++color]=x;
            root[color]=get_root(x);
        } else {
            int x,y;
            scanf("%d%d",&x,&y);
            int now=leaf[y];
            while (now!=x&&now!=root[y]) now=pre[now];
            if (now==x) printf("YES\n");
            else printf("NO\n");
        }
    }
    return 0;
}

	 						 	  	   		  		 		  		