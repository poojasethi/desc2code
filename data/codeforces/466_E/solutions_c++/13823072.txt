#include <iostream>
#include<bits/stdc++.h>
using namespace std;
int parent[100001],ancestor[100001];
int find(int x)
{
    if(ancestor[x]==x)
    return x;
    return ancestor[x]=find(ancestor[x]);
    
}   

int main()
{
    int n,q,i,j,k,type,x,y,cur,dest,flag;
    vector<int>v1,v2;
    cin>>n>>q;
    for(i=0;i<=100000;i++)
    {
        parent[i]=i;
        ancestor[i]=i;
    }   
    while(q--)
    {
        cin>>type;
        if(type==1)
        {
            cin>>x>>y;
            parent[x]=y;
            ancestor[x]=y;
        //  cout<<"1"<<endl;
        }
        else if(type==2)
        {
            cin>>x;
            v1.push_back(x);
            v2.push_back(find(x));
        //  cout<<"2"<<endl;
        }
        else
        {
            cin>>x>>i;
            i--;
            cur=v1[i];
            dest=v2[i];
            flag=0;
            while(1)
            {
                if(cur==x)
                {
                    flag=1;
                    break;
                }
                if(cur==dest)
                break;
                cur=parent[cur];
            }
            if(flag)
            cout<<"YES"<<endl;
            else
            cout<<"NO"<<endl;
        //  cout<<"3"<<endl;
        }
    }
    return 0;
}

