#include <cstdio>
#include <cstring>
#include <algorithm>

using namespace std;

const int NMAX = 100005;

int root[NMAX], num[NMAX];
int f[NMAX], tt[NMAX];

int Find (int x) {
    return x == root[x] ? x : root[x] = Find(root[x]);
}

int main() {

    int n, m;
    scanf("%d%d", &n, &m);

    for (int i = 1; i <= n; ++i) {
        root[i] = num[i] = i;
    }

    int ans = 0;
    while (m--) {
        int t;
        scanf("%d", &t);

        if (t == 1) {
            int x, y;
            scanf("%d%d", &x, &y);
            num[x] = root[x] = y;
        } else if (t == 2) {
            int x;
            scanf("%d", &x);
            ++ans;
            f[ans] = x;
            tt[ans] = Find(x);
        } else if (t == 3) {

            int x, i;
            scanf("%d%d", &x, &i);

            bool temp = false;
            int k = f[i];
            if (k == x || x == tt[i]) temp = true;

            while (!temp && k != tt[i]) {
                if (k == x) {
                    temp = true;
                    break;
                } else k = num[k];
            }

            if (temp) printf("YES\n");
            else printf("NO\n");

        }

    }

    return 0;
}
