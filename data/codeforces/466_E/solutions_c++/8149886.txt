#include <cstdio>
#include <algorithm>
#include <vector>

#define SIZ 100001

using namespace std;

int n,m,c=0;
int boss[SIZ]={},in[SIZ]={},out[SIZ]={};
int fdoc[SIZ],ldoc[SIZ],d=1;
int q1[SIZ],q2[SIZ],q=0;
vector<int> emp[SIZ];
void travel(int x)
{
    in[x]=c;
    c++;
    for(int r=0;r<emp[x].size();r++)
    {
        travel(emp[x][r]);
    }
    out[x]=c;
    c++;
}
int main()
{
    int i,j,t,x,y;
    int inx,outx;
    scanf("%d %d",&n,&m);
    for(i=0;i<m;i++)
    {
        scanf("%d",&t);
        if(t==1){
            scanf("%d %d",&x,&y);
            boss[x]=y;
            emp[y].push_back(x);
        }
        else if(t==2){
            scanf("%d",&x);
            y=x;
            ldoc[d]=x;
            while(boss[y]!=0) y=boss[y];
            fdoc[d]=y;
            d++;
        }
        else if(t==3)
        {
            scanf("%d %d",&q1[q],&q2[q]);
            q++;
        }
    }
    for(i=1;i<=n;i++)
    {
        if(boss[i]==0) travel(i);
    }
    for(i=0;i<q;i++)
    {
        j=q2[i];
        inx=in[q1[i]];
        outx=out[q1[i]];
        if((inx>=in[fdoc[j]])&&(inx<=in[ldoc[j]])&&(outx<=out[fdoc[j]])&&(outx>=out[ldoc[j]]))
            printf("YES\n");
        else printf("NO\n");
    }
    return 0;
}
