#include <iostream>
#include <vector>
#include <algorithm>

using namespace std;

int boss[100005] = { }, set[100005] = { };

vector<int> s, e;

int setOf(int v)
{
	//cout << ';' << v << ' ' << set[v] << ';';
	if(set[v] == 0) return v;
	else
	{
		set[v] = setOf(set[v]);
		return set[v];
	}
}

int main()
{
	int n, m;
	cin >> n >> m;

	for(int i = 0; i < m; i++)
	{
		int t;
		cin >> t;
		if(t == 1)
		{
			int x, y;
			cin >> x >> y;
			boss[x] = y;
			set[x] = y;
		}
		else if(t == 2)
		{
			int cur;
			cin >> cur;

			s.push_back(cur);
			e.push_back(setOf(cur));
		}
		else
		{
			int x, i;
			cin >> x >> i;

			int cur = s[i - 1], end = e[i - 1];

			//cout << '=';
			while(cur != end)
			{
				//cout << cur << ' ';
				if(cur == x)
				{
					break;
				}
				cur = boss[cur];
			}

			if(cur == x)
			{
				cout << "YES\n";
			}
			else
			{
				cout << "NO\n";
			}
		}
	}
}