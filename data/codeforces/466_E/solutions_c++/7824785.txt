#include <bits/stdc++.h>

typedef long long ll;
typedef unsigned long long ull;
#define pb push_back
#define mp make_pair
#define fi first
#define se second
#define MAX(a, b) ((a) > (b) ? (a) : (b))
#define MIN(a, b) ((a) < (b) ? (a) : (b))
#define SZ(V) (int) V.size()
#define LN(V) (int) V.length()
#define ALL(V) V.begin(), V.end()
using namespace std;

int p[100010], n, m, x, y, t, P[100010];
vector <int> d, p2;

int parent (int x) {

    if (p[x] == x) return x;
    else return p[x] = parent(p[x]);
}

int main() {

    ios_base::sync_with_stdio(0);

    #ifndef ONLINE_JUDGE
            freopen("in", "r", stdin);
            freopen("out", "w", stdout);
    #endif

    cin >> n >> m;

    for (int i = 1; i <= n; i++)
        p[i] = i;

    for (int i = 1; i <= m; i++) {

        cin >> t;

        if (t == 1) {

            cin >> x >> y;

            p[x] = y;
            P[x] = y;
        } else if (t == 2) {

            cin >> x;

            d.pb(x);
            p2.pb(parent(x));
        } else {

            cin >> x >> y;

            int a = d[y - 1], b = p2[y - 1];

            while (a != b) {

                if (a == x) break;
                a = P[a];
            }

            if (a == x) cout << "YES\n";
            else cout << "NO\n";
        }
    }

    return 0;
}
