#include <iostream>
#include <iomanip>
#include <vector>
#include <cmath>
#include <algorithm>
#include <set>
#include <queue>
#include <stack>

using namespace std;
int t,x,y,mmm;
int main() {
	ios::sync_with_stdio(false);
	int n,m;
	cin >> n >> m;
	vector <int> ems(n,-1);
	vector <int> ets(n);
	vector <int> ts(m);
	vector <int> tt(m);
	int ti = 0;
	int tss = 0;
	while (m--) {
		ti++;
		cin >> t;
		if (t == 1) {
			cin >> x >> y;
			x--;
			ems[x] = y-1;
			ets[x] = ti;
		} else if (t == 2) {
			tss++;
			cin >> x;
			ts[tss] = x-1;
			tt[tss] = ti;
		} else {
			cin >> x >> mmm;
			x--;
			int time_task = tt[mmm];
			int task_holder = ts[mmm];
			if (task_holder == x) {
				cout << "YES" << endl;
			} else {
				bool found = false;
				while (ems[task_holder] != -1) {
					if (ets[task_holder] > time_task)
						break;
					task_holder = ems[task_holder];
					if (task_holder == x) {
						found = true;
						break;
					}
				}
				if (found) {
					cout << "YES" << endl;
				} else {
					cout << "NO" << endl;
				}
			}
		}
	}
	return 0;
}
