#include<iostream>
#include<cstdio>
#include<cstring>
#include<algorithm>
using namespace std;
const int maxn = 100010;
int f[maxn],s[maxn],get[maxn],nxt[maxn];
int find(int x)
{
    return f[x]=f[x]==x?x:find(f[x]);
}
int n,m,t,x,y,cur;
int main()
{
    while(cin>>n>>m)
    {
        for(int i=0;i<maxn;i++)
            f[i]=i,nxt[i]=i;
        cur=1;
        for(int i=0;i<m;i++)
        {
            cin>>t;
            if(t==1)
            {
                cin>>x>>y;
                f[x]=y,nxt[x]=y;
            }
            if(t==2)
            {
                cin>>x;
                s[cur]=find(x);
                get[cur++]=x;
            }
            if(t==3)
            {
                cin>>x>>y;
                int ed=s[y],st=get[y];
                bool flag=true;
                while(st!=ed)
                {
                    if(st==x)
                    {
                        puts("YES");
                        flag=false;
                        break;
                    }
                    st=nxt[st];
                }
                if(flag&&x==ed)
                {
                    flag=false;
                    puts("YES");
                }
                if(flag)
                    puts("NO");
            }
        }
    }
    return 0;
}
	 		   	  			 		 	 	    		  			