#include <bits/stdc++.h>
using namespace std;

#define pb push_back

const int N = 1<<17;
const int K = 320;

deque<int> a[N / K];
int c[N / K][N];

int main() {
	int n;
	scanf("%d", &n);

	for (int i = 0, x; i < n; i++) {
		scanf("%d", &x);
		a[i / K].pb(x);
		c[i / K][x]++;
	}

	int q, prev = 0;
	scanf("%d", &q);
	for (int i = 0, t, l, r, k, la, lb, ra, rb; i < q; i++) {
		scanf("%d %d %d", &t, &l, &r);
		l = (l + prev - 1) % n;
		r = (r + prev - 1) % n;
		if (l > r) swap(l, r);
		la = l / K; lb = l % K;
		ra = r / K; rb = r % K;
		if (t == 1) {
			int v = a[ra][rb];
			if (la == ra) {
				a[ra].erase(a[ra].begin() + rb);
				a[ra].insert(a[ra].begin() + lb, v);
			} else {
				a[ra].erase(a[ra].begin() + rb);
				c[ra][v]--;
				for (int p = ra; p > la; p--) {
					int x = a[p-1].back();
					a[p].push_front(x);
					c[p][x]++;
					a[p-1].pop_back();
					c[p-1][x]--;
				}
				a[la].insert(a[la].begin() + lb, v);
				c[la][v]++;
			}
		} else {
			scanf("%d", &k);
			k = (k + prev - 1) % n + 1;
			prev = 0;
			if (la == ra) {
				for (int p = lb; p <= rb; p++)
					prev += a[ra][p] == k;
			} else {
				for (int p = lb; p < K; p++)
					prev += a[la][p] == k;
				for (int p = 0; p <= rb; p++)
					prev += a[ra][p] == k;
				for (int p = la+1; p < ra; p++)
					prev += c[p][k];
			}
			printf("%d\n", prev);
		}
	}
}