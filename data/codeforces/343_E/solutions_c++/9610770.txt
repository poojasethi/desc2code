#include <cstdio>
#include <queue>
#include <algorithm>
using namespace std;
const int N=205,M=1005,inf=1e9+7;
int n,m,c[M];
struct node;
struct edge{
	node *ed;
	edge *next;
	int cap;
} E[M<<1],*newE=E;
int Flag;
struct node{
	edge *son;
	int flag;
	int depth;
} V[N];
void addedge(node *u,node *v,int c){
	*newE=(edge){v,u->son,c},u->son=newE++;
	*newE=(edge){u,v->son,c},v->son=newE++;
}
bool cmp(const node *u,const node *v){
	return u->flag>v->flag;
}
node *S,*T,*seq[N];
bool layer(node **beg,node **end){
	for(node **it=beg;it<end;it++){
		node *u=*it;
		u->depth=0;
	}
	queue<node*> q;
	S->depth=1;
	q.push(S);
	while(!q.empty()){
		node *u=q.front(); q.pop();
		for(edge *e=u->son;e;e=e->next) if(e->cap){
			node *v=e->ed;
			if(!v->depth){
				v->depth=u->depth+1;
				if(v==T) return true;
				q.push(v);
			}
		}
	}
	return false;
}
int flow(node *u,int f){
	if(u==T) return f;
	int left=f;
	for(edge *e=u->son;e&&left;e=e->next) if(e->cap&&e->ed->depth==u->depth+1){
		int tmp=flow(e->ed,min(left,e->cap));
		e->cap-=tmp;
		E[e-E^1].cap+=tmp;
		left-=tmp;
	}
	if(left==f) u->depth=0;
	return f-left;
}
void dfs(node *u){
	if(u->flag==Flag) return;
	u->flag=Flag;
	for(edge *e=u->son;e;e=e->next) if(e->cap)
		dfs(e->ed);
}
int cnt;
struct data{
	node *u,*v;
	int w;
	friend bool operator < (const data &a,const data &b){
		return a.w<b.w;
	}
} res[N];
int work(node **beg,node **end){
	S=beg[0]; T=end[-1];
	if(S==T) return 0;
	newE=E;
	for(int i=0;i<m;i++) (newE++)->cap=c[i],(newE++)->cap=c[i];
	int ans=0;
	while(layer(seq+1,seq+n+1)){
		int f;
		while(f=flow(S,inf))
			ans+=f;
	}
	Flag++;
	dfs(S);
	sort(beg,end,cmp);
	node **mid=lower_bound(beg,end,T,cmp);
	res[cnt++]=(data){S,T,ans};
	return ans+work(beg,mid)+work(mid,end);
}
edge *eee;
void dfs2(node *u,node *fa){
	for(edge *e=u->son;e;e=e->next) if(e->cap&&e->ed!=fa){
		if(!eee||e->cap<eee->cap) eee=e;
		dfs2(e->ed,u);
	}
}
void print(node *u){
	cnt=0;
	eee=NULL;
	dfs2(u,NULL);
	if(!eee){
		printf("%d ",u-V);
		return;
	}
	edge *e1=eee,*e2=E+(e1-E^1);
	e1->cap=0;
	e2->cap=0;
	print(e1->ed);
	print(e2->ed);
}
int main(){
	scanf("%d%d",&n,&m);
	for(int i=0;i<m;i++){
		int a,b; scanf("%d%d%d",&a,&b,&c[i]);
		addedge(V+a,V+b,c[i]);
	}
	for(int i=1;i<=n;i++) seq[i]=V+i;
	printf("%d\n",work(seq+1,seq+n+1));
	Flag=0;
	for(int i=1;i<=n;i++) V[i].son=NULL;
	newE=E;
	for(int i=0;i<cnt;i++)
		addedge(res[i].u,res[i].v,res[i].w);
	print(V+1);
}
