#include<algorithm>
#include<cmath>
#include<cstdio>
#include<cstdlib>
#include<cstring>
#include<ctime>
#include<deque>
#include<iterator>
#include<iostream>
#include<list>
#include<map>
#include<memory>
#include<queue>
#include<set>
#include<stack>
#include<string>
#include<vector>
#include<utility>
#include<bitset>
#define ll long long
using namespace std;

bitset<22500> mp,w,r,e;
int main(){
    int n,m,k,i,j;
    cin>>n>>m>>k;
    string s;
    for(i=0;i<n;i++)
    {   cin>>s;
        for(j=0;j<m;j++)
        {   if(s[j]=='.' || s[j]=='E') {mp.set(i*m+j);r.set(i*m+j);}
            if(s[j]=='#') w.set(i*m+j);
            if(s[j]=='E') e.set(i*m+j);
        }
    }
    char c;
    scanf("%c",&c);
    for(i=0;i<k;i++)
    {   if(r==e) break;
        scanf("%c",&c);
        if(c=='L') r=(r>>1)&mp | (w<<1)&r;
        if(c=='R') r=(r<<1)&mp | (w>>1)&r;
        if(c=='U') r=(r>>m)&mp | (w<<m)&r;
        if(c=='D') r=(r<<m)&mp | (w>>m)&r;
    }
    if(r==e) cout<<i<<endl;
    else cout<<-1;
    //system("pause");
    return 0;
}
        
