#include <cstdio>
#include <cstring>
#include <algorithm>
#include <iostream>
#include <vector>
#include <queue>
#include <cmath>
#include <set>
#include <bitset>
using namespace std;

#define N 100005

int max(int x,int y){return x>y?x:y;}
int min(int x,int y){return x<y?x:y;}
int abs(int x,int y){return x<0?-x:x;}
int n, m, q;
char map[155][155];
char s[N];

int solve(){
	int i, j, k;
	bitset<155*155>dian, qiang, e, ro;
	for(i=0;i<n;i++){
		for(j=0;j<m;j++){
			if(map[i][j]=='#') qiang.set(i*m+j);
			if(map[i][j]=='.'||map[i][j]=='E') dian.set(i*m+j);
			if(map[i][j]=='E') e.set(i*m+j);
		}
	}
	ro=dian;
	for(i=0;i<q;i++){
		if(ro==e) return i;
		if(s[i]=='U') ro=((ro>>m)&dian)|(ro&(qiang<<m));
		else if(s[i]=='D') ro=((ro<<m)&dian)|(ro&(qiang>>m));
		else if(s[i]=='L') ro=((ro>>1)&dian)|(ro&(qiang<<1));
		else ro=((ro<<1)&dian)|(ro&(qiang>>1));
		
	}
	
	if(ro==e) return q;
	return -1;
}

main()
{
	int i, j, k;
	while(scanf("%d %d %d",&n,&m,&q)==3){
		for(i=0;i<n;i++) scanf("%s",map[i]);
		scanf("%s",s);
		printf("%d\n",solve());
	}
}