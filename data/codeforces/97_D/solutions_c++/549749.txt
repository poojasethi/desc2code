#include <cctype>
#include <iostream>
#include <fstream>
#include <cmath>
#include <string>
#include <vector>
#include <algorithm>
#include <queue>
#include <set>
#include <list>
#include <deque>
#include <stack>
#include <map>
#include <utility>
#include <cstring>
#include <sstream>
#include <bitset>
#include <assert.h>
#include <iomanip>
#include <climits>
#include <cstdio>
#include <ctime>

#define DEBUG_FLAG 1
#if DEBUG_FLAG
#define DBG(z) cout << #z << " : " << (z) << "\n";
#define DBY(x,y) cout << #x << " : " << (x) <<" , "<< #y << " : "<< (y) << "\n";
#define DBZ(x,y,z) cout << #x << " : " << (x) <<" , "<< #y << " : "<< (y) << " , " << #z << " : " << (z) << "\n";
#else
#define DBG(z)
#define DBY(x,y)
#define DBZ(x,y,z)
#endif

#define mp make_pair
#define pb push_back
#define fi first
#define se second
#define ms(x,y) memset((x),(y),sizeof((x)))
#define all(c) c.begin(),c.end()
#define emp(a,i) (!((a) & (1<<(i))))
#define sh(a) (1<<(a))

#define PI 3.1415926535

using namespace std;
using namespace __gnu_cxx;

int n,m,sz;
char mat[155][155];
char k[110000];
bitset<155> final[155],a[155],b[155];

int main()
{
    scanf("%d%d%d",&n,&m,&sz);
    for(int i=0;i<n;i++)
        scanf("%s",mat[i]);
    for(int i=0;i<n;i++)    for(int j=0;j<m;j++)    if(mat[i][j]=='E')  mat[i][j]='.',final[i][j]=1;
    for(int i=0;i<n;i++)    for(int j=0;j<m;j++)    if(mat[i][j]=='.')  a[i][j]=1;  else b[i][j]=1;
    scanf("%s",k);

    //a mi se kaj moze da sum, b mi e kaj ima precki

   /* for(int i=0;i<n;i++){
            for(int j=0;j<m;j++){
                cout<<a[i][j]<<" ";
            }
            cout<<"\n";
        }
    cout<<"\n\n\n";*/

    int ans=0;
    for(;ans<sz;ans++){
        bool error=0;
        for(int i=0;i<n;i++)
            if(final[i]!=a[i]){
                error=1;
                break;
            }
        if(!error)  break;
        if(k[ans]=='R'){
            for(int i=0;i<n;i++){
                bitset<155> tmp=b[i]>>1;
                tmp&=a[i];
                a[i]^=tmp;
                a[i]<<=1;
                a[i]|=tmp;
            }
        }
        if(k[ans]=='L'){
            for(int i=0;i<n;i++){
                bitset<155> tmp=b[i]<<1;
                tmp&=a[i];
                a[i]^=tmp;
                a[i]>>=1;
                a[i]|=tmp;
            }
        }
        if(k[ans]=='D'){
            for(int i=n-1;i>0;i--)
                a[i]=a[i-1];
            a[0].reset();
            for(int i=1;i<n;i++){
                bitset<155> tmp=a[i]&b[i];
                a[i]^=tmp;
                a[i-1]|=tmp;
            }
        }
        if(k[ans]=='U'){
            for(int i=0;i<n-1;i++)
                a[i]=a[i+1];
            a[n-1].reset();
            for(int i=n-2;i>=0;i--){
                bitset<155> tmp=a[i]&b[i];
                a[i]^=tmp;
                a[i+1]|=tmp;
            }
        }
     /*   for(int i=0;i<n;i++){
            for(int j=0;j<m;j++){
                cout<<a[i][j]<<" ";
            }
            cout<<"\n";
        }
        cout<<"\n\n";*/
    }
    bool error=0;
    for(int i=0;i<n;i++)
        if(final[i]!=a[i]){
            error=1;
            break;
        }
    if(error)  ans=-1;

    printf("%d\n",ans);


    return 0;
}
/*
1 10
6 ....#...##
LLLLLL


1 10
6 #...#....#
RRRRRR

10 1
6
.
.
.
#
.
.
.
.
#
#
DDDDDD


10 1
6
#
#
.
.
.
#
.
.
.
.
UUUUUU
*/
