#include <iostream>
#include <bitset>
using namespace std;
int n,m,k;
string st;
int main()
{
	int i,j;
	bitset<23005> a,b,c,e;
	cin>>n>>m>>k;
	for (i=0;i<n;i=i+1)
	{
		cin>>st;
		for (j=0;j<m;j=j+1)
		{
			if (st[j]=='#') b.set(i*m+j);else a.set(i*m+j);
			if (st[j]=='E') e.set(i*m+j);
		}
	}
	cin>>st;
	c=a;
	for (i=0;i<k;i=i+1)
	{
		if (c==e) {cout<<i<<endl;return 0;}  
        if (st[i]=='U') c=((c>>m)&a)|(c&(b<<m));
        if (st[i]=='D') c=((c<<m)&a)|(c&(b>>m));
        if (st[i]=='L') c=((c>>1)&a)|(c&(b<<1));
        if (st[i]=='R') c=((c<<1)&a)|(c&(b>>1));
	}
	if (c==e) cout<<i<<endl;else cout<<-1<<endl;
	return 0;
}
