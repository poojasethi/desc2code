#include <cstdio>
#include <cstring>
#include <bitset>
#include <iostream>

using namespace std;

char str[100100];

#define SIZE 151

int main(){
    //freopen("in.txt","r",stdin);
    int row,col,len;
    while( scanf("%d %d %d",&row,&col,&len) ==3 ){
        bitset<SIZE*SIZE> final,now,noObs,obs;

        for (int i=0;i<row;++i){
            scanf("%s",str);
            //printf("%s\n",str);
            for (int j=0;j<col;++j){
                //printf("%d %d ",j,i);
                if ( str[j]=='E' ){
                    final.set(i*col+j);
                    //printf("%d\n",i*row+j);
                    //cout<<final<<endl;
                }

                if ( str[j]!='#' ){
                    noObs.set(i*col+j);
                }else{
                    obs.set(i*col+j);
                    //printf("%d",i*row+j);
                }
            }
            //printf("\n");
        }
        scanf("%s",str);
        now=noObs;
        if ( now==final ){
            printf("0\n");
            continue;
        }
        //cout<<obs<<endl;
        int ans= -1 ;
        for (int i=0;i<len;++i){
            //cout<<now<<' '<<obs<<endl;
            if ( str[i]=='R' ){
                now = (now<<1 & noObs ) | ( now & obs>>1 ) ;
            }else if ( str[i]=='L' ){
                now = (now>>1 & noObs ) | ( now & obs<<1 ) ;
            }else if ( str[i]=='D' ){
                now = (now<<col & noObs ) | ( now & obs>>col ) ;
            }else if ( str[i]=='U' ){
                now = (now>>col & noObs ) | ( now & obs<<col ) ;
            }

            if ( now==final ){
                ans=i+1;
                break;
            }
        }

        printf("%d\n",ans);
    }
    return 0;
}

	 	 	 		   			  	 			 				