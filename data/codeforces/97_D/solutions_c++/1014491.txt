//97D Hewr
#include <iostream>
#include <cstdio>
#include <cstring>
#include <cstdlib>
#include <cmath>
#include <algorithm>
#include <vector>
#include <queue>
#include <iomanip>
#include <set>
#include <map>
#include <bitset>
using namespace std;
#define fo(i,a,b) for (int i = a; i <= b; ++i)
#define fd(i,a,b) for (int i = a; i >= b; --i)
#define fe(i,x) for (int i = g[x], y = E[i].y; i; i = E[i].l, y = E[i].y)
#define forall(i, x) for (typeof((x).begin()) i = (x).begin(); i != (x).end(); ++i)
#define pb push_back
#define SIZE(x) ((int) (x).size())
#define MP make_pair
#define fi first
#define se second
#define UNIQUE(x) x.resize(unique(x.begin(), x.end()) - x.begin())
#define clr(a,x) memset(&a, x, sizeof(a))
#define move(a,b) memcpy(&b, &a, sizeof(a))
#define Plus(a,b) (((LL) (a) + (b)) % mo)
#define Minus(a,b) ((((LL) (a) - (b) ) % mo + mo) % mo)
#define Mul(a,b) ((LL) (a) * (b) % mo)
#define updmin(a,b) (a = min(a, b))
#define updmax(a,b) (a = max(a, b))
#define sqr(x) ((x) * (x))

typedef long long LL;
typedef long double LD;
typedef pair<int, int> PII;
typedef vector<int> VI;

const double eps = 1e-10;
const int oo = ~0u >> 2, mo = (int) 1e9 + 7;
const int mn = 160, mm = sqr(mn);

bitset<mm> a, b, c, d;
int n, m, k;
char ch;

int main(){
    scanf("%d%d%d", &n, &m, &k);
    fo (i, 0, n - 1) fo (j, 0, m - 1){
        do { scanf("%c", &ch); } while (ch != '#' && ch != 'E' && ch != '.');
        (ch != '#' ? a : b).set(i * m + j);
        if (ch == 'E') d.set(i * m + j);
    }
    c = a;
    if (c == d){
        printf("0\n");
        return 0;
    }
    fo (i, 1, k){
        do { scanf("%c", &ch); } while (ch != 'U' && ch != 'L' && ch != 'R' && ch != 'D');
        if (ch == 'U') c = ((c >> m) & a) | (c & (b << m)); else
        if (ch == 'L') c = ((c >> 1) & a) | (c & (b << 1)); else
        if (ch == 'R') c = ((c << 1) & a) | (c & (b >> 1)); else
        if (ch == 'D') c = ((c << m) & a) | (c & (b >> m));
        if (c == d){
            printf("%d\n", i);
            return 0;
        }
    }
    printf("-1\n");
}
