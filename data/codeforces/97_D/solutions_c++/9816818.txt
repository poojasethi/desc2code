#include <map>
#include <set>
#include <list>
#include <ctime>
#include <cmath>
#include <queue>
#include <stack>
#include <bitset>
#include <vector>
#include <cstdio>
#include <string>
#include <cstring>
#include <sstream>
#include <iomanip>
#include <cstdlib>
#include <iostream>
#include <algorithm>
using namespace std;
bitset<22505> a,b,c,d;
int main ( ) {
	int n,m,k,i,j;
	string x;
	scanf("%d%d%d",&n,&m,&k);
	for (i=0;i<n;i++) {
		string x;
		cin>>x;
		for (j=0;j<m;j++) {
			if (x[j]=='#') b.set(i*m+j); else a.set(i*m+j);
			if (x[j]=='E') c.set(i*m+j);
		}
	}
	cin>>x;
	d=a;
    for (i=0;i<k;i++) {
        if (c==d) {printf("%d\n",i);return 0;}
        if (x[i]=='D') d=((d<<m)&a)|(d&(b>>m));
        if (x[i]=='U') d=((d>>m)&a)|(d&(b<<m));
        if (x[i]=='R') d=((d<<1)&a)|(d&(b>>1));
        if (x[i]=='L') d=((d>>1)&a)|(d&(b<<1));
    }
	if (c==d) printf("%d\n",k); else puts("-1");
    return 0;
}
/*
Sample test(s)

Input

5 5 7
#####
#...#
#...#
#E..#
#####
UULLDDR

Output

6

Input

5 5 7
#####
#.#.#
#...#
#E..#
#####
UULLDDR

Output

-1

Input

5 3 2
###
#.#
#.#
#E#
###
DD

Output

2
*/
