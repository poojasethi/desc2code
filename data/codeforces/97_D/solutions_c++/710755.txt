#include <map>
#include <set>
#include <cmath>
#include <stack>
#include <queue>
#include <string>
#include <vector>
#include <fstream>
#include <sstream>
#include <bitset>
#include <stdio.h>
#include <ctype.h>
#include <string.h>
#include <iostream>
#include <algorithm>
using namespace std;
#define li       	long long int
#define rep(i,to)	for(li i=0;i<((li)(to));i++)
#define pb       	push_back
#define sz(v)    	((li)v.size())
#define bit(n)   	(1ll<<(li)(n))


#define MAX 155
bitset<MAX> mp[MAX];
bitset<MAX> goal[MAX];
bitset<MAX> pos[MAX];
bitset<MAX> next[MAX];
string str[MAX];
string inst;

void check(li cnt){
	rep(i,MAX)if(goal[i]!=pos[i]) return;
	cout<<cnt<<endl;
	exit(0);
}

int main(){
	li n,m,k;
	cin>>n>>m>>k;
	rep(i,n) cin>>str[i];
	rep(i,n) mp[i].reset();
	rep(i,n) goal[i].reset();
	rep(i,n) pos[i].reset();
	rep(i,n)rep(j,m)if(str[i][j]=='#') mp[i][j]=1;
	rep(i,n)rep(j,m)if(str[i][j]=='E') goal[i][j]=pos[i][j]=1;
	rep(i,n)rep(j,m)if(str[i][j]=='.') pos[i][j]=1;
	cin>>inst;
	li cnt=0;
	while(true){
		check(cnt);
		if(cnt==sz(inst)) break;
		rep(i,MAX) next[i].reset();
		if(inst[cnt]=='U'){
			rep(i,n){
				mp[i].flip();
				next[i]|=pos[i+1]&mp[i];
				mp[i].flip();
				if(i) next[i]|=pos[i]&mp[i-1];
			}
		}else if(inst[cnt]=='D'){
			rep(i,n){
				mp[i].flip();
				if(i) next[i]|=pos[i-1]&mp[i];
				mp[i].flip();
				next[i]|=pos[i]&mp[i+1];
			}
		}else if(inst[cnt]=='L'){
			rep(i,n){
				next[i]|=(pos[i]>>1)&mp[i];
				next[i]=next[i]<<1;
				mp[i].flip();
				next[i]|=(pos[i]>>1)&mp[i];
				mp[i].flip();
			}
		}else{
			rep(i,n){
				next[i]|=(pos[i]<<1)&mp[i];
				next[i]=next[i]>>1;
				mp[i].flip();
				next[i]|=(pos[i]<<1)&mp[i];
				mp[i].flip();
			}
		}
		rep(i,MAX) pos[i]=next[i];
		cnt++;
	}
	cout<<-1<<endl;
}		
