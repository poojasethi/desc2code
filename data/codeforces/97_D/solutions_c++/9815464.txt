#include<iostream>
#include<algorithm>
#include<bitset>
#include<cstring>
#include<string>
using namespace std;
int n,m,k;
string str;
bitset<100005>ok,notok,work;
bitset<100005>end;
int main()
{
    cin>>n>>m>>k;
    for(int i=0;i<n;i++)
    {
        cin>>str;
        for(int j=0;j<m;j++)
        {
            if(str[j]=='#')
            {
                notok.set(m*i+j);
            }
            else
            {
                ok.set(m*i+j);
            }
            if(str[j]=='E')
            {
                end.set(i*m+j);
            }
        }
    }
    cin>>str;
    work=ok;
    int i;
    for(i=0;i<k;i++)
    {
        if(work==end)
        {
            cout<<i<<endl;
            return 0;
        }
        if(str[i]=='U')work=((work>>m)&ok)|(work&(notok<<m));
        if(str[i]=='L')work=((work>>1)&ok)|(work&(notok<<1));
        if(str[i]=='D')work=((work<<m)&ok)|(work&(notok>>m));
        if(str[i]=='R')work=((work<<1)&ok)|(work&(notok>>1));
    }
    if(work==end)cout<<k<<endl;
    else cout<<-1<<endl;
    return 0;
}