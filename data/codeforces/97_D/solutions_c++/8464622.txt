#include<iostream>
#include<algorithm>
#include<cstdio>
#include<cmath>
#include<cstring>
#include<bitset>
using namespace std;
bitset<22500>a,b,c,e;
int n,m,k;
char str[101000];
int main(){
    scanf("%d%d%d",&n,&m,&k);
    for(int i=0;i<n;i++){
      scanf("%s",str);
      for(int j=0;j<m;j++)
        if(str[j]=='#')b.set(i*m+j);
        else{
          a.set(i*m+j);
          if(str[j]=='E')e.set(i*m+j);
        }
      }
    c=a;
    scanf("%s",str);
    for(int i=0;i<k;i++){
      if(c==e){printf("%d\n",i);return 0;}
      if(str[i]=='L')c=((c>>1)&a)|((b<<1)&c);
      if(str[i]=='R')c=((c<<1)&a)|((b>>1)&c);
      if(str[i]=='U')c=((c>>m)&a)|((b<<m)&c);
      if(str[i]=='D')c=((c<<m)&a)|((b>>m)&c);
      }
    if(c==e)printf("%d\n",k);
    else printf("-1\n");
    return 0;
}
