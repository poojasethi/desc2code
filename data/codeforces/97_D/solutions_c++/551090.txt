#include <cstdio>
#include <bitset>
using namespace std;
int main()
{
    int n,m,k;
    scanf("%d%d%d",&n,&m,&k);
    bitset<150*150> curr,mask,wall,dest;
    for(int i=0;i<n;i++)
    {
        char str[1024];
        scanf("%s",str);
        for(int j=0;j<m;j++)
        {
            if(str[j]!='#') mask.set(j+i*150); else wall.set(j+i*150);
            if(str[j]=='E') dest.set(j+i*150);
        }
    }
    curr=mask;
    static char cmd[110000];
    scanf("%s",cmd);
    int ans=0;
    while(true)
    {
        if(curr==dest)
        {
            printf("%d\n",ans);
            break;
        }
        if(cmd[ans]==0)
        {
            puts("-1");
            break;
        }
        switch(cmd[ans])
        {
            case 'L':
            curr=(curr>>1)|((wall<<1)&curr);
            break;
            case 'R':
            curr=(curr<<1)|((wall>>1)&curr);
            break;
            case 'U':
            curr=(curr>>150)|((wall<<150)&curr);
            break;
            case 'D':
            curr=(curr<<150)|((wall>>150)&curr);
            break;
        }
        curr&=mask;
        ans++;
    }
    return 0;
}
