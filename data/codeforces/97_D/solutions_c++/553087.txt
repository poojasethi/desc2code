#include <map>
#include <set>
#include <cmath>
#include <stack>
#include <queue>
#include <string>
#include <vector>
#include <bitset>
#include <fstream>
#include <sstream>
#include <stdio.h>
#include <string.h>
#include <iostream>
#include <algorithm>
using namespace std;
#define li		long long
#define rep(i,to)	for(li i=0;i<((li)to);i++)
#define pb		push_back
#define sz(v)		((li)v.size())

#define MAX 155
int main(){
	bitset<MAX*MAX> goal,mask,wall,now;
	li n,m,k;
	cin>>n>>m>>k;
	rep(i,n){
		string str;
		cin>>str;
		rep(j,m){
			((str[j]=='#')?wall:mask).set(i*MAX+j);
			if(str[j]=='E') goal.set(i*MAX+j);
		}
	}
	string ins;
	cin>>ins;
	now=mask;
	rep(i,sz(ins)){
		if(now==goal){
			cout<<i<<endl;
			return 0;
		}
		if(ins[i]=='U')	now=((now>>MAX)&mask)|(now&(wall<<MAX));
		else if(ins[i]=='D') now=((now<<MAX)&mask)|(now&(wall>>MAX));
		else if(ins[i]=='R') now=((now<<1)&mask)|(now&(wall>>1));
		else if(ins[i]=='L') now=((now>>1)&mask)|(now&(wall<<1));
		else cout<<"error inst"<<endl;
	}
	if(now==goal) cout<<sz(ins)<<endl;
	else cout<<"-1"<<endl;
}
