#include <cstdio>
#include <map>
using namespace std;
#define SZ 100010
typedef long long ll;
int par[SZ];
int get(int a){return par[a]==a ? a : par[a]=get(par[a]);}
int merge(int a,int b){
  a=get(a); b=get(b);
  if(a!=b)par[a]=b;
}
int n,m,mod;
map<int,int> cnt;
int main(){
  for(int i=0;i<SZ;++i)par[i]=i;
  scanf("%d%d%d",&n,&m,&mod);
  for(int i=0;i<m;++i){
   int f,t; scanf("%d%d",&f,&t);
   merge(f,t);
                      }
  for(int i=1;i<=n;++i)++cnt[get(i)];
  int ans=1 , step=cnt.size()-2;
  if(cnt.size()>1){
   for(;step;step>>=1 , n=(n*1LL*n)%mod)
    if(step&1)ans=(ans*1LL*n)%mod;
   for(map<int,int>::iterator it=cnt.begin();it!=cnt.end();++it)
    ans=(ans*1LL*it->second)%mod;
                  }
  printf("%d\n" , ans%mod);
  return 0;
}
