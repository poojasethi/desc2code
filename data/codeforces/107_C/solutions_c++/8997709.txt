#include <cstdio>
typedef long long ll;
const int N=16;
int n;
ll k;
int m;
int used[N],lim[N],ans[N],loc[N],cnt[1<<N];
ll f[1<<N];
ll work(){
	for(int i=0;i<1<<n;i++) f[i]=0;
	f[0]=1;
	for(int i=0;i<1<<n;i++)
		for(int j=0;j<n;j++) if(!(i>>j&1)){
			int ii=i|1<<j;
			if(lim[j]&~i||used[cnt[i]]&&j!=loc[cnt[i]]) continue;
			f[ii]+=f[i];
		}
	return f[(1<<n)-1];
}
int main(){
	scanf("%d%I64d%d",&n,&k,&m);
	k-=2000;
	for(int i=0;i<1<<n;i++) cnt[i]=cnt[i>>1]+(i&1);
	while(m--){
		int a,b; scanf("%d%d",&a,&b);
		a--,b--;
		lim[b]|=1<<a;
	}
	if(k>work()) return puts("The times have changed"),0;
	for(int i=0;i<n;i++){
		for(ans[i]=0;ans[i]<n;ans[i]++) if(!used[ans[i]]){
			used[ans[i]]=1;
			loc[ans[i]]=i;
			ll tmp=work();
			if(k>tmp){
				used[ans[i]]=0;
				k-=tmp;
			}
			else
				break;
		}
		printf("%d ",ans[i]+1);
	}
}