#include <iostream>
#include <cstdio>
using namespace std;

int n, m;
long long y;

int sf[16];
long long dp[1 << 16];
int ans[16];
bool sel[16];

long long calc(int p) {
	dp[0] = 1;
	for (int mask = 1; mask < (1 << n); mask++) {
		dp[mask] = 0;
		int tot = __builtin_popcount(mask);
		tot--;
		for (int i = 0; i < n; i++) {
			if ((mask & (1 << i)) && !(mask & sf[i]) && (p < i || ans[i] == tot)) {
				dp[mask] += dp[mask & ~(1 << i)];
			}
		}
	}
	return dp[(1 << n) - 1];
}

int main() {
	cin >> n >> y >> m;
	y -= 2000;
	int a, b;
	for (int i = 0; i < m; i++) {
		cin >> a >> b;
		a--;
		b--;
		sf[a] |= (1 << b);
	}

	if (y > calc(-1)) {
		cout << "The times have changed" << endl;
		return 0;
	}

	for (int i = 0; i < n; i++) {
		for (int j = 0; j < n; j++) {
			if (sel[j]) continue;
			ans[i] = j;
			long long tot = calc(i);
			if (tot < y) {
				y -= tot;
			} else {
				sel[j] = true;
				break;
			}
		}
	}

	cout << ans[0] + 1;
	for (int i = 1; i < n; i++) {
		cout << " " << ans[i] + 1;
	}
	cout << endl;
	return 0;

}

