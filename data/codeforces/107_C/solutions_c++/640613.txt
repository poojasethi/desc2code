#include <iostream>
#include <fstream>
#include <algorithm>
#include <cassert>
#include <cctype>
#include <cmath>
#include <complex>
#include <cstdio>
#include <deque>
#include <iomanip>
#include <map>
#include <numeric>
#include <queue>
#include <set>
#include <stack>
#include <sstream>
#include <string>
#include <vector>
using namespace std;

#define INF 1e9
#define EPS 1e-9
#define iss istringstream
#define ll long long
#define rep(i,n) rep2(i,0,n)
#define rep2(i,m,n) for(int i=m;i<n;i++)
#define pi pair<int,int>
#define pb push_back
#define sz size()
#define vi vector<int>
#define vc vector
#define vs vector<string>

ll n,y,m,s[16],sn[16],dp[1<<16];

ll f(){
	fill(dp,dp+(1<<n),0);
	dp[0]=1;
	rep2(i,1,1<<n){
		int cur=-1;
		for(int j=i;j;j>>=1)cur+=j&1;
		rep(j,n)if((i&(1<<j))&&(s[j]==-1||s[j]==cur)&&!(i&sn[j]))dp[i]+=dp[i-(1<<j)];
	}
	return dp[(1<<n)-1];
}

int main(){
	cin>>n>>y>>m;
	y-=2000;
	rep(i,m){
		int a,b;
		cin>>a>>b;
		a--;b--;
		sn[a]|=1<<b;
	}
	fill(s,s+n,-1);
	for(int cur=0;cur<n;){
		s[cur]++;
		if(s[cur]==n){
			cout<<"The times have changed"<<endl;
			return 0;
		}
		ll c=f();
		if(c<y)y-=c;
		else cur++;
	}
	rep(i,n)cout<<s[i]+1<<(i<n-1?" ":"");cout<<endl;
}
