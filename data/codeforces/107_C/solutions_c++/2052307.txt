#include<cstdio>
#include<cstdlib>
#include<cstring>
#include<algorithm>
using namespace std;
int n,m,bef[16],a1,a2,ans[16],sv[16];
long long dp[1<<16],ct,x;
void cal(){
    memset(dp,0,sizeof(dp));
    dp[0] = 1;
    for(int i=0;i<(1<<n);i++){
        a1 = 0;    
        for(int j=0;j<n;j++) if(i&(1<<j)) a1++;
        for(int j=0;j<n;j++)
            if(!(i&(1<<j)) && (ans[j] == -1 || (ans[j] == a1)) && ((bef[j]&i) == bef[j]))
               dp[(1<<j)|i] += dp[i]; 
    } 
}
int main(){
    scanf("%d%I64d%d",&n,&ct,&m); ct -= 2001;
    for(int i=0;i<m;i++) scanf("%d%d",&a1,&a2), bef[a2-1] |= (1<<(a1-1));
    for(int i=0;i<n;i++) ans[i] = -1;
    for(int i=0;i<n;i++)
       for(int j=0;j<=n;j++){
           if(j == n) {printf("The times have changed\n");return 0; }
           if(sv[j]) continue;
           ans[i] = j;
           cal();
           if(dp[(1<<n)-1] > ct){
               sv[j] = 1;
               break;                
           }
           else ct -= dp[(1<<n)-1];
       }
    for(int i=0;i<n;i++) printf("%d ",ans[i]+1);
    //system("pause");
    return 0;
}
