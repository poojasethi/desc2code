#include<cstdio>
#include<cmath>
#include<iomanip>
#include<cstring>
#include<cstdlib>
#include<ctime>
#include<iostream>
#include<algorithm>
#include<vector>
#include<list>
#include<stack>
#include<queue>
#include<deque>
#include<set>
#include<map>
#include<string>
#include<bitset>
#include<functional>

using namespace std;

#define llint long long

int ans[20],at[20],g[20][70000],tt,n,m,before[20],x,y,u;
llint Y,f[20][70000];
bool use[20];

llint calc()
{
	tt++;
	g[1][0]=tt;
	f[1][0]=1;
	for(int i=1;i<=n;i++)
		for(int j=0;j<u;j++) if (g[i][j]==tt)
			for(int k=1;k<=n;k++) if (!(j&(1<<k-1)))
				if ((at[i]==0||at[i]==k)&&((j&before[k])==before[k]))
					if (g[i+1][j|(1<<k-1)]==tt)
						f[i+1][j|(1<<k-1)]+=f[i][j];
					else
						g[i+1][j|(1<<k-1)]=tt,f[i+1][j|(1<<k-1)]=f[i][j];
	return g[n+1][u-1]==tt?f[n+1][u-1]:0;
}

int main()
{
	//freopen("107C.in","r",stdin);
	
	cin>>n>>Y>>m; Y-=2000; u=1<<n;
	for(llint i=1;i<=m;i++)
	{
		cin>>x>>y;
		before[y]|=(1<<x-1);
	}
	
	if (calc()<Y)
	{
		puts("The times have changed");
		return 0;
	}
	
	for(int i=1;i<=n;i++)
		for(int j=1;j<=n;j++) if (!use[j])
		{
			ans[i]=j;
			at[j]=i;
			llint tmp=calc();
			if (Y>tmp) Y-=tmp; else
			{
				use[j]=true;
				break;
			}
			at[j]=0;
		}
	
	for(int i=1;i<n;i++) cout<<ans[i]<<' ';
	cout<<ans[n]<<endl;
	
	return 0;
}

