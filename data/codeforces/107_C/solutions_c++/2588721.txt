#include<iostream>
#include<cstdio>
#include<cmath>
#include<queue>
#include<vector>
#include<cstring>
#define MAXN 17
using namespace std;
typedef long long int ll;
ll dp[1<<MAXN],prev[MAXN],ans[MAXN];
ll n,m,k;

ll DP(ll now, ll mark) 
{
    if (now == n)return 1;
    if (dp[mark] != -1)return dp[mark];
    dp[mark] = 0;
    for (int i(0); i<n; ++i) {
        if (mark & (1<<i))continue;
        if (ans[i] != -1 && (ans[i] != now))continue;
        if ((mark & prev[i]) != prev[i])continue;
        dp[mark] += DP(now+1, mark | (1<<i));
    }
    return dp[mark];
}

int main()
{
    memset(prev,0,sizeof(prev));
    memset(ans,-1,sizeof(ans));
    memset(dp,-1,sizeof(dp));
    scanf("%I64d%I64d%I64d",&n,&m,&k);
    for (ll i(0); i<k; ++i) {
        ll a,b;
        scanf("%I64d%I64d",&a,&b);
        prev[b-1] |= (1<<(a-1));
    }
    m -= 2001;
    
    ll tt = DP(0,0);
    //cout<<tt<<endl;
    if (tt <= m) {
        cout<<"The times have changed"<<endl;
        return 0;
    }
    for (int i(0); i<n; ++i) {
        for (int j(0); j<n; ++j) {
            ans[i] = j;
            memset(dp,-1,sizeof(dp));
            tt = DP(0,0);
            if (tt > m) break;
            m -= tt;
        }
    }
    for (int i(0); i<n; ++i) {
        cout<<ans[i] + 1<<" ";
    }
    cout<<endl;
    //system("pause");
    return 0;
}