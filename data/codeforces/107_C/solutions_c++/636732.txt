#include <map>
#include <set>
#include <cmath>
#include <stack>
#include <queue>
#include <string>
#include <vector>
#include <fstream>
#include <sstream>
#include <stdio.h>
#include <string.h>
#include <iostream>
#include <algorithm>
#include <unistd.h>
#include  <sys/time.h>
using namespace std;
#define li		long long int
#define rep(i,to)	for(li i=0;i<((li)to);i++)
#define pb		push_back
#define sz(v)		((li)v.size())


#define MAX 16
li dp[MAX][1<<MAX];
li n,m,y;
li ans[MAX];
li bef[MAX];

li recur(li pos,li mask){
	if(pos==n) return 1;
	li &res=dp[pos][mask];
	if(res!=-1) return res;
	res=0;
	rep(i,n)if(ans[i]==-1 || ans[i]==pos){
		if((mask&bef[i])!=bef[i]) continue;
		if((mask>>i)&1) continue;
		res+=recur(pos+1,mask|(1<<i));
	}
	return res;
}

li rec(){
	rep(i,MAX)rep(j,1<<MAX) dp[i][j]=-1;
	return recur(0,0);
}

int main(){
	cin>>n>>y>>m;
	y-=2001;
	rep(i,MAX) bef[i]=0;
	rep(i,m){
		li a,b;
		cin>>a>>b;
		bef[b-1]|=1<<(a-1);
	}
	rep(i,MAX) ans[i]=-1;
	if(rec()<=y){ cout<<"The times have changed"<<endl; return 0; }
	li used[MAX];
	rep(i,MAX) used[i]=false;
	rep(i,n){
		rep(j,n)if(!used[j]){
			ans[i]=j;
			li tmp=rec();
			if(y<tmp){
				used[j]=true;
				break;
			}
			y-=tmp;
		}
	}
	rep(i,n) cout<<ans[i]+1<<" "; cout<<endl;
}
