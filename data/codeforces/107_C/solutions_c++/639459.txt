#include <iostream>
#define P pair <int, int>
#define ll long long
using namespace std;
const int MAX = 17;
int n, m, a, b;
int p[MAX], use[MAX], senior[MAX];
ll dp[1 << MAX], y;

ll solve(int t){
   dp[(1 << n) - 1] = 1;
   for (int i = (1 << n) - 2; i >= 0;--i){
       int k = __builtin_popcount(i);
       dp[i] = 0;
       for (int j = 0;j < n;++j){
           if ((i & (1 << j)) != 0) continue;
            if ((i & senior[j]) != senior[j]) continue;
           if (j <= t && p[j] != k) continue;
           dp[i] += dp[i ^ (1 << j)];
       }
   }
   return dp[0];
}
int main()
{
    cin >> n >> y >> m;
    y -= 2000;
    for (int i = 0;i < m;++i){
        cin >> a >> b;
        --a, --b;
        senior[b] |= (1 << a);
    }
    if (solve(-1) >= y){
        for (int i = 0;i < n;++i){
            for (int j = 0;j < n;++j){
                if (use[j]) continue;
                p[i] = j;
                ll d = solve(i);
                if (y > d) y -= d;
                else{
                     use[j] = 1;
                     break;
                } 
            }
        } 
        for (int i = 0;i < n;++i)
            cout << p[i] + 1 << " ";
        cout << endl;
    }
    else{
         cout << "The times have changed" << endl;
    } 
    
    cin >> n;
    return 0;
}
