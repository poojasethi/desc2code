#include <cstdio>
#include <cstring>
using namespace std;
#define rep(i,n) for(int i=0;i<(n);i++)
const int maxn=16,maxs=1<<maxn;
long long f[maxn+1][maxs];
int g[maxn];
int n;
int w[maxn],z[maxn];
long long gao(int p)
{
    memset(z,255,sizeof(z));
    rep(i,p) z[w[i]]=i;
    memset(f,0,sizeof(f));
    f[0][0]=1;
    rep(i,n)
    {
        rep(j,1<<n)
        {
            if(f[i][j]==0) continue;
            rep(k,n)
            {
                if(j&(1<<k)) continue;
                if(z[i]!=-1&&z[i]!=k) continue;
                if((j&g[k])!=g[k]) continue;
                f[i+1][j|(1<<k)]+=f[i][j];
            }
        }
    }
    return f[n][(1<<n)-1];
}
int main()
{
    int m;
    long long y;
    scanf("%d%I64d%d",&n,&y,&m);
    y-=2001;
    memset(g,0,sizeof(g));
    rep(i,m)
    {
        int a,b;
        scanf("%d%d",&a,&b);
        a--;
        b--;
        g[b]|=1<<a;
    }
    if(y>=gao(0))
    {
        puts("The times have changed");
        return 0;
    }
    bool u[maxn]={};
    rep(i,n)
    {
        rep(j,n)
        {
            if(u[j]) continue;
            w[i]=j;
            long long t=gao(i+1);
            if(y>=t)
            {
                y-=t;
            }
            else
            {
                u[j]=true;
                break;
            }
        }
    }
    rep(i,n)
    {
        printf("%d",w[i]+1);
        if(i==n-1) putchar('\n'); else putchar(' ');
    }
    return 0;
}
