#include <cstdio>
#include <iostream>
#include <string>
#include <algorithm>
#include <map>
#include <vector>
#include <queue>
#include <set>
#include <cstring>
using namespace std;
#define L(s) (int)(s).size()
#define rp(i,n) for(int (i)=0;(i)<(n);++(i))
#define all(x) (x).begin(),(x).end()
#define inf 1000000000
#define pii pair<int,int>
#define x first
#define y second
#define pb push_back
#define ll long long
#define mp make_pair
#define C(x) memset(x,0,sizeof(x))
#define VI vector<int>
int bef[17];
ll f[17][1<<16];
int at[17];
int n,m;
ll y;
ll cnt()
{
  memset(f,0,sizeof(f));
  f[0][0]=1;
  rp(guy,n)
      rp(mask,1<<n)
	  if (f[guy][mask])
        rp(pos, n)
          if (~mask & (1<<pos))
            {
              if (at[pos]!=-1 && at[pos]!=guy)
                continue;
              if ((mask & bef[pos]) == bef[pos])
                f[guy+1][mask | (1<<pos)]+=f[guy][mask];
            }
  return f[n][(1<<n)-1];
}
int main()
{
 // freopen("input.txt","r",stdin);
 // freopen("output.txt","w",stdout);
  cin>>n>>y>>m;
  y-=2001;
  rp(i,m)
  {
    int p,q;
    cin>>p>>q;
    --p;--q;
    bef[q]|=1<<p;
  }
  memset(at,-1,sizeof(at));
  if (cnt()<=y)
  {
    cout<<"The times have changed\n";
    return 0;
  }
  rp(i,n)
  {
    rp(j,n)
    {
      bool can=1;
      rp(k,i)
        if (at[k]==j)
          can=0;
      if (!can)
        continue;
      at[i]=j;
      ll val=cnt();
      if (val>y)
        break;
      y-=val;
    }
    if (i)
      cout<<" ";
    cout<<at[i]+1;
  }
  cout<<endl;
}
