#include<stdio.h>
using namespace std;
typedef long long LL;
LL f[17][1<<16],L,num;
int small[17],ans[17];
int n,m,x,y,i,j,k,now,all,pos;
inline void up(LL &x,LL y){
  if (x==-1||y==-1) {x=-1;return;}
  if ((x+=y)>=L) x=-1;
}
LL number(int id){
  if (id==n) return 1>=L?-1:L;
  f[0][0]=(1>=L)?-1:1;
  for (int i=0;i<n;i++)
    for (int S=0;S<(1<<n);S++)
      if (f[i][S]){
        if ((now>>i)&1){
          if ((S&small[ans[i]])==small[ans[i]])
            up(f[i+1][S|(1<<ans[i])],f[i][S]);
        }else for (int k=id;k<n;k++)
          if ((S>>k)&1^1)
            if ((S&small[k])==small[k])
              up(f[i+1][S|(1<<k)],f[i][S]);
        f[i][S]=0;
      }
  LL ret=f[n][all];f[n][all]=0;
  return ret;
}
int main(){
  scanf("%d%I64d%d",&n,&L,&m);
  all=1<<n;--all;L-=2000;
  for (i=1;i<=m;i++)
    scanf("%d%d",&x,&y),--x,--y,small[y]|=1<<x;
  num=number(0);
  if (num!=-1){
    puts("The times have changed");
    return 0;
  }now=0;
  for (i=0;i<n;i++){
    for (k=0;k<n;k++)
      if ((now>>k)&1^1){
        now^=(1<<k);ans[k]=i;
        num=number(i+1);
        if (num==-1) break;
        L-=num;now^=1<<k;
      }
    printf("%d ",k+1);
  }
}