#include <cstdio>

const int MXN = 40;

int chd[MXN][MXN];
int pos[MXN][MXN][4][50][3];

int D[4][2] = {
    {0, 1}, {0, -1}, {1, 0}, {-1, 0}
};

int main(){

    int n, b;
    scanf("%d %d" ,&n ,&b);

    for(int i = 0; i < MXN; i++){
        for(int j = 0; j < MXN; j++) chd[i][j] = -1;
    }

    for(int i = 0; i < n; i++){
        int x0, y0, x1, y1;
        scanf("%d %d %d %d" ,&x0 ,&y0 ,&x1 ,&y1);
        if(x0 == x1){
            if(y0 < y1)
                for(int j = y0; j <= y1; j++) chd[x0][j] = 0;
            else
                for(int j = y0; j >= y1; j--) chd[x0][j] = 1;
        }
        else{
            if(x0 < x1)
                for(int j = x0; j <= x1; j++) chd[j][y0] = 2;
            else
                for(int j = x0; j >= x1; j--) chd[j][y0] = 3;
        }
    }

    for(int i = 0; i <= b; i++){
        for(int j = 0; j <= b; j++){
            for(int d = 0; d < 4; d++){
                int ni = i + D[chd[i][j] == -1? d: chd[i][j]][0];
                int nj = j + D[chd[i][j] == -1? d: chd[i][j]][1];
                pos[i][j][d][0][0] = ni;
                pos[i][j][d][0][1] = nj;
                pos[i][j][d][0][2] = chd[i][j] == -1? d: chd[i][j];
            }
        }
    }

    for(int t = 1; t < 50; t++){

        for(int i = 0; i <= b; i++){
            for(int j = 0; j <= b; j++){
                for(int d = 0; d < 4; d++){

                    int *ptr = pos[i][j][d][t - 1];
                    int ni = ptr[0], nj = ptr[1], dir = ptr[2];

                    if(ni < 0 || ni > b || nj < 0 || nj > b){
                        pos[i][j][d][t][0] = ni;
                        pos[i][j][d][t][1] = nj;
                        pos[i][j][d][t][2] = dir;
                    }
                    else{
                        ptr = pos[ni][nj][chd[ni][nj] == -1? dir: chd[ni][nj]][t - 1];
                        pos[i][j][d][t][0] = ptr[0];
                        pos[i][j][d][t][1] = ptr[1];
                        pos[i][j][d][t][2] = ptr[2];
                    }
                }
            }
        }

    }

    int q;
    scanf("%d" ,&q);

    while(q--){

        char c;
        int x, y, d;
        long long t;
        scanf("%d %d %c %lld" ,&x ,&y ,&c ,&t);
        d = c == 'U'? 0: c == 'D'? 1: c == 'R'? 2: 3;

        for(int u = 49; u >= 0 && t && x >= 0 && x <= b && y >= 0 && y <= b; u--){
            if(t & (1LL << u)){
                t -= (1LL << u);
                int *ptr = pos[x][y][d][u];
                x = ptr[0];
                y = ptr[1];
                d = ptr[2];
            }
        }

        //printf("-- %d %d %d\n" ,x ,y ,d);
        if(x < 0 || x > b || y < 0 || y > b){
            x -= D[d][0];
            y -= D[d][1];
        }
        printf("%d %d\n" ,x ,y);

    }

}
