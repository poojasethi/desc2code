#include <cstdio>
#include <cstring>
#include <iostream>
#include <cmath>
#include <ctime>
#include <cstdlib>
#include <map>
#include <set>
#include <algorithm>
#include <queue>
#include <deque>
#include <bitset>
#include <string>
#include <vector>
#include <sstream>
#define zero(a) (abs(a)<eps)
#define lowbit(a) ((a)&(-(a)))
#define abs(a) ((a)>0?(a):(-(a)))
#define dj(x1,y1,x2,y2) ((x1)*(x2)+(y1)*(y2))
#define cj(x1,y1,x2,y2) ((x1)*(y2)-(x2)*(y1))
#define dis(x1,y1,x2,y2) (((x2)-(x1))*((x2)-(x1))+((y2)-(y1))*((y2)-(y1)))
const double eps = 1e-9;
const double pi = acos(-1);
const int oo = 1000000000;
const int mod = 1000000007;
const double E = 2.7182818284590452353602874713527;
using namespace std;

int m[1005][1005],f[26][4100001];

int main()
{
   int n,b,q;
   cin>>n>>b;
   for (int i=1;i<=n;i++)
   {
      int x1,y1,x2,y2;
      scanf("%d%d%d%d",&x1,&y1,&x2,&y2);
      if (x1==x2)
         for (int j=min(y1,y2);j<=max(y1,y2);j++)
            m[x1][j]=3+(y1<y2);
      else
         for (int j=min(x1,x2);j<=max(x1,x2);j++)
            m[j][y1]=1+(x1<x2);
   }
   for (int i=0;i<=b;i++)
      for (int j=0;j<=b;j++)
         for (int t=1;t<=4;t++)
         {
            int x=i,y=j,z;
            if (m[i][j])
               z=m[i][j];
            else
               z=t;
            if (z==1)
               x=max(i-1,0);
            else if (z==2)
               x=min(i+1,b);
            else if (z==3)
               y=max(j-1,0);
            else
               y=min(j+1,b);
            f[0][(t-1)*(b+1)*(b+1)+i*(b+1)+j+1]=(z-1)*(b+1)*(b+1)+x*(b+1)+y+1;
         }
   for (int i=1;i<=25;i++)
      for (int j=1;j<=(b+1)*(b+1)*4;j++)
         f[i][j]=f[i-1][f[i-1][f[i-1][f[i-1][j]]]];
   cin>>q;
   while (q--)
   {
      int x,y,z,p,ax,ay;
      long long t;
      char c;
      scanf("%d%d %c%I64d",&x,&y,&c,&t);
      if (c=='L')
         z=1;
      else if (c=='R')
         z=2;
      else if (c=='D')
         z=3;
      else
         z=4;
      p=(z-1)*(b+1)*(b+1)+x*(b+1)+y+1;
      for (int i=25;i>=0;i--)
         while (t>=(1LL<<(2*i)))
         {
            t-=(1LL<<(2*i));
            p=f[i][p];
         }
      ax=(p-1)%((b+1)*(b+1))/(b+1);
      ay=(p-1)%((b+1)*(b+1))%(b+1);
      printf("%d %d\n",ax,ay);
   }
   return 0;
}
