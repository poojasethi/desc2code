#include <cstdio>
#include <cstring>
#include <algorithm>
#include <vector>
using namespace std;

#define maxn 501010
#define LL long long

int uf[maxn],mf[maxn],lc[maxn],su[maxn],sm[maxn];
LL tot[maxn];
int dl[maxn],n,m;
vector<pair<int, LL> >add[maxn];
vector<int>uv[maxn],mv[maxn];
LL ans[maxn];
void upd(int u,int i)
{
   int tmp;
   if (dl[mf[u]]>=lc[u]) 
      ans[u] = 0;
   tmp=max(dl[mf[u]],lc[u]);
   long long f=0;
   int idx=lower_bound(add[uf[u]].begin(),add[uf[u]].end(),make_pair(tmp,f))-add[uf[u]].begin();
   if(idx>0)
       idx--;
   ans[u]+=add[uf[u]][add[uf[u]].size()-1].second-add[uf[u]][idx].second;
   lc[u]=i;
}
int main()
{
    int i,j,x,y,u,v;
    while (scanf("%d %d",&n,&m)!=EOF)
    {
        for (i=1;i<=n;i++)
        {
            su[i]=sm[i]=1;
            uf[i]=mf[i]=i;
            lc[i]=tot[i]=0;
            dl[i]=-1;
            uv[i].clear();
            uv[i].push_back(i);
            mv[i].clear();
            mv[i].push_back(i);
            add[i].clear();
            add[i].push_back(make_pair(0,0));
        }
        char cmd[100];
        for (i=1;i<=m;i++)
        {
            scanf("%s",cmd);
            if (cmd[0]=='U')
            {
                scanf("%d %d",&x,&y);
                int fx=uf[x];
                int fy=uf[y];
                if (su[fx]<su[fy])
                    swap(fx,fy);
                for(j=0;j<uv[fy].size();j++)
                {
                    upd(uv[fy][j],i);
                    uv[fx].push_back(uv[fy][j]);
                    uf[uv[fy][j]]=fx;
                }
                su[fx]+=su[fy];
            }
            else if (cmd[0]=='M')
            {
                scanf("%d %d",&x,&y);
                int fx=mf[x];
                int fy=mf[y];
                if (sm[fx]<sm[fy])
                    swap(fx,fy);
                for(j=0;j<mv[fy].size();j++)
                {
                    upd(mv[fy][j],i);
                    mv[fx].push_back(mv[fy][j]);
                    mf[mv[fy][j]]=fx;
                }
                sm[fx]+=sm[fy];
            }
            else if (cmd[0]=='A')
            {
                scanf("%d",&x);
                int fx=uf[x];
                add[fx].push_back(make_pair(i,(LL)tot[fx]+su[fx]));
                tot[fx]+=su[fx];
            }
            else if (cmd[0]=='Z')
            {
                scanf("%d",&x);
                int fx=mf[x];
                dl[fx]=i;
            }
            else
            {
                scanf("%d",&x);
                upd(x,i);
                printf("%I64d\n",ans[x]);
            }
        }
    }
    return 0;
}
