#include<cstdio>
#define rep(i,n) for(int i=0;i<n;i++)
#define For(i,n) for(int i=1;i<=n;i++)
#define ForD(i,n) for(int i=n;i;i--)
#define FOR(i,a,b) for(int i=a;i<=b;i++)
#define N 200010
int n,m,ans,a[N],b[N],p[N],pa[N],pb[N],l[N],r[N],pre[N],suc[N];
inline bool cmp(int s[N],int x,int y)
{
	return (!pre[x]||s[y]>s[y-x+pre[x]])&&(!suc[x]||s[y]<s[y-x+suc[x]]);
}
int main()
{
	scanf("%d%d",&n,&m);
	For(i,n) {scanf("%d",&pa[i]);a[pa[i]]=i;}
	For(i,m) {scanf("%d",&pb[i]);b[pb[i]]=i;}
	For(i,n) {l[i]=i-1;r[i]=i+1;}
	ForD(i,n)
	{
		pre[i]=pa[l[a[i]]];suc[i]=pa[r[a[i]]];
		r[l[a[i]]]=r[a[i]];
		l[r[a[i]]]=l[a[i]];
	}
	int k=p[1]=0;
	FOR(i,2,n)
	{
		while (k && !cmp(a,k+1,i))k=p[k];
		p[i]=++k;
	}
	k=0;
	For(i,m)
	{
		while (k && !cmp(b,k+1,i)) k=p[k];
		k++;
		if (k==n)
		{
			ans++;
			k=p[k];
		}

	}
	printf("%d",ans);
	return 0;
}
