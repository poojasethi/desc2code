#include <cstdio>
#define rep(i,n) for (int i=0;i<n;i++)
int n,m,t,j,ans,p[210000],a[210000],x[210000],y[210000],b[210000],l[210000],r[210000],f[210000];
bool mch(int* b,int i,int j) {
	if (x[i]!=-1 && b[j]<b[j-x[i]]) return 0;
	if (y[i]!=-1 && b[j]>b[j-y[i]]) return 0;
	return 1;
}
int main() {
	scanf("%d%d",&n,&m);
	rep(i,n) scanf("%d",&p[i]),a[--p[i]]=i;
	rep(i,m) scanf("%d",&t),b[t-1]=i;
	rep(i,n) l[i]=i-1,r[i]=i+1,x[i]=y[i]=-1;
	for (int i=n-1;i>=0;i--) {
		if (l[a[i]]!=-1) x[i]=i-p[l[a[i]]],r[l[a[i]]]=r[a[i]];
		if (r[a[i]]!=n) y[i]=i-p[r[a[i]]],l[r[a[i]]]=l[a[i]];
	}
	f[0]=-1;j=-1;
	for (int i=1;i<n;i++) { while (j!=-1 && !mch(a,j+1,i)) j=f[j];if (mch(a,j+1,i)) j++;f[i]=j;}
	j=-1;
	for (int i=0;i<m;i++) { while (j!=-1 && !mch(b,j+1,i)) j=f[j];if (mch(b,j+1,i)) j++;
		if (j==n-1) ans++,j=f[j];}
	printf("%d\n",ans);
}