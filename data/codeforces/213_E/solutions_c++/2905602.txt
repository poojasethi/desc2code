#include<iostream>
#include<cstdio>
#include<cstring>
#include<algorithm>
using namespace std;
const int u=200002;
int A[u],B[u],a[u],b[u],p[u],l[u],r[u],pr[u],ba[u],n,m,i,j,ans;
bool cmp(int *a,int i,int j)
{
	return !(pr[j]&&a[i]<a[i-j+pr[j]]||ba[j]&&a[i]>a[i-j+ba[j]]);
}
int main()
{
	cin>>n>>m;
	for(i=1;i<=n;i++) scanf("%d",&A[i]),a[A[i]]=i,l[i]=i-1,r[i]=i+1;
	for(i=1;i<=m;i++) scanf("%d",&B[i]),b[B[i]]=i;
	for(i=n;i;i--) j=a[i],pr[i]=A[l[j]],ba[i]=A[r[j]],l[r[j]]=l[j],r[l[j]]=r[j];
	for(i=2,j=0;i<=n;i++)
	{
		while(j&&!cmp(a,i,j+1)) j=p[j];
		p[i]=(j+=cmp(a,i,j+1));
	}
	for(i=1,j=0;i<=m;i++)
	{
		while(j&&!cmp(b,i,j+1)) j=p[j];
		if((j+=cmp(b,i,j+1))==n) j=p[j],ans++;
	}
	cout<<ans<<endl;
	return 0;
}