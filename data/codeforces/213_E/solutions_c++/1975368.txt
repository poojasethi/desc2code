#include<cstdio>
#include<iostream>
const int maxn=200010;
int N,M;
int ra[maxn],rb[maxn],a[maxn],b[maxn];
int prev[maxn],next[maxn],pre[maxn],suc[maxn];
int fail[maxn];
bool cmp(int *b,int p,int i){
    return (pre[p]==0||b[i-p+pre[p]]<b[i])&&(suc[p]==0||b[i-p+suc[p]]>b[i]);
}
int main()
{
    int i,p,ans;
    scanf("%d%d",&N,&M);
    for(i=1;i<=N;i++)scanf("%d",ra+i);
    for(i=1;i<=M;i++)scanf("%d",rb+i);
    for(i=1;i<=N;i++)a[ra[i]]=i;
    for(i=1;i<=M;i++)b[rb[i]]=i;
    for(i=0;i<=N;i++)prev[next[i]=i+1]=i;
    for(i=N;i;i--){
        pre[i]=ra[prev[a[i]]];suc[i]=ra[next[a[i]]];
        prev[next[a[i]]]=prev[a[i]];next[prev[a[i]]]=next[a[i]];
    }
    fail[1]=p=0;
    for(i=2;i<=N;i++){
        while(p&&!cmp(a,p+1,i))p=fail[p];
        fail[i]=(p+=cmp(a,p+1,i));
    }
    ans=p=0;
    for(i=1;i<=M;i++){
        while(p&&!cmp(b,p+1,i))p=fail[p];
        if((p+=cmp(b,p+1,i))==N)ans++,p=fail[p];
    }
    printf("%d\n",ans);
    //system("pause");
    return 0;
    
}
