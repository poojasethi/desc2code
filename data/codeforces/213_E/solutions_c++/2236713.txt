#include<cstdio>
#define fo(i,a,b) for(i=a;i<=b;++i)
#define fd(i,a,b) for(i=a;i>=b;--i)
const int mn=2010000;
int n,m,i,j,ans;
int sa[mn],a[mn],b[mn];
int pre[mn],suc[mn],fail[mn],x[mn],y[mn];
char ch;
void get(int&v)
{
    for(ch=getchar();ch<'0'||ch>'9';ch=getchar());
    v=ch-48;
    for(ch=getchar();ch>='0'&&ch<='9';ch=getchar())v=v*10+ch-48;
}
bool cmp(int *a,int l,int i)
{
    if(x[l]&&a[i]<a[i-x[l]])return 0;
    if(y[l]&&a[i]>a[i-y[l]])return 0;
    return 1;
}
int main()
{
    get(n),get(m);
    fo(i,1,n)get(sa[i]),a[sa[i]]=i;
    fo(i,1,m)get(j),b[j]=i;
    fo(i,0,n)suc[pre[i+1]=i]=i+1;
    fd(i,n,1)
    {
        j=a[i];
        x[i]=pre[j]!=0?i-sa[pre[j]]:0;
        y[i]=suc[j]!=n+1?i-sa[suc[j]]:0;
        pre[suc[j]]=pre[j],suc[pre[j]]=suc[j];
    }
    j=0;
    fo(i,2,n)
    {
        for(;j&&!cmp(a,j+1,i);j=fail[j]);
        if(cmp(a,j+1,i))++j;
        fail[i]=j;
    }
    j=0;
    fo(i,1,m)
    {
        for(;j&&!cmp(b,j+1,i);j=fail[j]);
        if(cmp(b,j+1,i))++j;
        if(j==n)++ans,j=fail[j];
    }
    printf("%d\n",ans);
    return 0;
}