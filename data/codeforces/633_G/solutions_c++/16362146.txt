#include<cstdio>
#include<bitset>
using namespace std;
const int N=100010;
typedef bitset<1003>B;
int n,m,q,i,j,op,x,y,a[N],g[N],v[N<<1],nxt[N<<1],ed,st[N],en[N],dfn,seq[N];
B T[262145],now,pr;
int tag[300000];
inline void add(int x,int y){v[++ed]=y;nxt[ed]=g[x];g[x]=ed;}
void dfs(int x,int y){
  st[x]=++dfn;
  seq[dfn]=a[x]%m;
  for(int i=g[x];i;i=nxt[i])if(v[i]!=y)dfs(v[i],x);
  en[x]=dfn;
}
inline void add1(int x,int p){
  (tag[x]+=p)%=m;
  T[x]=(T[x]<<p)|(T[x]>>(m-p));
}
inline void pb(int x){if(tag[x])add1(x<<1,tag[x]),add1(x<<1|1,tag[x]),tag[x]=0;}
inline void up(int x){T[x]=T[x<<1]|T[x<<1|1];}
void build(int x,int a,int b){
  if(a==b){
    T[x][seq[a]]=1;
    return;
  }
  int mid=(a+b)>>1;
  build(x<<1,a,mid),build(x<<1|1,mid+1,b),up(x);
}
void change(int x,int a,int b,int c,int d,int p){
  if(c<=a&&b<=d){add1(x,p);return;}
  pb(x);
  int mid=(a+b)>>1;
  if(c<=mid)change(x<<1,a,mid,c,d,p);
  if(d>mid)change(x<<1|1,mid+1,b,c,d,p);
  up(x);
}
void ask(int x,int a,int b,int c,int d){
  if(c<=a&&b<=d){now|=T[x];return;}
  pb(x);
  int mid=(a+b)>>1;
  if(c<=mid)ask(x<<1,a,mid,c,d);
  if(d>mid)ask(x<<1|1,mid+1,b,c,d);
  up(x);
}
int main(){
  scanf("%d%d",&n,&m);
  for(i=2;i<m;i++){
    x=1;
    for(j=2;j<i;j++)if(i%j==0)x=0;
    if(x)pr[i]=1;
  }
  for(i=1;i<=n;i++)scanf("%d",&a[i]);
  for(i=1;i<n;i++)scanf("%d%d",&x,&y),add(x,y),add(y,x);
  dfs(1,0);
  build(1,1,n);
  scanf("%d",&q);
  while(q--){
    scanf("%d%d",&op,&x);
    if(op==1)scanf("%d",&y),change(1,1,n,st[x],en[x],y%m);
    else{
      now.reset();
      ask(1,1,n,st[x],en[x]);
      printf("%d\n",(now&pr).count());
    }
  }
  return 0;
}