#include <cstring>
#include <cstdio>
#include <iostream>
#include <cmath>
using namespace std;

long long xx,V,ans,ansx,ansy,ansz;
long long num[1000],p[1000],power[1000][1000];
int n,tests;

void update(long long x, long long y, long long z)
{
    if (x*y+y*z+x*z<ans) 
        ans=x*y+y*z+x*z,ansx=x,ansy=y,ansz=z;
}

void dfsy(int dep, long long y)
{
    if (y*y>V/xx) return;
    if (dep>n)
    {
        update(xx,y,V/xx/y);
        return;
    }   
    for (int i=num[dep]; i>=0; i--)
        dfsy(dep+1, y*power[dep][i]);
}

void dfsx(int dep, long long x)
{
    if (x*x > V/x) return;
    if (dep>n)
    {
        xx=x; double a=sqrt(V*1.0/x);
        if (2*a*x+a*a<ans) dfsy(1,1);
        return;
    }
    
    for (int i=num[dep]; i>=0; i--)
    {
        num[dep]-=i;
        dfsx(dep+1, x*power[dep][i]);
        num[dep]+=i;
    }
}

int main()
{
    scanf("%d",&tests);
    for (;tests--;)
    {
        scanf("%d",&n);
        V=1;
        for (int i=1; i<=n; i++)
        {
            cin>>p[i]>>num[i];
            power[i][0]=1;
            for (int j=1; j<=num[i]; j++) power[i][j]=power[i][j-1]*p[i];
            V*=power[i][num[i]];
        }
        
        ansx=1, ansy=1, ansz=V; ans=2*V+1;
        dfsx(1,1);
        cout<<ans*2<<" "<<ansx<<" "<<ansy<<" "<<ansz<<endl;
    }
}
