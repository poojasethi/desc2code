#include<cstdio>
#include<cmath>
struct node
{
	long long P;
	int K,l;
}A[100];
long long B[100][100];
int T,N,i,j;
long long V,S,p,X,Y,Z;
void dfs2(int x,long long b)
{
	int i;
	long long a,c;
	if(b*b*p>V) return;
	if(x>N)
	{
		a=p,c=V/a/b;
		if(a*b+a*c+b*c<S)
		{
			S=a*b+a*c+b*c;
			X=a,Y=b,Z=c;
		}
		return;
	}
	for(i=A[x].l;i>=0;--i) dfs2(x+1,b*B[x][i]);
}
void dfs1(int x,long long a)
{
	int i;
	if(a*a*a>V) return;
	if(x>N)
	{
		p=a;
		double t=sqrt(V/a);
		if(2*a*t+V/a<S) dfs2(1,1);
		return;
	}
	for(i=A[x].K;i>=0;--i)
	{
		A[x].l=A[x].K-i;
		dfs1(x+1,a*B[x][i]);
	}
}
int main()
{
	for(scanf("%d",&T);T--;)
	{
		scanf("%d",&N);
		V=1;
		for(i=1;i<=N;++i)
		{
			scanf("%I64d%d",&A[i].P,&A[i].K);
			B[i][0]=1;
			for(j=1;j<=A[i].K;++j) B[i][j]=B[i][j-1]*A[i].P;
			V*=B[i][A[i].K];
			A[i].l=A[i].K;
		}
		S=2*V+1,X=Y=1,Z=V;
		dfs1(1,1);
		S*=2;
		printf("%I64d %I64d %I64d %I64d\n",S,X,Y,Z);
	}
	return 0;
}
