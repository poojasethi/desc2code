#include<cstdio>
#include<cmath>
#include<iostream>
using namespace std;
#define ll long long
ll A,C,V,S,x,y,z,a[105],b[105],p[105][105]; int t,n,T;
void dfs(int q,int t,ll B)
{
	if (B*B*(q?A:B)>V) return;
	if (t>n){
		if (q==0) {C=V/B; A=B; if (A*A<=C && (C+2*sqrt(C)*B<S)) dfs(1,1,1); A=1;}
		else {C=V/A/B; if (A*B+A*C+B*C<S) S=A*B+A*C+B*C,x=A,y=B,z=C;}
		return;
		}
	for (int i=b[t];i>=0;i--) b[t]-=i,dfs(q,t+1,B*p[t][i]),b[t]+=i;
}
int main()
{
	cin>>t;
	while (t--){
		cin>>n,V=A=1;
		for (int i=1;i<=n;i++){
			cin>>a[i]>>b[i],p[i][0]=1;
			for (int j=1;j<=b[i];j++) p[i][j]=p[i][j-1]*a[i];
			V*=p[i][b[i]];
			}
		S=2*V+2,dfs(0,1,1);
		cout<<S*2<<" "<<x<<" "<<y<<" "<<z<<endl;
		}
	return 0;
}
