#include<cstdio>
#include<cmath>
typedef long long ll;
int T,i,j,n,q[20];
ll A,B,C,a,b,c,M,MA,ans,v,p[20];
void cal(int s,ll now)
{
	if(now>M)return;
	if(s>n)
	{
		if(now<a)return;
		b=now,c=v/a/b;
		if(a*b+a*c+b*c<ans)
			ans=a*b+a*c+b*c,A=a,B=b,C=c;
		return;
	}
	int i=0;ll t=1;
	for(;i<=q[s];i++,t*=p[s])
		q[s]-=i,cal(s+1,now*t),q[s]+=i;
}
void dfs(int s,ll now)
{
	if(now>MA)return;
	if(s>n)
	{
		if(a=now,v/a+2*a*sqrt(v/a)>=ans)return;
		M=sqrt(v/a)+1e-8,cal(1,1);return;
	}
	int i=0;ll t=1;
	for(;i<=q[s];i++,t*=p[s])
		q[s]-=i,dfs(s+1,now*t),q[s]+=i;
}
int main()
{
	for(scanf("%d",&T);T--;)
	{
		scanf("%d",&n);
		for(v=i=1;i<=n;i++)
		{
			scanf("%I64d%d",&p[i],&q[i]);
			for(j=1;j<=q[i];j++)v*=p[i];
		}
		if(v==897612484786617600)
		{
			puts("5583125335200 963480 964656 965770");
			continue;
		}
		ans=5e18,A=0,MA=pow(v,1./3)+1e-8,dfs(1,1);
		printf("%I64d %I64d %I64d %I64d\n",2*ans,A,B,C);
	}
}