#include<cstdio>
#include<cmath>
#include<algorithm>
using namespace std;
typedef long long ll;
ll q[63][63],ans,ansa,ansb,ansc,temb,v,bnd1,bnd2;
int p[63],r[63],k;
void sear2(int now,ll b){
    if (b>bnd2) return;
    if (now==k){
        if (b>temb) temb=b;
    } else{
        for (int i=r[now];i>=0;i--) sear2(now+1,b*q[now][i]);
    }
}
void check(ll a,ll b){
    ll c=v/a/b;
    if (a*b+a*c+b*c<ans){
        ans=a*b+a*c+b*c;
        ansa=a,ansb=b,ansc=c;
    }
}
void sear(int now,ll a){
    if (a>bnd1) return;
    if (now==k){
        bnd2=ll(sqrt(v/a)+1e-6);
        if (a*bnd2+v/a+v/bnd2<ans){
            temb=0;
            sear2(0,1);
            check(a,temb);
        }
    } else{
        r[now]=0;
        for (int i=p[now];i>=0;i--){
            sear(now+1,a*q[now][i]);
            r[now]++;
        }
    }
}
int main(){
    int t,i,j;
    ll a;
    for (scanf("%d",&t);t;t--){
        scanf("%d",&k);
        v=1,ans=1ll<<62;
        for (i=0;i<k;i++){
            scanf("%I64d%d",&a,p+i);
            for (q[i][0]=1,j=1;j<=p[i];j++) q[i][j]=q[i][j-1]*a;
            v*=q[i][p[i]];
        }
        bnd1=ll(pow(v,1.0/3)+1e-6);
        sear(0,1);
        printf("%I64d %I64d %I64d %I64d\n",ans<<1,ansa,ansb,ansc);
    }
    return 0;
}