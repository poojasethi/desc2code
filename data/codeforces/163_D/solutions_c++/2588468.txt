#include<cstdio>
#include<cmath>
#define fd(i,a,b) for(i=a;i>=b;--i)
#define fo(i,a,b) for(i=a;i<=b;++i)
using namespace std;
typedef long long LL;
const int mn=100;
int T,n,s[mn];
LL V,A,B,C,S,p[mn],ps[mn][mn],bc,c,now;
void search(int r,const LL a,const LL b,const LL bc)
{
    if(b*b>bc)return;
    if(r>n)
    {
        c=bc/b,now=a*c+b*c+a*b;
        if(now<S)
        {
            S=now;
            A=a,B=b,C=c;
        }
        return;
    }
    int i;
    fd(i,s[r],0)
    {
        s[r]-=i;
        search(r+1,a,b*ps[r][i],bc);
        s[r]+=i;
    }
}
void dfs(int r,LL a)
{
    if(a*a*a>V)return;
    if(r>n)
    {
        bc=V/a;
        if(sqrt(bc)*2*a+bc>=S)return;
        search(1,a,1,bc);
        return;
    }
    int i;
    fd(i,s[r],0)
    {
        s[r]-=i;
        dfs(r+1,a*ps[r][i]);
        s[r]+=i;
    }
}
int main()
{
    scanf("%d",&T);
    int i,j;
    while(T--)
    {
        scanf("%d",&n);
        V=1;
        fo(i,1,n)
        {
            scanf("%I64d%d",p+i,s+i);
            ps[i][0]=1;
            fo(j,1,s[i])ps[i][j]=ps[i][j-1]*p[i];
            V*=ps[i][s[i]];
        }
        S=V+V+1,A=V,B=1,C=1;
        dfs(1,1);
        printf("%I64d %I64d %I64d %I64d\n",S*2,A,B,C);
    }
    return 0;
}