#include<bits/stdc++.h>
using namespace std;
typedef long long int uli;
const int mx=2e5+10;
int st[10][10][mx<<2];
int lf[mx<<2],rh[mx<<2];
int lp[mx<<2];
int k;
char s[mx],p[mx];

void cmb(int u){
   for(int i=0;i<k;i++)
      for(int j=0;j<k;j++)
         st[i][j][u]=st[i][j][u+u+1]+st[i][j][u+u+2];
   st[rh[u+u+1]][lf[u+u+2]][u]++;
   lf[u]=lf[u+u+1];
   rh[u]=rh[u+u+2];
}
void init(int u,int l,int r){
   lp[u]=-1;
   if(l==r)lf[u]=rh[u]=s[l]-'a'; 
   else{
      int mid=(l+r)>>1;
      init(u+u+1,l,mid);      
      init(u+u+2,mid+1,r);
      cmb(u);
   }
}
void go(int u,int l,int r,int v){
   lp[u]=lf[u]=rh[u]=v;
   for(int i=0;i<k;i++)
      for(int j=0;j<k;j++)
         st[i][j][u]=0;
   st[v][v][u]=r-l;
}
void clr(int u,int l,int r){
   if(l==r)return;
   int mid=(l+r)>>1;
   go(u+u+1,l,mid,lp[u]);
   go(u+u+2,mid+1,r,lp[u]);
   lp[u]=-1;
}
void upd(int u,int l,int r,int f,int t,int v){
   if(r<f || t<l)return;
   if(lp[u]!=-1)clr(u,l,r);
   if(f<=l && r<=t)go(u,l,r,v);   
   else{
      int mid=(l+r)>>1;
      upd(u+u+1,l,mid,f,t,v);
      upd(u+u+2,mid+1,r,f,t,v);
      cmb(u);
   }
}
int main(){
   int n,m,op,l,r;
   char ch[3];
   scanf("%d %d %d %s",&n,&m,&k,s);
   init(0,0,n-1);
   while(m--){
      scanf("%d",&op);
      if(op==1){
         scanf("%d %d %s",&l,&r,ch);
         upd(0,0,n-1,--l,--r,ch[0]-'a');
      }
      else{
         scanf("%s",p);
         int ans=1;
         for(int i=0;i<k;i++)
            for(int j=0;j<=i;j++)
               ans+=st[p[i]-'a'][p[j]-'a'][0];
         printf("%d\n",ans);
      }
   }
   return 0;
}
