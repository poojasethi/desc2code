#include<cstdio>
#include<cstring>
#include<string>
#include<iostream>
using namespace std;
int N,M,K,flag,i,j,f1,f2,Key,p,Num;
int A[1005],B[1005],fa[1005],f[1005],g[1005],P[1005],Room[1005];
string s,S[1005];
int getfather(int i)
{
	if(fa[i]==i) return i;
	fa[i]=getfather(fa[i]);
	return fa[i];
}
int main()
{
	scanf("%d%d%d",&N,&M,&K);
	for(i=1;i<=M;++i) scanf("%d%d",&A[i],&B[i]);
	for(i=1;i<=K;++i)
	{
		cin>>S[i];
		scanf("%d%d",&P[i],&Num);
		for(j=1;j<=Num;++j)
		{
			scanf("%d",&Key);
			Room[Key]=P[i];
		}
	}
	for(i=1;i<=N;++i) fa[i]=i;
	flag=1;
	for(;flag;)
	{
		flag=0;
		for(i=1;i<=M;++i)
			if(!f[i]&&(getfather(A[i])==getfather(Room[i])||getfather(B[i])==getfather(Room[i])))
			{
				f1=getfather(A[i]),f2=getfather(B[i]);
				fa[f1]=f2,flag=f[i]=1;
			}
	}
	for(i=1;i<=K;++i)
	{
		cin>>s;
		scanf("%d%d",&p,&Num);
		for(j=1;j<=K;++j)
			if(S[j]==s)
				if(getfather(p)!=getfather(P[j]))
				{
					printf("NO\n");
					return 0;
				}
		for(j=1;j<=Num;++j)
		{
			scanf("%d",&Key);
			if(getfather(p)!=getfather(Room[Key]))
			{
				printf("NO\n");
				return 0;
			}
			Room[Key]=p;
		}
	}
	for(i=1;i<=N;++i) fa[i]=i;
	flag=1;
	for(;flag;)
	{
		flag=0;
		for(i=1;i<=M;++i)
			if(!g[i]&&(getfather(A[i])==getfather(Room[i])||getfather(B[i])==getfather(Room[i])))
			{
				f1=getfather(A[i]),f2=getfather(B[i]);
				fa[f1]=f2,flag=g[i]=1;
			}
	}
	for(i=1;i<=N;++i)
		if(f[i]!=g[i])
		{
			printf("NO\n");
			return 0;
		}
	printf("YES\n");
	return 0;
}
