#include<stdio.h>
#include<algorithm>
#include<string>
#include<tr1/unordered_map>
using namespace std;
using namespace tr1;
typedef pair<int,int> pii;
int n,m,K;
unordered_map<string,int> M;
pii E[1010];
int s[1010],t[1010];
int a[1010],b[1010];
int ra[1010],rb[1010];
int find(int *r,int x)
{
	return r[x]==x?x:r[x]=find(r,r[x]);
}
void make(int *s,int *a,int *r)
{
	for(int i=1;i<=n;i++)r[i]=i;
	int T=n;
	while(T--)
		for(int i=1;i<=m;i++)
		{
			int u=find(r,E[i].first),v=find(r,E[i].second),w=find(r,s[a[i]]);
			if(u>v)swap(u,v);
			if((u==w)^(v==w))r[v]=u;
		}
	for(int i=1;i<=n;i++)find(r,i);
}
int main()
{
	scanf("%d%d%d",&n,&m,&K);
	for(int i=1;i<=m;i++)
	{
		int u,v;
		scanf("%d%d",&u,&v);
		E[i]=make_pair(u,v);
	}
	for(int i=1;i<=K;i++)
	{
		char buf[30];
		int x;
		scanf("%s%d%d",buf,s+i,&x);
		string str(buf);
		M[str]=i;
		while(x--)
		{
			int y;
			scanf("%d",&y);
			a[y]=i;
		}
	}
	for(int i=1;i<=K;i++)
	{
		char buf[30];
		int x,p;
		scanf("%s",buf);
		string str(buf);
		p=M[str];
		scanf("%d%d",t+p,&x);
		while(x--)
		{
			int y;
			scanf("%d",&y);
			b[y]=p;
		}
	}
	make(s,a,ra);
	make(t,b,rb);
	bool ok=1;
	for(int i=1;i<=n;i++)if(ra[i]!=rb[i]){ok=0;break;}
	for(int i=1;i<=n;i++)if(ra[s[i]]!=rb[t[i]]){ok=0;break;}
	for(int i=1;i<=m;i++)if(ra[s[a[i]]]!=rb[t[b[i]]]){ok=0;break;}
	puts(ok?"YES":"NO");
	return 0;
}
