#include <map>
#include <cstdio>
#include <string>
using namespace std;

int N,M,K,x[1005],y[1005],p[1005],q[1005],f[1005];
map<string,int>F;
char st[15];
bool b[1005],c[1005];

int find(int x) {return x==f[x]?x:f[x]=find(f[x]);}

void work()
{
	for (int i=1; i<=N; i++) f[i]=i;
	for (;;)
	{
		bool ok=0;
		for (int i=1; i<=M; i++) if (!b[i]&&(find(q[i])==find(x[i])||find(q[i])==find(y[i]))) f[find(x[i])]=find(y[i]),b[i]=ok=1;
		if (!ok) break;
	}
}

int main()
{
	scanf("%d%d%d",&N,&M,&K);
	for (int i=1; i<=M; i++) scanf("%d%d",&x[i],&y[i]);
	for (int i=1,s,x; i<=K; i++)
	{
		scanf("%s%d%d",st,&p[i],&s),F[string(st)]=p[i];
		for (;s; s--) scanf("%d",&x),q[x]=p[i];
	}
	work();
	for (int i=1,s,x,y; i<=K; i++)
	{
		scanf("%s%d%d",st,&y,&s);
		if (find(y)!=find(F[st])) goto no;
		for (;s; s--)
		{
			scanf("%d",&x);
			if (find(q[x])!=find(y)) goto no;
			q[x]=y;
		}
	}
	for (int i=1; i<=M; i++) c[i]=b[i],b[i]=0;
	work();
	for (int i=1; i<=M; i++) if (b[i]!=c[i]) goto no;
	puts("YES"); return 0;
	no:puts("NO");
}