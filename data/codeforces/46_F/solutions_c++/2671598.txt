#include<iostream>
#include<algorithm>
#include<map>
#include<string>
#include<cstdio>
#include<cstdlib>
#include<cstring>

using namespace std;

const int fin=0,maxn=1010;
int n,m,k;
string str;
map<string,int>G;
int b[maxn],c[maxn];
int r[maxn],s[maxn];
int p[maxn],q[maxn];
struct pt{int x,y;}E[maxn];

inline int getf(int *p,int x){
  if(x!=p[x])p[x]=getf(p,p[x]);
  return p[x];
}

void sol(int *r,int *b,int *p){
  int i,j=n,x,y,z;
  for(i=1;i<=n;++i)p[i]=i;
  while(j--)
    for(i=1;i<=m;++i){
      x=getf(p,E[i].x),y=getf(p,E[i].y),z=getf(p,r[b[i]]);
      if((x==z)^(y==z))
        if(x<y)p[y]=x;else p[x]=y;
    }
  for(i=1;i<=n;++i)p[i]=getf(p,i);
}

int main(){
  if(fin){
    freopen("t.in","r",stdin);
    freopen("t.out","w",stdout);
  }
  int i,t,j,w;
  cin>>n>>m>>k;
  for(i=1;i<=m;++i)scanf("%d%d\n",&E[i].x,&E[i].y);
  for(i=1;i<=k;++i){
    cin>>str>>r[i]>>j;
    while(j--)cin>>w,b[w]=i;
    scanf("\n");
    G[str]=i;
  }
  sol(r,b,p);
  for(i=1;i<=k;++i){
    cin>>str,t=G[str];
    cin>>s[t]>>j;
    while(j--)cin>>w,c[w]=t;
    scanf("\n");
  }
  sol(s,c,q);
  for(i=1;i<=n;++i)
    if(p[i]!=q[i])
      return puts("NO"),0;
  for(i=1;i<=k;++i)
    if(p[r[i]]!=q[s[i]])
      return puts("NO"),0;
  for(i=1;i<=m;++i)
    if(p[r[b[i]]]!=q[s[c[i]]])
      return puts("NO"),0;
  puts("YES");
  return 0;
}
