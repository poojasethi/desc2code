#include<bits/stdc++.h>
#define rep(i,A,B) for(int i=A;i<=B;i++)
#define dep(i,B,A) for(int i=B;i>=A;i--)
#define re(i,A) for(int i=0;i<(int)A;i++)
#define de(i,A) for(int i=A-1;~i;i--)
#define For(i,A,B) for(int i=A;i<B;i++)
#define mn 5011
#define inf (1000000111)
#define P 1000000007
#define si(x) ((int)x.size())
#define pb push_back
#define mp make_pair
#define X first
#define Y second
#define fill(A,B) memset(A,B,sizeof(A))
#define MAX(A,B) A=max(A,B)
#define MIN(A,B) A=min(A,B)
using namespace std;
typedef long long ll;
typedef pair<int,int> pii;
template<class T>inline void R(T &xx){xx=0;char ch=getchar();bool F=0;while((ch<'0'||ch>'9')&&ch!='-')ch=getchar();if(ch=='-')F=1,ch=getchar();while(ch>='0'&&ch<='9')xx=xx+xx+(xx<<3)+ch-48,ch=getchar();if(F)xx=-xx;}
template<class T>inline void add(int&x,T y){for(x+=y;x>=P;x-=P);}

int n,m,k,f[mn],ex[mn],ey[mn],bel[mn];bool a[mn],b[mn];
int find(int x){return f[x]==x?x:f[x]=find(f[x]);}
void work(bool *a){
    rep(i,1,n)f[i]=i;int F=1;
    for(bool F=1;F;){
        F=0;
        rep(i,1,m)if(!a[i]){
            int xx=find(ex[i]),yy=find(ey[i]),zz=find(bel[i]);
            if(xx==zz||yy==zz)f[xx]=yy,a[i]=F=1;
        }
    }
}
map<string,int>H;string s;
int main(){
#ifndef ONLINE_JUDGE
    freopen("1.in","r",stdin);
    //freopen("1.out","w",stdout);
#endif
    R(n),R(m),R(k);
    rep(i,1,m)R(ex[i]),R(ey[i]);
    int p,x,num;
    rep(i,1,k){
        cin>>s;R(p);H[s]=p;
        for(R(num);num--;)R(x),bel[x]=p;
    }work(a);
    rep(i,1,k){
        cin>>s;R(p);
        if(find(p)!=find(H[s]))return puts("NO"),0;
        for(R(num);num--;){R(x);if(find(p)!=find(bel[x]))return puts("NO"),0;bel[x]=p;}
    }work(b);
    rep(i,1,m)if(a[i]!=b[i])return puts("NO"),0;
    puts("YES");
    return 0;
}