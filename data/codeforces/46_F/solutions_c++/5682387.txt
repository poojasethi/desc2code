#include<cstdio>
#include<cstring>
#include<cstdlib>
#include<algorithm>
#include<map>
#include<iostream>
#define N 1200
using namespace std;
map<string,int> ss;
int n,m,K,ex[N],ey[N],fa[N],key[N][N],room[N],f1[3*N],f2[3*N],be[N];
int get(int x){
	return fa[x]==x?x:(fa[x]=get(fa[x]));
}
void work(int ans[]){
	int i,j,x,y,p,M,d;
	string s;
	for(i=1;i<=K;++i){
		cin>>s;
		if(!ss[s])p=ss[s]=i;
		else p=ss[s];
		scanf("%d%d",&room[p],&key[p][0]);
		for(j=1;j<=key[p][0];++j)scanf("%d",&key[p][j]),be[key[p][j]]=p;
	}
	for(i=1;i<=n;++i)fa[i]=i;
	for(i=1;i<=n;++i)
		for(j=1;j<=K;++j){
			for(x=1;x<=key[j][0];++x){
				y=key[j][x];
				if(get(room[j])==get(ex[y])||get(room[j])==get(ey[y])){
					fa[get(ex[y])]=get(ey[y]);
				}
			}
		}
	M=0;
	for(i=1;i<=n;++i)if(!ans[i]){
		if(!ans[get(i)])ans[get(i)]=++M;
		ans[i]=ans[get(i)];
	}
	for(i=1;i<=m;++i)ans[i+n]=ans[get(room[be[i]])];
	for(i=1;i<=K;++i)ans[i+n+m]=ans[get(room[i])];
}
int main(){
	int i;
	scanf("%d%d%d",&n,&m,&K);
	for(i=1;i<=m;++i)scanf("%d%d",&ex[i],&ey[i]);
	work(f1);
	work(f2);
	for(i=1;i<=m+n+K;++i)if(f1[i]!=f2[i])return puts("NO"),0;
	puts("YES");
	return 0;
}
