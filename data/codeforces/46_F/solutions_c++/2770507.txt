#include<cstdio>
#include<iostream>
#include<string>
#include<map>
using namespace std;
map<string,int> mp;
const int t=1005;
int fa[t],si[t],pd[t],r[t],a[t],b[t],pos[t],f[t],g[t];
string nm;
int findfa(int a){
	return fa[a]==a?a:fa[a]=findfa(fa[a]);
}
int main(){
	int n,m,k,i,j,p,x,y,z,ans;
//	freopen("46f.in","r",stdin);
//	freopen("46f.out","w",stdout);
	cin>>n>>m>>k;
	for (i=1;i<=n;i++) si[fa[i]=i]=1;
	for (i=1;i<=m;i++) pd[i]=true,cin>>a[i]>>b[i];
	for (i=1;i<=k;i++){
		mp[(cin>>nm,nm)]=i;
		cin>>r[i];
		for (cin>>j;j;j--) pos[(cin>>p,p)]=r[i];
	}
	for (i=1;i<n;i++) for (j=1;j<=m;j++) if (pd[j]){
		x=findfa(a[j]),y=findfa(b[j]),z=findfa(pos[j]);
		if (z==x || z==y || x==y){
			pd[j]=false;
			if (x!=y){
				if (si[x]>si[y]) si[fa[y]=x]+=si[y];
					else si[fa[x]=y]+=si[x];
			}
		}
	}
	for (i=1;i<=n;i++) f[i]=findfa(i);
	
	ans=0;
	for (i=1;i<=n;i++) si[fa[i]=i]=1;
	for (i=1;i<=m;i++) pd[i]=true;
	for (i=1;i<=k;i++){
		x=mp[(cin>>nm,nm)];
		cin>>y;
		ans|=f[y]!=f[r[x]];
		for (cin>>j;j;j--){
			cin>>p;
			ans|=f[r[x]]!=f[pos[p]];
			pos[p]=y;
		}
	}
	for (i=1;i<n;i++) for (j=1;j<=m;j++) if (pd[j]){
		x=findfa(a[j]),y=findfa(b[j]),z=findfa(pos[j]);
		if (z==x || z==y || x==y){
			pd[j]=false;
			if (x!=y){
				if (si[x]>si[y]) si[fa[y]=x]+=si[y];
					else si[fa[x]=y]+=si[x];
			}
		}
	}
	for (i=1;i<=n;i++) g[i]=findfa(i);
	for (i=1;i<=n;i++) for (j=1;j<=n;j++)
		ans|=((g[i]==g[j])^(f[i]==f[j]));
	puts(ans?"NO":"YES");
	return 0;
}
