#include<iostream>
#include<cstdio>
#include<cstring>
#include<cstdlib>
#include<cmath>
#include<vector>
#include<queue>
#include<deque>
#include<set>
#include<algorithm>
#include<ctime>
#include<map>
#ifdef unix
#define PL "%lld"
#else
#define PL "%I64d"
#endif
#define PB push_back
#define MP make_pair
#define INF 0x5fffffff
#define rep(i,x,y) for(i=x;i<=y;i++)
#define reps(i,x,y) for(i=x;i>=y;i--)
#define sqr(x) ((x)*(x))
#define Imin(x,y) ((x)<(y)?(x):(y))
#define Imax(x,y) ((x)>(y)?(x):(y))
#define Iabs(x) ((x)>0?(x):(-(x)))
using namespace std;
typedef long long LL;
typedef double DB;
typedef vector<int> VI;
char st[15];
int n,m,K;
int bel[1100],room[1100];
VI L[1100];
int ex[1100],ey[1100];
int f1[3100],f2[3100];
int fa[3100];
map<string,int> M;
int find(int x){
	if(fa[x]==x)return x;
	return fa[x]=find(fa[x]);
}
void calc(int *ret){
	int i,j,k;
	rep(i,1,n)fa[i]=i;
	rep(i,1,K){
		scanf("%s",st);
		if(!M[st])M[st]=i;
		int p=M[st];
		scanf("%d",&room[p]);
		L[p].clear();
		scanf("%d",&k);
		while(k--){
			scanf("%d",&j);
			L[p].PB(j);
			bel[j]=p;
		}
	}
	rep(i,1,n){
		rep(j,1,K){
			for(k=0;k<L[j].size();k++){
				int e=L[j][k];
				if(find(room[j])==find(ex[e])||find(room[j])==find(ey[e])){
					if(find(ex[e])<find(ey[e]))swap(ex[e],ey[e]);
					fa[find(ex[e])]=find(ey[e]);
				}
			}
		}
	}
	rep(i,1,n)ret[i]=find(i);
	rep(i,1,m)ret[i+n]=find(room[bel[i]]);
	rep(i,1,K)ret[n+m+i]=find(room[i]);
}
void solve(){
	int i,j,k;
	scanf("%d%d%d",&n,&m,&K);
	rep(i,1,m){
		scanf("%d%d",&ex[i],&ey[i]);
		// if(ex[i]>ey[i])swap(ex[i],ey[i]);
	}
	calc(f1);
	calc(f2);
	rep(i,1,n+m+K)
		if(f1[i]!=f2[i]){
			puts("NO");
			return ;
		}
	puts("YES");
}
int main(){
	#ifndef ONLINE_JUDGE
	freopen("in.txt","r",stdin);
	//freopen("out.txt","w",stdout);
	#endif
	// init();
	solve();
	return 0;
}
