#include <vector>
#include <cstdio>
#include <cstring>
#include <algorithm>
using namespace std;

#define n	300005
#define m	1000005
#define I64	long long
#define For(i,a,b)	for(int i=a;i<=b;i++)
#define Rep(i,a,b)	for(int i=a;i>=b;i--)

I64		Ans;
int		N,K,A[n],S[n],L[n],R[n];
vector<int>G[m];

int		Ask(int k,int l,int r){
		int x=upper_bound(G[k].begin(),G[k].end(),r)-G[k].begin()-1,
			y=lower_bound(G[k].begin(),G[k].end(),l)-G[k].begin()-1;
		return	x-y;
}

int		main(){
		scanf("%d%d",&N,&K);
		For(i,1,N)	scanf("%d",&A[i]),S[i]=(S[i-1]+A[i])%K;
		For(i,0,N)	G[S[i]].push_back(i);

		For(i,1,N)	for (L[i]=i-1;L[i]&&A[L[i]]<A[i];L[i]=L[L[i]]);
		Rep(i,N,1)	for (R[i]=i+1;R[i]<=N&&A[R[i]]<=A[i];R[i]=R[R[i]]);

		For(i,1,N)	if	(i-L[i]<R[i]-i){
			For(j,L[i]+1,i)	Ans+=Ask((A[i]+S[j-1])%K,i,R[i]-1);
		}	else	{
			For(j,i,R[i]-1)	Ans+=Ask((S[j]-A[i]%K+K)%K,L[i],i-1);
		}	printf("%I64d\n",Ans-N);
}