#include <bits/stdc++.h>
#define mod(x) ((x)<k?(x):(x)-k)
#define MA(x,y) ((x)>(y)?(x):(y))
using namespace std;
const int N=1000002;
int a[N],n,k,b[N];

int input(){
    scanf("%d%d",&n,&k);
    for (int i=1;i<=n;i++) scanf("%d",&a[i]),b[i]=a[i]%k;
    return 0;
}

int X[N],Y[N],x,y;
int mx=0;
int my=0;
int sx=0;
int sy=0;
long long ans=0;

void add(){
    mx=max(mx,a[x]);
    sx=mod(sx+b[x]);
    X[sx]++;
    int T=mod(sx-mx%k+k);
    ans+=Y[mod(k-T)];
}

void add2(){
    my=max(my,a[y]);
    sy=mod(sy+b[y]);
    Y[sy]++;
    int T=mod(sy-my%k+k);
    ans+=X[mod(k-T)];
}

void sol(int l,int r){
    if (l==r) return;

    int mid=(l+r)/2;
    x=mid+1;
    y=mid;
    sx=sy=mx=my=0;

    while (l<x || y<r){
        if (l==x) y++,add2(); else
        if (r==y) x--,add(); else
        if (MA(mx,a[x-1])<MA(my,a[y+1]))x--,add(); else
                                        y++,add2();

   //     cout<<x<<" "<<y<<" "<<ans<<" "<<mx<<" "<<my<<" "<<sx<<" "<<sy<<endl;
    }
  //  cout<<endl;

    sy=0;
    for (int i=mid+1;i<=r;i++){
        sy=mod(sy+b[i]);
        Y[sy]=0;
    }
    sx=0;
    for (int i=mid;i>=l;i--){
        sx=mod(sx+b[i]);
        X[sx]=0;
    }
    sol(l,mid);
    sol(mid+1,r);
}

int main() {
   // freopen("T.txt","r",stdin);
   // freopen("T2.txt","w",stdout);
    input();
    sol(1,n);
    cout<<ans<<endl;
    return 0;
}
