#include<stdio.h>
#include<algorithm>
using namespace std;
const int maxn=300050,maxk=1000050;
int n,K,a[maxn];
long long ans=0;
int cnt[maxk];
void work(int l,int r)
{
	if(l==r) return ;
	int i,j,mid=(l+r)>>1,mx,sl,sr;
	work(l,mid),work(mid+1,r);

	mx=sl=sr=0;
	for(i=mid,j=mid+1;i>=l;i--)
	{
		(sl+=a[i]%K)>=K?sl-=K:0;
		mx=max(mx,a[i]);
		while(j<=r&&a[j]<mx)
		{
			cnt[(sr+=a[j]%K)>=K?sr-=K:sr]++;
			j++;
		}
		ans+=cnt[((K-sl+mx%K)%K+K)%K];
	}
	//for(i=0;i<K;i++) printf("%d ",cnt[i]); printf("\n");
	while(j>mid+1)
		cnt[sr]--,(sr-=a[--j]%K)<0?sr+=K:sr;

	mx=sl=sr=0;
	for(i=mid+1,j=mid;i<=r;i++)
	{
		(sr+=a[i]%K)>=K?sr-=K:0;
		mx=max(mx,a[i]);
		while(j>=l&&a[j]<=mx)
		{
			cnt[(sl+=a[j]%K)>=K?sl-=K:sl]++;
			j--;
		}
		ans+=cnt[((K-sr+mx%K)%K+K)%K];
	}
	//for(i=0;i<K;i++) printf("%d ",cnt[i]); printf("\n");
	while(j<mid)
		cnt[sl]--,(sl-=a[++j]%K)<0?sl+=K:sl;
	//printf(" %d %d %I64d\n",l,r,ans);
}
int main()
{
#ifndef ONLINE_JUDGE
	freopen("data.in","r",stdin);
	freopen("data.out","w",stdout);
#endif
	int i,j;
	scanf("%d%d",&n,&K);
	for(i=1;i<=n;i++)
		scanf("%d",&a[i]);
	work(1,n);
	printf("%I64d\n",ans);
	return 0;
}
