#include <set>
#include <queue>
#include <cmath>
#include <ctime>
#include <cstdio>
#include <vector>
#include <cstdlib>
#include <cstring>
#include <iostream>
#include <algorithm>
#define LL long long
using namespace std;
LL ksm(LL x,LL y,LL z)
{
    if(!x)return 0;
    if(!y)return 1;
    LL t=ksm(x,y/2,z);
    if(y&1)
        return t*t%z*x%z;
    return t*t%z;
}
int main()
{
    int T;
    scanf("%d",&T);
    for(;T--;)
    {
        LL k,l,r,p,ans,a,b;
        scanf("%I64d%I64d%I64d%I64d",&k,&l,&r,&p);
        if(k==1){printf("%I64d\n",2%p);continue;}
        ans=k&1?ksm(ksm(2,p-2,p),r-l,p):1;
        k%=p;
        a=ksm(k,ksm(2,r+1,p-1),p);
        b=ksm(k,ksm(2,l,p-1),p);
        if(b==1)
            ans=ans*ksm(2,r-l+1,p)%p;
        else
            ans=ans*(a-1)%p*ksm(b-1,p-2,p)%p;
        printf("%I64d\n",(ans+p)%p);
    }
    return 0;
}
	  			 		  	 		 		 	 	 		