#include<cstdio>
typedef long long ll;
int p,T,k,a;
ll l,r,t;
ll po(ll a,ll n,int p){
	ll ret=1;
	for(;n;n>>=1){
		if(n&1)ret= ret* a % p;
		a=a*a%p;
	}
	return ret;
}
#define rev(a) po(a,p-2,p)
ll f(ll x){
	if(k%p)return (po(k,po(2,x,p-1),p)+p-1)%p;
		else return p-1;
}
int ss(){
	if(k==1)return 2%p;
	if(t=f(l))return f(r+1)*rev(t)%p*((k&1)?rev(po(2,r-l,p)):1)%p;
	return (k&1)?2%p:po(2,r-l+1,p);
}
int main(){
	for(scanf("%d",&T);T--;printf("%d\n",ss()))
		scanf("%d%I64d%I64d%d",&k,&l,&r,&p);
}