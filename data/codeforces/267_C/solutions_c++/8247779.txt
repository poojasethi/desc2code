#include <algorithm>
#include <cstring>
#include <cstdlib>
#include <cstdio>
#define db double
#define N 110
#define For(i,x,y) for (i=x;i<=y;i++)
using namespace std;
int i,j,k,n,m,x,y;
int f[N][N],X[5010],Y[5010],Z[5010];
db a[N][N],b[N];
void gauss() {
	int i,j,k;
	For(i,1,n-2) {
		For(j,i,n-2) if (a[j][i]) {
			For(k,i,n-1) swap(a[j][k],a[i][k]);
			break;
		}
		if (a[i][i]) for (j=n-1;j>=i;j--) a[i][j]/=a[i][i];
		For(j,i+1,n-1) for (k=n-1;k>=i;k--) a[j][k]-=a[i][k]*a[j][i];
	}
	for (i=n-2;i;i--) {
		b[i+1]=a[i][n-1]; 
		For(j,1,i-1) a[j][n-1]-=a[j][i]*a[i][n-1];
	}
	b[n]=1;
}
int main() {
	scanf("%d%d",&n,&m);
	For(i,1,m) {
		scanf("%d%d%d",&x,&y,&Z[i]);
		f[x][y]++,f[y][x]++;
		X[i]=x,Y[i]=y;
	}
	For(i,2,n) {
		For(j,1,n) {
			a[i-1][i-1]-=f[i][j];
			if (j>1&&j<n) a[i-1][j-1]+=f[i][j];
			if (j==n) a[i-1][n-1]-=f[i][j];
		}
	}
	gauss();
	db an=1e9,sum=0;
	For(i,1,m) {
		x=X[i],y=Y[i];
		db s=b[x]-b[y];
		if (s<0) s=-s;
		an=min(an,Z[i]/s);
		if (x==n||y==n) sum+=s;
	}
	For(i,1,n) b[i]*=an;
	printf("%.12lf\n",sum*an);
	For(i,1,m) printf("%.12lf\n",b[Y[i]]-b[X[i]]);
	return 0;
}
