#include <cstdio>
#include <iostream>
#define N 110
#define M 5050
#define abs(x) max((x),-(x))
using namespace std;
int n,m,f[N],a[M],b[M],c[M];
double x[N],A[N][N];
int find(int x){return f[x]==x ? x:f[x]=find(f[x]);}
int main(){
	scanf("%d%d",&n,&m);
	for(int i=1;i<=n;++i)f[i]=i;
	for(int i=1;i<=m;++i){
		scanf("%d%d%d",&a[i],&b[i],&c[i]);
		f[find(a[i])]=find(b[i]);
		if(a[i]!=1 && a[i]!=n)++A[a[i]][a[i]],--A[a[i]][b[i]];
		if(b[i]!=1 && b[i]!=n)++A[b[i]][b[i]],--A[b[i]][a[i]];
	}
	if(find(1)!=find(n)){
		for(int i=0;i<=m;++i)printf("0.00000\n");
		return 0;
	}
	A[1][n+1]=A[1][1]=1;//x[1]=1
	A[n][n+1]=(A[n][n]=1)*2;//x[n]=2
	/*for(int i=1;i<=n;++i){
    	int t=i;
		for(int j=i+1;j<=n;++j)
		    if(abs(A[j][i])>abs(A[t][i]))t=j;
		for(int j=i;j<=n+1;++j)swap(A[i][j],A[t][j]);
		for(int j=1;j<=n;++j)if(j!=i)
		    while(A[j][i]){
		    	int t=A[i][i]/A[j][i];
			    for(int k=i;k<=n+1;++k)A[i][k]-=A[j][k]*t,swap(A[i][k],A[j][k]);
		    }
	}*/
	for(int i=1;i<=n;++i){
		int t=i;
		for(int j=i+1;j<=n;++j)if(abs(A[j][i])>abs(A[t][i]))t=j;
		if(abs(A[i][i])<1e-6)continue;
		for(int j=1;j<=n+1;++j)swap(A[i][j],A[t][j]);
		for(int j=1;j<=n;++j)if(j!=i){
			double t=-A[j][i]/A[i][i];
			for(int k=i;k<=n+1;++k)A[j][k]+=A[i][k]*t;
		}
	}
	
	for(int i=1;i<=n;++i)x[i]=A[i][n+1]*1.0/A[i][i];
	double flow=0,t=1e50;
	for(int i=1;i<=m;++i)t=min(t,c[i]/abs(x[b[i]]-x[a[i]]));
	for(int i=1;i<=m;++i)if(a[i]==1 || b[i]==1)flow+=abs((x[b[i]]-x[a[i]])*t);
    printf("%.5lf\n",flow);
    for(int i=1;i<=m;++i)printf("%.5lf\n",(x[b[i]]-x[a[i]])*t);
}
 		 	  				 	 	  			  				 	