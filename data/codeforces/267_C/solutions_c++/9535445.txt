#include <cstdio>
#include <cstring>
#include <algorithm>
#include <cstdlib>
#include <cmath>
#include <map>
#include <string>
#include <vector>
#define mp make_pair
#define pii pair<int,int>
#define For(i,a,n)  for(int i=(a);i<=(n);i++)
#define Forn(i,a,n) for(int i=(a);i>=(n);i--)
#define REP(i,n)    for(int i=(1);i<=(n);i++)
using namespace std;

int n,m,u[5005],v[5005],w[5005];
double A[105][105],x[105],ans;

inline void setIO(string a){
#ifndef ONLINE_JUDGE
	string in=a+".in",out=a+".out";
	freopen(in.c_str(),"r",stdin);
	freopen(out.c_str(),"w",stdout);
#endif
}

inline void fg(){
	puts("0.0");
	For(i,1,m) printf("0.0\n");
	exit(0);
}

inline void gauss(int N){
	For(i,1,N){
		For(j,i,N) if(fabs(A[j][i])>1e-10){
			For(k,i,N+1) swap(A[j][k],A[i][k]);
			break;
		}if(fabs(A[i][i])<1e-10)continue;
		Forn(j,n+1,i) A[i][j]/=A[i][i];
		For(j,1,N)if(j^i){
			double c=A[j][i]/A[i][i];
			For(k,1,N+1) A[j][k]-=A[i][k]*c;
		}
	}For(i,1,n) x[i]=A[i][n+1];
}

int main(){
//	setIO("net");
	scanf("%d%d",&n,&m);
	For(i,1,m){
		scanf("%d%d%d",&u[i],&v[i],&w[i]);
		if(u[i]!=1 && u[i]!=n) --A[u[i]][u[i]],++A[u[i]][v[i]];
		if(v[i]!=1 && v[i]!=n) --A[v[i]][v[i]],++A[v[i]][u[i]];
	}A[n][n]=A[n][n+1]=A[1][1]=1;
//	For(i,1,n){For(j,1,n+1) printf("%.2lf ",A[i][j]);puts("");}
	gauss(n);
	double c=10000000000000000.;
	For(i,1,m){
		double Now=x[v[i]]-x[u[i]];
		c=min(c,fabs(w[i]/Now));
	}if(fabs(c)<1e-6 || c>1234298472982) c=0;
	For(i,1,m) if(u[i]==1 || v[i]==1) ans+=x[u[i]*v[i]]*c;
	printf("%.12lf\n",ans);
	For(i,1,m) printf("%.12lf\n",(x[v[i]]-x[u[i]])*c);
	return 0;
}
