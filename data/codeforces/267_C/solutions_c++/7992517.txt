#include <bits/stdc++.h>
using namespace std;
#define rep(i,a,n) for (int i=a;i<n;i++)
#define per(i,a,n) for (int i=n-1;i>=a;i--)
#define pb push_back
#define mp make_pair
#define all(x) (x).begin(),(x).end()
#define SZ(x) ((int)(x).size())
#define fi first
#define se second
typedef vector<int> VI;
typedef long long ll;
typedef pair<int,int> PII;
const ll mod=1000000007;
ll powmod(ll a,ll b) {ll res=1;a%=mod;for(;b;b>>=1){if(b&1)res=res*a%mod;a=a*a%mod;}return res;}
// head

const int N=110,M=5010;
int n,m;
int u[M],v[M],w[M];
double g[N][N];
void gauss(int n) {
	rep(i,0,n) {
		int p=i;
		rep(j,i+1,n) if (fabs(g[j][i])>=fabs(g[p][i])) p=j;
		rep(j,i,n+1) swap(g[i][j],g[p][j]);
		if (fabs(g[i][i])<=1e-9) continue;
        rep(k,i+1,n+1) g[i][k]/=g[i][i]; g[i][i]=1;
        rep(j,i+1,n) {
            double cof=-g[j][i];
            rep(k,i,n+1) g[j][k]+=cof*g[i][k];
        }
    }
    per(i,0,n) {
        rep(j,0,i) g[j][n]-=g[j][i]*g[i][n];
    }
}

int main() {
	scanf("%d%d",&n,&m);
	rep(i,0,m) {
		scanf("%d%d%d",u+i,v+i,w+i);
		--u[i]; --v[i];
	}
	rep(i,0,m) g[u[i]][v[i]]++,g[v[i]][u[i]]++;
	rep(i,0,n) rep(j,0,n) if (i!=j) g[i][i]-=g[i][j];
	g[0][n]=-1;
	rep(i,0,n) g[n-1][i]=0; g[n-1][n-1]=1;
	gauss(n);
	double ret=1e20;
	rep(i,0,m) if (fabs(g[u[i]][n]-g[v[i]][n])>=1e-9) ret=min(ret,w[i]/abs(g[u[i]][n]-g[v[i]][n]));
	if (ret>1e10) ret=0;
	printf("%.10f\n",ret);
	rep(i,0,m) printf("%.10f\n",(g[u[i]][n]-g[v[i]][n])*ret);
}
