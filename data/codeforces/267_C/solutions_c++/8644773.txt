#include<cstdio>
#include<cstring>
#include<algorithm>
#include<queue>
#include<vector>
#include<string>
#include<set>
#define LL long long
#define fi first
#define se second
#define MP make_pair
#define PII pair<int,int>
#define PIII pair<PII,int>
using namespace std;
double g[110][110],x[110];
int n,m,ues[110];
PIII p[5010];
bool vis[110];
void read(int &x)
{
	char ch=getchar();int mark=1;for(;ch!='-'&&(ch<'0'||ch>'9');ch=getchar());if (ch=='-') mark=-1,ch=getchar();
	for(x=0;ch>='0'&&ch<='9';ch=getchar()) x=x*10+ch-48;x*=mark;
}
double Abs(double x){if (x<0) return -x;return x;}
int main()
{
	//freopen("a.txt","r",stdin);
	read(n);read(m);
	g[1][1]=1;
	g[n][n]=1;g[n][n+1]=1;
	for(int i=1;i<=m;i++)
	{
		read(p[i].fi.fi);read(p[i].fi.se);read(p[i].se);
		g[p[i].fi.fi][p[i].fi.fi]++;g[p[i].fi.fi][p[i].fi.se]--;
		g[p[i].fi.se][p[i].fi.se]++;g[p[i].fi.se][p[i].fi.fi]--;
	}
	for(int i=1;i<=n;i++)
	{
		for(int j=1;j<=n;j++)
			if (Abs(g[i][j])&&!vis[j])
			{
				vis[j]=1;ues[i]=j;break;
			}
		for(int j=1;j<=n;j++)
			if (ues[i]!=j&&Abs(g[j][i]))
			{
				double tmp=-g[j][i]/g[ues[i]][i];
				for(int k=1;k<=n+1;k++) g[j][k]+=g[ues[i]][k]*tmp;
			}
	}
	for(int i=1;i<=n;i++) x[i]=g[ues[i]][n+1]/g[ues[i]][i];
	double Min=1e20;
	for(int i=1;i<=m;i++)
	{
		if (Abs(x[p[i].fi.fi]-x[p[i].fi.se])>1e-9) Min=min(Min,p[i].se/Abs(x[p[i].fi.fi]-x[p[i].fi.se]));
	}
	double ans=0;
	for(int i=1;i<=m;i++)
		if (p[i].fi.fi==1) ans+=Min*(x[p[i].fi.se]-x[p[i].fi.fi]);
		else if (p[i].fi.se==1) ans-=Min*(x[p[i].fi.se]-x[p[i].fi.fi]);
	printf("%.9lf\n",ans);
	if (Abs(ans)<1e-9) memset(x,0,sizeof(x)); 
	for(int i=1;i<=m;i++) printf("%.9lf\n",Min*(x[p[i].fi.se]-x[p[i].fi.fi]));
	return 0;
}
