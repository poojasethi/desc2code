#include <cstdio>
#include <cmath>
#include <iostream>
using namespace std;
const int N=104,M=5004;
int n,m,u[M],v[M];
double a[N][N],d[N],w[M];
int main()
{
	int i,j,k; scanf("%d%d",&n,&m);
	for (i=1;i<=n;i++) for (j=1;j<=n+1;j++) a[i][j]=0;
	for (i=1;i<=m;i++)
	{
		scanf("%d%d%lf",&u[i],&v[i],&w[i]);
		a[u[i]][v[i]]--;
		a[u[i]][u[i]]++;
		a[v[i]][v[i]]++;
		a[v[i]][u[i]]--;
	}
	for (i=1;i<=n;i++) a[1][i]=0;
	a[1][1]=a[n][n+1]=1;
	for (i=1;i<n;i++)
	{
		if (fabs(a[i][i])<1e-10)
		{
			int p=i;
			for (j=i+1;j<=n;j++) if (fabs(a[j][i])>fabs(a[p][i])) p=j;
			if (p!=i) for (j=i;j<=n;j++) swap(a[i][j],a[p][j]);
			else continue;
		}
		for (j=i+1;j<=n;j++)
		{
			double p=a[j][i]/a[i][i]; a[j][i]=0;
			for (k=i+1;k<=n;k++) a[j][k]-=a[i][k]*p;
		}
	}
	for (i=n;i>=1;i--)
	{
		if (fabs(a[i][i])<1e-10) {d[i]=0; continue;}
		d[i]=a[i][n+1]/a[i][i];
		for (j=i-1;j;j--)
		{
			double p=a[j][i]/a[i][i]; a[j][i]=0;
			a[j][n+1]-=p*a[i][n+1];
		}
	}
	double ans=0;
	if (fabs(d[n])>1e-10)
	{
		ans=1e100;
		for (i=1;i<=m;i++)
		{
			if (fabs(d[v[i]]-d[u[i]])<1e-10) continue;
			double tmp=fabs(w[i]/(d[v[i]]-d[u[i]]));
			if (tmp<ans) ans=tmp;
		}
	}
	printf("%.10lf\n",ans);
	for (i=1;i<=m;i++) printf("%.10lf\n",(d[v[i]]-d[u[i]])*ans);
	return 0;
}