#include<cstdio>
#include<algorithm>
using namespace std;
const int N = 105;
const int M = 5050;
int a[M],b[M],c[M];
int n,m;
double fc[N][N];
double val[N];
int main()
{
	int i,j,k;
	scanf("%d%d",&n,&m);
	for(i=1;i<=m;i++)
	{
		scanf("%d%d%d",&a[i],&b[i],&c[i]);
		if(1<a[i] && a[i]<n)
		{
			fc[a[i]][a[i]]+=1.0;
			if(1<b[i] && b[i]<n)
				fc[a[i]][b[i]]-=1.0;
			else if(b[i]==n)
				fc[a[i]][n+1]+=1.0;
		}
		if(1<b[i] && b[i]<n)
		{
			fc[b[i]][b[i]]+=1.0;
			if(1<a[i] && a[i]<n)
				fc[b[i]][a[i]]-=1.0;
			else if(a[i]==n)
				fc[b[i]][n+1]+=1.0;
		}
	}
	for(i=2;i<n;i++)
	{
		for(j=i;j<n;j++)
		{
			if(fc[j][i]<-1e-8 || fc[j][i]>1e-8)
				break;
		}
		if(j>=n)
			continue;
		for(k=i;k<=n+1;k++)
			swap(fc[i][k],fc[j][k]);
		for(j=i+1;j<=n+1;j++)
			fc[i][j]/=fc[i][i];
		fc[i][i]=1.0;
		for(j=i+1;j<n;j++)
		{
			for(k=i+1;k<=n+1;k++)
				fc[j][k]-=fc[j][i]*fc[i][k];
		}
	}
	for(i=n-1;i>1;i--)
	{
		val[i]=fc[i][n+1];
		for(j=i+1;j<=n;j++)
			val[i]-=fc[i][j]*val[j];
	}
	val[n]=1.0;
	double maxz=987654321.0;
	for(i=1;i<=m;i++)
	{
		if(val[a[i]]-val[b[i]]<1e-8 && val[b[i]]-val[a[i]]<1e-8)
			continue;
		double now=c[i];
		if(val[a[i]]<val[b[i]])
			now/=val[b[i]]-val[a[i]];
		else
			now/=val[a[i]]-val[b[i]];
		if(now<maxz)
			maxz=now;
	}
	double sum=0.0;
	for(i=1;i<=m;i++)
	{
		if(a[i]==1)
			sum+=val[b[i]];
		if(b[i]==1)
			sum+=val[a[i]];
	}
	sum*=maxz;
	printf("%.5f\n",sum);
	for(i=1;i<=m;i++)
	{
		double now=val[b[i]]-val[a[i]];
		now*=maxz;
		printf("%.5f\n",now);
	}
	return 0;
}
