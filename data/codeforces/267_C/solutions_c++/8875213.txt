#include <iostream>
#include <cstdio>
#include <cstdlib>
#include <algorithm>
#include <cstring>
#include <cmath>
#include <string>
using namespace std;
const double eps=1e-9,finf=1e208;
const int Maxn=103,Maxm=5005;
int n,m;
int a[Maxm],b[Maxm],c[Maxm];
double t[Maxn][Maxn],x[Maxn];

int main() {
	scanf("%d%d",&n,&m);
	for (int i=1;i<=m;i++) {
		scanf("%d%d%d",a+i,b+i,c+i);
		t[a[i]][a[i]]++; t[a[i]][b[i]]--;
		t[b[i]][b[i]]++; t[b[i]][a[i]]--;
	}
	for (int i=1;i<=n;i++) t[1][i]=0;
	t[1][1]=t[n][n+1]=1;
	for (int i=1;i<=n;i++) {
		int w=i;
		for (int j=i+1;j<=n;j++)
			if (fabs(t[w][i])<fabs(t[j][i])) w=j;
		if (w!=i) for (int j=i;j<=n+1;j++) swap(t[w][j],t[i][j]);
		if (fabs(t[i][i])<eps) continue;
		for (int j=i+1;j<=n;j++)
			if (fabs(t[j][i])>eps) {
				double g=t[j][i]/t[i][i];
				for (int k=i;k<=n+1;k++) t[j][k]-=t[i][k]*g;
			}
	}
	for (int i=n;i>=1;i--)
		if (fabs(t[i][i])>eps) {
			for (int j=i+1;j<=n;j++) t[i][n+1]-=t[i][j]*x[j];
			x[i]=t[i][n+1]/t[i][i];
		}
	double f=x[n]<eps?0:finf,flow=0;
	if (f>eps)
		for (int i=1;i<=m;i++) {
			f=min(f,c[i]/fabs(x[a[i]]-x[b[i]]));
			if (a[i]==n||b[i]==n) flow+=fabs(x[a[i]]-x[b[i]]);
		}
	printf("%.7lf\n",f*flow);
	for (int i=1;i<=m;i++) printf("%.7lf\n",f*(x[b[i]]-x[a[i]]));
	return 0;
}