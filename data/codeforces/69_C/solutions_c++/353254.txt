#include <iostream>
#include <sstream>
#include <string>
#include <vector>
#include <map>
#include <set>
#include <algorithm>
#include <cstdio>
#include <cmath>
#include <cstring>

using namespace std;

#define FOR(i,a,b)  for(i=(a);i<(b);i++)
#define REP(i,n)    for(i=0;i<(n);i++)
#define split(str)  {vs.clear();istringstream A(str);while(A>>(str))vs.push_back(str);}
#define pb          push_back
#define mp          make_pair

vector<string> bs;
map<map<string,int>,string> art;
map<int,map<string,int> > al;

int main()
{
    int k,n,m,q;
    int i,j,l,r;
    vector<string> vs;
    map<string,int> ms;
    map<map<string,int>,string>::iterator it;
    map<string,int>::iterator its;

    cin >> k >> n >> m >> q;

    string s1,s2;
    REP(i,n)
    {
        cin >> s1;
        bs.push_back(s1);
    }

    REP(i,m)
    {
        cin >> s1;
        getline(cin,s2);
        split(s2);
        ms.clear();

        int ln=vs.size();
        for(j=0;j<ln;j+=2)
            for(l=0;l<atoi(vs[j+1].c_str());l++)
                ms[vs[j]]++;

        art[ms]=s1.substr(0,s1.size()-1);
    }

    REP(i,q)
    {
        cin >> r >> s1;
        al[r][s1]++;

        for(it=art.begin();it!=art.end();it++)
        {
            ms=it->first;
            for(its=ms.begin();its!=ms.end();its++)
                if(al[r].find(its->first)==al[r].end() || al[r][its->first]!=its->second)
                    break;

            if(its==ms.end())
            {
                for(its=ms.begin();its!=ms.end();its++)
                    al[r].erase(its->first);

                al[r][it->second]++;
            }
        }
    }

    FOR(i,1,k+1)
    {
        ms=al[i];
        cout << ms.size() << endl;
        for(its=ms.begin();its!=ms.end();its++)
            if(its->second)
                cout << its->first <<" "<< its->second << endl;
    }

    return 0;
}
