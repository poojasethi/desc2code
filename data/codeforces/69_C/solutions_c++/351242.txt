#include<iostream>
#include<cstdio>
#include<string>
#include<sstream>
#include<set>
#include<map>
#include<algorithm>


using namespace std;
int main(){
    int k,n,m,q,num;
    scanf("%d%d%d%d",&k,&n,&m,&q);
    map<string,int> mp,mp2[m],ans[k];
    string tmp,tmp2,xx[m];
    for(int i=0;i<n;i++){
        cin>>tmp;
        mp[tmp]=i;
    }
     getline(cin,tmp,'\n');
    for(int i=0;i<m;i++){
        getline(cin,tmp,'\n');
        istringstream iss(tmp);
        getline(iss,xx[i],':');
        while(getline(iss,tmp2,',')){
            istringstream iss2(tmp2);
            iss2>>tmp;
            iss2>>num;
            mp2[i][tmp]=num;
        }
    }
    for(int i=0;i<q;i++){
        cin>>num>>tmp;
        ans[num-1][tmp]++;
        for(int j=0;j<m;j++){
            bool con=true;
            for(map<string,int>::iterator it=mp2[j].begin();it!=mp2[j].end() && con;it++){
                if(it->second>ans[num-1][it->first]) con=false;
            }
            if(con){
                for(map<string,int>::iterator it=mp2[j].begin();it!=mp2[j].end();it++){
                    ans[num-1][it->first]-=it->second;  
                    if(ans[num-1][it->first]==0) ans[num-1].erase(it->first);
                }
                ans[num-1][xx[j]]++;
            }
        }
    }
    for(int i=0;i<k;i++){
         for(map<string,int>::iterator it=ans[i].begin();it!=ans[i].end();){     
            if(it->second==0) ans[i].erase(it++);
            else it++;
        }
    }

    
    for(int i=0;i<k;i++){
        cout<<ans[i].size()<<endl;
         for(map<string,int>::iterator it=ans[i].begin();it!=ans[i].end();it++){     
            cout<<it->first<<" "<<it->second<<endl;
        }
    }
    return 0;
}
            
