# include <stdio.h>
# include <stdlib.h>
# include <map>
# include <vector>
# include <string>
# include <iostream>
# include <algorithm>
using namespace std;
struct comp
{
    string palabra;
    vector <string> S;
    vector <int> N;
};
struct jug
{
    map <string,int> J;
};
comp A[52];
jug E[103];
int main(){
    map <string,int> :: iterator it;
    int k,n,m,q,i,j,t,h,val,sum=0;
    char help;
    string temp;
    scanf("%d %d %d %d",&k,&n,&m,&q);
    for(i=0;i<n;i++){
        cin>>temp;
    }
    for(j=0;j<m;j++){
        cin>>A[j].palabra;
        A[j].palabra = A[j].palabra.substr(0,A[j].palabra.size()-1);
        do
        {
            cin>>temp;
            A[j].S.push_back(temp);
            cin>>t;
            A[j].N.push_back(t);
            scanf("%c",&help);
        }while(help==',');
    }
    for(i=0;i<q;i++){
        cin>>t;
        cin>>temp;
        E[t].J[temp]++;
        for(j=0;j<m;j++){
            val=0;
            for(h=0;h<A[j].S.size() && val==0;h++){
                    if( A[j].N[h] >   E[t].J[ A[j].S[h] ] ){
                        val=1;
                    }
            }
            if(val==0){
                for(h=0;h<A[j].S.size();h++){
                    E[t].J[ A[j].S[h] ] -=A[j].N[h] ;
                }
                E[t].J[ A[j].palabra ]++;
                j=0;
            }
        }
    }
    for(i=1;i<=k;i++){
        sum=0;
        for(it=E[i].J.begin();it!=E[i].J.end();it++){
            if( it->second>0){
                sum++;
            }
        }
        printf("%d\n",sum);
        for(it=E[i].J.begin();it!=E[i].J.end();it++){
            if( it->second>0){
                cout<<it->first<<" "<<it->second<<endl;
            }
        }
    }

    return 0;
}
