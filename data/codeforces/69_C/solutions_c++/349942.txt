#include <iostream>
#include <cstdio>
#include <algorithm>
#include <map>
using namespace std;
int k,n,m,q;
string simple[1000],ext[1000];
int need[1000][1000],a[1000][1000];
map<string,int> Isimple,ans[600];

int main()
{
//	freopen("input.txt","r",stdin);
	//freopen("output.txt","w",stdout);
	cin>>k>>n>>m>>q;
	
	for (int i = 1; i <= n; i++) {                                                   
		cin>>simple[i];
		Isimple[simple[i]] = i;
	}

	for (int i = 1; i <= m; i++) {
		cin>>ext[i];
		ext[i].erase(ext[i].length()-1);
		getchar();
		while (true) {
			string s;
			cin>>s;
						
			int x;
			cin>>x;

			need[i][Isimple[s]] = x;
			if (getchar() != ',') break;
		}
	}

	for (int ii = 1; ii <= q; ii++) {
		int x;
		string s;
		cin>>x;
		cin>>s;
		
		a[x][Isimple[s]]++;

		for (int i = 1; i <= m; i++) {
			bool ok = true;
			for (int j = 1; j <= n && ok; j++)
				if (need[i][j] > a[x][j]) ok = false;
			if (ok) {

				ans[x][ext[i]]++;

				for (int j = 1; j <= n; j++)
					a[x][j] -= need[i][j];
				break;
			}
		}
	}

	

	for (int i = 1; i <= k; i++) {
		for (int j = 1; j <= n; j++)
			if (a[i][j] > 0) ans[i][simple[j]] += a[i][j];

		cout<<ans[i].size()<<endl;
		for (map<string,int> :: iterator it = ans[i].begin(); it != ans[i].end(); it++) {
			cout<<it->first<< " "<<it->second<<endl;		
		}	
	}

	return 0;             
}
