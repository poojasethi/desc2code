#include <iostream>
#include <cstdio>
#include <cstring>
#include <cmath>
#include <cstdlib>
#include <vector>
#include <string>
#include <stack>
#include <queue>
#include <map>
#include <set>
#include <list>
#include <algorithm>
#include <sstream>
using namespace std;
typedef long long LL;
#define eps (1e-8)
map<string,int> co[105];
map<string,vector<pair<string,int> > > art;
void fun(int ind)
{
	map<string,vector<pair<string,int> > >::iterator it;
	for(it=art.begin();it!=art.end();it++)
	{
		bool valid=1;
		string key=(*it).first;
		for(int i=0;i<(int)art[key].size();i++)
		{
			if(co[ind][art[key][i].first]<art[key][i].second) 
			{
				valid=0;break;
			}
		}
		if(valid)
		{
			co[ind][key]++;
			for(int i=0;i<(int)art[key].size();i++)
			{
				co[ind][art[key][i].first]-=art[key][i].second;
			}
		}
	}
}
int main()
{
	int k,n,m,q;
	scanf("%d%d%d%d",&k,&n,&m,&q);
	for(int i=0;i<n;i++) {
		string tt; cin>>tt;
	}
	string line;
	getline(cin,line);
	for(int i=0;i<m;i++)
	{
		getline(cin,line);
		istringstream in(line);
		string name,basic;
		in>>name;
		name.erase(name.size()-1);
		while(in>>basic)
		{
			int x;char chr;
			in>>x; in>>chr;
			art[name].push_back(make_pair(basic,x));
		}
	}
	for(int i=0;i<q;i++)
	{
		int ind; string str;
		cin>>ind>>str;
		co[--ind][str]++;
		fun(ind);
	}
	for(int i=0;i<k;i++)
	{
		int cnt=0;
		map<string,int>::iterator it;
		for(it=co[i].begin();it!=co[i].end();it++)
		{
			if((*it).second>0) cnt++;
		}
		printf("%d\n",cnt);
		for(it=co[i].begin();it!=co[i].end();it++)
		{
			if((*it).second>0)
				cout<<(*it).first<<" "<<(*it).second<<endl;
		}
	}
    return 0;
}
