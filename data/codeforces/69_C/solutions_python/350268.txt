#!/usr/bin/python
import itertools, math, os, random, re, sys
random.seed (1234)
k, n, m, q = [int (x) for x in sys.stdin.readline ().split ()]
base = []
for i in range (n):
	s = sys.stdin.readline ().strip ()
	base += [s]
comp = []
receipts = []
for i in range (m):
	s = sys.stdin.readline ().strip ()
	t = s.split ()
	assert t[0][-1] == ':'
	name = t[0][:-1]
	need = []
	for j in range (len (t) - 1) [::2]:
		sub = t[j + 1]
		num = t[j + 2]
		if num[-1] == ',':
			num = num[:-1]
		num = int (num)
		need += [(sub, num)]
	receipts += [(name, need)]
	comp += [name]
d = [dict ([(x, 0) for x in sorted (base + comp)]) for i in range (k)]
for i in range (q):
	p, name = sys.stdin.readline ().split ()
	p = int (p) - 1
	d[p][name] += 1
	for name, need in receipts:
		ok = True
		for sub, num in need:
			if d[p][sub] < num:
				ok = False
		if not ok:
			continue
		for sub, num in need:
			d[p][sub] -= num
		d[p][name] += 1
		break
for i in range (k):
	c = 0
	for name, num in sorted (d[i].items ()):
		if num > 0:
			c += 1
	print c
	for name, num in sorted (d[i].items ()):
		if num > 0:
			print name, num
