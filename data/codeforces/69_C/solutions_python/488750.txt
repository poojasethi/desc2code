#!/usr/bin/env python
# -*- coding: utf-8 -*-
from collections import defaultdict

k, n, m, q = map(int, raw_input().split())
baseart = list()
for _ in xrange(n):
    baseart.append(raw_input())
complexart = defaultdict(dict)
for _ in xrange(m):
    s = raw_input().split(':')
    for e in s[1].split(','):
        e = e.split()
        complexart[s[0]][e[0].strip()] = int(e[1])
basepack = defaultdict(dict)
complexpack = defaultdict(dict)
for _ in xrange(q):
    nk, thing = raw_input().split()
    nk = int(nk)
    basepack[nk][thing] = basepack[nk].get(thing, 0) + 1
    for gkey, values in complexart.items():
        add = True
        for key, value in values.items():
            if basepack[nk].get(key, -1) < value:
                add = False
                break
        if add:
            complexpack[nk][gkey] = complexpack[nk].get(gkey, 0) + 1
            for key, value in values.items():
                basepack[nk][key] -= value
for i in xrange(1, k+1):
    lst = [(key, value) for key, value in basepack[i].items() + complexpack[i].items() if value > 0]
    print len(lst)
    for key, value in sorted(lst):
        print key, value
