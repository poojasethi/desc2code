import sys
from collections import Counter

def ip2int(s):
    return reduce(lambda a,b: a<<8 | b, map(int, s.split(".")))

def int2ip(ip):
  return ".".join(map(lambda n: str(ip>>n & 0xFF), [24,16,8,0]))

n,k = map(int, raw_input().split())
ips = map(ip2int, sys.stdin.read().split())

i = 31
mask = 0
while (i >= 0):
    mask = mask | (1 << i)
    data = Counter([ip & mask for ip in ips])
    if (len(data)==k):
        print int2ip(mask)
        exit()
    i = i - 1
print -1