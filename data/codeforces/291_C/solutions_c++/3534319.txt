
#include <cstdio>
#include <algorithm>
using namespace std;

typedef long long i8;

int n, s;
unsigned ip[100111];

main() {
	scanf("%d%d", &n, &s);
	
	unsigned a,b,c,d;
	for (int i=0; i<n; i++) {
		scanf("%u.%u.%u.%u",&a,&b,&c,&d);
		ip[i]= (a<<24) | (b<<16) | (c<<8) | d;
	}
	
	sort(ip,ip+n);
	
	unsigned ma=0, x=1U<<31;
	for (int e=1; e<=31; e++) {
		ma |= x;
		x /=2;
		
		int co=0;
		unsigned on;
		for (int i=0; i<n; i++) {
			if (!i || on != (ip[i] & ma)) {
				co++;
				on=(ip[i] & ma);
			}
		}
		
		if (co==s) {
			a=ma>>24;
			b=(ma>>16) & 255;
			c=(ma>>8) & 255;
			d=ma & 255;
			printf("%u.%u.%u.%u\n", a,b,c,d);
			return 0;
		}
		if (co>s) break;
	}
	
	printf("-1\n");
}
