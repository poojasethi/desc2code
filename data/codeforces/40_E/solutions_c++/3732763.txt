#include<cstdio>
#include<cstdlib>
#include<cstring>
#include<iostream>
#include<algorithm>
#define LL long long
using namespace std;
LL mod;
int n,m,q,aa,bb;
LL ksm(int x,int y)
{
	if(y<1)
		return 1;
	LL b=ksm(x,y/2),t=(b*b)%mod;
	if(y&1)t=(t*x)%mod;
	return(t%mod);
}
int a[1005],b[1005];
int da[1005],db[1005];
int main()
{
	scanf("%d%d",&n,&m);
	if((n&1)!=(m&1))
	{
		printf("0\n");
		return 0;
	}
	scanf("%d",&q);
	int tmp=max(aa=n,bb=m);
	for(int i=1;i<=tmp;i++)
		a[i]=b[i]=1;
	for(int i=1;i<=q;i++)
	{
		int x,y,z;
		scanf("%d%d%d",&x,&y,&z);
		a[x]*=z;b[y]*=z;
		da[x]++;db[y]++;
	}
	for(int i=1;i<=tmp;i++)
	{
		if(da[i]==m)
			if(a[i]==1)
			{
				printf("0\n");
				return 0;
			}
			else
				aa--,q-=m;
		if(db[i]==n)
			if(b[i]==1)
			{
				printf("0\n");
				return 0;
			}
			else
				bb--,q-=n;
	}
	scanf("%I64d",&mod);
	printf("%I64d\n",ksm(2,(aa-1)*(bb-1)-q));
	return 0;
}
			 	    		 	 				 	    		