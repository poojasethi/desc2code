#include<stdio.h>
int getint()
{
	int ret=0;bool ok=false,neg=false;
	for(;;)
	{
		int c=getchar();
		if(c>='0'&&c<='9')ret=(ret<<3)+ret+ret+c-'0',ok=true;
		else if(ok)return neg?-ret:ret;
		else if(c=='-')neg=true;
	}
}
int n,m,K;
int rcnt[1010],ccnt[1010];
bool rrev[1010],crev[1010];
int main()
{
	n=getint(),m=getint();
	K=getint();
	int free=(n-1)*(m-1)-K;
	for(int i=1;i<=K;i++)
	{
		int x=getint(),y=getint(),v=getint();
		rcnt[x]++,ccnt[y]++;
		if(v==-1)rrev[x]^=1,crev[y]^=1;
	}
	int p=getint();
	bool ok=true;
	for(int i=1;i<=n;i++)if(rcnt[i]==m)
	{
		free++;
		if(!rrev[i])ok=false;
	}
	for(int i=1;i<=m;i++)if(ccnt[i]==n)
	{
		free++;
		if(!crev[i])ok=false;
	}
	if((n^m)&1)ok=false;
	if(!ok)puts("0");
	else
	{
		int ans=1;
		for(int i=1;i<=free;i++)ans=(ans+ans)%p;
		printf("%d\n",ans);
	}
	return 0;
}
