#include <cstdio>
#include <cstdlib>
#include <cstring>
#include <algorithm>
#include <iostream>
using namespace std;

const int maxn = 1005;
int s[maxn], p[maxn];
int n, m, mod, ans;

int main() {
    int k, i, j, x, y, z;
    scanf("%d%d%d", &n, &m, &k);
    if ((n + m) & 1) {
        puts("0"); return 0;
    }
    while (k--) {
        scanf("%d%d%d", &x, &y, &z);
        if (n < m) swap(x, y);
        ++s[x]; p[x] ^= (1 - z) / 2;
    }
    scanf("%d", &mod); if (n < m) swap(n, m);
    for (i = 1, k = 0, ans = 1; i <= n; ++i) {
        if (!s[i] && !k) k = i;
        else if (s[i] == m && !p[i]) ans = 0;
        else {
            for (j = 1; j <= m - s[i] - 1; ++j)
                ans = (ans + ans) % mod;
        }
    }
    printf("%d\n", ans);
    return 0;
}
