#include <iostream>
#include <cstdio>
#include <cstring>
#include <cstdlib>
using namespace std;

int cnt[1000], sum[1000];
int n, m, K, P;

int main() {
//  freopen("data.in", "r", stdin);
    scanf("%d%d%d", &n, &m, &K);
    if (abs(n - m) % 2 == 1) {
        printf("0\n");
        return 0;
    }
    bool flg = false;
    if (n > m) swap(n, m), flg = true;
    for (int i = 0; i < K; i++) {
        int x, y, z; scanf("%d%d%d", &x, &y, &z); x--; y--;
        if (flg) swap(x, y);
        cnt[y]++; sum[y] += z == -1;
    }
    scanf("%d", &P);
    for (int i = 0; i < m; i++) if (cnt[i] == n) {
        if (sum[i] % 2 == 0) {
            printf("0\n");
            return 0;
        } else K--;
    }
    n = (n - 1) * (m - 1) - K;
    int ret = 1;
    for (int i = 0; i < n; i++) ret = ret * 2 % P;
    printf("%d\n", ret);
    return 0;
}