#include<cstdio>
#include<cstdlib>
#include<cstring>
#include<algorithm>
using namespace std;

int n, m, k, MOD;
int c[1010], f[1010];

int main()
{
	// freopen("e.in","r",stdin);
	scanf("%d%d",&n,&m);
	bool flag = true;
	if (n < m)
	{
		swap(n,m);
		flag = false;
	}
	
	scanf("%d",&k);
	memset(c,0,sizeof(c));
	for (int i = 1; i <= n; ++i) f[i] = 1;
	int x, y, t;
	for (int i = 1; i <= k; ++i)
	{
		if (flag) scanf("%d%d%d",&x,&y,&t);
		else scanf("%d%d%d",&y,&x,&t);
		c[x]++;
		f[x] *= t;
	}
	int i;
	for (i = 1; i <= n && c[i] > 0; ++i);
	swap(c[i],c[n]);
	swap(f[i],f[n]);
	scanf("%d",&MOD);
	
	int ans = 1;
	for (int i = 1; i < n; ++i)
		if (c[i] == m)
		{
			if (f[i] != -1) ans = 0;
		} else
			for (int j = 1; j <= m - 1 - c[i]; ++j) ans = (ans * 2) % MOD;
	if ((n + m) & 1) ans = 0;
	printf("%d\n",ans);
	return 0;
}
