#include <cstdio>
#include <cstring>
#include <algorithm>
using namespace std;
int a[1010],b[1010];
int i,j,k,n,m,t,x,y,z,p,ans;
void work()
{
 if ((n+m&1)==0)ans=1;
 else ans=0;
 for(i=1;i<=n;i++)
  {
  if(a[i]==0&& k==0) k=i;
   else if(a[i]==m && b[i]==1) ans=0;
     else 
      {
       for(j=1;j<=m-a[i]-1;j++) ans=ans*2%p;
      }
  }
}
int main()
{
 //freopen("40E.in","r",stdin);
 //freopen("40E.out","w",stdout);
 scanf("%d %d %d\n",&n,&m,&t);
 for(i=1;i<=max(n,m);i++)b[i]=1;
 for(i=1;i<=t;i++)
  {
   scanf("%d%d%d",&x,&y,&z);
   if(n<m)swap(x,y);
   a[x]++;
   b[x]=b[x]*z;
  }
 if(n<m) swap(n,m);
 scanf("%d",&p);
 work();
 printf("%d\n",ans);
 return 0;
}