#include<cstring>
#include<cstdlib>
#include<cstdio>
#include<cmath>
#include<iostream>
#define N 1100
#define LL long long
using namespace std;
int n,m,z[N],f[N],c[N][N],ans;
LL mmod;
int main()
{
	int o=0,k;
	scanf("%d%d",&n,&m);
	if(n<m) swap(n,m),o=1;
	scanf("%d",&k);
	for(int i=1;i<=k;i++)
	{
		int x,y,d;
		scanf("%d%d%d",&x,&y,&d);
		if(o) swap(x,y);
		if(d==1) z[x]++;
		else f[x]++;
	}
	scanf("%I64d",&mmod);
	c[0][0]=1;
	for(int i=1;i<=m;i++)
	{
		c[i][0]=1;
		for(int j=1;j<=i;j++) c[i][j]=(c[i-1][j]+c[i-1][j-1])%mmod;
	}
	if(n%2!=m%2) {printf("0\n");return 0;}
	bool bo=0;
	ans=1;
	for(int i=1;i<=n;i++)
	{
		if(z[i]==0 && f[i]==0 && bo==0) {bo=1;continue;}
		if(f[i]%2) o=0;
		else o=1;
		int t=m-z[i]-f[i];
		LL s=0;
		for(int j=o;j<=t;j+=2)
			s=(s+c[t][j])%mmod;
		ans=((LL)ans*s)%mmod;
	}
	printf("%d\n",ans);
	return 0;
}