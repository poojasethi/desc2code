#include<stdio.h>
int getint()
{
    int r=0,c;
    bool b=0,g=0;
    while(1)
    {
        c=getchar();
        if(c>='0'&&c<='9'){r=(r<<3)+r+r+c-'0';b=1;}
        else if(b)return g?-r:r;else if(c=='-')g=1;
    }
}
int r1[1005],c1[1005];
bool r2[1005],c2[1005];
int main()
{
    int i,n,m,p,k,x,y,v,s,h;
    bool b;
    n=getint();m=getint();k=getint();h=(n-1)*(m-1)-k;
    for(i=1;i<=k;i++)
    {
        x=getint();y=getint();v=getint();r1[x]++;c1[y]++;
        if(v==-1){r2[x]^=1;c2[y]^=1;}
    }
    p=getint();b=1;
    for(i=1;i<=n;i++)if(r1[i]==m){h++;if(!r2[i])b=0;}
    for(i=1;i<=m;i++)if(c1[i]==n){h++;if(!c2[i])b=0;}
    if((n^m)&1)b=0;
    if(!b)printf("0\n");
    else
    {
        for(s=1,i=1;i<=h;i++)s=(s+s)%p;
        printf("%d\n",s);
    }
    return 0;
}