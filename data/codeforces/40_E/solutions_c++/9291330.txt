#include<cstdio>
#include<cstring>
using namespace std;
int n,m;
int k,p;
int gs[1001],sm[1001];
int fl;
long long s=1;
int main()
{
	int i,j;
	scanf("%d%d%d",&n,&m,&k);
	if((n^m)&1){printf("0\n");return 0;}
	if(n<m){int t=n;n=m;m=t;fl=1;}
	memset(sm,-1,sizeof(sm));
	for(i=1;i<=k;i++)
	{
		int x,y,c;
		scanf("%d%d%d",&x,&y,&c);
		if(fl){gs[y]++;sm[y]*=c;}else{gs[x]++;sm[x]*=c;}
	}
	scanf("%d",&p);
	int fg=0;
	for(i=1;i<=n;i++)
	{
		if(!fg&&!gs[i])fg=1;else
		{
			if(gs[i]==m&&sm[i]<0){printf("0\n");return 0;}
			for(j=1;j<=m-gs[i]-1;j++){s<<=1;s%=p;}
		}
	}
	printf("%I64d\n",s);
	return 0;
}
