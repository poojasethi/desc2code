#include <stdio.h>

int r[1005], c[1005];
int rp[1005], cp[1005];

int main(void) {
	int n, m, k, p;
	scanf("%d%d", &n, &m);
	scanf("%d", &k);
	int v=(n-1)*(m-1)-k;
	while(k--) {
		int x, y, z;
		scanf("%d%d%d", &x, &y, &z);
		r[x]++;
		c[y]++;
		if(z==-1) {
			rp[x]=!rp[x];
			cp[y]=!cp[y];
		}
	}
	int flag=0;
	for(int i=1;i<=n;i++) {
		if(r[i]==m) {
			++v;
			if(!rp[i]) flag=1;
		}
	}
	for(int i=1;i<=m;i++) {
		if(c[i]==n) {
			++v;
			if(!cp[i]) flag=1;
		}
	}
	scanf("%d", &p);
	if((n%2==0) ^ (m%2==0)) flag=1;
	if(flag) puts("0");
	else {
		int ans=1;
		for(int i=0;i<v;i++)
			ans = ans*2%p;
		printf("%d\n", ans);
	}
	return 0;
}
