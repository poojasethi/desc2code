#include<cstdio>
int x[1111],y[1111],sx[1111],sy[1111];
int main(){
    int n,m,i,a,b,c,k,p,ans=0;
    scanf("%d%d%d",&n,&m,&k);
    for (i=0;i<=1000;i++) sx[i]=sy[i]=1;
    for (i=0;i<k;i++){
        scanf("%d%d%d",&a,&b,&c);
        x[a]++,y[b]++,sx[a]*=c,sy[b]*=c;
    }
    for (i=1;i<=n || i<=m;i++)
        if ((x[i]==m?++ans:0) && sx[i]==1 || (y[i]==n?++ans:0) && sy[i]==1) break;
    if (i<=n || i<=m || ((n+m)&1)) {puts("0"); return 0;}
    if (n==2 || m==2){
        for (i=1;i<=n || i<=m;i++) if (!x[i] || !y[i]) break;
        if (i>m && i>n && (n==2 && sx[1]*sx[2]==-1 || m==2 && sy[1]*sy[2]==-1)) {puts("0"); return 0;}
    }
    scanf("%d",&p);
    for (i=1,ans+=(n-1)*(m-1)-k;ans>0;ans--) i=i*2%p;
    printf("%d\n",i);
}