#include <iostream>
#include <algorithm>
using namespace std;
bool flag;
int n,m,i,j,k,x,y,z,p,A[1011],B[1011];
long long ans;
int main()
{
    cin >> n >> m;
    if ((n+m)&1)
    {
       cout << 0;
       return 0;
    }
    if (n<m)
    {
       swap(n,m);
       flag=true;
    }
    cin >> k;
    for (i=1;i<=k;i++)
    {
        cin >> x >> y >> z;
        if (flag) swap(x,y);
        if (z==-1) B[x]^=1;
        A[x]++;
    }
    for (i=1;i<=n;i++)
        if (A[i]==m)
        {
           if (B[i]==0)
           {
              cout << 0;
              return 0;
           }
           k--;
        }
    cin >> p;
    ans=1;
    for (i=1;i<=n*m-n-m+1-k;i++) (ans*=2)%=p;
    cout << ans;
    return 0;
}
