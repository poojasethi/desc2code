//#define FILE_IO

#include<iostream>
#include<algorithm>
#include<cstdio>
#include<cstring>

using std::max;
using std::swap;

typedef long long ll;

const int maxn=1010;
int n,m,P;
int c[maxn],T[maxn],b[maxn];

int main(){
#ifdef FILE_IO
  freopen("t.in","r",stdin);
  freopen("t.out","w",stdout);
#endif
  int i,x,y,w,ans,K;
  bool flag=0;
  scanf("%d%d%d",&n,&m,&K);
  if((n^m)&1)return puts("0");
  if(n<m)swap(n,m),flag=1;
  for(i=1;i<=n;++i)T[i]=1;
  while(K--){
    scanf("%d%d%d",&x,&y,&w);
    if(flag)swap(x,y);
    c[x]++,T[x]*=w;
  }
  scanf("%d",&P);
  for(b[0]=1,i=1;i<=n;++i)b[i]=b[i-1]*2%P;
  ans=1,flag=0;
  for(i=1;i<=n;++i)
    if(c[i]==m)
      if(T[i]==1)
        return puts("0");
      else ;
    else if(!c[i]&&!flag)
      flag=1;
    else ans=(ll)ans*b[m-c[i]-(c[i]!=m)]%P;
  printf("%d",ans);
  return 0;
}
