#include<cstdio>
#include<cstdlib>
#include<algorithm>
using namespace std;
int m,M,sh;
long long n,u,v,l,r;
long long SH(long long x){ return (x%M+M)%M; }
long long Q(long long x,long long pst,long long key,long long base,long long st){
     if(pst == 0 || key == 0 ) return 0;
     if(x == 1) return base;
     if(pst <= (x+1)/2){
          return Q((x+1)/2,pst,(key+1)/2,base,st*2);
     }
     else
        return SH( SH( (min(key,x)+1)/2*base + SH(st)*SH(SH(((min(key,x)+1)/2-1))*SH(((min(key,x)+1)/2)))) + Q(x/2,pst-(x+1)/2,key/2,base+st,st*2));
}
int main(){
    scanf("%I64d %d %d",&n,&m,&M);
    while(m){
        m--;
        scanf("%I64d %I64d %I64d %I64d",&l,&r,&u,&v);
        //printf("%I64d : %I64d : %I64d : %I64d\n",Q(n,r,v,1,1),Q(n,r,u-1,1,1),Q(n,l-1,u-1,1,1),Q(n,l-1,v,1,1));
        printf("%I64d\n",SH(Q(n,r,v,1,1)-Q(n,r,u-1,1,1)+Q(n,l-1,u-1,1,1)-Q(n,l-1,v,1,1)));         
    }
    //system("pause");
    return 0;
}
