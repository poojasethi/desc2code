#include <cstdio>
#define LL long long

LL      n,p,l,r,u,v;
int     m;

LL  Ans(LL l,LL r,LL ll,LL rr,LL u,LL v,LL s,LL d){
    if (l==ll && r==rr){
        if (v<s)    return  0;
        LL  a=(u-s+d-1)/d,b=(v-s)/d;
        if (a<0)
            a=0;
        if (b>r-l)
            b=r-l;
        if (a>r-l || a>b)
            return  0;
        if ((a+b)&1)
            return  ((b-a+1)%p*(s%p)+((a+b)%p)*((b-a+1)/2%p)%p*(d%p))%p;
        else
            return  ((b-a+1)%p*(s%p)+((a+b)/2%p)*((b-a+1)%p)%p*(d%p))%p;
    }
    else{
        LL  mid=l+r>>1;
        if (rr<=mid)
            return  Ans(l,mid,ll,rr,u,v,s,d*2);
        else
        if (ll>mid)
            return  Ans(mid+1,r,ll,rr,u,v,s+d,d*2);
        else
            return  (Ans(l,mid,ll,mid,u,v,s,d*2)+Ans(mid+1,r,mid+1,rr,u,v,s+d,d*2))%p;
    }
}

int main(){
    
    scanf("%I64d%d%I64d",&n,&m,&p);
    for (int i=1;i<=m;i++){
        scanf("%I64d%I64d%I64d%I64d",&l,&r,&u,&v);
        printf("%I64d\n",Ans(1,n,l,r,u,v,1,1));
    }
    
    return 0;
}
