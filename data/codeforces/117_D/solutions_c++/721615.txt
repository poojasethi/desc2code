#include <cstdio>
#include <cstring>
#include <iostream>

using namespace std ;

int m, mod ;
__int64 n ;

__int64 get (__int64 a0, __int64 d, __int64 num, __int64 r, __int64 v)
{
    if (!r || a0 > v) return 0 ;
    __int64 mid = num + 1 >> 1 ;
    d *= 2 ;
    if (r < mid) return get (a0, d, mid, r, v) ;
    __int64 x = min (mid, (v - a0) / d + 1) ;
    __int64 sum = (a0 % mod + (x - 1) % mod * (d / 2 % mod) % mod) * (x % mod) % mod ;
    return (sum + get (a0 + d / 2, d, num >> 1, r - mid, v)) % mod ;
}

int main ()
{
    scanf ("%I64d%d%d", &n, &m, &mod) ;
    for (int i = 0; i < m; i ++ )
    {
        __int64 l, r, u, v ;
        scanf ("%I64d%I64d%I64d%I64d", &l, &r, &u, &v) ;
        printf ("%I64d\n", (get (1, 1, n, r, v) - get (1, 1, n, r, u - 1) - 
                (get (1, 1, n, l - 1, v) - get (1, 1, n, l - 1, u - 1)) + mod * 2) % mod) ;
    }
    //system ("pause") ;
    return 0 ;
}
