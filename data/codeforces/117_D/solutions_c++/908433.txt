#include<iostream>
#include<cstdio>

typedef long long LL;

using namespace std;

LL n, m, mo;

inline LL ceil(LL a, LL b){
	if (a<1) return 0; else return (a-1)/b+1;
}

inline LL floor(LL a, LL b){
	if (a<0) return -1; else return a/b;
}

LL solve(LL b, LL n, LL l, LL r, LL u, LL v, LL d){
	if (l==1 && r==n){
		LL less=max(0LL, ceil(u-b, d)), more=min(n-1, floor(v-b, d));
		if (less>more) return 0;
		LL tmp=(b*2%mo+d%mo*((less%mo+more%mo)%mo)%mo)%mo*((more-less+1)%mo)%mo;
		return tmp;
	}
	LL ret=0, odd=(n+1)/2, even=n-odd;
	if (l>odd) ret=solve(b+d, even, l-odd, r-odd, u, v, d+d);
	else if (r<=odd) ret=solve(b, odd, l, r, u, v, d+d);
	else
		ret+=solve(b, odd, l, odd, u, v, d+d),
		ret+=solve(b+d, even, 1, r-odd, u, v, d+d);
	ret%=mo;
	return ret;
}

int main(){
	//freopen("D.in", "r", stdin);
	cin.sync_with_stdio(false);
	cin>>n>>m>>mo; mo*=2;
	for (;m;m--){
		LL l, r, u, v;
		cin>>l>>r>>u>>v;
		LL res=solve(1, n, l, r, u, v, 1);
		cout<<res/2<<endl;
	}
}
