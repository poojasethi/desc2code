#include <cstdio>
#include <algorithm>
#define LL long long int
using namespace std;

LL n,MOD,l,r,u,v;
int m;

LL query(LL x,LL y,LL s,LL st,LL ed,LL l,LL r,LL u,LL v){

	

	if (l<=st && r>=ed){
		if (x>v || y<u) return 0;
		LL hd = max(((u+s-x-1)/s)*s,0LL)+x,tl = min(y-x,((v-x)/s)*s)+x;
		//printf(" HD = %I64d TL = %I64d, S = %I64d, x = %I64d, y = %I64d, u = %I64d, v = %I64d\n",hd,tl,s,x,y,u,v);
		if (tl>=hd){
			LL sum = (hd+tl)%MOD, term = ((tl-hd)/s+1)%MOD;
			return (sum*term)%MOD;
		}
		else return 0;
	}
	else {
		LL c = (y-x)/s+1,x_,y_,st_,ed_,l_,r_,TT=0;
		//Left
			x_ = x;
			y_ = (c&1?y:y-s);
			st_= st;
			ed_= st+(c-1)/2;
			l_ = max(l,st_);
			r_ = min(r,ed_);
			if (r_>=l_)
				TT += query(x_,y_,s*2,st_,ed_,l_,r_,u,v);
		//Right
		if (y!=x){
			x_ = x+s;
			y_ = (c&1?y-s:y);
			st_= ed_+1;
			ed_= ed;
			l_ = max(l,st_);
			r_ = min(r,ed_);
			if (r_>=l_)
				TT+= query(x_,y_,s*2,st_,ed_,l_,r_,u,v);
			return TT%MOD;
		}	
	}
}

int main(){
	scanf("%I64d%d%I64d",&n,&m,&MOD);
	MOD *= 2;
	for (int i=0;i<m;i++){
		scanf("%I64d%I64d%I64d%I64d",&l,&r,&u,&v);
		printf("%I64d\n",query(1,n,1,1,n,l,r,u,v)/2);
	}
	return 0;
}
