#include<iostream>
#include<sstream>
#include<vector>
#include<algorithm>
#include<cstdio>
#include<cstdlib>
#include<cstring>
#include<cmath>
#define rep(i,n) for(int i=0;i<n;i++)
#define fr(i,c) for(__typeof (c.begin()) i=c.begin(); i!=c.end(); i++)
#define all(c) (c).begin(), (c).end()
#define pb push_back
using namespace std;

typedef vector<int> vi;
typedef long long ll;

int mod;
ll u,v;
int query(ll l,ll r,ll a,ll b,ll a0,ll d){
  //cerr<<l<<" "<<r<<" "<<a<<" "<<b<<" "<<a0<<" "<<d<<endl;
  if(r<a||b<l)return 0;
  if(l<=a&&b<=r){
    ll s=a0,t=a0+d*(b-a);
    if(s<u)s+=((u-s)/d+((u-s)%d!=0))*d;
    if(t>v)t-=((t-v)/d+((t-v)%d!=0))*d;
    
    //cerr<<"s: "<<s<<" t: "<<t<<endl;
    if(s>t)return 0;
    ll n=(t-s)/d+1;
    s+=t; if(s%2==0)s/=2; else n/=2;
    return n%mod*(s%mod)%mod;
  }
  return (query(l,r,a,(a+b)/2,a0,d*2)+query(l,r,(a+b)/2+1,b,a0+d,d*2))%mod;
}
void run(){
  ll n,l,r; int m;
  cin>>n>>m>>mod;
  rep(i,m){
    cin>>l>>r>>u>>v;
    cout<<query(l,r,1,n,1,1)<<endl;
  }
}
int main(){
#ifndef ONLINE_JUDGE
  //rep(i,3)
#endif
    run();
  return 0;
}
