#include "stdio.h"
typedef unsigned long long lld;
lld n,m,MOD,mn,mx,ans,l,r;
inline void calc(lld he,lld N,lld d,lld l,lld r){
    if (he>mx||he+(N-1)*d<mn) return;
    if (l==1&&r==N){
        lld st,ed;
        if (he>=mn)  st=1;  else st=(mn-he-1)/d+2;
        if (mx>=he+(N-1)*d) ed=N; else ed=(mx-he)/d+1;
        lld a=he*2+(st+ed-2)*d,b=ed-st+1; 
        if (a&1) b>>=1; else a>>=1;
        ans=(ans+((a%MOD)*(b%MOD))%MOD)%MOD;return;
    } 
    if (r<=((N+1)>>1)) calc(he,((N+1)>>1),d*2,l,r);
    else if (l>((N+1)>>1)) calc(he+d,N-((N+1)>>1),d*2,l-((N+1)>>1),r-((N+1)>>1));
    else calc(he,((N+1)>>1),d*2,l,((N+1)>>1)),calc(he+d,N-((N+1)>>1),d*2,1,r-((N+1)>>1));
}
int main(){
    scanf("%I64d%I64d%I64d",&n,&m,&MOD);
    while(m--){
        scanf("%I64d%I64d%I64d%I64d",&l,&r,&mn,&mx);ans=0;
        calc(1,n,1,l,r);printf("%I64d\n",ans);
    }
    return 0;
}
