#include <cstdio>
#include <algorithm>

using namespace std;

long long n,u,v;
int m,p;

long long cal(long long l,long long r,long long x,long long y,long long a,long long d)
{
  long long s=r-l+1;
  if((v<a)||(u>a+(s-1)*d))
    return 0;
  if((l==x)&&(r==y))
  {
    long long h=a+((max(u,a)-a-1+d)/d)*d,e=a+min((v-a)/d,s-1)*d;
    long long t=(e-h)/d+1;
    if(t%2==0)
      return (h+e)%p*((t/2)%p)%p;
    return ((h+e)/2)%p*(t%p)%p;
  }
  long long mid=(l+r)/2;
  if(y<=mid)
    return cal(l,mid,x,y,a,d*2);
  if(x>mid)
    return cal(mid+1,r,x,y,a+d,d*2);
  return (cal(l,mid,x,mid,a,d*2)+cal(mid+1,r,mid+1,y,a+d,d*2))%p;
}

int main(void)
{
  scanf("%I64d %d %d",&n,&m,&p);
  for(int i=1;i<=m;++i)
  {
    long long j,k;
    scanf("%I64d %I64d %I64d %I64d",&j,&k,&u,&v);
    long long ans=cal(1,n,j,k,1,1);
    printf("%I64d\n",ans);
  }
  return 0;
}