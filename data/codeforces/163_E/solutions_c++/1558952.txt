#include"stdio.h"
#include"string.h"
#include"algorithm"
#include"queue"
#include"map"
using namespace std;
int chd[1000003][26];
int word[1000004];
int ok[100004];
int fail[1000004],que[1000004],sz=1;
char a[1200003];
bool ha[1200004];
int n,k,x;
void ins(char *s,int val)
{
	int p=0;
	for(;*s;s++){
		int c=*s-'a';
		if(!chd[p][c])
		     chd[p][c]=sz++;
		p=chd[p][c];
	}
	word[p]=val;
	ha[p]=1;
}
void AC()
{
	int *s=que,*e=que;
	for(int i=0;i<26;i++)
	if(chd[0][i]){
	   fail[chd[0][i]]=0;
	   *e++=chd[0][i];
	}
	while(s!=e){
		int p=*s++;
		for(int i=0;i<26;i++)
		if(chd[p][i]){
			int v=chd[p][i];
			*e++=v;
			fail[v]=chd[fail[p]][i];
			ha[v]|=ha[fail[v]];
		}else{
			chd[p][i]=chd[fail[p]][i];
		}
	}
}
int main()
{
//	freopen("1.in","r",stdin);
    scanf("%d %d",&n,&k);
    for(int i=0;i<k;i++)
    {
    	scanf("%s",a);
    	ins(a,i+1);
    }
    AC();
    for(int i=0;i<n;i++)
    {
    	scanf("%s",a);
    	if(a[0]=='+')
    	{
	    	sscanf(a+1,"%d",&x);
	    	ok[x]=0;
	    }
	    if(a[0]=='-')
	    {
    		sscanf(a+1,"%d",&x);
	    	ok[x]=1;
    	}
    	ok[0]=1;
    	if(a[0]=='?')
    	{
	    	char *w=a+1;
	    	int st=0,ans=0;
	    	for(;*w;w++)
	    	{
	    		int c=*w-'a';
	    		st=chd[st][c];
	    		int sp=st;
	    		//printf("%d %d\n",c,sp);
				while(ha[sp])
				{
					if(!ok[word[sp]])
					ans++;
					sp=fail[sp];
				}
	    	}
	    	printf("%d\n",ans);
	    }
    }
	return 0;
}
 					   	 			  					   	