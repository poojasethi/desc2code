#include<cstdio>
#define MAXN 1100000

int E_f[MAXN],E_x[2*MAXN],E_y[2*MAXN],T(1),
	t(1),c[MAXN][26],q[MAXN],n,m,s[MAXN],L,P[MAXN],
	Beg[MAXN],End[MAXN],Cnt[2*MAXN],len,bl[MAXN];
	
long long Ans;

char Chr;

void Add(int a,int b){for(;a<=len;a+=a&-a)Cnt[a]+=b;}	

int Sum(int a)
{	int b(0);
	for(;a;a&=a-1)b+=Cnt[a];
	return b;
}	

void read(int&x)
{	for(;(Chr=getchar())<'0';);
	for(x=Chr-'0';(Chr=getchar())>='0';x=x*10+Chr-'0');
}

void reads(int K)
{	int i,k;
    for(L=0;(Chr=getchar())<'a';);
	for(s[L++]=Chr-'a';(Chr=getchar())>='a';s[L++]=Chr-'a');
	for(i=0,k=1;i<L;k=c[k][s[i++]])if(!c[k][s[i]])c[k][s[i]]=++t;
	P[K]=k;
}

void readc(int&i)
{	for(;(Chr=getchar())<'+';);
	i=Chr;
}

void reads2()
{	for(L=0;(Chr=getchar())<'a';);
	for(s[L++]=Chr-'a';(Chr=getchar())>='a';s[L++]=Chr-'a');
}

void In(int a,int b){E_x[T]=E_f[a];E_y[T]=b;E_f[a]=T++;}

void Build()
{	int i,j,k,l;
	for(s[i=0]=j=1;i<j;i++)
		for(k=0;k<26;k++)
			if(c[s[i]][k])
			{	s[j++]=c[s[i]][k];
				for(l=q[s[i]];!c[l][k];l=q[l]);
				q[c[s[i]][k]]=c[l][k];
				In(q[c[s[i]][k]],c[s[i]][k]);
			}
}

void Dfs()
{	int i;
    len++;
    Beg[1]=len;
	for(s[i=0]=1;i>=0;)
	if(E_f[s[i]])
	{	s[i+1]=E_y[E_f[s[i]]];
		E_f[s[i]]=E_x[E_f[s[i]]];
		i++;
		len++;
		Beg[s[i]]=len;
	}
	else
	{	len++;
		End[s[i]]=len;
        i--;
	}
}

void Solve()
{	int i,k;
	Ans=0;
	for(i=0,k=1;i<L;)
	{	for(;!c[k][s[i]];k=q[k]);
	    k=c[k][s[i++]];
        Ans+=Sum(Beg[k]);
	}
	printf("%I64d\n",Ans);
}

int main()
{	int i,j;
	//freopen("e.in","rb",stdin);
//	freopen("e.out","wb",stdout);
	read(n);
	read(m);
	for(i=1;i<=m;i++)reads(i);
	for(i=0;i<26;i++)c[0][i]=1;
	Build();
	Dfs();
	for(i=1;i<=m;i++)
	{   Add(Beg[P[i]],1);
	    Add(End[P[i]],-1);
	    bl[i]=1;
    }
	for(;n--;)
	{	readc(i);
		if(i=='+')
		{	read(j);
			if(!bl[j])
			{	Add(Beg[P[j]],1);
				Add(End[P[j]],-1);
				bl[j]=1;
			}
		}
		else if(i=='-')
		{	read(j);
			if(bl[j])
			{	Add(Beg[P[j]],-1);
				Add(End[P[j]],1);
				bl[j]=0;
			}
		}
		else
		{	reads2();
			Solve();
		}
	}
	return 0;
}
