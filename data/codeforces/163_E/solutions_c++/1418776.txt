#include<cstdio>
#include<cstring>
#include<algorithm>
using namespace std;
int n,m,vt,x,ans,tot,qh,qt,ti,v[1000010],to[1000010],head[1000010],st[1000010],ed[1000010];
int q[1000010],id[1000010],ok[1000010],cnt[1000010],next[1000010][26],f[1000010],c[1000010];
char ch[1000010],s[1000010];
void add(int u1,int v1){
    v[++vt]=v1;to[vt]=head[u1];head[u1]=vt;
}
void dfs(int k){
    st[k]=++ti;
    for(int i=head[k];i;i=to[i])
        dfs(v[i]);
    ed[k]=ti;
}
void ins(int x,int w){
    for(int i=x;i<=tot+1;i+=(i&(-i)))c[i]+=w;
}
void sum(int x){
    for(int i=x;i>0;i-=(i&(-i)))ans+=c[i];
}
int main(){
    scanf("%d%d",&m,&n);
    for(int i=1;i<=n;++i){
        scanf("%s",ch);
        int p=0,len=strlen(ch);
        for(int j=0;j<len;++j){
            if(!next[p][ch[j]-'a'])next[p][ch[j]-'a']=++tot;
            p=next[p][ch[j]-'a'];
        }
        id[i]=p;ok[i]=1;
    }
    q[++qt]=0;
    while(qh<qt){
        int p=q[++qh];
        for(int i=0;i<26;++i)
            if(next[p][i]){
                if(p)f[next[p][i]]=next[f[p]][i];
                q[++qt]=next[p][i];
            }
            else if(p)next[p][i]=next[f[p]][i];
    }
    for(int i=1;i<=tot;++i)add(f[i],i);
    dfs(0);
    for(int i=1;i<=n;++i)
        ins(st[id[i]],1),ins(ed[id[i]]+1,-1);
    for(int i=1;i<=m;++i){
        scanf("%s",ch);
        if(ch[0]=='?'){
            sscanf(ch+1,"%s",s);
            int p=0,len=strlen(s);
            ans=0;
            for(int j=0;j<len;++j){
                p=next[p][s[j]-'a'];
                sum(st[p]);
            }
            printf("%d\n",ans);
        }else
        if(ch[0]=='+'){
            sscanf(ch+1,"%d",&x);
            if(!ok[x]){
                ok[x]=1;
                ins(st[id[x]],1),ins(ed[id[x]]+1,-1);
            }
        }else{
            sscanf(ch+1,"%d",&x);
            if(ok[x]){
                ok[x]=0;
                ins(st[id[x]],-1),ins(ed[id[x]]+1,1);
            }
        }
    }
    return 0;
}
