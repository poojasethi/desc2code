#include<stdio.h>
int  nx[1000514][26],spt;
int  fl[1000514];
int efl[1000514];
int  ed[1000514];
int ing[100514];
int lik[100514];
int newnode(){
	for(int i=0;i<26;i++)
		nx[spt][i]=0;
	ed[spt]=0;
	return spt++;
	}
void add(char*s,int p,int id){
	for(int i=0;s[i];i++){
		int a=s[i]-'a';
		if(nx[p][a]==0)
			nx[p][a]=newnode();
		p=nx[p][a];
		}
	ed[p]++;
	lik[id]=p;
	}
int q[1000514],qs,qe;
void make_fl(int root){
	 fl[root]=0;
	efl[root]=0;
	qs=qe=0;
	q[qe++]=root;
	for(;qs!=qe;){
		int p=q[qs++];
		for(int i=0;i<26;i++){
			int t=nx[p][i];
			if(t==0)
				continue;
			int tmp=fl[p];
			for(;tmp&&nx[tmp][i]==0;tmp=fl[tmp]);
			 fl[t]=tmp==0?root:nx[tmp][i];
			efl[t]=ed[fl[t]]?fl[t]:efl[fl[t]];
			q[qe++]=t;
			}
		}
	}
int ans;
void match(char*t,int root){
	int p=root;
	for(int i=0;t[i];i++){
		int a=t[i]-'a';
		for(;p&&nx[p][a]==0;p=fl[p]);
		if(p==0)
			p=root;
		else
			p=nx[p][a];
		ans+=ed[p];
		for(int tmp=efl[p];tmp;tmp=efl[tmp])
			ans+=ed[tmp];
		}
	}
int n,k,root;
char s[1000514];
void sol(){
	spt=1;
	root=newnode();
	for(int i=1;i<=k;i++){
		scanf("%s",s);
		add(s,root,i);
		ing[i]=1;
		}
	make_fl(root);
	int tmp;
	for(int i=0;i<n;i++){
		scanf("%s",s);
		if(*s=='+'){
			sscanf(s+1,"%d",&tmp);
			if(ing[tmp]==0){
				ing[tmp]=1;
				ed[lik[tmp]]++;
				}
			}
		if(*s=='-'){
			sscanf(s+1,"%d",&tmp);
			if(ing[tmp]==1){
				ing[tmp]=0;
				ed[lik[tmp]]--;
				}
			}
		if(*s=='?'){
			ans=0;
			match(s+1,root);
			printf("%d\n",ans);
			}
		}
	}

int main(){
	//freopen("in.txt","r",stdin);
	//freopen("0.txt","w",stdout);
	scanf("%d %d",&n,&k);
	sol();
	return 0;
	}
