#include <iostream>
#include <string>
#include <string.h>
using namespace std;

const int maxn = 1000010;

int sz;
int ch[maxn][26];
int fail[maxn];
int val[maxn];
int ok[maxn];

int que[maxn];
int idx[maxn];

string a;

void build(int id) {
	int p = 0;
	for (int i = 0; a[i]; i++) {
		int c = a[i] - 'a';
		if (!ch[p][c]) {
			memset(ch[sz], 0, sizeof(ch[sz]));
			val[sz] = 0;
			ok[sz] = 0;
			ch[p][c] = sz++;
		}
		p = ch[p][c];
	}
	val[p] = 1;
	ok[p] = 1;
	idx[id] = p;
}

void AC() {
	int s = 1;
	int e = 1;
	for (int i = 0; i < 26; i++) if (ch[0][i]) {
		fail[ch[0][i]] = 0;
		que[e++] = ch[0][i];
	}
	while (s != e) {
		int p = que[s++];
		for (int i = 0; i < 26; i++) {
			if (ch[p][i]) {
				int v = ch[p][i];
				que[e++] = v;
				fail[v] = ch[fail[p]][i];
				val[v] += val[fail[v]]; 
			}
			else {
				ch[p][i] = ch[fail[p]][i];
			}
		}
	}
}

int getNum() {
	int x = 0;
	for (int i = 1; a[i]; i++) {
		x = x * 10 + a[i] - '0';
	}
	return x;
}

int main() {

	int n;
	int k;
	
	cin >> n >> k;
	sz = 1;
	for (int i = 1; i <= k; i++) {
		cin >> a;
		build(i);
	}
	AC();
	while (n--) {
		cin >> a;
		if (a[0] == '?') {
			int cnt = 0;
			int p = 0;
			for (int i = 1; a[i]; i++) {
				int c = a[i] - 'a';
				p = ch[p][c];
				int q = p;
				while (val[q]) {
					if (ok[q]) cnt += 1;
					q = fail[q];
				}
			}
			cout << cnt << endl;
		}
		else if (a[0] == '+') {
			int x = getNum();
			ok[idx[x]] = 1;
		}
		else if (a[0] == '-') {
			int x = getNum();
			ok[idx[x]] = 0;
		}
	}

	return 0;
}
