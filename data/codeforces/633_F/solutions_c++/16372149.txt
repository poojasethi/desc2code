#include<bits/stdc++.h>
using namespace std;
typedef long long LL;
typedef pair<int,int> PII;
#define MP make_pair
#define PB push_back
#define AA first
#define BB second
#define OP begin()
#define ED end()
#define SZ size()
#define cmin(x,y) x=min(x,y)
#define cmax(x,y) x=max(x,y)
#define NAME ""
#define UsingFile 0
const LL MOD = 1000000007;
const double PI = acos(-1.);
int fa[100005];
vector<int>G[100005];
LL ds[100005];//deep son
LL dp[100005];//u sub max line sum
LL w[100005];
LL zz[100005];
LL of[100005];//
void dfsds(int u,int f){
	int i,v;
	ds[u]=0;
	for(i=0;i<G[u].SZ;i++){
		v=G[u][i];
		if(v==f)continue;
		dfsds(v,u);
		cmax(ds[u],ds[v]);
	}
	ds[u]+=w[u];
}
void dfsdp(int u,int f){
	int i,v;
	LL b[2];
	b[0]=0;
	b[1]=0;//b[0]>=b[1]
	for(i=0;i<G[u].SZ;i++){
		v=G[u][i];
		if(v==f)continue;
		dfsdp(v,u);
		if(ds[v]>=b[0]){
			b[1]=b[0];
			b[0]=ds[v];
		}else cmax(b[1],ds[v]);
	}
	dp[u]=w[u]+b[0]+b[1];
	for(i=0;i<G[u].SZ;i++){
		v=G[u][i];
		if(v==f)continue;
		cmax(dp[u],dp[v]);
	}
}
void dfsof(int u,int f){
	int i,v;
	LL b[2];
	b[0]=of[u];
	b[1]=0;//b[0]>=b[1]
	for(i=0;i<G[u].SZ;i++){
		v=G[u][i];
		if(v==f)continue;
		if(ds[v]>=b[0]){
			b[1]=b[0];
			b[0]=ds[v];
		}else cmax(b[1],ds[v]);
	}
	for(i=0;i<G[u].SZ;i++){
		v=G[u][i];
		if(v==f)continue;
		if(ds[v]==b[0])
			of[v]=b[1]+w[u];
		else of[v]=b[0]+w[u];
		dfsof(v,u);
	}
}
void dfszz(int u,int f){
	int i,v;
	LL b[3];
	b[0]=of[u];
	b[1]=0;//b[0]>=b[1]
	b[2]=0;
	for(i=0;i<G[u].SZ;i++){
		v=G[u][i];
		if(v==f)continue;
		if(ds[v]>=b[0]){
			b[2]=b[1];
			b[1]=b[0];
			b[0]=ds[v];
		}else if(ds[v]>=b[1]){
			b[2]=b[1];
			b[1]=ds[v];
		}else cmax(b[2],ds[v]);
	}
	LL c[2];
	c[0]=0;
	c[1]=0;
	for(i=0;i<G[u].SZ;i++){
		v=G[u][i];
		if(v==f)continue;
		if(dp[v]>=c[0]){
			c[1]=c[0];
			c[0]=dp[v];
		}else cmax(c[1],dp[v]);
	}
	for(i=0;i<G[u].SZ;i++){
		v=G[u][i];
		if(v==f)continue;
		if(ds[v]==b[0]){
			zz[v]=w[u]+b[1]+b[2];
		}else if(ds[v]==b[1]){
			zz[v]=w[u]+b[0]+b[2];
		}else zz[v]=w[u]+b[0]+b[1];
		if(~f)cmax(zz[v],zz[u]);
		if(dp[v]==c[0])cmax(zz[v],c[1]);
		else cmax(zz[v],c[0]);
		dfszz(v,u);
	}
}
int main(){
    if(UsingFile)freopen(NAME".in","r",stdin);
    if(UsingFile)freopen(NAME".out","w",stdout);
    int i,j,k,_T;
    int n;
    while(~scanf("%d",&n)){
    	for(i=1;i<=n;i++)G[i].clear(),scanf("%d",&w[i]);
    	for(i=1;i<n;i++){
    		int u,v;
    		scanf("%d%d",&u,&v);
    		G[u].PB(v),G[v].PB(u);
    	}
    	dfsds(1,-1);
    	dfsdp(1,-1);
    	of[1]=0;
    	dfsof(1,-1);
    	zz[1]=0;
    	dfszz(1,-1);
    	LL ans=0;
    	for(i=2;i<=n;i++)cmax(ans,dp[i]+zz[i]);
    	cout<<ans<<"\n";
    }
    return 0;
}