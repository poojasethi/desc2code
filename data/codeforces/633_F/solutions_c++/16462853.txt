#include<bits/stdc++.h>
#define N 100005
#define rep(u) for (int u=0;u<3;u++)
#define For for (int i=End[x],y;i;i=Next[i]) \
		if ((y=Go[i])!=father[x]) 
using namespace std;
typedef long long LL;
int Go[N<<1],Next[N<<1],End[N],father[N],cnt;
LL f[N][3][3],big1,big2,big3,big4,ans;int a[N],n,x,y,i,id;
void add(int u,int v){Go[++cnt]=v;Next[cnt]=End[u];End[u]=cnt;}
inline void Max(LL &x,LL y){if (y>x) x=y;}
inline void up(LL &x,LL &y,LL z){if (z>x) y=x,x=z;else if (z>y) y=z;}
void DFS(int x);
LL DP(int x,int p1,int q1,int p2,int q2){
	big1=big2=id=0;
	For if (f[y][p1][q1]>big1) big1=f[y][p1][q1],id=y;
	For if (y!=id) Max(big2,f[y][p2][q2]);
	LL ret=big1+big2;
	big1=big2=id=0;
	For if (f[y][p2][q2]>big1) big1=f[y][p2][q2],id=y;
	For if (y!=id) Max(big2,f[y][p1][q1]);
	Max(ret,big1+big2);return ret;
}
LL DP2(int x,int p1,int q1,int p2,int q2){
	big1=big2=big3=id=0;
	For if (f[y][p2][q2]>big3) big3=f[y][p2][q2],id=y;
	For if (y!=id) up(big1,big2,f[y][p1][q1]);
	LL ret=big1+big2+big3;
	int ch=0;big1=big2=big3=id=0;
	For if (f[y][p1][q1]>big1) big1=f[y][p1][q1],ch=y;
	For if (y!=ch) if (f[y][p2][q2]>big3) big3=f[y][p2][q2],id=y;
	For if (y!=ch&&y!=id) Max(big2,f[y][p1][q1]);
	Max(ret,big1+big2+big3);
	big2=big3=id=0;
	For if (y!=ch) if (f[y][p1][q1]>big2) big2=f[y][p1][q1],id=y;
	For if (y!=ch&&y!=id) Max(big3,f[y][p2][q2]);
	Max(ret,big1+big2+big3);return ret;
}
void DFS(int x){
	int son=0;For father[y]=x,DFS(y),son++;
	//0:没有选 1：向上延伸到根 2：已经结束
	For Max(f[x][0][1],f[y][0][1]),
			Max(f[x][1][0],f[y][1][0]);
	f[x][0][1]+=a[x];f[x][1][0]+=a[x];
	
	big1=big2=big3=big4=0;
	For Max(f[x][0][2],f[y][0][2]),up(big1,big2,f[y][0][1]),
			Max(f[x][2][0],f[y][2][0]),up(big3,big4,f[y][1][0]);
	Max(f[x][0][2],big1+big2+a[x]);
	Max(f[x][2][0],big3+big4+a[x]);
	
	For Max(f[x][1][2],f[y][1][2]+a[x]);
	Max(f[x][1][2],DP(x,1,0,0,2)+a[x]);
	For Max(f[x][2][1],f[y][2][1]+a[x]);
	Max(f[x][2][1],DP(x,0,1,2,0)+a[x]);
	
	For Max(f[x][2][2],f[y][2][2]);
	Max(f[x][2][2],DP(x,2,0,0,2));
	Max(f[x][2][2],DP(x,2,1,0,1)+a[x]);
	Max(f[x][2][2],DP(x,1,2,1,0)+a[x]);
	Max(f[x][2][2],DP2(x,1,0,0,2)+a[x]);
	Max(f[x][2][2],DP2(x,0,1,2,0)+a[x]);
	
	rep(u) rep(v) rep(A) rep(B)
		if (A<u&&B<v) Max(f[x][u][v],f[x][A][B]);
}
int main(){
	scanf("%d",&n);LL sum=0;
	for (i=1;i<=n;i++)
		scanf("%d",&a[i]),sum+=a[i];
	for (i=1;i<n;i++)
		scanf("%d%d",&x,&y),add(x,y),add(y,x);
	DFS(1);
	printf("%I64d\n",f[1][2][2]);
}