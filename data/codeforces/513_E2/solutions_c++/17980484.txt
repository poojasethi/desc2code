//
//	ID: y0rkl1u
//	PROG: codeforces 513E2. Subarray Cuts
//	LANG: C++
//	DATE: 05.18.2016
//	NOTE: DP!
//

#include <bits/stdc++.h>
using namespace std;

#ifdef WIN32
	#define LL "%I64d"
#else 
	#define LL "%lld"
#endif
#define ef else if
#define reg register
#define rint reg int
#define Min(a,b) ((a)<(b)?(a):(b))
#define Max(a,b) ((a)>(b)?(a):(b))
#define Abs(a) ((a)>=0?(a):(-(a)))
#define cmin(a,b) ((a)>(b)?(a)=(b):1)
#define For(i,l,r) for(rint i=(l),_c=(r);i<=_c;i++)
#define Dor(i,l,r) for(rint i=(l),_c=(r);i>=_c;i--)
#define clr(a,sz) memset(a,0,sizeof(a[0])*(sz+5))
#define clrs(a,k,sz) memset(a,k,sizeof(a[0])*(sz+5))
#define pt(x,b) cerr<<#x<<" = "<<x<<(b?'\n':'\t')
#define pa(a,l,r) do{cerr<<#a<<" = ";\
	For(_i,l,r)cerr<<a[_i]<<" \n"[_i==r];}while(0)
typedef long long ll;

void cmax(rint&a,rint b)
{
	a<b?a=b:0;
}
const int sign[2]={1,-1};
#define inf 400000000		// <--

const int MN=30011,MK=211;
int n,k,f[MN][MK][2][2][2],a[MN];
inline void Main()
{
	scanf("%d%d",&n,&k);
	For(i,1,n)scanf("%d",a+i);

	For(i,0,n+1)For(j,0,k+1){			// <-- +1?
		For(e,0,1)For(c1,0,1)For(c2,0,1){
			f[i][j][e][c1][c2]=-inf;
			if(j==0&&e==0){
				f[i][j][e][c1][c2]=0;
			}
		}
	}

	For(i,0,n-1)For(j,0,k){
		For(e,0,1)For(c1,0,1)For(c2,0,1){
			rint g;
			if((g=f[i][j][e][c1][c2])==-inf)continue;
			if(j==0){
				cmax(f[i+1][j+1][1][c1][c2],
					   sign[c2]*a[i+1]);
			}
			ef(j<=k-1){
				cmax(f[i+1][j][1][c1][c2],
					   (j==1?0:sign[c1^1]*a[i+1])+sign[c2]*a[i+1]+g);
				if(e==0)cmax(f[i+1][j][e][c1][c2],g);
				if(e){
					For(c3,0,1){
						cmax(f[i+1][j+1][0][c2][c3],g);
						cmax(f[i+1][j+1][1][c2][c3],
							   g+sign[c2^1]*a[i+1]+(j+1==k?0:sign[c3]*a[i+1]));
					}
				}
			}
			ef(j==k){
				cmax(f[i+1][j][1][c1][c2],
					   g+sign[c1^1]*a[i+1]);
				if(e==0)cmax(f[i+1][j][e][c1][c2],g);
			}
		}
	}

	rint ans=-inf;
	For(i,0,n)For(c1,0,1)For(c2,0,1){
		cmax(ans,f[i][k][1][c1][c2]);
	}
	cout<<ans<<endl;
}
int main()
{
	Main();
	return 0;
}
