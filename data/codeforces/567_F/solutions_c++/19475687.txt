#include <stdio.h>
#include <string.h>
#include <iostream>
#include <algorithm>
#define M 80
#define ll long long
using namespace std;
int n,rel[M][M];
ll dp[M][M];
int rep(char c){
	if(c=='<')return 1;
	if(c=='>')return 2;
	return 3;
}
void Init(char str[]){
	int len=strlen(str),a,b=0,c,t=1;
	for(int i=0;i<len;i++){
		if(str[i]==' '){
			if(t==1)a=b;
			if(t==2)
				if(b>10)c=(b==13)?4:5;
				else c=b;
			t++;b=0;
		}else if(str[i]<='9'&&str[i]>='0')b=b*10+str[i]-'0';
		else b=b*10+rep(str[i]);
	}
	if(a>b){
		swap(a,b);
		if(c<3)c=(c==1)?2:1;
		if(c>3)c=(c==4)?5:4;
	}
	rel[a][b]=c;
}
bool check1(int L,int R){
	if(rel[R][R+1]&&rel[R][R+1]<3)return 0;
	for(int i=R+1;i<=n;i++)
		if(rel[L][i]==1||rel[L][i]==3||rel[L][i]==4)return 0;
	for(int i=L;i<R;i++){
		if(rel[i][R]==1||rel[i][R+1]==1)return 0;
		if(rel[i][R]==3||rel[i][R+1]==3)return 0;
		if(rel[i][R]==4||rel[i][R+1]==4)return 0;
	}
	return !rel[L][R]||rel[L][R]==2||rel[L][R]==5;
}
bool check2(int L,int R){
	if(rel[L-1][L]&&rel[L-1][L]<3)return 0;
	for(int i=1;i<L;i++)
		if(rel[i][R]==2||rel[i][R]==3||rel[i][R]==5)return 0;
	for(int i=L+1;i<=R;i++){
		if(rel[L][i]==2||rel[L-1][i]==2)return 0;
		if(rel[L][i]==3||rel[L-1][i]==3)return 0;
		if(rel[L][i]==5||rel[L-1][i]==5)return 0;
	}
	return !rel[L][R]||rel[L][R]==1||rel[L][R]==4;
}
bool check3(int L,int R){
	for(int i=L+1;i<R;i++){
		if(rel[L][i]==2||rel[i][R]==1)return 0;
		if(rel[L][i]==3||rel[i][R]==3)return 0;
		if(rel[L][i]==5||rel[i][R]==4)return 0;
	}
	return !rel[L][R]||rel[L][R]>2;
}
ll dfs(int L,int R){
	if(R<=L)return 0;
	if(R-L==1)return rel[L][R]==0||rel[L][R]>2;
	ll &t=dp[L][R];
	if(t==-1){
		t=0;
		if(check1(L,R-1))t+=dfs(L,R-2);
		if(check2(L+1,R))t+=dfs(L+2,R);
		if(check3(L,R))t+=dfs(L+1,R-1);
	}
	return t;
} 
int main(){
	memset(dp,-1,sizeof(dp));
	int m,i,a,b;
	char str[10];
	scanf("%d %d\n",&n,&m);
	for(i=1;i<=m;i++){
		gets(str);
		Init(str);
	}n*=2;
	cout<<dfs(1,n)<<endl;
	return 0;
}
