#include <algorithm>
#include <cstring>
#include <cstdlib>
#include <cstdio>
#define N 100010
#define M 1010
#define int64 long long
#define For(i,x,y) for (i=x;i<=y;i++)
using namespace std;
struct ww {
	int a,b;
	inline bool operator == (const ww &A) {
		return a==A.a&&b==A.b;
	}
} c[26][M],a[M],d[M];
int i,j,k,n,m,L,R,v,t;
int len[26],b[26][N],next[N],x[M],y[M];
char p[N],s[M][5];
int64 an;
inline bool cc1(const ww &a,const ww &b) {
	return a.a<b.a;
}
inline void pre() {
	For(i,0,25) {
		b[i][*b[i]+1]=n+1;
		For(j,1,*b[i]) next[b[i][j]]=b[i][j+1];
		sort(c[i]+1,c[i]+len[i]+1,cc1);
		int A=len[i]; len[i]=0;
		For(j,1,A) if (!len[i]||c[i][len[i]].a<c[i][j].a) c[i][++len[i]].a=c[i][j].a;
	}
	For(i,1,m) {
		int A=s[i][0]-'a';
		For(j,1,len[A]) if (c[A][j].a==x[i]) break;
		c[A][j].b++;
		For(j,1,len[A]) if (c[A][j].a==y[i]) break;
		c[A][j].b--;
	}
	For(i,0,25) For(j,1,len[i]) {
		if (c[i][j].a) {
			if (c[i][j].a>*b[i]) {
				len[i]=j-1; break;
			} else c[i][j].a=b[i][c[i][j].a];
		}
		a[++v]=c[i][j];
	}
	sort(a+1,a+v+1,cc1);
}
inline void suan() {
	int cen=0,last=0;
	if (d[t].a<n+1) d[++t]=(ww){n+1,0};
	For(j,1,t) {
		int A=d[j].a;
		if (L<=cen&&cen<=R&&last+1<A&&A>i) an+=A-1-max(i-1,last);
		cen+=d[j].b;
		if (A<=n&&A>=i&&L<=cen&&cen<=R) an++;
		last=A;
	}
}
int main() {
	//freopen("138e.in","r",stdin);
	//freopen("138e.out","w",stdout);
	scanf("%s",p+1);
	n=strlen(p+1);
	scanf("%d%d%d",&m,&L,&R);
	//if (p[1]=='a'&&p[2]=='b') printf("%d %d %d\n",m,L,R);
	For(i,1,n) {
		k=p[i]-'a';
		b[k][++*b[k]]=i;
	}
	For(i,1,m) {
		scanf("%s%d%d",s[i],&x[i],&y[i]); y[i]++;
		k=s[i][0]-'a';
		c[k][++len[k]].a=x[i];
		c[k][++len[k]].a=y[i];
	}
	pre();
	For(i,1,n) {
		if (i==738)
		j=1;
		int A=p[i]-'a';
		t=0;
		For(j,1,v) if (!t||d[t].a<a[j].a) d[++t]=a[j];
			else d[t].b+=a[j].b;
		suan();
		if (i==n) break;
		j=k=1; t=0;
		for (;j<=len[A]||k<=v;) {
			if (j>len[A]) d[++t]=a[k++];
			else if (j<=len[A]&&c[A][j]==a[k]) j++,k++;
			else d[++t]=a[k++];
		}
		For(j,1,len[A]) {
			int B=c[A][j].a;
			if (B&&B!=n+1) c[A][j].a=next[B];
		}
		for (;len[A]&&c[A][len[A]].a==n+1;len[A]--);
		j=k=1; v=0;
		for (;j<=len[A]||k<=t;) {
			if (j>len[A]||k<=t&&d[k].a<c[A][j].a) a[++v]=d[k++];
			else a[++v]=c[A][j++];
		}
	}
	printf("%I64d\n",an);
	//for(;;);
	return 0;
}
