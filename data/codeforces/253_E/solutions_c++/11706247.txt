#include <bits/stdc++.h>

using namespace std;

typedef long long LL;

const int N = 50010;

struct Event{
	int p,t,s,num;
};

struct cmp{
inline bool operator ()(const Event &a,const Event &b){
	return a.p<b.p;
}
};

inline bool cmp2(const Event &a,const Event &b){return a.t<b.t;}

int n;
Event lst[N];
int pp[N],m;
LL T,ed[N];
int x;

priority_queue<Event,vector<Event>,cmp> q;

inline void calc(int p){
	LL ct=0;
	for(int i=1;i<=n;i++){
		while(!q.empty() && ct<lst[i].t){
			if(ct+q.top().s<=lst[i].t) ct+=q.top().s,ed[q.top().num]=ct,q.pop();
			else{
				Event t=q.top();q.pop();
				t.s-=lst[i].t-ct,ct=lst[i].t;
				q.push(t);
			}
		}
		ct=lst[i].t;
		if(lst[i].p==-1) lst[i].p=p;
		q.push(lst[i]);
		if(lst[i].p==p) lst[i].p=-1;
	}
	while(!q.empty()) ct+=q.top().s,ed[q.top().num]=ct,q.pop();
}
int main()
{
#ifdef ONLINE_JUDGE
	freopen("input.txt","r",stdin);
	freopen("output.txt","w",stdout);
#endif
	scanf("%d",&n);
	for(int i=1;i<=n;i++) scanf("%d%d%d",&lst[i].t,&lst[i].s,&lst[i].p),lst[i].num=i;
	scanf("%I64d",&T);
	for(int i=1;i<=n;i++) if(lst[i].p==-1) x=i;
	sort(lst+1,lst+n+1,cmp());
	lst[1].p=0;
	for(int i=1;i<=n;i++) if(lst[i].p>lst[i-1].p+1)
		pp[++m]=lst[i].p-1;
	if(lst[n].p<=999999999) pp[++m]=1000000000;
	lst[1].p=-1;
	int l=1,r=m,rs=1;
	sort(lst+1,lst+n+1,cmp2);
	while(l<=r){
		int mid=l+r>>1;
		calc(pp[mid]);
		if(ed[x]>=T) rs=mid,l=mid+1;
		else r=mid-1;
	}
	printf("%d\n",pp[rs]);calc(pp[rs]);
	for(int i=1;i<=n;i++) printf("%I64d ",ed[i]);puts("");
	return 0;
}
