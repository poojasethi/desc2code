#include<queue>
#include<stdio.h>
#include<string.h>
#include<algorithm>
#define N 51000
using namespace std;
typedef long long ll;
struct node
{
	int t,s,p,no;
	friend bool operator < (const node &a,const node &b)
	{
		return a.t<b.t;
	}
}a[N];
struct node2
{
	int s,p,no;
	node2(){}
	node2(int _,int __,int ___):
		s(_),p(__),no(___){}
	friend bool operator < (const node2 &a,const node2 &b)
	{
		return a.p<b.p;
	}
};
ll ans[N];
int x,n;
int st[N],top;
priority_queue<node2>q;
ll calc()
{
	int i;
	ll j;
	node2 temp;
//	memset(ans,0,sizeof(ans));
	for(i=1,j=0;i<=n;i++)
	{
		while(!q.empty()&&j<a[i].t)
		{
			temp=q.top(),q.pop();
			j+=temp.s;
			if(j<=a[i].t)
			{
				ans[temp.no]=j;
			}
			else
			{
				q.push(node2(j-a[i].t,temp.p,temp.no));
				j=a[i].t;
			}
		}
		q.push(node2(a[i].s,a[i].p,a[i].no));
		j=a[i].t;
	}
	while(!q.empty())
	{
		temp=q.top(),q.pop();
		j+=temp.s;
		ans[temp.no]=j;
	}
	return ans[a[x].no];
}
int main()
{
	#ifdef ONLINE_JUDGE
	freopen("input.txt","r",stdin);
	freopen("output.txt","w",stdout);
	#endif
	int i,l,r,cnt;
	ll m;
	scanf("%d",&n);
	for(i=1;i<=n;i++)
	{
		scanf("%d%d%d",&a[i].t,&a[i].s,&a[i].p);
		if(a[i].p!=-1)
			st[++top]=a[i].p;
		a[i].no=i;
	}
	sort(a+1,a+n+1);
	for(i=1;i<=n;i++)
	{
		if(a[i].p==-1)
		{
			x=i;
			break;
		}
	}
	st[++top]=0,st[++top]=(int)(1e9)+1;
	sort(st+1,st+top+1);
	for(i=1,cnt=0;i<top;i++)
	{
		if(st[i+1]!=st[i]+1)
			st[++cnt]=st[i]+1;
	}
	top--;
	scanf("%I64d",&m);
	l=1,r=cnt;
	while(l<=r)
	{
		a[x].p=st[l+r>>1];
		if(calc()>m)
			l=(l+r>>1)+1;
		else
			r=(l+r>>1)-1;
	}
	printf("%d\n",st[l]);
	a[x].p=st[l];
	calc();
	for(i=1;i<=n;i++)
	{
		printf("%I64d ",ans[i]);
	}
	return 0;
}
