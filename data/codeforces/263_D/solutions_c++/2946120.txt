#include <cstdio>
#include <cstring>
#include <algorithm>
#define FOR(i,s,e) for (int i=(s); i<(e); i++)
#define EXP(i,l) for (int i=(l); i; i=qn[i])
#define N 200005
using namespace std;

int n, m, len, x, y, ok, t, ed;
int l[N], qd[N], qn[N], p[N], v[N];

void bd(int x, int y){
	qd[++ed] = y, qn[ed] = l[x], l[x] = ed;
}

int main(){
	scanf("%d%d%d", &n, &m, &len);
	while (m--) scanf("%d%d", &x, &y), bd(x, y), bd(y, x);
	
	p[0] = 1, v[1] = 1, t = 1;
	while (1){
		EXP(i,l[p[t-1]]){
			if (v[qd[i]] && t - v[qd[i]] >= len) ok = v[qd[i]];
			else if (!v[qd[i]]) x = qd[i];
		}
		if (ok) break;
		v[p[t] = x] = t + 1;
		++t;
	}
	
	printf("%d\n", t - ok + 1);
	FOR(i,ok-1,t) printf("%d ", p[i]);
	return 0;
}
