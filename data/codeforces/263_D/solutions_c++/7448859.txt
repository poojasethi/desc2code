#include <cstdio>
#include <cstring>
#include <vector>
#include <iostream>
using namespace std;
#define N 105000
vector<int> G[N],ans;
int vis[N],pos[N],st,k,n,m;
void dfs(int u,int dep){
    ans.push_back(u);
    vis[u]=dep;
    for(int i=G[u].size()-1;i>=0;i--){
        int v = G[u][i];
        if(vis[v]){
            if(vis[u]-vis[v]>=k){
                st=vis[v]-1;
                return;
            }
        }else{
            dfs(v,dep+1);
            return;
        }
    }
}

int main() {
    scanf("%d%d%d",&n,&m,&k);
    while(m--){
        int u,v;
        scanf("%d%d",&u,&v);
        G[u].push_back(v);
        G[v].push_back(u);
    }
    dfs(1,1);
    printf("%d\n",ans.size()-st);
    for(int i=st;i<ans.size();++i)
        printf("%d ",ans[i]);
    return 0;
}
