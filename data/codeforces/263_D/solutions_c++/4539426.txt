#include "iostream"
#include "vector"
#define MAXN 100002
using namespace std;
int vist[MAXN]={};
int n,m,k;
std::vector<int> G[MAXN];
std::vector<int> ans;
int num=1;
int l;
void dfs(int i)
{
		ans.push_back(i+1);
		vist[i]=num++;
		for (int j = 0; j < G[i].size(); ++j)
		{
				
				if(vist[G[i][j]]>0)
				{
					if(vist[i]-vist[G[i][j]]>=k)
					{
						
						l=vist[G[i][j]]-1;
						return;	
					}
				}
				else
				{
					dfs(G[i][j]);return;
				}
		}
}
int main(int argc, char const *argv[])
{
	cin>>n>>m>>k;
	for (int i = 0; i < m; ++i)
	{
		int a,b;
		cin>>a>>b;
		G[a-1].push_back(b-1);
		G[b-1].push_back(a-1);
	}
	dfs(0);
	cout<<ans.size()-l<<endl;
	for (int i = l; i < ans.size(); ++i)
	{
		cout<<ans[i]<<" ";
	}
	return 0;
}