#include <cstdio>
#include <vector>
#include <cstdlib>
using namespace std;

#define N 100001

int n, m, k, vis[N], a, b, res[N], rp, vc, out[N];
vector<int> adj[N];

int main()
{
	scanf("%d%d%d", &n, &m, &k);
	for (int i = 0; i < m; ++i)
	{
		scanf("%d%d", &a, &b);
		adj[a].push_back(b);
		adj[b].push_back(a);
	}
	rp = 1;
	vis[1] = rp;
	res[rp] = 1;
	while (1)
	{
		int p = res[rp];
		//printf("%d\n", p);
		for (int i = 0; i < adj[p].size(); ++i)
		{
			int q = adj[p][i];
			if (vis[q] && rp+1-vis[q] >= k+1)
			{
				printf("%d\n", rp+1-vis[q]);
				for (int i = vis[q]; i <= rp; ++i)
				{
					printf("%d ", res[i]);
				}
				printf("\n");
				return 0;
			}
			if (!vis[q])
			{
				vis[q] = ++rp;
				res[rp] = q;
				break;
			}
		}
	}
}
