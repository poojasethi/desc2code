#include<iostream>
#include<stdio.h>
#include<math.h>
#include<string.h>
#include<string>
#include<algorithm>
#include<vector>
#include<queue>

using namespace std;
int n,m,k;
vector<int> p[110000];
int visited[110000]={};
int q[110000]={};
int dfs(int x,int s)
{
	for (int i=0;i<p[x].size();i++)
	{
		if (visited[p[x][i]]==0)
		{
			visited[p[x][i]]=s;
			q[s]=p[x][i];
			dfs(p[x][i],s+1);
			visited[p[x][i]]=0;
		}
		if (s-visited[p[x][i]]>k)
		{
			cout<<s-visited[p[x][i]]<<endl;
			for (int j=visited[p[x][i]];j<s;j++)
				cout<<q[j]<<" ";
			exit(0);
		}
	}
	return 0;
}
int main()
{
	cin>>n>>m>>k;
	for (int i=1;i<=m;i++)
	{
		int a,b;
		cin>>a>>b;
		p[a].push_back(b);
		p[b].push_back(a);
	}
	visited[1]=1;
	q[1]=1;
	dfs(1,2);
	return 0;
}