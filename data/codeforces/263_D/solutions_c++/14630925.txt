#include<iostream>
#include<vector>
using namespace std;
const int MAXN=100*1000+10;
vector <int> a[MAXN];
int n,m,k,h[MAXN];
int dfs(int v,int t)
{
    h[v]=t;
    int i=0;
    for(; i<a[v].size() && h[a[v][i]]!=0; i++)
        if(t-h[a[v][i]]+1>k)
        {
            cout<<t-h[a[v][i]]+1<<'\n'<<v+1<<' ';
            return a[v][i];
        }
    int x=dfs(a[v][i],t+1);
    if(x==-1)
        return -1;
    cout<<v+1<<' ';
    if(x==v)
        return -1;
    return x;
}
int main()
{
    cin>>n>>m>>k;
    for(int i=0; i<m; i++)
    {
        int v,u;
        cin>>v>>u;
        a[v-1].push_back(u-1);
        a[u-1].push_back(v-1);
    }
    dfs(0,1);
    cout<<'\n';
    return 0;
}
