#include<iostream>
#include<cstdio>
#include<algorithm>
#include<cstring>
#include<vector>
using namespace std;
vector <int> a[100000+10];
int k=0,flag=1,vis[100005],ans,b[100000+5];
int dfs(int m)
{
    ans++;
    vis[m]=ans;
    b[ans]=m;
    int i;
    for(i=0;i<a[m].size();i++)
	{
		int t=a[m][i];
		if(vis[t])
		{
			if(ans+1-vis[t]>k)
			{
				flag=t;
				return 1;
			}
		}
		else
		{
			if(dfs(t))
				return 1;
		}
	}
	return 0;
}
int main()
{
	int m,n,i;
    scanf("%d%d%d",&n,&m,&k);
    for(i=1;i<=m;i++)
    {
        int p,q;
        scanf("%d%d",&p,&q);
        a[p].push_back(q);
        a[q].push_back(p);
    }
    if(dfs(1))
	{
		printf("%d\n",ans+1-vis[flag]);
		for(i=ans;b[i]!=flag;i--)
			printf("%d ",b[i]);
		printf("%d\n",flag);
	}
	return 0;
}
	 		 		 	    				  	  			 	 			