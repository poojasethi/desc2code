#include<iostream>
#include<vector>
#include<cstring>
using namespace std;
vector<int>g[110000];
int res[110000];
int n,m,k,tim,st,ed,u,v,vis[110000];
bool dfs(int x)
{
    vis[x]=++tim;
    res[tim]=x;
    for(int i=0;i<g[x].size();++i)
    {
        int y=g[x][i];
        if(vis[y])
        {
            if(tim-vis[y]<k)  continue;
            st=vis[y];
            ed=tim;
            return true;
        }
        else if(dfs(y))
            return true;
    }
    return false;
}
int main()
{
    cin>>n>>m>>k;
    while(m--)
    {
        cin>>u>>v;
        g[u].push_back(v);
        g[v].push_back(u);
    }
    memset(vis,0,sizeof(vis));
    tim=0;
    dfs(1);
    cout<<ed-st+1<<endl;
    for(int i=st;i<=ed;++i) cout<<res[i]<<' ';
    cout<<endl;
    return 0;
}
