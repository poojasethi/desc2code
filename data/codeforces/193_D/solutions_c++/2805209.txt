#include<cstdio>
#include<algorithm>
#define For(i,n) for(int i=1;i<=n;i++)
#define N 300010
using namespace std;

int n,x,y,a[N],b[N],d[N<<2],s[N<<2],c0[N<<2],c1[N<<2];
long long ans;

void Build(int x,int l,int r)
{
	c0[x]=r-l+1;
	if (l==r) return;
	int m=l+r >>1;
	Build(x+x,l,m);Build(x+x+1,m+1,r);
}
void Down(int x)
{
	if (!d[x]) return;
	d[x+x]+=d[x];s[x+x]+=d[x];
	d[x+x+1]+=d[x];s[x+x+1]+=d[x];
	d[x]=0;
}
void Change(int x,int l,int r,int aa,int bb,int w)
{
	if (aa<=l && r<=bb)
	{
		s[x]+=w;d[x]+=w;
		return;
	}
	Down(x);
	int m=l+r >>1;
	if (aa<=m) Change(x+x,l,m,aa,bb,w);
	if (m+1<=bb) Change(x+x+1,m+1,r,aa,bb,w);
	
	s[x]=min(s[x+x],s[x+x+1]);
	c0[x]=c0[x+x]*(s[x]==s[x+x]) + c0[x+x+1]*(s[x]==s[x+x+1]);
	c1[x]=c1[x+x]*(s[x]==s[x+x]) + c1[x+x+1]*(s[x]==s[x+x+1]);
	c1[x]+=c0[x+x]*(s[x]+1==s[x+x]) + c0[x+x+1]*(s[x]+1==s[x+x+1]);
}
void Ask(int x,int l,int r,int aa,int bb)
{
	if (aa<=l && r<=bb)
	{
		ans+=c0[x]*(s[x]<=2) + c1[x]*(s[x]<=1);
		return;
	}
	Down(x);
	int m=l+r >>1;
	if (aa<=m) Ask(x+x,l,m,aa,bb);
	if (m+1<=bb) Ask(x+x+1,m+1,r,aa,bb);
}
int main()
{
	scanf("%d",&n);
	For(i,n) scanf("%d",&a[i]),b[a[i]]=i;
	Build(1,1,n);
	for(int i=n;i;i--)
	{
		x=a[b[i]+1];y=a[b[i]-1];
		if (x>y) swap(x,y);
		if (i<x) Change(1,1,n,i,x-1,1),Change(1,1,n,y,n,-1);
		else if (i<y) Change(1,1,n,i,y-1,1);
		else Change(1,1,n,i,n,1);
		Ask(1,1,n,i,n);
	}
	printf("%I64d\n",ans-n);
	return 0;
}
