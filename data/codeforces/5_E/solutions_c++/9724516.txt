
#include<iostream>
#include<stdio.h>
using namespace std;

int sta[1000010],pr[1000010],in[1000010],af[1000010];
long long ans ;
int maxn,top,can;

int main(){
	int n;
	scanf("%d",&n);
	for(int i=1;i<=n;i++){
		scanf("%d",&in[i]);
		if(in[i] > in[maxn]) maxn = i;
	}
	for(int i = maxn;i<=n;i++) af[i-maxn+1] = in[i];
	for(int i=1;i<maxn;i++)    af[n-maxn+i+1] = in[i];
	for(int i=1;i<=n;i++){
		while(top && af[i] > af[sta[top]]) ans ++,--top;
		sta[++top] = i;
		pr[top] = af[sta[top-1]] == af[i] ? pr[top-1]:top-1;
		ans += (top - (pr[top]?pr[top]:1));
		if(pr[top] <= 1)  can = i;
	}
	maxn =0;
	for(int i=n;i>can;i--) if(af[i] >= maxn) ans++,maxn = af[i];
	cout<<ans<<endl;
}
