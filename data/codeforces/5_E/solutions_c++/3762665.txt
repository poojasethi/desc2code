#include<cstdio>
#include<cstdlib>
#define N 2100000
#define int64 long long
#define foru(i,a,b) for(int i=a;i<=b;++i)

using namespace std;
int h[N],n,p[N],v[N],r;
int64 ans;
int main()
{
	//freopen("input.txt","r",stdin);
	//freopen("output.txt","w",stdout);
	scanf("%d\n",&n);
	foru(i,1,n) scanf("%d",&h[i]);
	foru(i,1,n) h[n+i]=h[i];
	foru(i,1,n)
	{
		while(r&&v[r]<h[i]) --r;
		if(!r||v[r]>h[i]) v[++r]=h[i],p[r]=1;
		else ++p[r];
	}
	foru(i,1,n)
	{
		while(v[r]<h[i]) ans+=(v[1]!=h[i]||r!=2||p[1]!=1)*p[r--];
		if(v[r]>h[i]) v[++r]=h[i],p[r]=1,++ans;
		else p[r]+=(r!=1),ans+=(r!=1)*p[r];
		//printf("%I64d\n",ans);
	}
	printf("%I64d\n",ans+((int64)p[1])*(p[1]-1)/2);
	return 0;
}
