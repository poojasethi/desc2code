#include <iostream>
#include <algorithm>

using namespace std;
const int MAXN = 1000005;
int up[MAXN],down[MAXN], h[MAXN], e[MAXN];
int N;
int main(){
    cin>>N;
    for (int i =0; i<N; i++){
        cin>>h[i];
    }
    rotate(h, max_element(h, h+N), h+N);
    h[N] = h[0];
    long long tot = 0;
    for (int i = N-1; i>=0; i--){
        up[i] = i+1;
        while (up[i]<N && h[i]>h[up[i]]) up[i] = up[up[i]];
        if (up[i]<N && h[i]==h[up[i]]){
            e[i] = e[up[i]]+1;
            up[i] = up[up[i]];
        }
    }
    for (int i = 0; i<N; i++){
        tot += e[i];
        if (h[i] == h[0]) continue;
        tot+=2;
        down[i] = i-1;
        while (down[i]>0 && h[i]>=h[down[i]]) down[i] = down[down[i]];
        if (down[i]==0  && up[i]==N) tot--;
    }
    cout<<tot<<endl;
    return 0;
}
