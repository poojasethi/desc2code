#include <iostream>
#include <stack>
using namespace std;
#define DIM 1<<20
int m,n,i,j,t,a[DIM],b[DIM],u[DIM];
long long rs=2;
stack< pair< int,int > > s;


int main(){
	
	cin >> n;
	for (i=0; i<n; i++) cin >> b[i],b[i]>b[t]?t=i:0;
	for (i=t; i<t+n; i++) a[i-t]=b[i%n];

	for (i=1; i<n; i++)
		if (s.empty()) s.push(make_pair(a[i],1)); else
		{
			m=1;
			while (!s.empty() && s.top().first<=a[i])
			{
				rs+=s.top().second;
				if (a[i]==s.top().first) m+=s.top().second;
				s.pop();
			}
			if (!s.empty()) rs++;
			s.push(make_pair(a[i],m));
		}
		
	m=a[1]; u[1]=u[n-1]=1;
	for (i=2; i<n; i++)
		if (a[i]>=m) rs+=!u[i],u[i]=1,m=a[i];
	m=a[n-1];
	for (i=n-2; i>0; i--)
		if (a[i]>=m) rs+=!u[i],u[i]=1,m=a[i];
	
	cout << rs;

	return 0;
}
