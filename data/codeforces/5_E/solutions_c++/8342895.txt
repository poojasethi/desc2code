// by Î¾

#include <cctype>
#include <cstdio>
#include <algorithm>

#define o c=getchar()
#define rep(i,l,r) for(int i=l;i<=r;++i)

using namespace std;

typedef int P[1000006];

long long Ans;
int top,MX,n,_;
P pre,p,h,st;

inline void in(int &x){
    char c;while(!isdigit(o));for(x=0;isdigit(c);o)x=x*10-48+c;
}

int main(){
    in(n);*h=~0U>>1;
    rep(i,1,n){in(p[i]);if(p[i]>p[MX])MX=i;}
    rep(i,MX,n)h[i-MX+1]=p[i];
    rep(i,1,MX-1)h[n-MX+i+1]=p[i];
    rep(i,1,n){
        while(top && h[st[top]]<h[i])--top,++Ans;
        st[++top]=i;
        pre[top]=h[st[top-1]]==h[i]?pre[top-1]:top-1;
        Ans+=top-(pre[top]?pre[top]:1);if(pre[top]<=1)_=i;
    }
    MX=0;
    for(int j=n;j>_;--j)if(h[j]>=MX)++Ans,MX=h[j];
    printf("%I64d\n",Ans);
}