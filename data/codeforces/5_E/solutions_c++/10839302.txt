#include <iostream>
#include <stdio.h>

const int N=1000020;
using namespace std;

long long res;
int h[N],r[N],f1[N],f2[N];
int a[N],b[N],x,i,j,n,st,mx;

main()
{
 cin>>n;
 for (i=0;i<n;i++)
  scanf("%d",&b[i]),x=max(x,b[i]);
 for (i=0;i<n;i++) if (b[i] == x) break;

 for (j=i;j<n;j++)
  a[j-i]=b[j];
 for (j=n-i;j<n;j++)
  a[j]=b[j-n+i];

 for (i=1;i<n;i++)
  {
   while (st >= 1 && h[st] < a[i]) { res+=r[st]; st--; }
   if (st >= 2 || (st == 1 && h[st] != a[i])) res++;
   if (st && h[st] == a[i]) res+=r[st];
   getchar();
   if (!st || h[st] != a[i])
    {
     h[++st]=a[i];
     r[st]=1;
    } else r[st]++;
  }
 for (i=1;i<n;i++)
  {
   mx=max(mx,a[i]);
   if (mx == a[i]) f1[i]=1;
  }
 mx=0;
 for (i=n-1;i>=1;i--)
  {
   mx=max(mx,a[i]);
   if (mx == a[i]) f2[i]=1;
  }

 for (i=0;i<n;i++)
  if (f1[i] || f2[i]) res++;

 cout<<res<<endl;
}
