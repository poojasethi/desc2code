#include<algorithm>
#include<cstdio>
#define N 1111111
using namespace std;
bool b[N];
int a[N],left[N],sta[N];
int main(){
    int n;
    scanf("%d",&n);
    int i;
    for(i=0;i<n;++i)scanf("%d",a+i);
    rotate(a,max_element(a,a+n),a+n);
    int stalen=0;
    long long sum=2;
    left[1]=1;
    sta[stalen++]=1;
    for(i=2;i<n;++i){
        left[i]=1;
        while(stalen&&a[sta[stalen-1]]<=a[i]){
            sum+=left[sta[--stalen]];
            if(a[sta[stalen]]==a[i])left[i]+=left[sta[stalen]];
        }
        if(stalen)++sum;
        sta[stalen++]=i;
    }
    int maxx=a[1];
    for(i=2;i<n-1;++i)
        if(maxx<=a[i]){
            maxx=a[i];
            ++sum;
            b[i]=1;
        }
    maxx=a[n-1];
    for(i=n-2;i>1;--i){
        if(maxx<=a[i]){
            maxx=a[i];
            sum+=!b[i];
        }
    }
    printf("%I64d",sum);
    return 0;
}