#include <algorithm>
#include <cstdio>
#include <iostream>

using namespace std;

typedef long long int Lint;

const int MAXN=1000010;

int N;
int ar[MAXN],l[MAXN],r[MAXN],cnt[MAXN];

Lint res;

int main(){
	
	scanf(" %d",&N);
	
	for( int i=0 ; i<N ; i++ )
		scanf(" %d",ar+i);
	
	rotate(ar,max_element(ar,ar+N),ar+N);
	ar[N]=ar[0];
	
	for( int i=N-1; i>=0 ; i-- ){
		
		r[i]=i+1;
		
		while( r[i]<N && ar[i]>ar[r[i]] )
			r[i]=r[r[i]];
		if( r[i]<N && ar[i]==ar[r[i]] ){
			cnt[i]=cnt[r[i]]+1;
			r[i]=r[r[i]];
		}
	}
	
	for( int i=0 ; i<N; i++ )
		if( ar[i]!=ar[0]) {
			l[i]=i-1;
		while( l[i]>0 && ar[i]>=ar[l[i]])
			l[i]=l[l[i]];
	}
	
	for( int i=0 ; i<N ; i++ ){
		
		res+=cnt[i];
		
		if( ar[i]==ar[N] )
			continue;
			
		res+=2;
		
		if( l[i]==0 && r[i]==N )
			res--;
	}
	
	printf("%I64d\n",res);
	return 0;
}
