#include <cstdio>
#include <algorithm>
using namespace std;
int n;
const int N = 1000101;
long long ans = 0;
int a[N], c[N], l[N], r[N];

int main()
{
    scanf("%d", &n);
    for (int i = 0; i != n; ++i)
        scanf("%d", &a[i]);

    rotate(a, max_element(a, a + n), a + n);
    a[n] = a[0];
    for(int i = n - 1; i >= 0; --i)
    {
        for (r[i] = i + 1; r[i] < n && a[r[i]] < a[i]; r[i] = r[r[i]]);
        if (r[i] < n && a[r[i]] == a[i])
        {
            c[i] = c[r[i]] + 1;
            r[i] = r[r[i]];
        }
    }
    for(int i = 0; i < n; ++i)
    {
        ans += c[i];
        if (a[i] != a[0])
        {
            for (l[i] = i - 1; l[i] > 0 && a[i] >= a[l[i]]; l[i] = l[l[i]]);
            ans += 2;
            if (l[i] == 0 && r[i] == n) --ans;
        }
    }
    printf("%I64d", ans);
    return 0;
}

