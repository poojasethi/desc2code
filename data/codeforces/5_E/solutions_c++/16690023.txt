#include <cstdio>
#include <iostream>
#include <string>
#include <cstring>
#include <algorithm>
#include <vector>
using namespace std;

const int MAX_N = 1000000 + 5;
int H[MAX_N];
int L[MAX_N], R[MAX_N], E[MAX_N];
int n;

int main(){
        //freopen("E.in","r",stdin);
	scanf("%d", &n);
	for(int i=0;i<n;++i) scanf("%d", &H[i]);
	rotate(H,max_element(H,H+n),H+n);
	H[n]=H[0];
	for(int i=n-1;i>=0;--i){
		R[i]=i+1;
		while(R[i]<n && H[R[i]]<H[i]) R[i]=R[R[i]];
		if(R[i]<n && H[R[i]]==H[i]) E[i]=E[R[i]]+1, R[i]=R[R[i]];
	}
	long long ans=0;
	for(int i=0; i<n; ++i){
		ans += E[i];
		if(H[i]==H[0]) continue;
		L[i]=i-1;
		while(L[i]>0 && H[L[i]]<=H[i]) L[i]=L[L[i]];
		ans += 2;
		if(L[i]==0 && R[i]==n) ans--;
	}
	printf("%lld\n",ans);
        return 0;
}
	  		  		 		 	    	 	 		   		