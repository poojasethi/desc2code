#include <bits/stdc++.h>
//Damned if I don't take what I want.

using namespace std;

typedef long long ll;
typedef pair<int, int> pii;

const int MAXN = 1e6 + 100;

int p[MAXN], ans[MAXN], h[MAXN], temp[MAXN];

int main(){
	int n; scanf("%d", &n);

	int ind = 0;
	for (int i = 0; i < n; i++){
		scanf("%d", &temp[i]);
		if ( temp[i] > temp[ind] ) ind = i;
	}
	
	for (int i = 0; i < n; i++)
		h[i] = temp[ (i + ind) % n];

	memset(temp, 0, sizeof temp);
	for (int i = n - 1; i >= 0; i--)
	    temp[i] = max(temp[i + 1], h[i]);


	h[n] = h[0];

	ans[0] = 0;
	ll outp = 0;
	for (int i = 1; i <= n; i++){
		p[i] = i - 1;
		while(p[i] && h[ p[i] ] <= h[i]){
			if (h[i] == h[p[i]]) ans[i] += ans[ p[i] ] + 1;
			p[i] = p[ p[i] ];
		}
		outp += ans[i];
		if (h[ p[i] ] > h[i]) outp++;
		if (i < n && temp[i + 1] > h[i] || p[i]) outp++;
		//cerr << i << " : " << ans[i] << endl;
	}

	cout << outp << endl;




	

}

