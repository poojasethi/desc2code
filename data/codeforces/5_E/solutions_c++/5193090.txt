#include <cstdio>
#include <cstring>
#include <algorithm>
#include <iostream>
#include <vector>
#include <queue>
#include <map>

using namespace std ;

const int MAXN = 1000100 ;

int a[MAXN] , mx ;
int l[MAXN] , r[MAXN] , b[MAXN] , n , s[MAXN];


int main(){
    scanf("%d",&n) ;
    for (int i=0;i<n;i++){
        cin>>a[i];
        if (a[mx]<a[i]) mx=i;
    }
    for (int i=0;i<n;i++)
        b[(i-mx+n)%n]=a[i];
    b[n]=b[0];
    for (int i=1;i<n;i++){
        l[i]=i-1;
        while (l[i]>0&&b[i]>=b[l[i]]) l[i]=l[l[i]];
    }
    for (int i=n-1;i>=0;i--){
        r[i]=i+1;
        while (r[i]<n&&b[i]>b[r[i]]) r[i]=r[r[i]];
        if (r[i]<n&&b[i]==b[r[i]]){
            s[i]=s[r[i]]+1;
            r[i]=r[r[i]];
        }
    }
    long long ans=0;
    for (int i=1;i<n;i++){
        ans=ans+s[i]+2;
        if (l[i]==0&&r[i]==n) ans--;
    }
    cout<<ans<<endl;
    return 0;

}
