#include <cstdio>
#include <cstdlib>
#include <cstring>
#include <algorithm>

using namespace std;

const int MAX=1000005;
int a[MAX],l[MAX],r[MAX],cnt[MAX]={0};

int main(){
    long long ret=0;
    int n;
    
    scanf("%d",&n);
    for(int i=0;i<n;i++){
        scanf("%d",&a[i]);
    }
    rotate(a,max_element(a,a+n),a+n);
    
    //for(int i=0;i<n;i++) printf("%d ",a[i]);puts("");
    a[n]=a[0];
    for(int i=n-1;i>=0;i--){
        r[i]=i+1;
        while(r[i]<n&&a[r[i]]<a[i]) r[i]=r[r[i]];
        if(r[i]<n&&a[i]==a[r[i]]){
            cnt[i]=cnt[r[i]]+1;
            r[i]=r[r[i]];
        }
    }
    
    for(int i=0;i<n;i++){
        ret+=cnt[i];
        if(a[i]==a[0])  continue;
        ret+=2;
        l[i]=i-1;
        while(l[i]&&a[l[i]]<=a[i])  l[i]=l[l[i]];
        if(l[i]==0&&r[i]==n)    ret--;
    }
    printf("%I64d\n",ret);
    
    return 0;
}
