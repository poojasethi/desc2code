#include<iostream>
#include<cstdio>
#include<cstring>
using namespace std;
int a[1000010],b[1000010],c[1000010],tmp[1000010],f[1000010];
int main()
{
	__int64 ans=0;
	int n,i,j,k;
	scanf("%d",&n);
	int maxn=-2100000000,re;
	for(i=1;i<=n;i++){
		scanf("%d",&tmp[i]);
		if(tmp[i]>maxn) maxn=tmp[i],re=i;
	}
	int cnt=0;
	for(i=re;i<=n;i++)
		a[++cnt]=tmp[i];
	for(i=1;i<re;i++)
		a[++cnt]=tmp[i];
	memset(f,0,sizeof(f));
	for(i=n;i>=1;i--){
		b[i]=i+1;
		while(b[i]<=n&&a[i]>a[b[i]]) b[i]=b[b[i]];
		if(b[i]<=n&&a[i]==a[b[i]]) f[i]=f[b[i]]+1,b[i]=b[b[i]];
	}
	for(i=1;i<=n;i++){
		c[i]=i-1;
		while(c[i]>0&&a[i]>=a[c[i]]) c[i]=c[c[i]];
	}
	for(i=1;i<=n;i++){
		ans+=f[i];
		if(a[i]==maxn) continue;
		if(c[i]==1&&b[i]>n) ans++;
		else ans+=2;
	}
	printf("%I64d\n",ans);
	//system("pause");
	return 0;
}
