#include<iostream>
#include<cstdio>
#include<cstring>
#define ll long long 
using namespace std;

int a[1000005],t[1000005];
int l[1000005],r[1000005];
int main()
{
	int n;
	cin>>n;
	for(int i=0;i<n;i++)
		scanf("%d",&a[i]);
	int Max=-1,pos=-1;
	for(int i=0;i<n;i++)
		if(a[i]>Max)
			Max=a[i],pos=i;
	for(int i=0;i<n;i++)
		t[i]=a[pos++],pos%=n;
	t[n]=a[pos];
	memset(a,0,sizeof(a));
	for(int i=1;i<n;i++)
	{
		l[i]=i-1;
		while(l[i]>0&&t[i]>=t[l[i]])
		{
			l[i]=l[l[i]];
		}
	}
	a[n]=0;
	for(int i=n-1;i>=0;i--)
	{
		r[i]=i+1;
		while(r[i]<n&&t[i]>t[r[i]])
		{
			r[i]=r[r[i]];
		}
		if(r[i]<n&&t[i]==t[r[i]])
		{
			a[i]=a[r[i]]+1;
			r[i]=r[r[i]];
		}
	}
	ll ans=0;
	for(int i=1;i<n;i++)
		{
			ans+=a[i];
			ans+=2;
			if(l[i]==0&&r[i]==n)
				ans--;
		}
	cout<<ans<<endl;
	return 0;
}
