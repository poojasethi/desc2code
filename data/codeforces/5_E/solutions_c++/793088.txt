#include<iostream>
#include<cstdio>
#include<algorithm>
using namespace std;

int a[1000001],b[1000001],r[1000001],l[1000001],n,c[1000001];
long long ans;
void read(int &x)
{
	char ch;
	while(ch=getchar(),ch<'0');
	x=ch-'0';
	while(ch=getchar(),ch>='0')x*=10,x+=ch-'0';
}

int main()
{
//	freopen("yoshi.in","rb",stdin);
//	freopen("yoshi.out","wb",stdout);
	read(n);
	for(int i=0;i<n;++i)read(a[i]);
	rotate(a,max_element(a,a+n),a+n);
	a[n]=a[0];
	for(int i=n-1;i>=0;--i)
	{
		r[i]=i+1;
		for(;r[i]<n&&a[r[i]]<a[i];)r[i]=r[r[i]];
		if(r[i]<n&&a[r[i]]==a[i])c[i]=c[r[i]]+1,r[i]=r[r[i]];
	}
	for(int i=n-1;i>=0;--i)
	for(;r[i]<n&&a[r[i]]==a[i];)
	r[i]=r[r[i]];
	for(int i=0;i<n;++i)
	{
		ans+=c[i];
		if(a[i]==a[0])continue;
		l[i]=i-1;
		for(;l[i]>0&&a[l[i]]<=a[i];)l[i]=l[l[i]];
		ans+=2;
		if(l[i]==0&&r[i]==n)ans--;
	}
	printf("%I64d\n",ans);
	return 0;
}
