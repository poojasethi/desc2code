#include <iostream>
#include <cstdio>
#include <cstring>
#include <vector>
#include <map>
#include <set>
#include <algorithm>

using namespace std;

const int maxn=3000010;
int n,oh[maxn],h[maxn],p,l[maxn],r[maxn],c[maxn];
long long ans;

int main(){
    scanf("%d",&n);
    for (int i=1; i<=n; i++){
        scanf("%d",oh+i);
        if (oh[i]>oh[p]) p=i;
    }
    for (int i=p; i<=n; i++) h[i-p]=oh[i];
    for (int i=1; i<=p; i++) h[n-p+i]=oh[i];
    for(int i=n; i>=0; i--){
        r[i]=i+1;
        while (r[i]<=n && h[i]>h[r[i]]) r[i]=r[r[i]];
        if(r[i]<=n&&h[i]==h[r[i]]) c[i]+=c[r[i]]+1, r[i]=r[r[i]];
    }
    for (int i=1; i<=n; i++){
        l[i]=i-1;
        while(l[i]>0 && h[i]>=h[l[i]]) l[i]=l[l[i]];
    }
    for (int i=1; i<=n; i++){
        ans+=c[i];
        if (h[i]==h[0]) continue;
        ans+=2;
        if (l[i]==0 && r[i]==n) ans--;
    }
    cout<<ans<<endl;
}
