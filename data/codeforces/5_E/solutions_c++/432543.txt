#include <stdio.h>

int a[2000005];
int st[2000005], top;
int rep[2000005];
int main(void) {
	int n, mx=0, i;
	scanf("%d", &n);
	for(i=0;i<n;i++)
		scanf("%d", &a[i]);
	for(i=0;i<n;i++)
		if(mx<a[i])
			mx = a[i];
	int s=0, m, c=0;
	for(i=0;i<n;i++) {
		a[n+i] = a[i];
		if(mx==a[i])
			break;
	}
	m = i;
	for(i=0;i<n;i++)
		if(mx==a[i])
			++c;
	long long ans = 0;
	ans += c * 1LL * (c-1) / 2;
	top=0;
	st[top] = a[m];
	rep[top]=1;
	
	for(i=m+1;i<m+n;i++) {

		while (st[top] < a[i]) {
			ans += rep[top] * 1LL*(rep[top]-1)/2+rep[top]*2;
			--top;
		}
		if(st[top] > a[i]) {
			st[++top] = a[i];
			rep[top] = 1;
		} else {
			rep[top]++;
		}
	}

	while (st[top] < a[m]) {
		ans += rep[top] * 1LL*(rep[top]-1)/2+rep[top]*((top!=1||rep[0]>1)?2:1);
		--top;
	}
	
	printf("%I64d\n", ans);
	return 0;
}
