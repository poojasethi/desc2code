#include <stdio.h>
#include <iostream>
#include <algorithm>
using namespace std;
#define rep(i, n) for(int i=0; i<(int)(n); i++)

int n, h[1000001], l[1000001], r[1000001], c[1000001];

int main() {
    scanf("%d", &n);
    rep(i, n) scanf("%d", h+i);
    rotate(h, max_element(h, h+n), h+n);
    h[n] = h[0];
    for(int i=n-1; i>=0; i--) {
        r[i] = i+1;
        while(r[i]<n && h[i]>h[r[i]]) r[i]=r[r[i]];
        if(r[i]<n && h[i]==h[r[i]]) { c[i]=c[r[i]]+1; r[i]=r[r[i]]; }
    }
    rep(i, n) if(h[i]!=h[0]) {
        l[i] = i-1;
        while(l[i]>0 && h[i]>=h[l[i]]) l[i]=l[l[i]];
    }
    long long s=0;
    rep(i, n) {
        s += c[i];
        if(h[i]==h[0]) continue;
        s += 2;
        if(l[i]==0 && r[i]==n) s--;
    }
    cout << s << endl;
}
