#include"iostream"
#include"algorithm"
#include"vector"
#include"map"
#include"stack"
#include"queue"
#define f(i,a,b) for(int i=a;i<=b;i++)
#define fr(i,m,n) for(int i=m;i>=n;i--)
const int N = 1000002;
using namespace std;
int n,h[N],l[N],r[N],c[N];
main(){
       long long res=0;
       cin>>n;f(i,0,n-1) cin>>h[i];
       rotate(h,max_element(h,h+n),h+n);
       h[n]=h[0];
	fr(i,n-1,0)
	{
		r[i]=i+1;
		while(r[i]<n && h[r[i]]<h[i])	r[i]=r[r[i]];
		if(r[i]<n && h[r[i]]==h[i])	c[i]=c[r[i]]+1,r[i]=r[r[i]];
	}
	f(i,0,n-1)
	{
		res+=c[i];
		if(h[i]==h[0])	continue;
		l[i]=i-1;
		while(l[i]>0 && h[l[i]]<=h[i])	l[i]=l[l[i]];
		res+=2;
		if(l[i]==0 && r[i]==n)	res--;
	}	
	cout<<res;         
       }
