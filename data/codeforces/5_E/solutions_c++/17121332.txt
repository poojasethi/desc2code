#include <stdio.h>
#include <algorithm>
using namespace std;
#define N 1000100

int n, a[N], r[N], l[N], same[N];

int main() {
	scanf("%d", &n);
	for (int i = 0; i < n; i ++) scanf("%d", &a[i]);
	rotate(a, max_element(a, a + n), a + n);
	a[n] = a[0];
	for (int i = n - 1; i >= 0; i --) {
		r[i] = i + 1;
		while (r[i] < n && a[i] > a[r[i]]) r[i] = r[r[i]];
		if (r[i] < n && a[i] == a[r[i]]) same[i] = same[r[i]] + 1, r[i] = r[r[i]];
	}
	long long ans = 0;
	for (int i = 0; i < n; i ++) {
		ans += same[i];
		if (a[i] < a[0]) {
			ans += 2;
			l[i] = i - 1;
			while (l[i] > 0 && a[i] >= a[l[i]]) l[i] = l[l[i]];
			if (l[i] == 0 && r[i] == n) ans --;
		}
	}
	printf("%I64d\n", ans);
	return 0;
}
