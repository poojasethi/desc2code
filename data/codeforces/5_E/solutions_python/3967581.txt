n = input()
a = map(int, raw_input().split())
i = a.index(max(a))
a = [1 << 30] + a[i:] + a[:i]

f, g, t = [0], [1], 0
for i in xrange(1, n + 1):
	j, k = i - 1, 1
	while a[j] <= a[i]:
		if a[j] == a[i]: k += g[j]
		t += g[j]
		j = f[j]
	if j: t += 1
	f.append(j)
	g.append(k)

h = 0
for i in xrange(n, 1, -1):
	if h <= a[i]:
		h = a[i]
		if f[i] > 1: t += 1

print t