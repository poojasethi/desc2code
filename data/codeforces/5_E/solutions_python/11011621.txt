#!/usr/bin/env python

def main():
    n = input()
    c, l, r = [0]*(n+1), [0]*(n+1), [0]*(n+1)
    h = map(int, raw_input().split(' '))
    x = 0
    for i in xrange(n):
        if h[i] > h[x]:
            x = i
    h = h[x:]+h[0:x]
    h.append(h[0])
    for i in xrange(n-1, -1, -1):
        r[i] = i+1
        while r[i] < n and h[i] > h[r[i]]:
            r[i] = r[r[i]]
        if r[i] < n and h[i] == h[r[i]]:
            c[i] = c[r[i]]+1
            r[i] = r[r[i]]
    ans = 0
    for i in xrange(n):
        ans += c[i]
        if h[i] < h[0]:
            l[i] = i-1
            while l[i] > 0 and h[i] >= h[l[i]]:
                l[i] = l[l[i]]
            ans += 2
            if l[i] == 0 and r[i] == n:
                ans -= 1
    print(ans)

main()