n = input()
h = map(int, raw_input().split(' ')) * 2
i = h.index(max(h))
h = h[i : i + n + 1]
l, r, c = [[0] * (n + 1) for _ in range(3)]
for i, v in enumerate(h):
	t = i - 1
	while t >= 0 and h[t] < v:
		t = l[t]
	if t >= 0 and h[t] == v:
		c[i] = c[t] + 1
		t = l[t]
	l[i] = t
for i, v in enumerate(reversed(h)):
	i = n - i
	t = i + 1
	while t <= n and h[t] <= v:
		t = r[t]
	r[i] = t
print sum(1 + (u > 0 or v < n) for u, v in zip(l, r) if u != -1) + sum(c[ : n])