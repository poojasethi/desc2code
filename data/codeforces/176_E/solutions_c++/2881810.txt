#include<cstdio>
#include<map>
#include<algorithm>
#define MAXN 101000

using namespace std;

int n,m,x[2*MAXN],y[2*MAXN],z[2*MAXN],f[MAXN],T(2),
	_[MAXN],c[MAXN][20],Tail,s[MAXN],D[MAXN];

long long Data[MAXN],d[MAXN],Ans;

map <int,int> Map;

int Lca(int a,int b)
{
	if(D[a]<D[b]){int i(a);a=b;b=i;}
	for(int k=17;k>=0;k--)if(D[c[a][k]]>=D[b])a=c[a][k];
	for(int k=17;k>=0;k--)
	if(c[a][k]!=c[b][k])
	{
		a=c[a][k];
		b=c[b][k];
	}
	return a==b?a:c[a][0];
}

void Check(int x)
{
	map <int,int> :: iterator I,J;
	Ans-=Data[x];
	I=Map.lower_bound(_[x]);
	if(I!=Map.begin())
	{
		J=I;
		J--;
		Data[x]=d[x]-d[Lca(x,J->second)];
	}
	else
	{
		J=Map.end();
		J--;
		Data[x]=d[x]-d[Lca(x,J->second)];
	}
	Ans+=Data[x];
}

void IN(int a,int b,int c){x[T]=f[a];y[T]=b;z[T]=c;f[a]=T++;}

int main()
{
	int i,j,k,l;
	char Oper[10];
	map <int,int> :: iterator I,J;
	scanf("%d",&n);
	for(i=1;i<n;i++)
	{
		scanf("%d%d%d",&j,&k,&l);
		IN(j,k,l);
		IN(k,j,l);
	}
	_[D[1]=d[s[l=0]=1]=1]=Tail++;
	for(;l>=0;)
	if(f[s[l]])
	{
		i=f[s[l]];
		f[s[l]]=x[f[s[l]]];
		if(!d[y[i]])
		{
			c[y[i]][0]=s[l];
			D[y[i]]=D[s[l]]+1;
			d[y[i]]=d[s[l]]+z[i];
			_[s[++l]=y[i]]=Tail++;
		}
	}
	else l--;
	for(k=1;k<18;k++)
		for(i=1;i<=n;i++)
			c[i][k]=c[c[i][k-1]][k-1];
	for(scanf("%d",&m);m--;)
	{
		scanf("%s",Oper);
		if(Oper[0]=='+')
		{
			scanf("%d",&i);
			Map[_[i]]=i;
			Check(i);
			I=Map.upper_bound(_[i]);
			if(I!=Map.end())Check(I->second);
				else Check(Map.begin()->second);
		}
		else if(Oper[0]=='-')
		{
			scanf("%d",&i);
			Map.erase(_[i]);
			Ans-=Data[i];
			Data[i]=0;
			I=Map.upper_bound(_[i]);
			if(I!=Map.end())Check(I->second);
				else if(Map.begin()!=Map.end())Check(Map.begin()->second);
		}
		else printf("%I64d\n",Ans);
	}
	return 0;
}
