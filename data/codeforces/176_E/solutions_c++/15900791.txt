#include <bits/stdc++.h>
// Cogito, ergo sum

using namespace std;

typedef long long ll;
typedef pair<ll, ll> pii;

const ll MAXN = 1e5 + 100, MAXB = 20;

ll par[MAXN][MAXB], h[MAXN], st[MAXN], sN, d[MAXN];
vector<pii> G[MAXN];

void makeroot(ll u, ll p, ll topar){
	h[u] = (p == -1 ? 0 : h[p] + 1);
	d[u] = (p == -1 ? 0 : d[p] + topar);
	st[u] = sN++;

	par[u][0] = p;
	for (ll i = 1; i < MAXB; i++) par[u][i] = ( par[u][i - 1] == -1 ? -1 : par[ par[u][i - 1] ][i - 1]);

	for (ll i = 0; i < G[u].size(); i++){
		ll v = G[u][i].first, w = G[u][i].second;
		if (v != p) makeroot(v, u, w);
	}
}

ll lca(ll u, ll v){
	if (h[u] < h[v]) swap(u, v);

	for (ll i = MAXB - 1; i >= 0; i--)
		if (par[u][i] != -1 && h[ par[u][i] ] >= h[v])
			u = par[u][i];

	if (u == v) return u;
	
	for (ll i = MAXB - 1; i >= 0; i--)
		if (par[u][i] != par[v][i])
			u = par[u][i], v = par[v][i];

	return par[u][0];
}

inline ll dis(ll u, ll v){ return d[u] + d[v] - 2 * d[ lca(u, v) ]; }

set< pii > s;
inline ll next(ll u){
	set< pii > :: iterator iter = s.upper_bound( pii(st[u], u) );
	if (iter == s.end()) iter = s.begin();
	return iter->second;
}

inline ll prev(ll u){
	set<pii> :: iterator iter = s.upper_bound( pii(st[u], u) );
	if (iter == s.begin()) iter = s.end();
	iter--;
	return iter->second;
}

int main(){
	ios::sync_with_stdio( false );
	cout.tie(0); cin.tie(0);

	ll n; cin >> n;
	for (ll i = 0; i < n - 1; i++){
		ll a, b, c; cin >> a >> b >> c; a--; b--;
		G[a].push_back( pii(b, c) );
		G[b].push_back( pii(a, c) );
	}

	makeroot(0, -1, 0);
	//for (ll i = 0; i < n; i++)
	//	cerr << i << " : " << h[i] << ", " << st[i] << ", " << d[i] << endl;

	ll q; cin >> q;

	ll ans = 0;
	while( q-- ){
		char com; cin >> com;

		if (com == '?') cout << ans / 2 << "\n";
		else if (com == '+'){
			ll u; cin >> u; u--;

			if ( s.size() ){
				ll x = next(u), y = prev(u);
				ans += dis(x, u) + dis(y, u) - dis(x, y);
			}

			s.insert( pii(st[u], u) );
		}
		else if (com == '-'){
			ll u; cin >> u; u--;

			s.erase( pii(st[u], u) );
			if (s.size() ){
				ll x = next(u), y = prev(u);
				ans -= dis(x, u) + dis(y, u) - dis(x, y);
			}
		}
	}
}

