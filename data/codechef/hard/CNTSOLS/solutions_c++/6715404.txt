#include<stdio.h>
#include<math.h>
#include<stdlib.h>
#include<string.h>
#include<iostream>
#include<algorithm>
using namespace std;

static long MOD = 1000000007;

int pow_cal(int n,long long p,int m){
    long long c=1;
    long long total_p=p;
    int result=1,temp=n;
    if (p==0&&n==0) {
        if (m==1)
            return 0;
            else return 1;
            }
    while (total_p>0){
        if (total_p%(c*2)==c||total_p==c){
            result *=temp;
            result%=m;
            total_p-=c;
        }
        c*=2;
        temp*=temp;
        temp%=m;
    }
    return result;


}

int main (){
  int t;
  scanf ("%d",&t);
  while (t--){
    long long upper,d;
    int m,n;
    scanf ("%lld %lld %d %d",&upper,&d,&m,&n);
    long long total[n];
    for (int i=0;i<n;i++){
        total[i] = 0;
    }
    for (int i=0;i<n;i++){
        int count = upper/n;
        if (i<=upper%n) count++;

        int p = pow_cal(i,d,n);

        total[p] += count;
    }
    long long ans=0;
    long long temp;
    for (int i=0;i<n;i++){
        for (int j=0;j<n;j++){
            for (int k=0;k<n;k++){
                if ((i+j+k)%n==m){

                    temp = total[i];
                    temp %= MOD;
                    temp *= total[j];
                    temp %= MOD;
                    temp *= total[k];
                   temp %= MOD;
                    ans += temp;
                    ans%=MOD;
                }
            }
        }
    }
    printf ("%lld\n",ans);
  }

}