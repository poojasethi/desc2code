#include <stdio.h>
#define mod 1000000007
long long int modulo(int a, int b, int c)
{
	long long int x=1,y=a;
	if(b==0)
		return 1;
	while(b>0)
	{
		if(b%2)
			x=(x*y)%c;
		y=(y*y)%c;
		b/=2;
	}
	return x%c;
}
long long total(int x, int u, int n)
{
	/*
	long long int sum=u/n;
	if((u%n)&&(x<=(u%n)))
		sum++;
	return sum;*/
	if(u%n>=x)
		return u/n+1; 
	else
		return u/n;
}
int main()
{
	int t,u,d,m,n,i,x,y,z,find[45];
	long long int add,answer;
	scanf("%d",&t);
	while(t--)
	{
		scanf("%d%d%d%d",&u,&d,&m,&n);
		for(i=0; i<n; i++)
			find[i]=modulo(i,d,n);
		answer=0;
		for(x=0; x<n; x++)
			for(y=0; y<n; y++)
				for(z=0; z<n; z++)
					if((find[x]+find[y]+find[z])%n==m)
						answer=(answer+ (((total(x,u,n)*total(y,u,n))%mod)*total(z,u,n))%mod )%mod;
		printf("%lld\n",answer);
	}
	return 0;
}