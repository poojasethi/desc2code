#include <iostream>
using namespace std;
#define mod 1000000007
long long int px(long long int i,long long int d,long long n)
{
     if(d == 0) {
          return 1;
     }
     if(d == 1) {
          return (i%n);
     }else {
           long long int f = d/2;
           long long int l = px(i,f,n);
           if(d%2 == 0) {
                  return ((l*l)%n);
           }else {
                 return ((((l*l)%n)*i)%n);
           }
     }
}



long long int gg(long long int x,long long int u,long long int n)
{
        long long int j = u/n;
        if((u%n) >= x) {
               return j+1;
        }else {
              return j;
        }
}


        
int main()
{
    int t;
    cin >> t;
    long long int u,d,m,n;
    for(int i = 0; i <  t; i++) {
            cin >> u >> d >> m >> n;
            long long int z[n];
            for(long long int j = 0; j < n; j++) {
                    if(j == 0 && d == 0) {
                         z[0] = 1;
                    }else if(j == 0) {
                          z[0] = 0;
                     }else if(j == 1) {
                         z[1] = 1;
             
                    }else {
                          z[j] = px(j,d,n);
                         // cout << z[j] << endl;
                    }
            }
            
            long long int ans = 0;
            for(int j = 0; j < n; j++) {
                    for(int k = 0; k < n; k++) {
                            for(int l = 0; l < n; l++) {
                                    if((z[j]+z[k]+z[l])%n==m)
                                    {
                                    ans = (ans + (((gg(j,u,n)*gg(k,u,n))%mod)*gg(l,u,n))%mod)%mod;
                                    }
                            }
                    }
            }
            
            cout << ans << endl;
                                
            
    } 
    
    return 0;
}
