#include<stdio.h>
#include<cmath>
#include<iostream>
using namespace std;
long long md=1000000007;

int x[45],i,j,k;
long long T,upper,d,m,n,ans,s1,s2,s3;

inline long long power(int num,int p,int mod)
{
	if(p==0)return 1;
	else if(p%2) return (num*power(num,p-1,mod))%mod;
	else
	{
		long long res=power(num,p/2,mod);
		return (res*res)%mod;
	}
}

inline long long fn(int idx)
{
	ans=0;
	for(i=0;i<idx;i++)for(j=0;j<idx;j++)for(k=0;k<idx;k++)
	if((x[i]+x[j]+x[k])%n==m)
	{
        s1=(upper-i)/idx+1;
		s2=(upper-j)/idx+1;
        s3=(upper-k)/idx+1;
		ans+=(s1*s2%md*s3)%md;
		ans%=md;
	}
	return ans;
}
inline long long fn1(int idx)
{
	ans=0;
	for(i=0;i<=idx;i++)for(j=0;j<=idx;j++)for(k=0;k<=idx;k++)
	if((x[i]+x[j]+x[k])%n==m)ans++;
	return ans;
}

int main()
{
	scanf("%lld",&T);
	while(T--)
	{
		scanf("%lld%lld%lld%lld",&upper,&d,&m,&n);
		for(i=0;i<=n;i++)x[i]=power(i,d,n)%n;
		if(upper>n)
		printf("%lld\n",fn(n)%md);
		else
		printf("%lld\n",fn1(upper)%md);
	}
	return 0;
}