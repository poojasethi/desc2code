#include<stdio.h>
#define ll long long
#define MOD 1000000007
ll modulo(ll a,ll b,ll c)
{
	ll x=1,y=a;
	while(b>0)
	{
		if(b%2==1)
		x=(x*y)%c;
		y=(y*y)%c;
		b=b/2;
	}
	return x%c;
}
int main()
{
	
	ll t,upper,d,m,N,ans;
	ll a[50],i,j,k,x,y,z;
	scanf("%lld",&t);
	while(t--)
	{
		ans=0;
		scanf("%lld%lld%lld%lld",&upper,&d,&m,&N);
		for( i=0;i<N;i++)
		a[i]=modulo(i,d,N);
		for( i=0;i<N;i++)
		for( j=0;j<N;j++)
		for( k=0;k<N;k++)
		{
			if((a[i]+a[j]+a[k])%N==m)
			{
				x=upper/N+(i<=(upper%N));
				y=upper/N+(j<=(upper%N));
				z=upper/N+(k<=(upper%N));
				ans+=(x*((y*z)%MOD))%MOD;
				ans=ans%MOD;
			}
		}
		printf("%lld\n",ans);
	}
	return 0;
}