#include <bits/stdc++.h>
#define lli long long
#define M 1000000007

using namespace std;

int etf(int x)
{
    int ans = 0;
    for ( int i = 1; i <= x; i++ ) {
        if ( __gcd(i,x) == 1 ) ans++;
    }
    return ans;
}

lli fast_pow(lli a, lli b, lli c)
{
    if ( a == 0 && b == 0 ) return 1%c;
    if ( a == 0 && b != 0 ) return 0;
    lli res = 1;
    while ( b > 0 ) {
        if ( b&1 ) res = (res*a)%c;
        a = (a*a)%c;
        b >>= 1;
    }
    return res;
}

lli cal(lli x, lli n, lli upper)
{
    if ( upper < x ) return 0;
    lli val = (upper-x)/n + 1;
    val %= M;
    return val;
}

int main()
{
    int t;
    lli upper,d,m,n,ans;
    
    cin >> t;

    while ( t-- ) {

        cin >> upper >> d >> m >> n;

    //    d %= etf(n);

        ans = 0;

        for ( lli i = 0; i <= n-1; i++ ) {
            for ( lli j = 0; j <= n-1; j++ ) {
                for ( lli k = 0; k <= n-1; k++ ) {
                    lli p = fast_pow(i,d,n) + fast_pow(j,d,n) + fast_pow(k,d,n);
                    p %= n;
                    if ( p == m ) {
                        lli val = cal(i,n,upper)%M;
                        val = (val*cal(j,n,upper))%M;
                        val = (val*cal(k,n,upper))%M;
                        ans = (ans + val)%M;
                    }
                }
            }
        }
        cout << ans << endl;
    }
    return 0;
}
