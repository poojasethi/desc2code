#include <iostream>

using namespace std;
typedef long long ll;
#define FORN(i,n) for(int i = 0; i < n; i++)

ll up,d,n,m;
ll MOD = 1000000007;
ll cant[50];

ll exp(ll a, ll b, ll mod)
{
	if(b == 0) return 1%mod;

		ll x = exp(a, b/2, mod);
		x = (x*x)%mod;

		if(b&1) x = (x*a)%mod;

		return x;
}

ll mul(ll a, ll b)
{
	return (a*b)%MOD;
}

ll solve()
{
	ll ans = 0;

	FORN(i, n)
		FORN(j, n)
			FORN(k, n)
			{
				if( (i + j + k)%n == m%n )
				{
					ans += (cant[i]*((cant[j]*cant[k])%MOD))%MOD;
					ans %= MOD;
				}
			}

	return ans%MOD;
}

int main()
{
	int t;
	cin >> t;
	//t = 1;
	while(t--)
	{
		cin >> up >> d >> m >> n;
		for(int i = 0; i < n; i++)
		{
			ll resto = exp(i,d,n);
			if(i <= up)
				cant[resto] += ((up- i)/n + 1);
		}
		cout << solve() << endl;
		fill(cant, cant + 50,0);

	}
	return 0;
}
