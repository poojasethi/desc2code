#include<iostream>
#include<cstdio>
#define MOD 1000000007
#define MAX 43
using namespace std;

long long int me(int x,int n,int m)
{
	if(n==0)
		return 1;
	else
	{
		long long int p = me(x,n/2,m);
		if(n&1)
			return (((p*p)%m)*x)%m;
		else
			return (p*p)%m;
	}
}

long long int no_sol(int x,int u,int N)
{
	if(u%N>=x)
		return u/N+1;
	else
		return u/N;
}


int main(){
    long long t,i,j,k,N,m,range,temp;
    long long d,u,a[MAX];
    scanf("%lld",&t);
    while(t--){
        scanf("%lld %lld %lld %lld",&u,&d,&m,&N);
        //range=u<N?u+1:N;
        //for(i=0;i<range;i++) count[i]=0;
        //if(u>N){for(i=0;i<range;i++) count[i]=(u+1)/N; temp=(u+1)%N; j=0; while(temp--) count[j++]+=1; }
        //else for(i=0;i<range;i++) count[i]=1;
        for(i=0;i<N;i++)
		{
			if(i==0&&d==0)
				a[i] = 1;
			else if(i==0 || i == 1)
				a[i] = i;
			else
				a[i] = me(i,d,N);
		}
        //for(i=0;i<range;i++) cout<<count[i]<<" "<<a[i]<<endl;
        //cout<<endl<<endl;
        //for(i=0;i<range;i++) cout<<count[i]<<" ";
        //cout<<endl;
        long long cnt=0;
        long long t;
        for(i=0;i<N;i++){
            for(j=0;j<N;j++){
                for(k=0;k<N;k++){
                    if((a[i]+a[j]+a[k])%N==m){
                        t=(no_sol(i,u,N)*no_sol(j,u,N))%MOD;
                        t=(t*no_sol(k,u,N))%MOD;
                        //cout<<i<<" "<<j<<" "<<k<<" "<<t<<endl;
                        cnt=(cnt+t)%MOD;
                    }
            }
        }
        }
        cout<<cnt%MOD<<endl;
    }
}

