#include <iostream>
#include<bits/stdc++.h>
using namespace std;
#define modi 1000000007
#define ll long long

ll fun1(ll a,ll b,ll mod)
{
	
    ll ans;
    
    if(b==0) return 1;
    else {ans=fun1(a,b/2,mod);
    ans*=ans;
    ans%=mod;}
    if(b%2==1) {(ans*=a);ans%=mod;}

    return ans;
}



#define scan(t) scanf("%lld",&t)

using namespace std;

int main()
{
   //cout << "Hello world!" << endl;
    ll t;
    scan(t);
    while(t--)
    {
        ll upper,d,n,m;
        scan(upper);        scan(d);
        scan(m);
        scan(n);

ll a[45],i;
memset(a,0,sizeof(a));

for(i=0;i<n;i++)
a[i]=(upper/n)+(upper%n>=i);



//printf("%d ",fun1(0,0,3));




//printf("%d",fun1(7,3,6));

ll j,k,count=0;
for(i=0;i<n;i++)
    for(j=0;j<n;j++)
    for(k=0;k<n;k++)
{ll cur=0;
cur+=fun1(i,d,n);
cur+=fun1(j,d,n);

cur+=fun1(k,d,n);
	
	if(cur%n==m)
{count+=(((a[i]*a[j])%modi)*a[k])%modi;
count%=modi;

}
}

printf("%lld\n",count);

    }

return 0;
}