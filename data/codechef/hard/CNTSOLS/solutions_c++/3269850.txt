#include<stdio.h>
#include<iostream>
#include<math.h>
#include<vector>
#include<map>
#include<string>
#include<string.h>
#include<algorithm>
#define PI acos(-1.0)
#define SIZE 1000
#define MOD 1000000007L
#define Fi(a,n) for(int i=a;i<n;i++)
#define Fj(a,n) for(int j=a;j<n;j++)
#define Fk(a,n) for(int k=a;k<n;k++)
using namespace std;
int modular_pow(int base, int exponent, int modulus)
{
	int result = 1;
	while (exponent > 0)
	{
		if (exponent % 2 == 1)
			result = (result * base) % modulus;
		exponent = exponent >> 1;
		base = (base * base) % modulus;
	}
	return result;
}
int main()
{
	int T;
	scanf("%d", &T);
	while (T--)
	{
		int upper, d, m, n;
		int x1, x2, x3;
		int limit;
		int pow[50], i;
		long long count;
		scanf("%d%d%d%d", &upper, &d, &m, &n);
		limit = (upper < n ? upper : n - 1);
		for (i = 0; i <= limit; ++i)
			pow[i] = modular_pow(i, d, n);
		count = 0;
		for (x1 = 0; x1 <= limit; ++x1)
			for (x2 = 0; x2 <= limit; ++x2)
				for (x3 = 0; x3 <= limit; ++x3)
					if ((pow[x1] + pow[x2] + pow[x3]) % n == m)
					{
						long long  c1 = upper / n + (x1 <= (upper % n));
						long long  c2 = upper / n + (x2 <= (upper % n));
						long long  c3 = upper / n + (x3 <= (upper % n));
						long long tmp = ((c1 % MOD) * (c2 % MOD)) % MOD;
						tmp = (tmp * (c3 % MOD)) % MOD;
						count = (count + tmp) % MOD;
					}
		printf("%lld\n", count);
	}
	return 0;
}
