#include<iostream>
#include<string>
using namespace std;
#define FOR(i,a,b) for(int i=a;i<=b;++i)
typedef long long Int;
void assert(bool x){if(!x)throw -1;}
const int MODULO = 1000000007;
 
int binpw(int x,int times,int md){
	int ans=1;
	while(times){
		if(times&1)ans=(ans*(Int)x)%md;
		x=(x*(Int)x)%md;
		times/=2;
	}
	return ans;
}
 
int has_mod[111];
void solve(){
	int tests;cin>>tests;
	while(tests--){
		int up,N,d,m;
		//1<=xi<=up
		//sum xi^d == m mod N
		//0<=m<N
		cin>>up>>d>>m>>N;
 
		assert(m>=0 && m<N);
		assert(1<=up && up<=1000000000);
		assert(0<=d && d<=1000000000);
		assert(N<=40);
 
		FOR(i,0,N-1)has_mod[i] = (up/N)+(up%N>=i);
		Int ans=0;
		FOR(md1,0,N-1)FOR(md2,0,N-1)FOR(md3,0,N-1){
			Int cur=0;
			cur+=binpw(md1,d,N);
			cur+=binpw(md2,d,N);
			cur+=binpw(md3,d,N);
 
			if(cur%N==m){
				int tmp=has_mod[md1];
				tmp=(tmp*(Int)has_mod[md2])%MODULO;
				tmp=(tmp*(Int)has_mod[md3])%MODULO;
				//cout<<md1<<" "<<md2<<" "<<md3<<" "<<tmp<<endl;
				ans=(ans+tmp)%MODULO;
			}
		}
		cout<<ans<<endl;
		/*ans=0;
		FOR(i1,0,up)FOR(i2,0,up)FOR(i3,0,up){
			Int now = (0LL+binpw(i1,d,N)+binpw(i2,d,N)+binpw(i3,d,N))%N;
			if(now==m)++ans;//cout<<i1<<" "<<i2<<" "<<i3<<endl;
		}
		cout<<ans<<endl;*/
	}
}
 
int main()
{
	//freopen("input.txt","r",stdin);freopen("output.txt","wb",stdout);
	solve();
	/*const int files = 4;
	for(int file=0;file<files;++file){
		//cerr<<file<<endl;
		string fread = "input";fread+=char(file+48);fread+=".txt";
		string fwrite = "output";fwrite+=char(file+48);fwrite+=".txt";
		freopen(fread.data(),"r",stdin);freopen(fwrite.data(),"wb",stdout);
		solve();
	}*/
}
