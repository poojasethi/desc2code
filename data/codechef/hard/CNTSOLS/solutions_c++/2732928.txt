#include<iostream>
#define ll long long
#define mod 1000000007
using namespace std;

    ll power(ll a,ll b,ll m){
    ll res = 1 ;
    for( ; b ; b>>=1 , a = a*a%m)
        if(b&1)
            res = res*a%m;
    return res%m;
}


int main(void)
{
    ll i,j,k,l,t,upper,d,m,n;
    cin>>t;
    while(t--)
    {
        cin>>upper>>d>>m>>n;
        ll arr[n];
        for(i=0;i<=n-1;i++)
        {
            arr[i]=0;
        }
        ll rem;
        for(i=0;i<=n-1&&i<=upper;i++)
        {
            rem=power(i,d,n);
            arr[rem]=arr[rem]+((upper-i)/n);
            arr[rem]++;
            arr[rem]=arr[rem]%mod;
        }
        /*for(i=0;i<=n-1;i++)
            cout<<arr[i]<<endl;*/
        l=0;
        ll p,q;
        for(i=0;i<=n-1;i++)
        {
            for(j=0;j<=n-1;j++)
            {
                for(k=0;k<=n-1;k++)
                {
                    q=(i+j+k)%n;
                    if(q!=m)
                        continue;
                    //cout<<i<<' '<<j<<' '<<k<<endl;
                    p=(arr[i]*arr[j])%mod;
                    p=(p*arr[k])%mod;
                    l=(l+p)%mod;
                }
            }
        }
        cout<<l<<endl;
    }
    return 0;
}
