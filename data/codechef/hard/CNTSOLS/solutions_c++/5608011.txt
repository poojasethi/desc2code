#include <iostream>
#include <stdio.h>
#include <map>
#include <algorithm>
#include <vector>
#include <cstring>
using namespace std;

typedef long long LL;
typedef pair<int,int> PII;
typedef map<int,int> MII;

#define MOD 1000000007
#define MAX 100005


LL power(LL b,LL e,LL mod)
{
    LL r=1;
    while(e>0)
    {
        if(e&1)
        {
            r *= b;
            r  %= mod;
        }
        e >>= 1;
        b *= b;
        b %= mod;
    }
    return r%mod;
}

LL a[50]; /// a[i] stores i^d % n

LL upper,d,m,n;
void pre()
{
        if(d==0)
        {
            for(int i=0;i<=40;++i)
            {
                a[i] = 1;
            }

        }
        else
        {
            a[0] = 0;
            a[1] = 1;
            for(int i=2;i<=40;++i)
            {
             a[i] = (power(i,d,n))%n;
            }
        }

}

LL ans=0;

LL number_sol(LL x)
{
    if(x==0) return (1 + (int)(upper/n));

LL r=(LL)(upper/n);

if((upper%n) > 0 && x <= (upper%n))
{
    ++r;
}

return r;



}


void process(LL a,LL b,LL c)
{

 LL t1 = number_sol(a);  ans %= MOD;
 LL t2 = number_sol(b);  ans %= MOD;
LL t3 = number_sol(c);  ans %= MOD;

LL t4 = (t1*t2)%MOD;
t4 = (t4*t3)%MOD;

ans = ans%MOD + t4%MOD;

ans %= MOD;


}




int main()
{
    int test;
    cin>>test;
    while(test>0)
    {
        --test;

        cin>>upper>>d>>m>>n;

        memset(a,0,sizeof(a));
        pre();

        ans=0;

        for(int i=0;i<n;++i)
        {
            for(int j=0;j<n;++j)
            {
                for(int k=0;k<n;++k)
                {
                    LL temp = ((a[i]%n + a[j]%n)%n + a[k]%n)%n;

                    if(temp==m)
                    {
                        //cout<<" i = "<<i<<" j = "<<j<<" k = "<<k<<endl;
                        process(i,j,k);
                    }
                }
            }
        }

        cout<<ans%MOD<<endl;

    }
    return 0;
}
