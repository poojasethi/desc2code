#include<bits/stdc++.h>
using namespace std;
map<int,int> mp;
int main()
{
	int i,j;
	int n,f;
	int t;
	int y,ans,c;
	long long h,x;
	scanf("%d",&t);
	while(t--)
	{
		ans=0;
		mp.clear();
		scanf("%d%d",&n,&f);
		//cout<<mp[15]<<"\n";
		for(i=0;i<n;++i)
		{
			scanf("%lld",&x);
			//if(mp.find(x)==mp.end())
			//	mp[x]=0;
			//else
			mp[x]+=1;
		}
		map<int,int> ::iterator it;
		for(it=mp.begin();it!=mp.end();++it)
		{
			c=0;
			x=it->first;
			y=it->second;
			h=f;
			while(x/h)
			{
				if(x%h==0/*&&mp.find(x/h)!=mp.end()*/)
				c+=mp[x/h];
				h*=f;
			}
			//cout<<c<<" "<<y<<"\n";
			c*=y;
			//cout<<c<<"\n";
			c+=(y*(y-1))/2;
			//cout<<c<<"\n";
			ans+=c;
			//cout<<ans<<"\n";
		}
		cout<<ans<<"\n";
	}
	return 0;
}