#include<bits/stdc++.h>
using namespace std;
int arr[200010],num=1e9+7,in[100010],out[100010],cnt=0,dep[100010],val[100010];
vector<pair<int,int> >buf;
vector<int> g[100010],q[100010];
void dfs(int u,int ht,int par)
{
	in[u]=cnt++;dep[u]=ht;
	for(int i=0;i<g[u].size();i++)
	if(g[u][i]!=par)dfs(g[u][i],ht+1,u);
	out[u]=cnt;
}
void update(int u,int a,int b)
{
	for(int i=0;i<q[u].size();i++)
	{
		a=(a+arr[q[u][i]])%num;
		b=(b+arr[q[u][i]-1])%num;
	}
	q[u].clear();
	val[u]=(val[u]+a)%num;
	int pass=(a+b)%num;
	for(int i=0;i<g[u].size();i++)
	update(g[u][i],pass,a);
}
main()
{
	int tc;
	arr[1]=1,arr[2]=1;
	for(int i=3;i<200010;i++)
	arr[i]=(arr[i-1]+arr[i-2])%num;
		int n,m;
		scanf("%d %d",&n,&m);
		//for(int i=0;i<=n;i++)g[i].clear(),val[i]=0,q[i].clear();
		for(int i=1;i<n;i++)
		{
			int t;
			scanf("%d",&t);
			g[t].push_back(i+1);
			//g[t].push_back(i+1);
		}
		dfs(1,0,-1);
		//for(int i=1;i<=n;i++)printf("dep %d =%d\n",i,dep[i]);
		char s[5];
		int sz=sqrt(m);tc=m;
		while(tc--)
		{
			scanf("%s",s);
			if(s[0]=='U')
			{
				int u,k;
				scanf("%d %d",&u,&k);
				buf.push_back(make_pair(u,k));
				if(buf.size()==sz)
				{
					for(int i=0;i<sz;i++)
					{
						q[buf[i].first].push_back(buf[i].second);
					}
					update(1,0,0);
					buf.clear();
				}
			}
			else
			{
				int u;
				scanf("%d",&u);
				int ans=val[u];
				for(int i=0;i<buf.size();i++)
				{
					if(in[buf[i].first]<=in[u] && out[buf[i].first]>=out[u])
					ans=(ans+(arr[buf[i].second-dep[buf[i].first]+dep[u]])%num)%num;
				}
				printf("%d\n",ans);
			}
		}
}