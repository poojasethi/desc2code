#include<iostream>
#include<cstdio>
#define gc getchar_unlocked
long long multiple(long long a, long long b, long long c) // a * b % c
{
    if (b == 0) {
        return 0;
    }
    long long ret = multiple(a, b >> 1, c);
    ret = (ret + ret) % c;
    if (b & 1) {
        ret = (ret + a) % c;
    }
    return ret;
}
void ra(long long int arr[], int start, int end)
{
	long long int temp;
	while(start < end)
	{
		temp = arr[start];
		arr[start] = arr[end];
		arr[end] = temp;
		start++;
		end--;
	}
}
void mu(long long int a[],int start,int end,long long int B,long long int C)
{
	for(int j=start;j<=end;j++)
	{
		a[j]= multiple(a[j],B,C);
	}
}
void ad(long long int a[],int start,int end,long long int A,long long int C)
{
	for(int j=start;j<=end;j++)
	{
		a[j]= (((a[j]%C) + (A%C))%C);
	}
}
char s[1002];
long long int a[1002];
/*void scanint(int &x)
{
register int c = gc();
x = 0;
for(;(c<48 || c>57);c = gc());
for(;c>47 && c<58;c = gc()) {x = (x<<1) + (x<<3) + c - 48;}
}*/
int main()
{
	int T;
	//scanint(T);
	scanf("%d",&T);
	int N;
	long long int A,B,C,K,D;
	while(T--)
	{
		scanf("%d",&N);
		K=1;
		D=0;
		for(int i=0;i<N;i++)
		{
			scanf("%lld",&a[i]);
		}
		scanf("%lld %lld %lld %s",&A,&B,&C,&s);
		int beg = 0,end=N-1,dir=1;
		for(int i=0;i<N;i++)
		{
			if(s[i]=='R')
			{
			    long long int tem = beg;
				beg = end;
				end = tem;
				dir = (-1)*dir;
			}
			else if(s[i]=='M')
			{
				K=multiple(K,B,C);
				D=multiple(D,B,C);
			}
			else if(s[i]=='A')
			{
				D = (D + A)%C;
			}

			long long int ans = multiple(a[beg],K,C);
			ans = (ans + D)%C;
			printf("%lld ",ans);
			beg = beg + dir;
			//end = end - dir;
		}
		if(T>0)
			printf("\n");
	}
	//system("pause");
	return 0;
}
