#include <iostream>
#include <cstdio>
using namespace std;
#define Nodes 1000
long long L[Nodes+3],A,B,C;
long long k[Nodes+3],d[Nodes+3];

long long mul(long long a,long long b,long long c)
{
	if(a==0 or b==0) return 0;
	long long res=0;
	while(b)
	{
		if(b&1) res=(res+a)%c;
		a=(a+a) %c;
		b>>=1;
	}
	return res%c;
}

int main() {
	int t,n;
	char ar[Nodes+3];
	cin>>t;
	while(t--)
	{
		cin>>n;
		for(int i=1;i<=n;i++)
		cin>>L[i];
		cin>>A>>B>>C;
		scanf("%s",ar+1);
		int start=1,end=n,xr=1;
		k[0]=1;
		d[0]=0;
		for(int i=1;i<=n;i++)
		{
			if(ar[i]=='R')
			{
				xr^=1;
				k[i]=k[i-1];
				d[i]=d[i-1];
			}
			else if(ar[i]=='A')
			{
				k[i]=k[i-1];
				d[i]=(d[i-1]+A)%C;
			}
			else if(ar[i]=='M')
			{
				k[i]=mul(k[i-1],B,C);
				d[i]=mul(d[i-1],B,C);
			}
			long long res=(mul(k[i],L[xr?start++:end--],C)+d[i])%C;  // mod c
			
			cout<<res<<" ";
		}
		cout<<endl;
	}


	// your code goes here
	return 0;
}