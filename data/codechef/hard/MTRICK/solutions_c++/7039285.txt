#include <bits/stdc++.h>
using namespace std;
inline long long int multiply(long long int a,long long int b,long long int c)
{
	if(b==0)
	{
		return 0;
	}
	long long int answer=multiply(a,b>>1,c);
	answer=(answer+answer)%c;
	if(b&1)
	{
		answer=(answer+(a)%c)%c;
	}
	return answer;
}
long long int l[1004],pow_b[1004];
int main()
{
	ios_base::sync_with_stdio(false);
	int t;
	cin>>t;
	while(t--)
	{
		int n;
		cin>>n;
		for(int i=0;i<n;i++)
		{
			cin>>l[i];
		}
		long long int a,b,c;
		cin>>a>>b>>c;
		string s;
		cin>>s;
		int track=0,count_b=0;
		long long int ans=0;
		vector<long long int> v;
		pow_b[0]=1;
		for(int i=1;i<=s.size();i++)
		{
			if(b!=0)
			pow_b[i]=multiply(pow_b[i-1],b,c);
		else
			pow_b[i]=0;
		}
		int u=0,vv=n-1;
		for(int i=0;i<s.size();i++)
		{
			if(s[i]=='A')
			{
				ans=(ans+(a%c))%c;
				//cout<<ans<<"\n";
			}
			else if(s[i]=='M')
			{
				ans=multiply(ans,b,c);
				count_b++;
			}
			else if(s[i]=='R')
			{
				track=(track+1)%2;
			}
			if(track==0)
			{
				//cout<<pow_b[count_b]<<"\n"<<l[u]%c<<"\n";
				long long int x=multiply(l[u],pow_b[count_b],c);
				v.push_back((ans+x)%c);
				u++;
			}
			else
			{
				long long int x=multiply(l[vv],pow_b[count_b],c);
				v.push_back((x+ans)%c);
				vv--;
			}
		}
		for(int i=0;i<v.size();i++)
		{
			cout<<v[i]<<" ";
		}
		cout<<"\n";
	}
}