#include<iostream>
#include<math.h>
#include<cstdio>
#include<string.h>
#define gc getchar_unlocked
using namespace std;
void fastin(int &x)
{
	register int a=gc();
	x=0;
	for(;a<48 || a>57;a=gc());
	for(;a>47 && a<58;a=gc())
		x=(x<<1)+(x<<3)+a-48;	
}
void fastin(unsigned long long int &x)
{
	register int a=gc();
	x=0;
	for(;a<48 || a>57;a=gc());
	for(;a>47 && a<58;a=gc())
		x=(x<<1)+(x<<3)+a-48;	
}
unsigned long long int fast_mul(unsigned long long int a,unsigned long long int b,unsigned long long c)
{
	if(b==1) return a;
	else if(b==0) return 0;
	else if(b&1) return ((a%c)+fast_mul(a,b-1,c)%c);
	else
	{
		unsigned long long half=fast_mul(a,b>>1,c);
		return ((half%c)<<1)%c;
	}	
}

int main()
{
	int s,end,dir,t,n,i,temp;
	unsigned long long int a,b,c,list[1005],k,d;
	char string[1005];
	fastin(t);
	while(t--)
	{
		s=0;
		dir=1;
		fastin(n);
		for(i=0;i<n;i++)
		fastin(list[i]);
		k=1;
		d=0;
		fastin(a);fastin(b);fastin(c);
		scanf("%s",string);
		end=n-1;
		//cout<<end;
		//cout<<str<<"\n";
		for(i=0;string[i];i++)
		{
			if(string[i]=='A')
			{
				k=(k%c);
				d=(d+a)%c;
				printf("%llu ",(fast_mul(list[s],k,c)+d)%c);
			}
			else if(string[i]=='M')
			{
				k=fast_mul(k,b,c);
				d=fast_mul(d,b,c);
				printf("%llu ",(fast_mul(list[s],k,c)+d)%c);
			}
			else
			{
				temp=s;
				s=end;
				end=temp;
				dir*=(-1);
				printf("%llu ",(fast_mul(list[s],k,c)+d)%c);	
			}
			s+=(dir);
		}
		printf("\n");
		
	}

	
	
	
	
	
	 
	return 0;
}

