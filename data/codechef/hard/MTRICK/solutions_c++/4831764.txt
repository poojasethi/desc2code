#include <bits/stdc++.h>
 
using namespace  std;
 
typedef long long ll;
 
#define SZ 1010
 
ll MultMod(ll a,ll b,ll mod){
    a %= mod;
    b %= mod;
    ll ret=0;
    while(b){
        if(b&1){
            ret += a;
            if(ret >= mod) ret -= mod;
        }
        a = a<<1;
        if(a >= mod) a -= mod;
        b = b>>1;
    }
    return ret;
}
 
ll arr[SZ];
 
int main() {
    int t, n, i, beg, end;
    ll a, b, c, add, mul;
    bool soja;
    char s[SZ];
 
    scanf("%d",&t);
 
    while(t--){
        scanf("%d",&n);
 
        for(i=1;i<=n;i++) scanf("%lld",&arr[i]);
        scanf("%lld %lld %lld",&a,&b,&c);
 
        a %= c;
        b %= c;
        scanf("%s",s+1);
        soja = 1;
        beg = 1;
        end = n;
        add = 0LL;
        mul = 1LL;
 
        for(i=1;i<=n;i++){
            if(s[i] == 'R'){
                soja = !soja;
            }
 
            else if(s[i] == 'A'){
                add = (add + a) % c;
            }
 
            else{
                add = MultMod(add, b, c);
                mul = MultMod(mul, b, c);
            }
 
            if(i != 1) printf(" ");
            if(soja){
                arr[beg] = MultMod(arr[beg], mul, c);
                arr[beg] = (arr[beg] + add) %c;
                printf("%lld",arr[beg]);
                beg++;
            }
            else{
                arr[end] = MultMod(arr[end], mul, c);
                arr[end] = (arr[end] + add) % c;
                printf("%lld",arr[end]);
                end--;
            }
        }
        puts("");
    }
 
    return 0;
}
 