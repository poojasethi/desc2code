#include <cstdio>
using namespace std;

#define MAX 1003

long long l[MAX];
char s[MAX];

long long multiply(long long a, long long b, long long c)
{
    if (b == 0) {
        return 0;
    }
    long long ret = multiply(a, b >> 1, c);
    ret = (ret + ret) % c;
    if (b & 1) {
        ret = (ret + a) % c;
    }
    return ret;
}

int main(int argc, char const *argv[])
{
	int t, n;
	long long a, b, c;
	long long cur;

	scanf("%d", &t);
	while(t--) {
		scanf("%d", &n);
		for (int i = 0; i < n; i++)
			scanf("%lld", &l[i]);
		scanf("%lld %lld %lld", &a, &b, &c);
		scanf("%s", s);

		int begin = 0, end = n;
		long long rev = 0, add = 0, mul = 1;
		for (int i = 0; i < n; i++) {
			if(s[i] == 'R') {
				rev ^= 1;
			}
			else if(s[i] == 'A') {
				add = (add + a) % c;
			}
			else if(s[i] == 'M') {
				add = multiply(add, b, c);
				mul = multiply(mul, b, c);
			}
			cur = l[rev ? --end : begin++];
			cur = multiply(cur, mul, c);
			cur = (cur + add) % c;
			printf("%lld ", cur);
		}
		printf("\n");
	}
	return 0;
}