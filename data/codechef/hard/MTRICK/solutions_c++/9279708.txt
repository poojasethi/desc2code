#include<bits/stdc++.h>
using namespace std;
long long int l[1001];
char s[1001];

long long int mul(long long int a,long long int b,long long int c)
{
    if(b==0)
        return 0;
    long long int ret=mul(a,b>>1,c);
    ret=(ret+ret)%c;
    if(b&1)
    {
        ret=(ret+a)%c;
    }
    return ret;
}
int  main()
{
int t;
cin>>t;
while(t--)
{

    int n;
    cin>>n;

    int i;

    for(i=0;i<n;i++)
        cin>>l[i];

    long long int a,b,c;
    cin>>a>>b>>c;

   
    cin>>s;
    long long int sl,rem;
    int low=0;
    int high=n-1;
    int direction=0;
rem=0;
sl=1;

for(i=0;i<n;i++)
{
if(s[i]=='R')
{
    direction^=1;
}

if(s[i]=='A')
{
    rem=(rem+a)%c;
}
if(s[i]=='M')
{
    sl=mul(sl,b,c);
    rem=mul(rem,b,c);
}

    if(direction==0)
    {

        l[low]=(mul(l[low],sl,c)+rem)%c;
        cout<<l[low]<<endl;
        low++;
    }

    else if(direction==1)
    {

        l[high]=(mul(l[high],sl,c)+rem)%c;
        cout<<l[high]<<endl;
        high--;
    }

}
}
return 0;
}
