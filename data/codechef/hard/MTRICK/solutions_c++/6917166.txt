#include<bits/stdc++.h>
using namespace std;
typedef long long LL;

long long mulmod(long long a,long long b,long long c)
{
	long long x = 0,y=a%c;
	while(b > 0)
	{
	    if(b%2 == 1)
		{
			x = (x+y)%c;
		}
		y = (y*2)%c;
		b /= 2;
	}
	return x%c;
}

int main()
{
    long long t,n,i,A,B,C;
    scanf("%lld",&t);
    while(t--)
    {
        scanf("%lld",&n);
        char str[10000];
        long long arr[n+1];
        for(i=0;i<n;i++)
        {
            scanf("%lld",&arr[i]);
        }
        scanf("%lld%lld%lld",&A,&B,&C);
        scanf("%s",str);
        long long start=0,last=n-1;
        long long mul=1,add=0;
        int dir=0;
        for(i=0;i<n;i++)
        {
            if(i)
                printf(" ");
            if(str[i]=='R')
            {
                dir=1-dir;
            }
            else if(str[i]=='A')
            {
                add=(add+A)%C;
            }
            else if(str[i]=='M')
            {
                mul=mulmod(mul,B,C);
                add=mulmod(add,B,C);
            }
            if(dir==0)
            {
               long long ans=(mulmod(arr[start],mul,C)+add)%C;
                printf("%lld",ans);
                start++;
            }
            else
            {
                long long ans=(mulmod(arr[last],mul,C)+add)%C;
                printf("%lld",ans);
                last--;
            }
        }
        printf("\n");
    }
    return 0;
}
