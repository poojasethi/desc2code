#include<bits/stdc++.h>
using namespace std;
long long multi(long long a,long long b,long long c) {
	if(b==0)
	return 0;
	long long ret =multi(a,b >> 1,c);
	ret=(ret+ret)%c;
	if(b&1) {
		ret=(ret+a)%c;
	}
	return ret;
}
int main() {
	long long t,p;
	long long n,i;
	scanf("%lld",&t);
	while(t--) {
		scanf("%lld",&n);
		vector<long long > v;
		for(i=0;i<n;i++){
			scanf("%lld",&p);
			v.push_back(p);
		}
		long long a,b,c;
		scanf("%lld%lld%lld",&a,&b,&c);
		string s;
		cin >> s;
//		printf("\n");
/*		for(i=0;i<n;i++)
		printf("%lld ",v[i]);
		printf("\n%lld %lld %lld\n",a,b,c);
		cout << s <<endl;
*/

		long long add=0,mul=1,rev=0,cur;
		for(i=0;i<s.size();i++) {
			if(s[i]=='A') 
			add=(add+a)%c;
			else if(s[i]=='M') {
				mul=multi(mul,b,c);
				add=multi(add,b,c);
			} 
			else 
			rev++;
			if(rev%2==0) {
				cur = v[0];
				v.erase(v.begin()); 
			} else {
				cur = v[v.size()-1];
				v.erase(v.end()-1);
			}
//			cout << "add " << add << " mul " << mul <<" cur " << cur <<endl;
			cur = multi(cur,mul,c);
//			cout << "cur " << cur <<endl;
			cur = (cur + add)%c;
			if(i==0)
			printf("%lld",cur);
			else
			printf(" %lld",cur);
		}
		printf("\n");
	}
	return 0;
}