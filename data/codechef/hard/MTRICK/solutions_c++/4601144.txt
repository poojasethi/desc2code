#include<bits/stdc++.h>
//#define getchar() gc
long long int getn()
{long long int i=0;
 char ch=getchar();
 while(ch<'0'||ch>'9')
 ch=getchar();
 while(ch>='0'&&ch<='9')
 {i=(i<<1)+(i<<3)+ch-'0';
  ch=getchar();
 }
 return i;
}
long long int mult(long long int x, long long int y, long long int mod)
{
x %= mod;
y %= mod;
long long int z = 0;
for (; x; x >>= 1){
if(x & 1)
if((z += y) >= mod)
z -= mod;
if((y += y) >= mod)
y -= mod;
}
return z;
}
int main()
{  int t,n;
   char str[1004];
	long long int arr[2][1004],a,b,c;
	scanf("%d",&t);
	while(t--)
	{   fflush(stdin);
		scanf("%d",&n);
		for(int i=0;i<n;i++)
		arr[0][i]=getn();
		a=getn();b=getn();c=getn();
		scanf("%s",str);
		int start=0,end=n-1,dir=0;
		for(int i=0;i<n;i++)
		{
		   if(str[i]=='R')
           {
				if(dir)
				dir=0;
				else
				dir=1;

           }
		   arr[1][i]=dir==1?end:start;
		   if(dir)
    			 end--;
	    		else
		    	 start++;

		   
		}
		long long int part1=1,part2=0,ans;
		//long double p,q;
		for(int i=0;i<n;i++)
		{if(str[i]=='A')
		 { //p=(((long double)part2+(long double)a)%(long double)c);
		   part2=(part2%c)+(a%c);
		   //part2=(unsigned long long int)p;
		   part2%=c;
		 }
		 if(str[i]=='M')
		 {
				 part1=mult(part1,b,c);
		  //part1=(unsigned long long int)q;
		         part2=mult(part2,b,c);
		  //part2=(unsigned long long int)p;
		 }
		  ans=((mult(arr[0][arr[1][i]],part1,c)+part2)%c);
		  printf("%lld ",ans);

		}
		printf("\n");
	}
	return 0;
}
