#include <bits/stdc++.h>
#define maxn 1005

using namespace std;
typedef long long ll;

int n;
ll a[maxn];
ll A, B, C;
char s[maxn];

void read_in() {
    scanf("%d",&n);
    for(int i=1;i<=n;i++) scanf("%lld",a+i);
    scanf("%lld%lld%lld",&A,&B,&C);
    scanf("%s",s+1);
}

ll nhan(ll x,ll y) {
    if (y==0) return 0LL;
    ll t=nhan(x,y/2);
    t=(t+t) % C;
    if (y%2) t=(t+x) % C;
    return t;
}

void solve() {
    int dau=1, cuoi=n, huong=0;
    ll K=1, D=0;
    for(int i=1;i<=n;i++) {
        switch (s[i]) {
            case 'R': huong=1-huong; break;
            case 'A': D=(D+A+C) % C; break;
            case 'M': K=nhan(K,B); D=nhan(D,B); break;
        }
        if (huong==0) {
            a[dau]=(nhan(a[dau],K)+D) % C;
            printf("%lld ",a[dau++]);
        } else {
            a[cuoi]=(nhan(a[cuoi],K)+D) % C;
            printf("%lld ",a[cuoi--]);
        }
    }
    printf("\n");
}

int main() {
    #ifndef ONLINE_JUDGE
    freopen("inp.txt","r",stdin);
    freopen("out.txt","w",stdout);
    #endif // ONLINE_JUDGE
    int T; scanf("%d",&T);
    while (T--) {
        read_in();
        solve();
    }
}
