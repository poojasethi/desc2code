#include <stdio.h>
#include <stdlib.h>
#include <iostream>
#include <string.h>
#include <algorithm>
#include <math.h>
#include <vector>
#include <queue>
#include <set>
#include <stack>
#include <map>
#define INF_MAX 2147483647
#define INF_MIN -2147483647
#define INF_LL 9223372036854775807LL
#define INF 2000000000
#define PI acos(-1.0)
#define inf INT_MAX
using namespace std;
typedef long long int LL;
LL A , B , C , arr[1004] , mult , add , res[1004] , ans;
int test , N , st , en , temp , dir;
string ip;

LL multiply_add(LL a,LL b){    
    LL mod = C;
    a %= mod;
    b %= mod;
    LL ret=0;
    while(b){
        if(b&1){
            ret += a;
            if(ret >= mod) ret -= mod;
        }
        a = a<<1;
        if(a >= mod) a -= mod;
        b = b>>1;
    }
    return ret;
}

int main()
{

scanf("%d",&test);
while(test--)
{
	add = 0;
	mult = 1;

	scanf("%d",&N);
	st = 1;
	en = N;
	dir  = 1;
	for(int i=1;i<=N;i++)
		scanf("%lld",&arr[i]);
	scanf("%lld %lld %lld",&A,&B,&C);

	cin >> ip;
	A = (A%C);
	B = (B%C);
	for(int i=1;i<=N;i++)
	{
		if(ip[i-1]=='R'){
			dir*=-1;
		}
		else if(ip[i-1]=='A')
		{
			add = add + A;
			add = (add%C);
		}
		else if(ip[i-1]=='M')	
		{
			add = multiply_add(add , B);
			mult = multiply_add(mult , B);
		}
		if(dir==1)
		{
			ans = multiply_add(arr[st]%C , mult%C);
			ans = ((ans%C) + (add%C))%C;
			st++;
		}
		else
		{
			ans = multiply_add(arr[en]%C , mult%C);
			ans = ((ans%C) + (add%C))%C;
			en--;
		}
		printf("%lld ", ans);
	}
	printf("\n");
}
return 0;
}



