#include<bits/stdc++.h>
using namespace std;
typedef long long LL;

LL dmul(LL a, LL b, LL M)
{
	LL ans = 0;
	for(int i = 1; i <= b; i++)
		ans = (ans + a) % M;
	return ans;
}

LL mulmod(LL a, LL b, LL M)
{
	if(b < 10) return dmul(a, b, M);
	LL x = dmul(a, b % 10, M);
	LL y =  mulmod(a, b / 10, M);
	y = dmul(y, 10, M);
	y = (y + x) % M;
	return y;
}

int main()
{
    long long t,n,i,A,B,C;
    scanf("%lld",&t);
    while(t--)
    {
        scanf("%lld",&n);
        char str[10000];
        long long arr[n+1];
        for(i=0;i<n;i++)
        {
            scanf("%lld",&arr[i]);
        }
        scanf("%lld%lld%lld",&A,&B,&C);
        scanf("%s",str);
        long long start=0,last=n-1;
        long long mul=1,add=0;
        int dir=0;
        for(i=0;i<n;i++)
        {
            if(i)
                printf(" ");
            if(str[i]=='R')
            {
                dir=1-dir;
            }
            else if(str[i]=='A')
            {
                add=(add+A)%C;
            }
            else if(str[i]=='M')
            {
                mul=mulmod(mul,B,C);
                add=mulmod(add,B,C);
            }
            if(dir==0)
            {
               long long ans=(mulmod(arr[start],mul,C)+add)%C;
                printf("%lld",ans);
                start++;
            }
            else
            {
                long long ans=(mulmod(arr[last],mul,C)+add)%C;
                printf("%lld",ans);
                last--;
            }
        }
        printf("\n");
    }
    return 0;
}
