#include<iostream>
using namespace std;
#include<stdio.h>
long long multiply(long long a, long long b, long long c) // a * b % c
{
    if (b == 0) {
        return 0;
    }
    long long ret = multiply(a, b >> 1, c);
    ret = (ret + ret) % c;
    if (b & 1) {
        ret = (ret + a) % c;
    }
    return ret;
}
int main()
{
    long long t,i;
    scanf("%lld",&t);
    while(t--)
    {
        long long n;
        scanf("%lld",&n);
        long long arr[n];
        char s[n+1];
        for(i=0;i<n;i++)
        scanf("%lld",&arr[i]);
        long long a,b,c;
        scanf("%lld %lld %lld",&a,&b,&c);
        scanf("%s",s);
        long long ans[n];
        long long dir=1,j=0,top=0,add=0,mul=1,start=0,end=n-1;
        for(i=0;i<n;i++)
        {
            if(s[i]=='R')
            {
                j=((dir==1)?end:start);
                dir=dir*(-1);
               // cout<<end<<" "<<start;
            }
            else if(s[i]=='A')
            {
                add=(add+a)%c;
            }
            else
            {
                mul=multiply(mul,b,c);
                add=multiply(add,b,c);
            }
            ans[top]=arr[j];
           // cout<<arr[j]<<" ";
            j=j+dir;
            (dir==1)?start++:end--;
            ans[top]=(multiply(ans[top],mul,c)+add)%c;
            top++;
        }
     //   cout<<"\n";
        for(i=0;i<n;i++)
        printf("%lld ",ans[i]);
        printf("\n");
    }
    return 0;
}
