using namespace std;

#include <iostream>
#include <cstdio>
#include <cstdlib>
#include <algorithm>
#include <cmath>
#include <cstring>
#include <iterator>
#include <sstream>
#include <fstream>
#include <cassert>
#include <climits>
#include <cstdlib>
#include <string>
#include <vector>
#include <queue>
#include <deque>
#include <stack>
#include <map>
#include <set>
#include <bitset>
#include <stdio.h>
#include <math.h>
#include <list>

long long addmod(long long a, long long b, long long c){
	a = a%c;
	b = b%c;
	long long sum = a-c+b;
	return sum<0 ? (sum+c):sum;
}

long long timemod(long long x, long long y, long long m){
	x %= m;
  	y %= m;
  	long long a = x < y ? x : y; // min
  	long long b = x < y ? y : x; // max
  	long long product = 0;
 	for (; a != 0; a >>= 1, b = addmod(b,b,m) )
    	if (a&1) product = addmod(product,b,m);
 	return product;
}

int main(){
	// cout << sizeof(int) <<"\n";
	// cout << sizeof(long long) << "\n";
	// cout << sizeof(unsigned long long) << "\n";
	// cout << timemod(4,5,5);
	int t,n;
	long long temp,a,b,c;
	string s;
	scanf("%d",&t);
	while(t--){
		scanf("%d",&n);
		vector<long long> l;
		for (int i = 0; i < n; ++i)
		{
			scanf("%lld",&temp);
			l.push_back(temp);
		}
		scanf("%lld %lld %lld",&a,&b,&c);
		cin >> s;
		int rev=0;
		long long mult=1,add=0,element;
		for (int i = 0; i < n; ++i)
		{
			if (s[i]=='R')
			{
				rev++;
			}
			else if (s[i]=='A')
			{
				add = addmod(add,a,c);
			}
			else {
				mult = timemod(mult,b,c);
				add = timemod(add,b,c);
			}
			if (rev%2==0)
			{
				element = l[0];
				l.erase(l.begin());
			}
			else {
				element = l[l.size()-1];
				l.erase(l.end()-1);
			}
			long long temp = timemod(element, mult, c);
			temp = addmod(temp, add, c);
			if (i!=(n-1))
			{
				printf("%lld ", temp);
			}
			else printf("%lld\n",temp);
		}
	}
	return 0;
}