#include <iostream>
#include <stdio.h>
#include <string>
 
using namespace std;
 
typedef long long LL;
typedef unsigned long long ULL; 
 
ULL mulmod(ULL a, ULL b, ULL m) {
    ULL r = 0;
    /* Remove these mods if the caller can ensure a and b are in range */
    a %= m;
    b %= m;
    while (b > 0) {
        if (b & 1)  r = ((m-r) > a) ? r+a : r+a-m;    /* r = (r + a) % m */
        b >>= 1;
        if (b)      a = ((m-a) > a) ? a+a : a+a-m;    /* a = (a + a) % m */
    }
    return r;
}
 
int main()
{
	int t;
	LL in;
	scanf("%d",&t);
	while(t--)
	{
		ULL arr[1010];
		ULL arr1[1010];
		
		int i,n;
		scanf("%d",&n);
		
		for(i=0;i<n;++i)
		scanf("%llu",&arr[i]);
		
		ULL a,b,c;
		scanf("%llu %llu %llu",&a,&b,&c);
		
		char str[1010];
		scanf("%s",str);
		
		int l = 0, r = n-1;
		bool reverse = false;
		for(i=0;i<n;++i)
		{
			if(str[i]=='R')
			reverse = !reverse;
			
			if(reverse)
			{
				arr1[i] = arr[r];
				r--;
			}
			else
			{
				arr1[i] = arr[l];
				l++;
			}			
		}
		
		/*
		printf("printing arr1\n");
		for(i=0;i<n;++i)
		cout<<arr1[i]<<" ";
		
		cout<<endl;
		*/
		
		ULL add = 0ull;
		ULL mult = 1ull;
		
		for(int i = 0;i<n;++i)
		{
			//printf("\n\ni = %d\n\n",i);
			char ch = str[i];
			if(ch == 'A')
			{
				add = (add+a)%c;								
			}	
			else if(ch == 'M')
			{
				mult = mulmod(mult,b,c);//  (mult*b)%c;
				add = mulmod(add,b,c);//(add*b)%c;				
			}			
			
			arr1[i] = (mulmod(arr1[i],mult,c) + add)%c;
			printf("%llu ",arr1[i]);								 		
		}		
		printf("\n");		
	}
	return 0;    
}
 
/*
5
5
2 4 1 7 3
3 2 1000
ARMRA
*/