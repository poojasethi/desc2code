#!/usr/bin/env python
# coding=utf-8

T = input()
for _ in xrange(T):
    N = input()
    L = map(int, raw_input().split())
    A, B, C = map(int, raw_input().split())
    s = raw_input()
    revcnt = 0
    slope = 1
    D = 0
    offset = 0
    for i in xrange(N):
        if s[i] == 'R':
            revcnt = 1 - revcnt
        if s[i] == 'A':
            D += A
        if (s[i] == 'M'):
            slope *= B
            D *= B
        slope %= C
        D %= C
        if revcnt == 1:
            print (L[N - 1 - offset] * slope + D) % C,
            offset += 1
        else:
            print (L[i - offset] * slope + D) % C,
    print ""
