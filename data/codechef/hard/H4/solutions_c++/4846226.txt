#include<iostream>
using namespace std ;
int MOD ;
inline int solve(int a,long long b)
{
 int ret = 1 ;
 for(;b;b>>=1)
 {
  if(b&1) ret = ret*(long long)a%MOD ;
  a = a*(long long)a%MOD ;   
 }
 return ret ;
}
 
typedef pair<int,int> P ;
inline P solve2(int a,long long b)
{
  if(b == 1) return P(1,a) ;
  if(b&1)
  { 
   P cur = solve2(a,b-1) ; 
   int ret = cur.first + cur.second ; 
   cur.second = cur.second*(long long)a%MOD ;
   if(ret >= MOD) ret -= MOD ;
   return P(ret,cur.second) ;
  }
  P cur = solve2(a,b>>1) ;
  int ret = (1 + cur.second)*(long long)cur.first%MOD ;
  cur.second = cur.second*(long long)cur.second%MOD ;
  return P(ret,cur.second) ;
}
 
main()
{
 int i,j,k,runs ;
 long long n,p ;
 
 scanf("%d",&runs) ;
 while(runs--)
 {
  scanf("%lld%d",&n,&MOD) ;
  if(MOD == 1) { printf("0\n") ; continue ; }
  long long ret = 0 ;
  for(i=1;i<MOD && i<=n;i++)
  {
   ret += solve(i,i)*(long long)solve2(solve(i,MOD),n/MOD+(n%MOD>=i)).first%MOD ;
   if(ret >= MOD) ret -= MOD ;
  }
  printf("%lld\n",ret) ;
 }
}