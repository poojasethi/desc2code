#include <stdio.h>
 
int powmod(int a, long long n, int m)
{
	long long s=a,t=1;
	while(n)
	{
		if (n&1)
			t=(t*s)%m;
		s=(s*s)%m;
		n>>=1;
	}
	return (int)t;
}
 
int inv(long long x, int y)
{
	int yy=y;
	long long p0=1,p1=0,t,p2;
	while(y)
	{
		p2=p0-x/y*p1;
		p0=p1;
		p1=p2;
		t=y;
		y=x%y;
		x=t;	
	}
 
	p0%=yy;
	if (p0<0)
		return p0+yy;
	return (int) p0;
}
 
long long ukupno,t,n,total;
long long temp1,temp2,temp3;
int u,i,p,a,m,mm;
	
int main()
{
	
	scanf("%lld",&t);
	while(t--)
	{
		scanf("%lld %d",&n,&m);	
		mm=m;
		total=0;
		for(p=2;m>1;p++)
		{
			if (p*p>m)
				p=m;
			if (m%p==0)
			{
				u=1;a=0;
				while(m%p==0)
				{
					m/=p;
					u*=p;
					a++;
				}		
				ukupno=0;
				for(i=1;i*p<a&&i*p<=n;i++)
					ukupno+=powmod(i*p,i*p,u);					
				ukupno%=u;
 
				for(i=1;i<u&&i<=n;i++)
				{
					if (i%p==0)
						continue;
					temp1=powmod(i,(long long)i,u);
					temp3=powmod(i,(long long)u,u);
					if (temp3==1)
					{
						ukupno=(ukupno+(n-i+u)/u*temp1)%u;
						continue;
					}
					temp3=inv(temp3-1,u);
					temp2=powmod(i,(n-i+u)/u*u,u)-1;
					ukupno=(ukupno+temp1*temp2*temp3)%u;
				}				
				total=(total+mm/u*ukupno*inv(mm/u,u))%mm;	
			}	
		}
		printf("%lld\n",total);
	}	
}