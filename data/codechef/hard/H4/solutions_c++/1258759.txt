#include <cstdio>

using namespace std;

typedef unsigned long long ll;
ll mod;
ll pows[64];

int sz;

ll f(ll a, ll n, char cmd) { // calculates a^n ; a + a^2 + ... + a^n
          if(n == 0) return 0;
          if(n == 1) return a;

          sz = 0;
          while(n) pows[sz++] = n, n >>= 1; 
          
          ll s, st;
          s = st = a;
          
          for(int i=sz-1; i>0; i--) {
                      s = (1 + st) * s % mod;
                      st = st * st % mod;
                      if(pows[i - 1] & 1) st = st * a % mod, s = (s + st) % mod; 
                      }
          
          if(cmd == 'p') return st;
          return s;
          }

ll n, t;

ll g(ll a, bool fl) {
        if(t < !fl) return 0;
        
         ll ret, x;
         
         ret = f(a, a, 'p'),
         x = f(a, mod, 'p'),
         ret = ret * (1 + f(x, t - !fl, 's')) % mod;
         
         return ret;
         }

ll cur, ans;    

void solve() { 
     scanf("%lld%lld", &n, &mod);
     
     t = n / mod,
     n %= mod,
     ans = 0;
     
     for(int i=1; i<mod; i++)
     cur = g(ll(i), i <= n),
     ans = (ans + cur) % mod;
     
     printf("%lld\n", ans);
     }

int main() {
    int t;
    scanf("%d", &t);
    
    while(t--) solve();    
    return 0;
    }

