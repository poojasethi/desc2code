#include <cstdio>

using namespace std;

typedef unsigned long long ll;
ll mod;
ll pows[4][64];

int sz[4];

ll f(ll a, ll n, char cmd, char fl) { // calculates a^n ; a + a^2 + ... + a^n
          if(n == 0) return 0;
          if(n == 1) return a;
          
          if(fl == 3)
          {
          sz[3] = 0;
          while(n) pows[3][sz[3]++] = n, n >>= 1; 
          }
          
          ll s, st;
          s = st = a;
          
          for(int i=sz[fl]-1; i>0; i--) {
                      s = (1 + st) * s % mod;
                      st = st * st % mod;
                      if(pows[fl][i - 1] & 1) st = st * a % mod, s = (s + st) % mod; 
                      }
          
          if(cmd == 'p') return st;
          return s;
          }

ll n, t;

ll g(ll a, bool fl) {
        if(t < !fl) return 0;
        
         ll ret, x;
         
         ret = f(a, a, 'p', 3),
         x = f(a, mod, 'p', 2),
         ret = ret * (1 + f(x, t - !fl, 's', !fl)) % mod;
         
         return ret;
         }

ll cur, ans;    
ll cpy;

void solve() { 
     scanf("%lld%lld", &n, &mod);
     
     t = n / mod,
     n %= mod,
     ans = 0;
     
     //t -> 0, t-1 -> 1, mod -> 2
     if(t > 1)
     {
     cpy = t, sz[0] = 0;
     while(cpy) pows[0][sz[0]++] = cpy, cpy >>= 1; 
     }
     
     if(t > 2)
     {
     cpy = t - 1, sz[1] = 0;
     while(cpy) pows[1][sz[1]++] = cpy, cpy >>= 1; 
     }
     
     if(mod > 1) 
     {
     cpy = mod, sz[2] = 0;
     while(cpy) pows[2][sz[2]++] = cpy, cpy >>= 1; 
     }
     
     for(int i=1; i<mod; i++)
     cur = g(ll(i), i <= n),
     ans = (ans + cur) % mod;
     
     printf("%lld\n", ans);
     }

int main() {
    int t;
    scanf("%d", &t);
    
    while(t--) solve();    
    return 0;
    }

