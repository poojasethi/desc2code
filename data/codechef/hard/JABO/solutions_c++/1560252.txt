#include<iostream>
#include<stdio.h>
#include<cstring>
using namespace std;
long long set[501*2500+5],rank[501*2500+5],high[501*2500+5];
int find(int i)
{
    while(set[i]!=-1)
        i=set[i];
    return i;
}
void make_union(int i,int j)
{
    i=find(i);
    j=find(j);
    if(i!=j)
    {
        if(rank[i]>rank[j])
        {
            set[j]=i;
            high[i]+=high[j];
        }
        else
        {
            set[i]=j;
            high[j]+=high[i];
            if(rank[i]==rank[j])
                rank[j]++;
        }
    }
}
int conv(char a,char b)
{
	int val=0,i=0;
	
	if (a>='a' && a<='z')
		i=a-'a'+26;
	else
		i=a-'A';
	val=i*52;
	if (b>='a' && b<='z')
		i=b-'a'+26;
	else
		i=b-'A';
	val+=i;
	return val-1;
}
int main()
{
    int r,c,i,x1,x2,y1,y2,y;
    char s[15];
    long long n;
    scanf("%lld%d%d",&n,&r,&c);
    memset(set,-1,sizeof(set));
    memset(rank,0,sizeof(rank));
    memset(high,0,sizeof(high));
    while(n--)
    {
        scanf("%s",s);
        if(s[0]=='W')
        {
            for(i=1;i<strlen(s);)
            {
                y1=conv(s[i],s[i+1]);
                i+=2;
                x1=conv(s[i],s[i+1]);
                i+=2;
                y2=conv(s[i],s[i+1]);
                i+=2;
                x2=conv(s[i],s[i+1]);
                i+=2;
                //cout<<y1<<" "<<x1<<" "<<y2<<" "<<x2<<endl;
                make_union(y1+c*(x1/5)+c,y2+c*(x2/5)+c);
            }    
        }
        else if(s[0]=='V')
        {
            for(i=1;i<strlen(s);)
            {
                y1=conv(s[i],s[i+1]);
                i+=2;
                x1=conv(s[i],s[i+1]);
                i+=2;
                //cout<<y1<<" "<<x1<<endl;
                high[find(y1+c*(x1/5)+c)]++;
            }
        }
        else if(s[0]=='R')
        {   
            for(i=1;i<strlen(s);)
            {
                y1=conv(s[i],s[i+1]);
                i+=2;
                x1=conv(s[i],s[i+1]);
                i+=2;
                //cout<<y1<<" "<<x1<<endl;
                high[find(y1+c*(x1/5)+c)]--;
            }
        }
        else if(s[0]=='L')
        {
            for(i=1;i<strlen(s);)
            {
                y1=conv(s[i],s[i+1]);
                i+=2;
                x1=conv(s[i],s[i+1]);
                i+=2;
                y2=conv(s[i],s[i+1]);
                i+=2;
                x2=conv(s[i],s[i+1]);
                i+=2;
                //cout<<y1<<" "<<x1<<" "<<y2<<" "<<x2<<endl;
                r=find(y1+c*(x1/5)+c);
                y=find(y2+c*(x2/5)+c);
                //cout<<r<<" "<<high[r]<<" "<<y<<" "<<high[y]<<endl;
                if((high[r]!=0 && high[y]==0) ||(high[r]==0 && high[y]!=0))
                    printf("ON\n");
                else
                    printf("OFF\n");
            }
        }
    }
    //system("pause");
    return 0;
}
