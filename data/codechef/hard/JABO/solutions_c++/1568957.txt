#include <cstdio>
using namespace std;

int n, r, c, rc, f[1300000], v[1300000];
char s[20];

int c2i(char c) {
    if (c <= 'Z') return c - 'A';
    return c - 'a' + 26;
}

int fun(char *s) {
    int x1 = c2i(s[0]);
    int x2 = c2i(s[1]);
    int y1 = c2i(s[2]);
    int y2 = c2i(s[3]);
    int x = x1 * 52 + x2;
    int y = y1 * 52 + y2;
    x--;
    y--;
    y /= 5;
    return y * c + x;
}

int q[1300000], qw;
int find(int z) {
    qw = 0;
    q[qw] = z;
    while (f[z] != z) {
        z = f[z];
        q[++qw] = z;
    }
    for (int i=0; i<qw; ++i) f[q[i]] = z;
    return z;
}

int main() {
    scanf("%d%d%d", &n, &r, &c);
    rc = r*c;
    for (int i=0; i<rc; ++i) {
        f[i] = i;
        v[i] = 0;
    }
    for (int i=0; i<n; ++i) {
        scanf("%s", s);
        if (s[0] == 'W') {
            int x = fun(s+1);
            int y = fun(s+5);
            x = find(x);
            y = find(y);
            if (x != y) {
                v[y] += v[x];
                f[x] = y;
            }
        }
        else if (s[0] == 'V') {
            int x = fun(s+1);
            x = find(x);
            v[x]++;
        }
        else if (s[0] == 'R') {
            int x = fun(s+1);
            x = find(x);
            v[x]--;
        }
        else {
            int x = fun(s+1);
            int y = fun(s+5);
            x = find(x);
            y = find(y);
            if ((v[x]>0)^(v[y]>0)) printf("ON\n");
            else printf("OFF\n");
        }
    }
    return 0;
}
