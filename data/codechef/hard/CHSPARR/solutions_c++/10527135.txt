#include<bits/stdc++.h>
#define MOD 1000000007LL
using namespace std;

long long m;
long long A[100010];
long long RSQA[100010];

long long access(int m,long long  x){
	if(m==0) return A[x];
	if(x%2==1){
		return access(m-1,(x-1LL)/2LL+1LL)%MOD;
	}
	return (access(m-1,x/2LL)%MOD + access(m-1,x/2LL+1LL)%MOD)%MOD;
}

long long S(int m, long long x){
	if(m==0) return RSQA[x] % MOD;
	if(x%2){
		return (
				(-A[1]+MOD)%MOD
				+3*S(m-1,x/2+1)%MOD
				+(-access(m,x)+MOD)%MOD
			) % MOD;
	}
	return (
			3*S(m-1,x/2LL+1LL)%MOD
			+(-A[1]+MOD)%MOD
			+(-2*access(m-1,x/2LL+1LL)+MOD)%MOD
		)% MOD;
}
int N;
long long x,y;
int main(){
	int tc; cin>>tc;
	while(tc--){
		cin>>N>>m>>x>>y;
		A[0]=RSQA[0]=0;
		for(int i = 1; i<=N; i++) {
			cin>>A[i];
			RSQA[i] = A[i];
			RSQA[i]+=RSQA[i-1];
		}
		if(x==1LL) cout<<S(m,y)<<endl;
		else cout<<(S(m,y)-S(m,x-1)+MOD)%MOD<<endl;		
	}
}