#include <bits/stdc++.h>
 
using namespace std;
 
#define fr(a, b, c) for(int a = b; a < c;a++)
 
#define dbg(x) cerr << ">>> " << x << endl;
#define _ << ", " <<
 
typedef long long ll;
typedef pair<int, int> ii;
 
ll mod = 1e9 + 7;
 
ll n, m, x, y;
ll v[100111];
ll pot3[100];

ll getPos2(ll x) {
    fr(i, 0, m) {
        x = 2 * x - 1;
    }
    return x;
}

ll getPos(ll x) {
	return (x << m) - ( (1 << m) - 1);
}

ll getInfluence(ll ext, ll mid, ll m) {
	return (1 + (pot3[m] - 1)/2) * ext + pot3[m+1] * mid;
    fr(i, 0, m) {
        mid = (ext + 3 * mid) % mod;
    }
    return (ext + mid) % mod;
}

ll getAns(ll L, ll R, ll qL, ll qR, ll x, ll m) {
    //dbg(L _ R _ qL _ qR _ x _ m)
    if(m == 0) return L <= x ? qL%mod : 0;
   
    if(x <  L) return 0;
    if(x >= R) return (mod + getInfluence( (qL + qR) % mod, 0, m) - (qR%mod)) % mod;
   
    ll M = (L + R)/2;
    ll qM = qL + qR;
   
    ll a = getAns(L, M, qL, qM, x, m - 1);
    ll b = getAns(M, R, qM, qR, x, m - 1);
   
    return (a + b) % mod;
}
 
ll solve(ll x) {
    if(!x) return 0;
   
    ll ans = 0;
   
    fr(i, 0, n) {
        ans += (getAns(getPos(i + 1), getPos(i + 2), 1, 0, x, m) * v[i  ]) % mod;
        ans %= mod;
        ans += (getAns(getPos(i + 1), getPos(i + 2), 0, 1, x, m) * v[i+1]) % mod;
        ans %= mod;
    }
   
    return ans;
}
 
int main() {
    ios_base::sync_with_stdio(false);
   
   	pot3[0] = 1;
   	fr(i, 1, 100) pot3[i] = pot3[i-1] * 3;
   
    int T;
   
    cin >> T;
   
    while(T--) {
        cin >> n >> m >> x >> y;
       
        fr(i, 0, n) cin >> v[i];
       
        v[n] = 0;
       /*
        fr(i, 1, 20) {
            dbg(solve(i));
        }
       */
        ll ans = (solve(y) - solve(x - 1) + mod) % mod;
       
        cout << ans << endl;
    }
   
    return 0;
}
 
 
/*
0 1 0
0 1 1 1 0
0 1 1 2 1 2 1 1 0
0 1 1 2 1 3  2  3  1  3  2  3  1  2  1  1  0
0 1 2 4 5 8 10 13 14 17 19 22 23 25 26 27 27
*/