#include <iostream>
#include <stdio.h>
#include <string.h>
#include <algorithm>
#define ll long long int

using namespace std;

ll mulmod(ll A, ll B, ll MOD)
{
	if ( B == 0 ) return 0;
	ll u = mulmod(A, B/2, MOD);
	ll res;
	if ( B%2 == 0 )
		res = u + u;
	else
		res = u + u + A;
	while ( res >= MOD ) res -= MOD;
	return res;
}

ll powermod(ll a,ll k,ll P)
{
    if (k == 0)
        return 1;
    ll temp = powermod(a, k/2, P);
    ll res=1;

    res = mulmod(mulmod(temp,temp,P),res,P);
    if (k&1)
        res = mulmod(res,a,P);
    return res;
}

int main()
{
    int t;
    scanf("%d",&t);

    while(t--)
    {
        char input[10002];
        ll mod,i=0,res=1,ans;
        scanf("%lld",&mod);
        scanf("%s",input);
        ans=1%mod;
        while(i<strlen(input))
        {
            ll base=0;
            while(input[i]>='0'&&input[i]<='9')
            {
                base = mulmod(base,10,mod);
                base = base + input[i]-48;
                base = base%mod;
                i++;
            }
            i++;
            i++;
            res=1%mod;
            while(input[i]>='0'&&input[i]<='9')
            {
                res = powermod(res,10,mod);
                res%=mod;
                res = mulmod(res,powermod(base,input[i]-48,mod),mod);
                res%=mod;
                i++;
            }
            ans = mulmod(ans,res,mod);
            ans%=mod;
            i++;
        }
        printf("%lld\n",ans);
    }
    return 0;
}
