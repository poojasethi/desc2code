#include<bits/stdc++.h>
using namespace std;
#define ll long long
ll  MOD;
ll  mult(ll  A, ll  B)
{
	if ( B == 0 ) return 0;
	ll  u = mult(A, B/2);
	ll  res;
	if ( B%2 == 0 )
		res = u + u;
	else
		res = u + u + A;
	return (res%MOD);
}

char s[10001];
void solve()
{
	scanf("%lld %s",&MOD,s);
	int l = strlen(s);
	ll ans = 1;
	for (int i=0; i<l; i++)
	{
		ll F = 0;
		int j = i;
		while ( s[j] >= '0' && s[j] <= '9' )
		{
			//F = mult(F, 10);
			F=(1ull*F*10)%MOD;
			F =(F + s[j]-'0')%MOD;
			j++;
		}
		j+=2;
		ll NF = 1;
		while ( s[j] >= '0' && s[j] <= '9' )
		{
			ll WNF = 1;
			for (int k=1; k<=10; k++)
				WNF = mult(NF, WNF);
			NF = WNF;
			for (int k=1; k <= s[j]-'0'; k++)
				NF = mult(NF, F);
			j++;
		}
		ans = mult(ans, NF);
		i = j;
	}
	printf("%lld\n",ans);
}
int main()
{
	int test;
	cin>>test;
	while ( test-- ) solve();
	return 0;
}
