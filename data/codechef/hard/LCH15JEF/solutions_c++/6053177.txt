#include <cstdio>
#include <algorithm>
#include <vector>
#include <iostream>
#include <string>
#include <string.h>
#include <set>
#include <map>
#include <stdlib.h>
#include <iomanip>
#include <bitset>
#include <cmath>
using namespace std ;

long long MOD ;
long long mult(long long A, long long B)
{
	if ( B == 0 ) return 0;
	long long u = mult(A, B/2);
	long long res;
	if ( B%2 == 0 )
		res = u + u;
	else
		res = u + u + A;
	while ( res >= MOD ) res -= MOD;
	return res;
}

char input[10100];
void solve()
{
        cin>>MOD ;
        cin>>input;
        int l=strlen(input) ;
        long long ans=1%MOD ;
        for(int i=0 ; i<l ; i++) {
            long long F=0 ;
            int j=i ;
            while(input[j]>='0' && input[j]<='9'){
                F = mult(F,10) ;
                F += (input[j]-'0') ;
                F %= MOD ;
                j++ ;
            }
            j++ ;
            j++ ;
            long long secF=1%MOD ;
            while(input[j]>='0' && input[j]<='9') {
                long long WNF = 1;
                for (int k=1; k<=10; k++)
                    WNF = mult(secF, WNF);
                secF = WNF;
                for (int k=1; k <= input[j]-'0'; k++)
                    secF = mult(secF, F);
                j++;
                //secF=modulo(secF,10,m) ;
                //secF=mult(secF,modulo(F,input[j]-'0',m),m) ;
                //j++ ;
            }
            ans=mult(ans,secF) ;
            i=j ;
        }
        cout<<ans<<"\n" ;
}

int main()
{
    int test ;
    cin>>test ;
    while(test--) solve() ;
    return 0 ;
}
