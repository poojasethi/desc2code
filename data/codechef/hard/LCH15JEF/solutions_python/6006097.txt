import re
for i in xrange(int(raw_input())):
    m, s = raw_input().strip().split()
    m = long(m)
    s = s.strip()
    a = re.split(r'[^0-9]+', s)
    ans = 1
    for i in xrange(0, len(a), 2):
        ans = (ans * pow(long(a[i]), long(a[i + 1]), m)) % m
    print ans 
