t=int(raw_input())
while(t):
  a=map(str,raw_input().strip().split(" "))
  b=map(str,a[1].split("*"))
  
  i=0
  pr=1
  while(i<=(len(b)-1)):
    
    pr=pr*(pow(long(b[i]),long(b[i+2]),long(a[0]))%long(a[0]))
    i+=3
  print pr%long(a[0])  
  t-=1