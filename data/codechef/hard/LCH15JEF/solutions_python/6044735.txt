for _ in range(int(raw_input())):
	inp = raw_input().split()
	m = int(inp[0])
	result = 1
	temp = inp[1].split('*')
	length = len(temp)/3
	for i in range(length):
		result = result*pow(int(temp[::3][i]), int(temp[2::3][i]), m)%m
	print result