test=int(input())
def power(a,b,md):
    res=1
    while(b):
        if(b&1):
            res=(res*a)%md
        a=(a*a)%md
        b/=2
    return res
while(test!=0):
    test-=1
    m,st=raw_input().split()
    m=int(m)
    ar=st.replace("**",",").split('*')
    mul=1
    for p in ar:
        a,b=p.split(",")
        a=int(a)
        b=int(b)
        mul=(mul*power(a,b,m))%m
    print mul