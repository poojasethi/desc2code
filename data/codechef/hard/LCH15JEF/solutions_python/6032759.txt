def modpow(b,e,m):
	res=1;
	while(e>0):
		if(e%2==1):
			res=(res%m*b%m)%m
		e=e>>1
		b=(b%m*b%m)%m
	return res		
t=int(raw_input())
while(t>0):
  str=raw_input()
  l=str.split()	
  m=int(l[0])
  lst=l[1].split("*")
  ans=1
  for i in range(0,len(lst),3):
	  ans=(ans%m*modpow(int(lst[i]),int(lst[i+2]),m)%m)%m
  print ans
  t-=1
	

	
	