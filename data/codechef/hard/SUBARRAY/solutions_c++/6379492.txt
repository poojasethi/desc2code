#include <bits/stdc++.h>
using namespace std;


char s[100050];
long long f[100050];
long long now[100050];
int sta[100050],pos[100050];
int l[300];
int main()
{
    int t;scanf("%d",&t);
    l['[']=1;l[']']=-1;
    l['{']=2;l['}']=-2;
    l['<']=3;l['>']=-3;
    l['(']=4;l[')']=-4;
    while(t--)
    {
        int n;scanf("%d%s",&n,s+1);
        for(int i=1;i<=n;i++)
            scanf("%lld",f+i),f[i]+=f[i-1],now[i]=0;
        int k=0;
        long long ans=0;
        for(int i=1;i<=n;i++)
        {
            int j=l[s[i]];
            if(j>0)pos[k]=i,sta[k++]=j;
            else
            {
                if(k&&sta[k-1]==-j)
                {
                    ans=max(ans,f[i]-f[pos[k-1]-1]+now[pos[k-1]-1]);
                    now[i]=max(0ll,f[i]-f[pos[k-1]-1]+now[pos[k-1]-1]);
                    k--;
                }
                else k=0;
            }
        }
        printf("%lld\n",ans);
    }
    return 0;
}
