#include<bits/stdc++.h>
using namespace std;
#define MAXN 100007
#define ll long long int
char ch[MAXN];
ll sum[MAXN],inp[MAXN],maxsum[MAXN],hsh[MAXN];
char opp(char c)
{

        if(c==')')return '(';
         if(c=='}')return '{';
        if(c==']')return '[';
        if(c=='>')return '<';
        return '.';

}
void answer()
{    ll ans=0;
    ch[0]='$';
    int i,j,n;
        scanf("%d",&n);
        for(i=0;i<=n+1;i++)
            hsh[i]=0;
        scanf("%s",ch+1);

        for(i=1;i<=n;i++)
        {
            scanf("%lld",&inp[i]);
        }
        sum[0]=0;
        for(i=1;i<=n;i++)
            sum[i]=sum[i-1]+inp[i];
        stack<int> s;
        s.push(0);
        for(i=1;i<=n;i++)
        {
            if(ch[s.top()]==opp(ch[i]))
            {
                hsh[i]=s.top();
                s.pop();
            }
            else
            {
                s.push(i);
            }
        }
        for(i=1;i<=n;i++)
        {
            maxsum[i]=0;
            if(hsh[i])
            {
                maxsum[i]=max(sum[i]-sum[hsh[i]-1]+maxsum[hsh[i]-1],maxsum[i]);
            }
            ans=max(ans,maxsum[i]);
        }
        printf("%lld\n",ans);
}
int main()
{

    int t;
    scanf("%d",&t);
    while(t--)
    {  answer();
    }
    return 0;
}
