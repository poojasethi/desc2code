#include <bits/stdc++.h>
using namespace std;
typedef long long int ll;
ll arr[100005];
ll sum[100005],dp[100005];
int last[100005];
char s[100005];
inline char OPPOSITE(char ch){
 if(ch==')') return '(';
 if(ch=='}') return '{';
 if(ch==']') return '[';
 if(ch=='>') return '<';
 return '.';
}
int main(){
 int t,n;
 scanf("%d",&t);
 while(t--){
  scanf("%d",&n);
  scanf("%s",s+1);
  for(int i=0;i<=n+1;i++) last[i] = 0;
  for(int i=1;i<=n;i++) scanf("%lld",&arr[i]);
  sum[0] = 0;
  for(int i=1;i<=n;i++) sum[i] = sum[i-1]+arr[i];
  stack<int> st;
  st.push(0);
  for(int i=1;i<=n;i++){
    if(s[st.top()] == OPPOSITE(s[i])){
        last[i] = st.top();
        st.pop();
    }else st.push(i);
  }
  ll maxi = 0;
  for(int i=1;i<=n;i++){
    dp[i] = 0;
    if(last[i] != 0) dp[i] = max(dp[i],sum[i]-sum[last[i]-1]+dp[last[i]-1]);
    maxi = max(maxi,dp[i]);
  }
  printf("%lld\n",maxi);
 }
 return 0;
}
