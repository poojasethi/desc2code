
#include <stdio.h>
#include <stdlib.h>
#include <iostream>
#include <string.h>
#include <algorithm>
#include <math.h>
#include <vector>
#include <queue>
#include <set>
#include <stack>
#include <map>
#define INF_MAX 2147483647
#define INF_MIN -2147483647
#define INF_LL 9223372036854775807LL
#define INF 2000000000
#define PI acos(-1.0)
#define inf INT_MAX
#define llu unsigned long long int
#define all(v) v.begin(),v.end()
#define pb push_back
#define mp make_pair
#define F first
#define S second
#define si(n) scanf("%d",&n)
#define slli(n) scanf("%lld",&n);
#define ss(n) scanf("%s",n);
using namespace std;
typedef long long int LL;
LL psum[100010] , a[100010];
char S[100010];
stack< pair<char , int > > stk;
LL dp[100010] , ans;
int prv[100010];
pair<char , int > temp;
char x;
int main()
{
int N , test;
si(test);
while(test--)
{
while(!stk.empty())
	stk.pop();
ans = 0;
si(N);
ss(S);
// printf("$%s$\n", S);
ans = 0;
for(int i=0;i<N;i++)
{
	dp[i] = 0;
	prv[i] = -1;
	slli(a[i]);
}
psum[0] = a[0];
for(int i=1;i<N;i++)
	psum[i]=psum[i-1] + a[i];
for(int i=0;i<N;i++)
{
	if(stk.empty()){
		stk.push(mp(S[i] , i));
	}
	 //{ [,],{,},<,>,(,) }âˆ— 
	else
	{
		temp = stk.top();
		if(temp.first == '[' && S[i] == ']')
		{
			prv[i] = temp.second;
			stk.pop();			
		}
		else if(temp.first == '{' && S[i] == '}')
		{
			prv[i] = temp.second;
			stk.pop();			
		}
		else if(temp.first == '<' && S[i] == '>')
		{
			prv[i] = temp.second;
			stk.pop();			
		}		
		else if(temp.first == '(' && S[i] == ')')
		{
			prv[i] = temp.second;
			stk.pop();			
		}
		else
		{
			stk.push(mp(S[i] , i));
		}
	}
}
// for(int i=0;i<N;i++)
	// cout << prv[i] << " ";
// cout << endl;
for(int i=0;i<N;i++){
	if(prv[i]!=-1){
		dp[i] = max<LL >(dp[i] , psum[i] - ((prv[i]>0)?psum[prv[i]-1]:0) + max<LL >(0 , ((prv[i]>0)?dp[prv[i]-1]:0)));
		ans = max<LL >(ans , dp[i]);
	}
}


printf("%lld\n", ans);
}


return 0;
}










