#include<stdio.h>
#include<math.h>
#include<stdlib.h>
#include<iostream>
#include<cstring>
#include<stack>
#define getcx getchar_unlocked
using namespace std;
inline void inp( long long  &n )//fast input function
{
   n=0;
   long long  ch=getcx();long long  sign=1;
   while( ch < '0' || ch > '9' ){if(ch=='-')sign=-1; ch=getcx();}

   while(  ch >= '0' && ch <= '9' )
           n = (n<<3)+(n<<1) + ch-'0', ch=getcx();
   n=n*sign;
}

long long Max(long long a,long long b)
{
   if(a<b)
   return b;
   else
   return a;
}

int main()
{
 long long t;
   
   
   long long arr[100008];
    long long sum[100008];
    long long max[100008];
    char str[100008];
   
    long long n;
    
    long long hash[100008];
    inp(t);
    long long i;
    while(t--)
    {
    
    
    
    inp(n);
    str[0]='$';
    scanf("%s",str+1);
    
    for(i=0;i<n;i++)
    inp(arr[i]);
    
    sum[0]=0;
    
    for(i=1;i<=n;i++)
    sum[i]=sum[i-1]+arr[i-1];
    
    
    for(i=0;i<=n+1;i++)
    hash[i]=0;
    
    stack<int >s;
    s.push(0);
    for(i=1;i<=n;i++)
    {
    
          if(!s.empty())
          {
          
              if((str[i]=='}' && str[s.top()]=='{') || (str[i]==']' && str[s.top()]=='[')|| (str[i]==')' && str[s.top()]=='(')|| (str[i]=='>' && str[s.top()]=='<'))
          {
          
              hash[i]=s.top();      
              s.pop();
          }
          else
          s.push(i);
          }
    else
    {
      s.push(i);
    }
    
    }
    
    long long ans=0;
    for(i=1;i<=n;i++)
    {
    
       max[i]=0;
       
       if(hash[i])
       {
           max[i]=Max(sum[i]-sum[hash[i]-1]+max[hash[i]-1],max[i]);
       
       }
       
       ans=Max(ans,max[i]);
    
    }
    
    printf("%lld\n",ans);
    }

return 0;
}
