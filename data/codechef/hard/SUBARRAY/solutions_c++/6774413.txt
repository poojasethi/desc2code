#include <bits/stdc++.h>
using namespace std;

typedef	long long ll;
typedef vector<int> vi;
typedef vector<ll> vll;
typedef pair<int, int> pii;
#define pb push_back
#define mp make_pair
#define rep(i,n) for(int i = 0; i < n; i++)
#define sc(n) scanf("%d",&n)
#define scll(n) scanf("%I64d",&n)
#define mod 1000000007
#define ll long long
template<class T>inline T gcd(T a,T b){return b?gcd(b,a%b):a;}
char match(char ch){
	if(ch=='}') return '{';
	if(ch==')') return '(';
	if(ch=='>') return '<';
	if(ch==']') return '[';
	return '#';
}
int main()
{
	int test;
	sc(test);
	while(test--){
		int n;
		sc(n);
		int arr[n+1];
		ll sum[n+1];
		sum[0] = 0;
		string str;
		cin>>str;
		for(int i = 1; i <= n; i++ ) {
			sc(arr[i]);
			sum[i] = sum[i-1] + arr[i];
		}
		ll minid[n+1];
		minid[0] = 0;
		stack<int>st;
		for(int i = 0;i<n;i++){
			minid[i+1] = 0;
			if(!st.empty()&&str[st.top()-1]==match(str[i])){
				minid[i+1] = st.top();
				st.pop();
			}
			else st.push(i+1);
		}
		/*for(int i = 1;i<=n;i++){
			cout<<sum[i]<<" "<<minid[i]<<endl;
		}*/
		ll dp[n+1];
		dp[0] = 0;
		ll ans = 0;
		for(int i = 1;i<=n;i++){
			dp[i] = 0;
			if(minid[i]){
				dp[i] = max(dp[i],sum[i]-sum[minid[i]-1]+dp[minid[i]-1]);
			}
			ans = max(ans,dp[i]);
		}
		printf("%lld\n",ans);
	}
}
