#include <bits/stdc++.h>
using namespace std;

long long result[100000],a[100000],sum[100000],dp[100000],arr[100000];
stack<long long>s;

bool isopen(char a){
    if(a=='{'||a=='['||a=='<'||a=='(')
        return true;
    return false;
}

bool match(char a,char b){
    if(a=='{'&&b=='}')
        return true;
    if(a=='['&&b==']')
        return true;
    if(a=='('&&b==')')
        return true;
    if(a=='<'&&b=='>')
        return true;
    return false;
}

int main(){
    long long t,n,ans;
    scanf("%lld",&t);
    while(t--){
        scanf("%lld",&n);
        for(long long i=0;i<n;i++)
            arr[i]=dp[i]=-1;
        string b;
        cin>>b;
        for(long long i=0;i<n;i++)
            scanf("%lld",&a[i]);
        while(!s.empty())
            s.pop();
        for(long long i=0;i<n;i++){
            if(isopen(b[i]))
                s.push(i);
            else{
                if(!s.empty()){
                    if(match(b[s.top()],b[i])){
                        arr[i]=s.top();
                        s.pop();
                    }else{
                        while(!s.empty())
                            s.pop();
                    }
                }
            }
        }
        sum[0]=a[0];
        for(long long i=1;i<n;i++)
            sum[i]=a[i]+sum[i-1];
        for(long long i=0;i<n;i++){
            if(arr[i]!=-1){
                if(arr[i]==0)
                    dp[i]=sum[i];
                else
                    dp[i]=sum[i]-sum[arr[i]-1];
            }
        }
        long long ans=0;
        for(long long i=0;i<n;i++){
            if(arr[i]==-1)
                result[i]=0;
            else if(arr[i]==0)
                result[i]=max(0LL,dp[i]);
            else
                result[i]=max(0LL,dp[i]+max(0LL,result[arr[i]-1]));
            ans=max(ans,result[i]);
        }
        printf("%lld\n",ans);
    }
}
