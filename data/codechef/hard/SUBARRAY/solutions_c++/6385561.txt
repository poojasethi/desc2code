#include <bits/stdc++.h>
using namespace std;
typedef long long int ll;
int arr[100005];
ll sum[100005],dp[100005];
int last[100005];
char s[100005];
inline char OPPOSITE(char ch){
 if(ch==')') return '(';
 if(ch=='}') return '{';
 if(ch==']') return '[';
 if(ch=='>') return '<';
 return '.';
}
int main(){
 int t,n;
 scanf("%d",&t);
 while(t--){
  scanf("%d",&n);
  scanf("%s",s);
  for(int i=1;i<=n;i++) scanf("%d",&arr[i]);
  sum[0] = 0;
  for(int i=1;i<=n;i++) sum[i] = sum[i-1]+arr[i];
  stack<int> st;
  st.push(-1);
  for(int i=0;i<=n;i++){
    dp[i] = 0;
    last[i] = -1;
  }
  for(int i=1;i<=n;i++){
    if(st.top()!=-1 &&  s[st.top()]==OPPOSITE(s[i-1])){
        last[i-1] = st.top();
        st.pop();
    }
    else st.push(i-1);
  }
  ll maxi = 0;
  for(int i=1;i<=n;i++){
    if(last[i-1] != -1) dp[i] = max(dp[i],sum[i]-sum[last[i-1]]+dp[last[i-1]]);
    maxi = max(maxi,dp[i]);
  }
  printf("%lld\n",maxi);
 }
 return 0;
}
