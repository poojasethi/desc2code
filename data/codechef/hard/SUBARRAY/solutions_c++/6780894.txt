#include <bits/stdc++.h>
using namespace std;

string s;
long long int a[100005];
int j,n;
long long int ans;

pair<long long int,int> rec()
{
    if(j>=n)
        return make_pair(0,1);
    char ch,ex;
    int pre;
    pre=j;
    ch=s[j];
    j++;
    if(ch=='(')
        ex=')';
    else if(ch=='{')
        ex='}';
    else if(ch=='<')
        ex='>';
    else if(ch=='[')
        ex=']';
    else
        return make_pair(0,1);
    long long int msum=0;
    long long int sum,presum=0;
    int flag =0;
    pair<long long int,int>p;
    while(j<n)
    {
        if(s[j]==ex)
        {
            msum=msum+a[j]+a[pre];
            if(msum>ans&&flag==0)
                ans=msum;
            break;
        }
        else if(s[j]=='('||s[j]=='{'||s[j]=='<'||s[j]=='[')
        {
            p=rec();
            sum=p.first;
            if(p.second==1)
            {
                flag=1;
                presum=0;
                msum=sum;
            }
            else
            {
            if(sum>ans)
                ans=sum;
            if(presum+sum>=sum)
                presum=presum+sum;
            else
                presum=sum;
            if(flag==0)
            msum=msum+sum;
            if(presum>ans)
                ans=presum;
            }
        }
        else
        {
            flag=1;
            break;
        }
    }
    if(j>=n)
        flag=1;
    j++;
    if(msum>ans&&flag==0)
        ans=msum;
    if(flag==0)
        return make_pair(msum,0);
    else
    return make_pair(0,1);
}

int main()
{
    int test,i;
    long long int sum,presum;
    scanf("%d",&test);
    while(test--)
    {
        scanf("%d",&n);
        cin>>s;
        for(i=0;i<n;i++)
            scanf("%lld",&a[i]);
        ans=0;
        j=0;
        presum=0;
        int flag=0;
        pair<long long int,int>p;
        while(j<n)
        {
            p=rec();
            sum=p.first;
            //cout<<p.second<<endl;
            if(p.second==1)
            {
                presum=0;
            }
            else
            {
                if(sum>ans)
                    ans=sum;
                if(presum+sum>=sum)
                    presum=presum+sum;
                else
                    presum=sum;
                if(presum>ans)
                    ans=presum;
            }
        }
        if(ans<0)
            ans=0;
        printf("%lld\n",ans);
    }
    return 0;
}
