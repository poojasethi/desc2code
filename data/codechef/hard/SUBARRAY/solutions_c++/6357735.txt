#include <bits/stdc++.h>

#define MOD (1000000007)
#define MAXINT (2000000009)
#define EPS (1e-9)
#define mp   make_pair
#define pb   push_back
#define pii  pair<int,int> 
#define vi   vector<int> 
#define se   second
#define fi   first
#define ll long long int

using namespace std;

char s[100005];
int a[100005],b[100005];
ll dp[100005],sum[100005];

bool isclosing(char c)
{
	if(c==')' || c=='}' || c==']' || c=='>')
		return true;
	else
		return false;
}

bool ispair(char a,char b)
{
	if(a=='(' && b==')')	return true;
	if(a=='[' && b==']')	return true;
	if(a=='{' && b=='}') 	return true;
	if(a=='<' && b=='>')	return true;
	return false;
}

int main()
{
	int test,i,n,x;
	ll ans;
	scanf("%d",&test);
	while(test--)
	{
		scanf("%d",&n);
		scanf("%s",s);
		for(i=0;i<n;i++)
			scanf("%d",&b[i]);
		sum[0]=b[0];
		for(i=1;i<n;i++)
			sum[i]=sum[i-1]+b[i];
		stack<int> ss;
		for(i=0;i<n;i++)
		{
			a[i]=-1;
			if(isclosing(s[i]))
			{
				if(!ss.empty())
				{
					if(ispair(s[ss.top()],s[i]))
					{
						a[i]=ss.top();
						ss.pop();
					}
					else
					{
						while(!ss.empty())
							ss.pop();
					}
				}
			}
			else
				ss.push(i);
		}
		dp[0]=0;
		for(i=1;i<n;i++)
		{
			if(a[i]==-1)
				dp[i]=0;
			else
			{
				dp[i]=max(sum[i]-(a[i]==0?0:sum[a[i]-1])+(a[i]==0?0:dp[a[i]-1]),0ll);
			}
		}		
		ans=0;
		for(i=0;i<n;i++)
			ans=max(ans,dp[i]);
		cout<<ans<<endl;
	}
	return 0;
}