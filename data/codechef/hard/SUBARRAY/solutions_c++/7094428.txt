#include <bits/stdc++.h>
using namespace std;

long long result[100000];

long long getans(long long*arr,long long* dp,long long i){
    if(result[i]!=-1)
        return result[i];
    if(arr[i]==-1)
        return 0;
    long long ans=dp[i];
    if(arr[i]>0)
        ans+=max(0LL,getans(arr,dp,arr[i]-1));
    result[i]=ans;
    return ans;
}

bool isopen(char a){
    if(a=='{'||a=='['||a=='<'||a=='(')
        return true;
    return false;
}

bool match(char a,char b){
    if(a=='{'&&b=='}')
        return true;
    if(a=='['&&b==']')
        return true;
    if(a=='('&&b==')')
        return true;
    if(a=='<'&&b=='>')
        return true;
    return false;
}

int main(){
    long long t,n;
    scanf("%lld",&t);
    while(t--){
        scanf("%lld",&n);
        string b;
        long long a[n],sum[n],dp[n];
        long long arr[n];
        for(long long i=0;i<n;i++)
            arr[i]=dp[i]=-1;
        cin>>b;
        for(long long i=0;i<n;i++)
            scanf("%lld",&a[i]);
        stack<long long>s;
        for(long long i=0;i<n;i++){
            if(isopen(b[i]))
                s.push(i);
            else{
                if(!s.empty()){
                    if(match(b[s.top()],b[i])){
                        arr[i]=s.top();
                        s.pop();
                    }else{
                        while(!s.empty())
                            s.pop();
                    }
                }
            }
        }
        sum[0]=a[0];
        for(long long i=1;i<n;i++)
            sum[i]=a[i]+sum[i-1];
        for(long long i=0;i<n;i++){
            if(arr[i]!=-1){
                if(arr[i]==0)
                    dp[i]=sum[i];
                else
                    dp[i]=sum[i]-sum[arr[i]-1];
            }
        }
        for(long long i=0;i<n;i++)
            result[i]=-1;
        long long ans=0;
        for(long long i=n-1;i>=0;i--){
            ans=max(ans,getans(arr,dp,i));
        }
        printf("%lld\n",ans);
    }
}
