#include <bits/stdc++.h>
using namespace std;
#define ll long long int
#define rep(i,n) for(int i = 1; i <= n; i++)
#define Rep(i,a,b) for(int i = a; i < b; i++)
#define x 100005
char str[x];
int v[x],hbp[x];
ll dp[x],sum[x]; 
inline int ss()
{
  int o=0;
  int u=getchar_unlocked(),s=1;
  for(;u<'0' || u>'9';)
  {
    if (u=='-') s=-1;
    u=getchar_unlocked();
  }
  while(u>='0' && u<='9'){
    o=o*10+u-'0';
    u=getchar_unlocked();}
  o=o*s;
  return o;
}
inline void rr(ll a) {
  char c;
  char snum[20];
  int i = 0;
  do {
    snum[i++] = a % 10 + 48;
    a = a / 10;
  } while (a != 0);
  i = i - 1;
  while (i >= 0)
    putchar_unlocked(snum[i--]);
  putchar_unlocked('\n');
}
int main()
{
int t;
  t=ss();
  while (t--) {
    int n;
    n=ss();
    scanf("%s", str);sum[0]=0;
    rep(i, n) {
      int yk=ss();
      sum[i] = yk +sum[i - 1];
    }
    stack<int> st;
    st.push(0);int k,j;
 char ch[8]={'(','{','<','[',')','}','>',']'};
    Rep(i, 1, n) {
      for( j=0;j<4;j++)
     if(str[i]==ch[j+4])
     { 
      if(!st.empty() && str[st.top()]==ch[j])
      {
       k=st.top();
       st.pop();
       dp[i]=max(0LL,dp[k-1]+sum[i+1]-sum[k]);
      }
      else
       st.push(i),dp[i]=0;
      break;
     }
     if(j==4)
      st.push(i),dp[i]=0;
    }
    ll ans = 0;
    rep(i, n)
    if(ans<dp[i]) ans = dp[i];
    rr(ans);
  }
  return 0;
}