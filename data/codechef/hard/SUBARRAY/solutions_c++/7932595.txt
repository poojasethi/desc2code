#include<bits/stdc++.h>

using namespace std;
#define ll long long
char str[100010];
ll ans,a[100010],start[100010],dp[100010],sum[100010];
char open[257];
stack<int> s;

#ifndef ONLINE_JUDGE
    #define gc getchar
    #define pc putchar
#else
    #define gc getchar_unlocked
    #define pc putchar_unlocked
#endif

inline void fp(ll n){
    if (n / 10 != 0)
    fp(n / 10);
    pc((n % 10) + '0');
}

inline void fr(ll &x) {
    register int c = gc();
    int d=0;
    x = 0;
    for(; (c<48 || c>57); c = gc())if(c=='-')d=1;
    for(; c>47 && c<58 ; c = gc()) {
        x = (x<<1) + (x<<3) + c - 48;
    }
    if(d)x=-x;
}

inline ll max1(ll a,ll b){
    return a>b?a:b;
}

int main(){
    ll t,n;
    open['{']=open['(']=open['<']=open['[']='o';//opening brackets
    open['}']='{';
    open[')']='(';
    open['>']='<';
    open[']']='[';

    fr(t);
    while(t--){
        while(!s.empty())s.pop();
        //memset(start,-1,sizeof(start));

        fr(n);
        scanf(" %s",&str[0]);
        sum[0]=0;
        for(int i=1;i<=n;++i){
            fr(a[i]);
            sum[i]=a[i]+sum[i-1];
        }
        start[0]=-1;
        for(int i=0;str[i]!='\0';++i){
            start[i+1]=-1;
            if(open[str[i]]=='o'){
                s.push(i);
            }
            else{
                if(!s.empty()&&open[str[i]]==str[s.top()]){
                    start[i+1]=s.top()+1;//as numbers are 1-indexed
                    s.pop();
                }
                else{
                    while(!s.empty())s.pop();
                }
            }
        }
        /*for(int i=1;str[i-1]!='\0';++i){
            cout<<"> "<<start[i]<<"\n";
        }*/
        dp[0]=0;
        for(int i=1;i<=n;++i){
            dp[i]=max1(0LL,start[i]==-1?0:(dp[start[i]-1]+sum[i]-sum[start[i]-1]));
            //cout<<">"<<dp[i]<<endl;
        }
        ans=0;
        for(int i=1;i<=n;++i)ans=max1(ans,dp[i]);
        printf("%lld\n",ans);
    }
    return 0;
}
