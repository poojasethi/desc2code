#include<cstdio>
#include<iostream>
#include<cstring>
#include<vector>
#include<memory.h>
#include<cstdlib>
#include<cmath>
#include<cassert>
#include<memory.h>
#include<algorithm>
#include<queue>
#include<utility>
#include<map>
#include<bitset>
using namespace std;

typedef vector<int> VI;
typedef long long LL;
typedef unsigned long long uLL;
typedef pair<int, int> PII;
typedef vector<PII> VPII;
#define pb push_back
#define fi first
#define se second
#define mp make_pair
#pragma comment(linker, "/STACK:266777216")

const int inf=1000000000;
const LL INF=LL(inf)*inf;
const double eps=1e-9;
const double PI=2*acos(0.0);

#define NN 100005

char str[NN][2];
LL num[NN];
int K;

int P[NN];
LL Q[NN], R[NN], sum[NN];

int min(int a, int b){return a<b?a:b;}
LL min(LL a, LL b){return a<b?a:b;}

void solve()
{
    sum[0] = 0;
    scanf("%d", &K);
    for(int i=0; i<K; i++)
    {
        scanf("%s%lld", str[i+1], &num[i+1]);
        sum[i+1] = sum[i] + num[i+1];
    }
    /*for(int i=1; i<=K; i++)
    {
        cout<<i<<" "<<str[i]<<endl;
    }*/
    int id=0, mx = 0, j;
    LL a, b, ans = 0;
    for(int i=1; i<=K; i++)
    {
        j = 2*id - i;
        if(mx>i)
        {
            if(mx-i>= P[j])
            {
                P[i] = P[j];
                R[i] = R[j];
                Q[i] = R[j];
            }
            else
            {
                P[i] = mx - i;
                Q[i] = ((num[i]+1)*(num[i]))/2 + sum[mx] - sum[i];
                R[i] = Q[i];
                //cout<<"doge"<<endl;
            }

        }
        else
        {
            P[i] = 0;
            Q[i] = ((num[i]+1)*(num[i]))/2;
            R[i] = Q[i];
            //cout<<str[i]<<" "<<Q[i]<<endl;
        }

        while(str[i+P[i]+1][0] == str[i-P[i]-1][0] && i+P[i]+1<=K && i-P[i]-1>0 )
        {
            int idx1 = i+P[i]+1, idx2 = i-P[i]-1;

           a = num[i+P[i]+1];
           b = num[i-P[i]-1];
           //cout<<"i "<<i<<" P[i] "<<P[i]<<" "<<idx1<<" "<<idx2<<" "<<str[idx1][0]<<" "<<str[idx2][0]<<" "<<a<<" "<<b<<" "<<Q[i]<<endl;


           //cout<<"new "<<Q[i]<<endl;
           if(a != b)
           {
               Q[i]+= min(a,b);
               break;
           }
           else
           {
               Q[i]+= min(a,b);
               R[i]+= min(a,b);
               P[i]++;
           }
        }

            if(i+P[i]>mx)
            {
                   id = i;
                   mx = i+P[i];
            }

        ans+= Q[i];
        //cout<<P[i]<<" "<<Q[i]<<endl;
    }
    printf("%lld\n", ans);


}

int main()
{
    #ifndef ONLINE_JUDGE
    freopen("input.txt","r",stdin);
    freopen("output.txt","w",stdout);
    #endif
    int t;
    scanf("%d", &t);
    while(t--)
    {
        solve();
    }
}
