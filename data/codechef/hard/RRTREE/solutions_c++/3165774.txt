/*

*/

//#pragma comment(linker, "/STACK:16777216")
#include <fstream>
#include <iostream>
#include <string>
#include <complex>
#include <math.h>
#include <set>
#include <vector>
#include <map>
#include <queue>
#include <stdio.h>
#include <stack>
#include <algorithm>
#include <list>
//#include <memory.h>

#define y0 sdkfaslhagaklsldk
#define y1 aasdfasdfasdf
#define yn askfhwqriuperikldjk
#define j1 assdgsdgasghsf
#define tm sdfjahlfasfh
#define lr asgasgash

#define  INF 100000000
#define eps 1e-10
//#define M_PI 3.141592653589793
//#define mx 1000000000000ll
#define bs 1000000007

//#define free asdfasdfsdadsg
#define MAXN 10000
//#define SIZE 60
#define bsize 256

using namespace std;

long T1[777777],T2[777777];
long P[777777][22];
long t1,t2,n;
vector<long> g[777777];
long tv,q,qu[777777];
long cur,res;
long H[777777],D[777777];
long tests;

bool upper(long a,long b)
{
 return (T1[a]<=T1[b]&&T2[a]>=T2[b]);
}

void dfs(long v,long p)
{
 P[v][0]=p;
 for (int i=1;i<=20;i++)
  P[v][i]=P[P[v][i-1]][i-1];
 T1[v]=t1;
 ++t1;
 for (int i=0;i<g[v].size();i++)
  dfs(g[v][i],v);
   T2[v]=t2;
   ++t2;
}

long lca(long a,long b)
{
 if (upper(a,b))return a;
 if (upper(b,a))return b;
 for (int i=20;i>=0;--i)
  if (!upper(P[a][i],b))a=P[a][i];
  return P[a][0];
}

long t;

int main(){
//freopen("perm.in","r",stdin);
//freopen("perm.out","w",stdout);
//freopen("input.txt","r",stdin);
//freopen("output.txt","w",stdout);
ios_base::sync_with_stdio(0);

cin>>tests;
for (;tests;--tests)
{
 cin>>n;
 for (int i=0;i<=n;i++)
 g[i].clear();
 
 for (int i=1;i<n;i++)
 {
  cin>>t;
  --t;
  g[t].push_back(i);
  qu[i]=t;
 }
 t1=t2=0;
 dfs(0,0);
 long cur=0;
 long res=0;
 H[0]=0;
 D[0]=0;
 
 for (int i=1;i<n;i++)
 {
  t=qu[i];
  H[i]=H[t]+1;
  if (H[t]==H[cur]){D[i]=D[cur]+1;
  cur=i;res=max(res,D[i]);}
  else
  {
   long v=lca(cur,i);
   D[cur]=max(D[cur],H[cur]+H[i]-2*H[v]);
   res=max(res,D[cur]);
  }
  cout<<//"&&"<<
  res<<endl;
 }
 
}

cin.get();cin.get();
return 0;}
