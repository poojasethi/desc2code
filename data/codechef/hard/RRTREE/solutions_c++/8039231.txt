#include<iostream>
#include<algorithm>
#include<list>
#include<vector>
#include<cmath>
using namespace std;

int dp[18][100009];
int depth[100009];

int lca(int a,int b)
{
if(depth[a]<depth[b])
swap(a,b);
int temp=log2(depth[a]);
for(int i=temp;i>=0;i--)
if(depth[a]-(1<<i)>=depth[b])
a=dp[i][a];
if(a==b)
return a;
for(int i=temp;i>=0;i--)
if(dp[i][a]!=-1&&dp[i][a]!=dp[i][b])
a=dp[i][a],b=dp[i][b];
return dp[0][a];
}

int main()
{
ios_base::sync_with_stdio(false);
int t;
cin>>t;
while(t--)
{
int n;
cin>>n;
list<int>adj[n+2];
depth[0]=0;
int temp1=0;
int temp2=0;
int ans=0;
dp[0][0]=-1;
for(int i=1;i<n;i++)
{
int x;
cin>>x;
x--;
adj[i].push_back(x);
adj[x].push_back(i);
dp[0][i]=x;
for(int j=1;j<=16;j++)
dp[j][i]=dp[j-1][dp[j-1][i]];
depth[i]=1+depth[x];
int dis1=depth[temp1]+depth[i]-2*depth[lca(temp1,i)];
int dis2=depth[temp2]+depth[i]-2*depth[lca(temp2,i)];
int dis3=depth[temp1]+depth[temp2]-2*depth[lca(temp1,temp2)];
//cout<<dis1<<" "<<dis2<<" "<<dis3<<endl;
if(dis1>dis3)
{
ans=dis1;
temp2=i;
}
else if(dis2>dis3)
{
ans=dis2;
temp1=i;
}
else
ans=dis3;
cout<<ans<<endl;
}
}
return 0;
}
