#include<cstdio>
#include<cstring>
#include<cstdlib>
#include<cctype>
#include<ctime>
#include<assert.h>

#include<cmath>
#include<iostream>
#include<fstream>

#include<string>
#include<vector>
#include<queue>
#include<map>
#include<algorithm>
#include<set>
#include<sstream>
#include<stack>

using namespace std;

#define MAX(a,b) ((a)>(b) ? (a) : (b))
#define MIN(a,b) ((a)<(b) ? (a) : (b))
#define EPS 1e-9
#define asdf exit(0);






int dp[2020][2020];
int a[2020][2020];
int l[2020];
int r[2020];


int main()
{
    int T,i,j,I,n,m=2024072000;
    int inf=m+100,pre;


    //freopen("in.txt","r",stdin);
	//freopen("out.txt","w",stdout);
	scanf("%d",&T);


	while(T--)
	{
        scanf("%d %d %d",&n,&m,&I);


        if(I==1)
        {
            for(i=1;i<=n;i++)
            for(j=0;j<m;j++)
            scanf("%d",&a[i][j]);

        }
        else
        {

            int X,P,Q,M;
            scanf("%d %d %d %d",&X,&P,&Q,&M);
            int cur = X;

            for(i=1;i<=n;i++)
            for(j=0;j<m;j++)
            {
                cur = ( cur*P + Q ) % M;
                a[i][j] = X - cur;
            }
        }


        for(i=1;i<=n;i++)
        {
            l[0]=0;
            for(j=1;j<m;j++)
            {
                l[j]=max(0,l[j-1]+a[i][j-1]);
            }


            r[m-1]=0;
            for(j=m-2;j>=0;j--)
            {

                r[j]=max(0,r[j+1]+a[i][j+1]);
            //   cout<<r[j]<<" ";

            }

            //asdf



            pre=-inf;
            for(j=0;j<m;j++)
            {
                dp[i][j]=-inf;
                pre=max(pre,dp[i-1][j]+l[j]);
                dp[i][j]=max(dp[i][j],pre+r[j]+a[i][j]);

                pre+=a[i][j];
          //      cout<<dp[i][j]<<" ";
//

            }

           // asdf

            pre=-inf;
            for(j=m-1;j>=0;j--)
            {
                pre=max(pre,dp[i-1][j]+r[j]);
                dp[i][j]=max(dp[i][j],pre+l[j]+a[i][j]);
                pre+=a[i][j];
            }


            /*for(j=0;j<m;j++)
            {
                cout<<dp[i][j]<<" ";
            }
            asdf*/


        }

        /*for(i=1;i<=n;i++)
        {
            for(j=0;j<m;j++) cout<<dp[i][j]<<" ";
            cout<<endl;
        }


        asdf*/

        int ans=-inf;

        for(j=0;j<m;j++)
        {
            ans=max(ans,dp[n][j]);
        }


        printf("%d\n",ans);








    }
	return 0;
}

