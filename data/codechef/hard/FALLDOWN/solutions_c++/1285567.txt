#include<stdio.h>

int r,c,x,me,p,q,m,cur,tmp,t;
int a[2015][2015],f[2015][2015],st[2015],ed[2015],g1[2015],g2[2015];
bool sign;

inline int f_max2(int w,int q)
{
if(w>=q)
return w;
return q;
}

inline int f_max3(int q,int w,int e)
{
if(w>=e)
{
if(w>=q)
return w;
return q;
}
else
{
if(e>=q)
return e;
return q;
}
}

int main()
{
scanf("%d",&t);
for(int i=0;i<t;i++)
{
scanf("%d",&r);
scanf("%d",&c);
scanf("%d",&me);
if(me==1)
{
for(int i=1;i<=r;i++)
{
for(int j=1;j<=c;j++)
{
scanf("%d",&a[i][j]);
}
}
}
else
{
scanf("%d",&x);
scanf("%d",&p);
scanf("%d",&q);
scanf("%d",&m);
cur=x;
for(int i=1;i<=r;i++)
{
for(int j=1;j<=c;j++)
{
cur=((cur*p)+q)%m;
a[i][j]=x-cur;
}
}
}
for(int i=1;i<=c;i++)
{
f[0][i]=0;
}
for(int i=1;i<=r;i++)
{
st[1]=0;
for(int j=2;j<=c;j++)
{
tmp=st[j-1]+a[i][j-1];
if(tmp<=0)
tmp=0;
st[j]=tmp;
}
ed[c]=0;
for(int j=c-1;j>=1;j--)
{
tmp=ed[j+1]+a[i][j+1];
if(tmp<=0)
tmp=0;
ed[j]=tmp;
}
g1[1]=f[i-1][1]+a[i][1];
for(int j=2;j<=c;j++)
{
g1[j]=f_max2(f[i-1][j]+a[i][j]+st[j],g1[j-1]+a[i][j]);
}
g2[c]=f[i-1][c]+a[i][c];
for(int j=c-1;j>=1;j--)
{
g2[j]=f_max2(f[i-1][j]+a[i][j]+ed[j],g2[j+1]+a[i][j]);
}
for(int j=1;j<=c;j++)
{
if(j==1 || j==c)
f[i][j]=a[i][j]+f[i-1][j]+st[j]+ed[j];
else
f[i][j]=a[i][j]+f_max3(f[i-1][j]+st[j]+ed[j],g1[j-1]+ed[j],g2[j+1]+st[j]);
//printf("%d ",f[i][j]);
}
//printf("\n");
}
tmp=f[r][1];
for(int i=2;i<=c;i++)
{
if(f[r][i]>tmp)
tmp=f[r][i];
}
printf("%d\n",tmp);
}
return 0;
}