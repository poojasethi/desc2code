/* 
    Template: 
    By Jugal :) 
*/ 
#include<bits/stdc++.h>
using namespace std; 

typedef long long int ll; 
typedef vector <int> vi; 
typedef vector <vi> vii; 
typedef pair<int,int> pii;
typedef ll ft;

#define get getchar_unlocked
#define put putchar_unlocked
#define pb push_back 
#define mp make_pair 
#define ff first 
#define ss second 
#define sz size() 
#define len length() 
#define rep(i,n) for(int i=0;i<n;i++) 
#define ref(i,a,n) for(int i=a;i<=n;i++) 
#define reb(i,n,a) for(int i=n;i>=a;i--) 
#define all(a) a.begin(),a.end() 
#define gi(n) scanf("%d",&n)
#define gii(n) scanf("%lld",&n)
#define gc(c) scanf(" %c",&c) 
#define pi(n) printf("%d",n) 
#define pii(n) printf("%lld",n)
#define pc(c) printf("%c",c)
#define ps printf(" ") 
#define pn printf("\n") 

void gl(char *str) { char c; int i=0; if((c=get())!='\n') str[i++]=c; while((c=get())!='\n') str[i++]=c;str[i]='\0'; }
void pl(char *str) { rep(i,strlen(str)) put(str[i]); }

void gfi(ft &n) { 
	char c;
	ft sign=1; n=0;
	while(((c=get())<'0' || c>'9') && c!='-');
	if(c=='-') sign=-1; if(c>='0' && c<='9') n=(n<<3)+(n<<1)+(c-'0');
	while((c=get())!='\n' && c!=' ') n=(n<<1)+(n<<3)+(c-'0');
	n*=sign;
}

void pf(ft n) { if(n) pf(n/10),put(n%10+'0'); }
void pfi(ft n) { if(n<0) put('-'),n*=-1; pf(n); }

ll fpow(ll a,ll b,ll m) {
	ll ans=1;
	while(b) {
		if(b&1) ans=(ans*a)%m;
		a=(a*a)%m;
		b>>=1;
	}
	return ans;
}

ll ldp[1000065],rdp[1000054],mdp[1000045];

int main() {
	ll t;
	gii(t);
	while(t--) {
		ll n,m,q;
		gii(n);gii(m);gii(q);

		rep(i,n/2+1) ldp[i]=1;
		rep(i,n/2+1) rdp[i]=1;
		rep(i,n/2+1) mdp[i]=1;

		ref(i,1,n/2) ldp[i]=(ldp[i-1]*fpow(i,i-1,m))%m;
		ref(i,1,n/2) rdp[i]=(rdp[i-1]*fpow(n-i+1,i,m))%m;
		
		if(n&1) mdp[n/2]=n/2+1;
		reb(i,n/2-1,1) mdp[i]=((ll)((mdp[i+1]*(ll)(i+1))%m)*(ll)(n-i))%m;
		
		while(q--) {
			ll r,ans=1;
			gii(r);
			r=min(r,n-r);
			ans=((ll)((ldp[r]*rdp[r])%m)*(ll)fpow(mdp[r],r,m))%m;
			pii(ans);pn;
		}
	}
	return 0;
}
