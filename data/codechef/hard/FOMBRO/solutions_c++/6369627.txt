#include <iostream>
#include <algorithm>
#include <cmath>
#include <stdio.h>
#include <vector>
#include <stdlib.h>

using namespace std;


#define ll long long int
#define inchar getchar_unlocked

 
inline void inp( ll &n )
{
n=0;
ll ch=inchar();ll sign=1;
while( ch < '0' || ch > '9' ){if(ch=='-')sign=-1; ch=inchar();}
while( ch >= '0' && ch <= '9' )
n = (n<<3)+(n<<1) + ch-'0', ch=inchar();
n=n*sign;
}


ll ans[1000010],p[1000010];

int main() {

    ll test;
    inp(test);
    while(test--)
     {
         ll n,m,q,r,lt,rt;
         inp(n);inp(m);inp(q);
         r = n/2;
         if(n&1)
          {
              p[r] = ((r+1)*(r+2))%m;
              lt = r;rt = r+3;
          }
          else
          {
              p[r] = (r+1)%m;
              lt = r;rt = r+2;
          }
          for(ll i =n/2-1;i>=1;i--)
           {
               p[i] = (p[i+1]*((lt*rt)%m))%m;
               lt--;rt++;
           }
          ans[1] = p[1];
          ll nh = n/2;
          for(ll i=2;i<=nh;i++)
           ans[i] = (ans[i-1]*p[i])%m ;// cout<<ans[i]<<" x\n";
         while(q--)
          {
              inp(r);
              r = min(r,n-r);
              printf("%lld\n",ans[r]);
          }
     }
    
    
    
    //getchar();
    //getchar();
	return 0;
} 
