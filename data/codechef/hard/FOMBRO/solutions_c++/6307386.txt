#include <stdio.h>

typedef long long LL;
const int N=500001;
LL p[N];
int R[N];

int main(int argc, char* argv[])
{
    int h, i, t, n, m, q, r;
    scanf("%d", &t);
    int prevn=0;
    for(h=0;h<t;h++)
    {
        scanf("%d %d %d", &n, &m, &q);
        int end=prevn>>1;
        for(i=0;i<end;i++)
        {
            p[i]=R[i]=0;
        }
        int a=(n&1) ? (n+1)>>1 :  (n+2)>>1;
        LL upper=a, lower=a;
        if(n&1) upper+=1;
        LL x=(n&1) ? (LL)a*(a+1)%m : a;
        int cnt=0;
        p[cnt]=x;
        for(i=a-1;i>=3;i--)
        {
            upper++;
            lower--;
            x=x*upper%m*lower%m;
            cnt++;
            p[cnt]=x;
        }
        x=1;
        for(i=1;i<=n;i++)
        {
            x*=i;
            if(x>=m) x%=m;
        }
        R[0]=x;
        int half=n>>1;
        for(i=2;i<=half;i++)
        {
            R[i-1]=R[i-2]*p[half-i]%m;
        }
        for(i=0;i<q;i++)
        {
            scanf("%d", &r);
            if(r>half) r=n-r;
            printf("%d\n", R[r-1]);
        }
        prevn=n;
    }
    return 0;
}

