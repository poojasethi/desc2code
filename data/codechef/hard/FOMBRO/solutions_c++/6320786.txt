#pragma comment(linker, "/STACK:1024000000,1024000000")
#include <iostream>
#include <stdio.h>
#include <string.h>
#include <algorithm>
#include <cmath>
#include <map>
#include <vector>
#include <queue>
using namespace std;
#define x first
#define y second
#define pii pair<int,int>
#define vi vector<int>
#define pb push_back
#define mp make_pair
#define all(x) x.begin(),x.end()
#define FOREACH(it,x) for(typeof(x.begin())it=x.begin();it!=x.end();it++)
#define DBG(x) cerr<<#x<<"="<<x<<"\n";
#define ull unsigned long long
#define ll long long
#define inf 1000000007
#define mod 1000000007
#define N 1000010

int pow(int a,int b,int p)
{
    int ans=1;
    while(b){
        if(b&1)ans=1LL*ans*a%p;
        b>>=1;a=1LL*a*a%p;
    }
    return ans;
}
int f[N],d[N],b[N];
int main()
{
    int i,j,k,ca=0,T,n,m;
    scanf("%d",&T);
    while(T--){
        int q,r,ans;
        scanf("%d%d%d",&n,&m,&q);
        f[0]=1;d[0]=1;
        for(i=1;i<=n/2;i++)f[i]=1LL*f[i-1]*pow(i,i-1,m)%m;
        for(i=1;i<=n/2;i++)d[i]=1LL*d[i-1]*pow(n-i+1,i,m)%m;
        if(n&1)b[n/2]=n/2+1;
        else b[n/2]=1;
        for(i=n/2-1;i>=0;i--)b[i]=1LL*b[i+1]*(i+1)%m*(n-i)%m;
        while(q--){
            scanf("%d",&r);
            r=min(r,n-r);
            ans=1LL*f[r]*d[r]%m*pow(b[r],r,m)%m;
            printf("%d\n",ans);
        }
    }
    return 0;    
}