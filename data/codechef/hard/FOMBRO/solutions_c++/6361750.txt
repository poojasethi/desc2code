#include <bits/stdc++.h>
using namespace std;
#define maxn 1000000+3
typedef long long int ll;

ll n, m, q;
ll forwdp[maxn];
ll backdp[maxn];
ll betdp[maxn];

ll binpow(ll a, ll b, ll M) {
    ll res = 1;
    while(b) {
        if(b&1) {
            res = (res * a)%M;
        }
        a = (a*a)%M;
        b>>=1;
    }
    return res;
}
void precompute() {
    forwdp[0]  = 1;
    backdp[0]  = 1;
    
    for(ll i=1;i<=n/2;i++) {
        forwdp[i] = (forwdp[i-1]*binpow(i,i-1,m)) % m;
    }
    for(ll i=1;i<=n/2;i++) {
        backdp[i] = (backdp[i-1]*binpow(n-i+1,i,m))%m;
    }
    
    if(n&1) {
        betdp[n/2] = (n/2)+1;
    } else {
        betdp[n/2] = 1;
    }
    
    for(ll i=n/2-1;i>=1; i--) {
        betdp[i] = ( (ll)( ( betdp[i+1]*(i+1) )%m )*(n-i) )%m;
    }
}
int main() {
	// your code goes here
	int t;
	
	scanf("%d",&t);
	while(t--) {
	    ll answer;
	    scanf("%lld %lld %lld",&n, &m, &q);
	    precompute();
	    while(q--) {
	        ll r;
	        scanf("%lld",&r);
	        r = min(n-r, r);
	        
	        answer = ((ll)((forwdp[r] * binpow(betdp[r],r,m))%m) * backdp[r])%m;
	        
	        cout<<answer<<"\n";
	    }
	}
	return 0;
}

