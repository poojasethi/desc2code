/* Template V1.0 | Author: warlock_ankur */
#include <bits/stdc++.h>
using namespace std;

typedef	long long ll;
#define PUT(ST, x) (ST |= 1 << x)		// Put x into Set ST
#define DEL(ST, x) (ST &= ~(1 << x))	// Remove x from Set ST
#define rep(i,n) for(int i = 0; i < n; i++)
#define Rep(i,a,b) for(int i = a; i < b; i++)
#define all(a) a.begin(),a.end()
#define MAXN 1000010

int n, m, q, r;
ll firstpart[MAXN << 1], lastpart[MAXN], middle[MAXN << 1];

inline void inp(int &n) {
	n = 0;
	int ch = getchar_unlocked();
	int sign = 1;
	while (ch < '0' || ch > '9') {
		if (ch == '-') sign = -1;
		ch = getchar_unlocked();
	}
	while (ch >= '0' && ch <= '9')
		n = (n << 3) + (n << 1) + ch - '0', ch = getchar_unlocked();
	n = n*sign;
}

inline void outp(ll a) {
	char c;
	char snum[20];
	int i = 0;
	do {
		snum[i++] = a % 10 + 48;
		a = a / 10;
	} while (a != 0);
	i = i - 1;
	while (i >= 0)
		putchar_unlocked(snum[i--]);
	putchar_unlocked('\n');
}

ll exp(ll a, ll b)
{
	ll x = 1, y = b;
	while (y) {
		if (y & 1)
			x = (x*a) % m;
		y = y >> 1;
		a = (a*a) % m;
	}

	return x;
}

void precompute()
{
	firstpart[0] = 1, lastpart[0] = 1;
	int N = n >> 1;
	for (int i = 1; i <= N; i++)
		firstpart[i] = (firstpart[i - 1] * exp(i, i - 1)) % m;
	for (int i = 1; i <= N; i++)
		lastpart[i] = (lastpart[i - 1] * exp(n - i + 1, i)) % m;

	if (n & 1)
		middle[N] = (N) +1;
	else
		middle[N] = 1;

	for (int i = N - 1; i > 0; i--)
		middle[i] = (((middle[i + 1] * (i + 1)) % m)*(n - i)) % m;
}

void solve()
{
	precompute();
	while (q--) {
		//scanf("%d", &r);
		inp(r);
		r = min(r, n - r);

		ll ans = (firstpart[r] * lastpart[r]) % m;
		ans = (ans*exp(middle[r], r)) % m;
		//printf("%lld\n", ans);
		outp(ans);
	}
}

int main()
{
	int t;
	//scanf("%d", &t);
	inp(t);
	while (t--) {
		//scanf("%d %d %d", &n, &m, &q);
		inp(n), inp(m), inp(q);
		solve();
	}

	return 0;
}
