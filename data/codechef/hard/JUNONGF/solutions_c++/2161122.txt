/* author : Mukesh Kumar Yadav
   Problem:  
   */
#include<algorithm>
#include<iostream>
#include<cstring>
#include<cstdlib>
#include<climits>
#include<fstream>
#include<cctype>
#include <bitset>
#include<cstdio>
#include<string>
#include<vector>
#include<queue>
#include<stack>
#include<cmath>
#include<map>
#include<set>
using namespace std;
 
#define df(i,a,b) for(typeof(b) i=a;i>=b;i--)
#define f(i,a,b) for(typeof(b) i=a;i<=b;i++)
#define fill(x,a) memset(x,a,sizeof(x))
#define Clear(x) memset(x,0,sizeof(x))
#define inf 2147000000
#define pb push_back
#define mp make_pair
#define Y second
#define X first
 
const double pi     =   acos(-1.0);
const double eps    =   1e-8;
 
typedef unsigned long long int ull;
typedef long long int ll;
typedef vector<string> VS;
typedef pair<int,int> ii;
typedef vector<int> VI;
#define mod 1000000007
 
int N;
ll V,P[101],Q[101],A[2],B[2],C[2],M[2],L[101];
 
ll ppower(ll a, ll b){
	if(b==1) return a%mod;
	if(b==0) return 1;
	if(a==0 || a==1) return a;
	ll c = ppower(a,b/2)%mod;
	if(b%2) return (((c*c)%mod)*a)%mod;
	else return ((c*c)%mod); 
}
 
int main()
{  
//	freopen("input.txt","r",stdin);
	int t;
	scanf("%d", &t);
	while(t--){
		scanf("%lld %d",&V, &N);
			scanf("%lld %lld",&P[0] , &P[1]);
			scanf("%lld %lld",&A[0] , &B[0]) ;
		 	scanf("%lld %lld",&C[0] , &M[0]);
			
			
			scanf("%lld %lld",&Q[0] , &Q[1]);
			scanf("%lld %lld",&A[1] , &B[1]) ;
		 	scanf("%lld %lld",&C[1] , &M[1]);
		 	
		for(int i=2; i<N; i++){
			P[i]=((((A[0]*A[0])%M[0])*P[i-1])%M[0]+(B[0]*P[i-2])%M[0]+C[0])%(M[0]);
			Q[i]=((((A[1]*A[1])%M[1])*Q[i-1])%M[1]+(B[1]*Q[i-2])%M[1]+C[1])%(M[1]);
		}
		ll ans = 1;
		bool flag = false;
		ll LD=1;
		for(int i=0; i<N; i++){
			L[i] = (P[i]*M[1]+Q[i]+1);
			LD *= ((L[i]-1)%(mod-1));
			LD %= (mod-1);
			if(L[i] == 1) {
				flag = true;
				break;
			}
		}
		
		if(!flag)
		{
		if((V%mod) == 0 && LD == 0)
		{
			cout << "0" << endl;
			continue;
			
		}
		ans = ppower(V%mod, LD);	
		}
		else
		{
			ans = 1;
		}	
		printf("%lld\n",ans);
	}
	
  	return 0;
} 