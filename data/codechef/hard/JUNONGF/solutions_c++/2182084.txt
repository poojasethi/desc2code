#include<iostream>
#include<stdio.h>
long long int cal(long long int,long long int);
int check();
int n;
long long int p[105],q[105],l[105];
int main()
{
long int t,k;
int i;
long long int a[2],b[2],c[2],m[2],v,po;
long long int ans,mod;
mod=1000000007;
scanf("%d",&t);
for(k=1;k<=t;k++)
{
scanf("%lld %d",&v,&n);
scanf("%lld %lld %lld %lld %lld %lld",&p[0],&p[1],&a[0],&b[0],&c[0],&m[0]);
scanf("%lld %lld %lld %lld %lld %lld",&q[0],&q[1],&a[1],&b[1],&c[1],&m[1]);
l[0]=p[0]*m[1]+q[0]+1;
l[1]=p[1]*m[1]+q[1]+1;
po=(l[0]-1)%(mod-1);
po=(po*((l[1]-1)%(mod-1)))%(mod-1);
for(i=2;i<n;i++)
{
p[i]=((((a[0]*a[0])%m[0])*p[i-1])%m[0]+((b[0]*p[i-2])%m[0]+c[0])%m[0])%m[0];
q[i]=((((a[1]*a[1])%m[1])*q[i-1])%m[1]+((b[1]*q[i-2])%m[1]+c[1])%m[1])%m[1];
l[i]=p[i]*m[1]+q[i]+1;
po=(po*((l[i]-1)%(mod-1)))%(mod-1);
}
if(v%mod==0)
{
if(check()==1)
{
printf("1\n");
}
else
{
printf("0\n");
}
}
else
{
ans=cal(v,po);
printf("%lld\n",ans);
}
}
return 0;
}
int check()
{
int i;
for(i=0;i<n;i++)
{
if(l[i]==1)
{
return 1;
}
}
return 0;
}
long long int cal(long long int x,long long int m)
{
long long int y,b,mod;
mod=1000000007;
y=1;
b=x%mod;
while(m>0)
{
if(m%2!=0)
{
y=(y*b)%mod;
}
m=m/2;
b=(b*b)%mod;
}
return y;
}
