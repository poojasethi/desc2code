#include<iostream>
#include<stack>
#include<vector>
#include<cstring>
#include<algorithm>
using namespace std ;
long long  tree[100005] ,  n ;
long long  sum ( int x )
{
    long long  ans = 0 ;
    for ( int i = x ; i > 0 ;  )
    {
        ans = ans + tree[i] ;
        i = ( i - ( i & -i)) ;
    }
    return ans ;
}
void update ( int x )
{
    for ( int i = x ; i <= n ;  )
    {
        tree[i] = tree[i] + 1 ;
        i = ( i + ( i & -i)) ;
    }
}
/*int tree[262144 * 4 ] ;
void update ( int id , int i , int j , int u , int k )
{
    if ( ( u < i) || ( j < u ) || ( i  > j ) )
    return ;

    if ( ( u == i ) && ( u == j ) )
    {
     tree[id] = k ;
     return ;
    }

   if ( ( i <= u ) && ( u <= j ) )
   {
       int mid = ( i + j ) / 2 ;
    update( 2*id , i , mid  , u , k   );
    update(( 2*id + 1 ) , ( mid  + 1 ) , j , u , k  );
    tree[id] = tree[2*id] + tree[(2*id)+ 1] ;
    return ;
   }

}

int query ( int id , int i , int j , int l ,  int r )
{
    if ( ( r < i) || (  l >  j ) )
    return 0  ;
    if ( ( i >= l ) && ( j <= r ) )
        return tree[id] ;


       int mid = ( i + j ) / 2 ;
    int   h1 =  query( (2*id) , i ,  mid  , l , r   );
    int   h2 =  query(( 2*id + 1 ) , ( mid  + 1 ) , j , l , r  ) ;
    return ( h1 + h2 ) ;


}
*/

int main()
{
    int te , t ;
    string s ;
    cin >> te ;
    stack < int > st ;
    while(te--)
    {
         while ( !st.empty())
         {
             st.pop() ;
         }

        cin >> n ;
        cin >> s ;
        int a[n+1] ;
        memset ( a , 0 , sizeof(a));
        for ( int i = 0 ; i < n ; i++)
          {
              if ( s[i] == '4')
              {
                  st.push(i);
              }
              else
              {
                  if ( !st.empty())
                  {
                       t = st.top();
                      st.pop();
                      a[t]++ ;
                      if ( !st.empty())
                      {

                        a[st.top()] = max ( a[st.top()] , a[t] );
                      }
                  }
              }
          }

        while ( !st.empty())
        {
            int t = st.top() ;
            a[t] = 0 ;
            st.pop() ;

        }

        memset ( tree , 0 , sizeof(tree)) ;
        long long  ans = 0 ;

        for ( int i = 0 ; i < n ; i++)
        {
            if ( a[i] != 0 )
            {
                /*if ( a[i] == 1 )
                {
                    ans = ans + i + 1 ;
                }
                */
                //else
                //{
                    ans = ans + i + 1 - ( 2 * sum ( a[i] - 1  ) )  ;
                     update ( a[i] ) ;
                //}
            }
           // update ( 1 , 1 , n , a[i] , 1 ) ;

        }

        cout << ans << endl ;
    }
    return 0 ;
}
