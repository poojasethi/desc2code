#include<bits/stdc++.h>
using namespace std;
#define ll long long
#define ull unsigned long long
#define pb push_back
#define ft first
#define se second
#define mp make_pair
ll *fenwick;
int n;
void update(int pos){
	while(pos<n){
		fenwick[pos]++;
		pos|=(pos+1);
	}
}
ll query(int pos){
	ll ans=0;
	while(pos>=0){
		ans+=fenwick[pos];
		pos=(pos& (pos+1))-1;
	}
	return ans;
}
int main(int argc, char const *argv[]){
    int t;
    scanf("%d", &t);
    while(t--){
    	scanf("%d", &n);
    	string s;
    	cin>>s;
    	stack<pair<int, int> >fr;
    	ll ans=0;
    	int step[n];
    	for(int i = 0; i < n; ++i) step[i]=0;

    	for(int i = 0; i < n; ++i){
    		int g;
    		if(s[i]=='7'){
    			if(fr.size()){
    				pair<int, int> pr=fr.top();
    				g=pr.ft;
    				step[i]=pr.se;
    				step[g]=pr.se;
    				fr.pop();
    				if(fr.size()) fr.top().se=max(fr.top().se, pr.se+1);
    			}
    		}
    		else fr.push(mp(i, 1));
    	}//for i

    	fenwick=new ll[n];


    	for(int z = 0; z < n; fenwick[z]=0, ++z); // for z
    	for(int i = 0; i < n; ++i){
    		if(!step[i]) continue;
    		if(s[i]=='4') ans+=(i+1-2*query(step[i]-1));
    		if(s[i]=='7') update(step[i]);
    	}//for i
    	printf("%lld\n", ans);
    }
	return 0;
}