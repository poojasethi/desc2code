
/*===============*\
|  ID: TMANDZU    |
|    LANG: C++    |
\*===============*/
//Tornike Mandzulashvili
//#pragma comment(linker,"/STACK:256000000")
#include <time.h>
#include <stdio.h>
#include <stdlib.h>
#include <algorithm>
#include <stack>
#include <math.h>
#include <vector>
#include <string>
#include <map>
#include <queue>
#include <iostream>
#include <set>
#include <cstring>

#define EPS 0.000000001
#define Pi 3.1415926535897932384626433832795028841971
#define hash1 1000003
#define hash2 1000033
#define md 1000000007
#define INF 1000000500ll
#define mp make_pair
#define pb push_back
#define S size()
#define MX(aa,bb) (aa>bb?aa:bb)
#define MN(aa,bb) (aa<bb?aa:bb)
#define fi first
#define se second
#define PI pair < ll ,ll  >
#define REP(i,a,n) for(i=a;i<n;i++)
#define sc scanf
#define pt prll f
#define big long long
#define VI vector <ll >
#define DID (long long)
#define ll long long
#define AL(a) (a).begin(),(a).end()
#define INFF DID INF*INF


using namespace std;

const ll  T=1e5 + 5 ;

ll  n,t,i,j,l;
vector <PI> M,v;
ll  mx[T],d[T];
string st;
ll ans;
ll  s[T];

ll  get(ll  x){
    ll  h=0;
    while (x){
        h+=s[x];
        x=x&(x-1);
    }
    return h;
}

ll  upd(ll  x){
    while (x<=100000){
        s[x]++;
        x=2*x-((x-1)&x);
    }
}

main()
{
    #ifndef ONLINE_JUDGE
            freopen("text.in","r",stdin); freopen("text.out","w",stdout);
    #endif

    ll  i;

    cin>>t;
    while (t--){
        v.clear();
        M.clear();
        cin>>n;
        cin>>st;
        l=0;
        for (i=0;i<n;i++){
            if (l==0){
                d[l++]=i;
                mx[l-1]=1;
            }else {
                if (st[d[l-1]]=='4' && st[i]=='7'){
                    v.pb(mp(d[l-1],i));
                    M.pb(mp(d[l-1],mx[l-1]));
                    if (l>1) mx[l-2]=MX(mx[l-2],mx[l-1]+1);
                    l--;
                }else {
                    d[l++]=i;
                    mx[l-1]=1;
                }
            }
        }

        for (i=0;i<=100000;i++)
        s[i]=0;
        ans=0;

        sort(M.begin(),M.end());

        for (i=0;i<M.S;i++){
            ans+=M[i].fi+1-get(M[i].se-1)*2;
            upd(M[i].se);
        }

        cout<<ans<<endl;
    }

}
