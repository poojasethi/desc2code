#include <cstdio>
#include <iostream>
#include <cstring>
#include <vector>

using namespace std;

int nTest;
int n;
char s[100010];
int f[100010];
pair<int, int> ll[100010];
vector<int> q[2];

void update(int i, int v) {
    for(; i <= n; i += i&-i) f[i] += v;
}
int get(int i) {
    int ret = 0;
    for(; i; i -= i&-i) ret += f[i];
    return ret;
}

int main() {
//    freopen("PPLUCKY.in", "r", stdin);
    
    for(scanf("%d", &nTest); nTest; nTest--) {
        scanf("%d", &n);
        scanf("%s", s+1);
        s[0] = s[n+1] = '@';
        q[0].clear(); q[1].clear();
        for(int i = 1; i <= n; i++) f[i] = 0;
        for(int i = 1; i <= n; i++) {
            update(i, 1);
            ll[i] = make_pair(i-1, i+1);
            if (s[i] == '4' && s[ll[i].second] == '7') q[0].push_back(i);
        }
        long long ret = 0;
        for(int ii = 0; q[ii].size(); ii^=1) {
            for(int id = 0; id < q[ii].size(); id++) {
                int i = q[ii][id];
                ret += get(i);
                ll[ll[i].first].second = ll[ll[i].second].second;
                ll[ll[ll[i].second].second].first = ll[i].first;
                if (s[ll[i].first] == '4' && s[ll[ll[i].first].second] == '7') q[ii^1].push_back(ll[i].first);
            }
            for(int id = 0; id < q[ii].size(); id++) {
                int i = q[ii][id];
                update(i, -1); update(ll[i].second, -1);
            }
            q[ii].clear();
        }
        printf("%lld\n", ret);
    }
    
    return 0;
}

