#include <vector>
#include <string>
#include <cstring>
#include <iostream>
#include <cstdio>
#include <cmath>
#include <algorithm>
#include <queue>
#include <stack>
#include <set>
#include <map>
#include <ctime>
using namespace std;
#define FOR(i,a,b) for(int i=a; i<=b; i++)
#define REP(i,a,b) for(int i=a; i>=b; i--)
#define FORAD(i,u) for(int i=0; i < (int)u.size(),i++)
#define BUG(x) cout << x << endl
#define ll long long
#define fi first
#define se second
#define pb push_back
#define two(i) 1 << i
#define sz(x) (int)x.size()
#define e 1e-12
#define bit(s,i) (s >> (i-1)) & 1
#define Nmax 100100
const double pi = acos(-1);
typedef vector<int> vi ;
typedef pair<int,int> pii ;
int n,t[Nmax],test,trc[Nmax],sau[Nmax],top,vt[Nmax];
string s ;
ll res ;

void up(int i ){
  while (i<=n){
     t[i]++;
     i+=i&(-i) ;
  }
}
int get(int i){
  int c = 0;
  while (i) {
    c+=t[i];
    i-=i&(-i) ;
  }
  return c ;
}

int main()
 {
     //freopen("PPLUCKY.INP","r",stdin);
    // freopen("PPLUCKY.OUT","w",stdout);
     scanf("%d\n",&test) ;
     while (test--){
      scanf("%d\n",&n) ;
      getline(cin,s) ;
      s = '@' + s + '@' ;
      FOR(i,1,n){
        trc[i] = i-1;
        sau[i] = i+1;
        t[i] = 0;
      }
      res = 0 ;
      int top = 0 ;
      FOR(i,1,n-1) if (s[i]=='4'&&s[i+1]=='7') vt[++top] = i;
     // cout << top << endl ;
      while (1) {
        if (top==0) break ;
        int top2 = 0 ;
        REP(i,top,1) {res+=vt[i]-2*get(vt[i]) ;up(vt[i]);}
        FOR(i,1,top) {
          int u = trc[vt[i]],v = sau[sau[vt[i]]] ;
          trc[v] = u;sau[u] = v;
          if (s[u]=='4'&&s[v]=='7') vt[++top2] = u ;
        }
        top = top2 ;
      }
      printf("%lld\n",res) ;
     }
     return 0;
 }
