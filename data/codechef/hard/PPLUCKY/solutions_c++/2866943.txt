#include<iostream>
#include<cstdio>
#define MAX(x,y) (x>y?x:y)
using namespace std;
int main()
{
    int t;
    scanf(" %d",&t);
    while(t--)
    {
        int n;
        char str[100001],stack[100001];
        int id[100001]={0},max[100001]={0};
        int turn[100001]={0};
        scanf(" %d",&n);
        scanf("%s",str);
        int i=0,top=0,nopop=0,maxpop=0;
        stack[0]=str[0];
        id[0]=1;
        max[0]=0;
        i++;
        while(i<n)
        {
            if(top!=-1 && stack[top]=='4' && str[i]=='7')
            {
               // cout<<"popping  "<<id[top]<<" at "<<i+1;
                nopop++;
                turn[id[top]]=max[top]+1;
             //   cout<<" turn "<<max[top]+1<<endl;
                top--;
                if(top>-1)
                max[top]=MAX(max[top+1]+1,max[top]);
           //     cout<<"max turn of "<<id[top]<<" is "<<max[top]<<endl<<endl;
            }
            else
            {
                if(nopop>maxpop)
                    maxpop=nopop;
                nopop=maxpop;
 
                top++;
                stack[top]=str[i];
                max[top]=0;
                id[top]=i+1;
            }
            i++;
        }
       /* i=1;
        while(i<=n)
        {
            cout<<turn[i]<<" ";
            i++;
        }*/
        long long ans=0;
 
  //      cout<<endl;
        int ttn[100001]={0};
        i=1;
        while(i<=n)
        {
            if(turn[i]!=0)
            {
                ans+=i;
                ttn[turn[i]]++;
                int j=1;
                int minus=0;
                while(j<turn[i])
                {
                    minus+=ttn[j];
                    //ans-=(ttn[j]*2);
                 //   cout<<"at "<<i<<" minus "<<ttn[j]<<endl;
                    j++;
                }
                ans-=(minus*2);
            }
            i++;
        }
        printf("%lld\n",ans);
 
    }
    return 0;
}
