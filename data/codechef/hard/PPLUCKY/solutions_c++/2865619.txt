#include <stdio.h>
#include <math.h>
#include <algorithm>
#include <set>
#include <map>
#include <queue>
#define MAXN 1000005
using namespace std;

struct ura{
    int x;
    char val;    
};

char C;
ura pila[MAXN];
int fin;
int N;
long long int answer;
int t;

int BIT[MAXN];

void update(int x ,int pos){
    for(;pos<=N;pos+=pos&-pos)
        BIT[pos]+=x;    
}

int query(int pos){
    int suma=0;
    for(;pos>0;pos-=pos&-pos)
        suma+=BIT[pos];
    return suma;     
}

void mete(char x,int pos){
    if(pila[fin].val=='4'&&x=='7'&&fin!=0){
        pila[fin-1].x=max(pila[fin].x+1,pila[fin-1].x);
        update(2,pila[fin].x+1);
        answer+=pos-1-query(pila[fin].x);   
        fin--; 
    }else{
        pila[++fin].val=x;  
        pila[fin].x=0;  
    }
}

int main(){
    scanf("%d",&t);
    while(t--){
        scanf("%d",&N);
        for(int i=1;i<=N;i++){
            scanf(" %c",&C);
            mete(C,i);    
        }    
        fin=0;
        printf("%lld\n",answer);
        answer=0;
        for(int i=1;i<=N;i++)
            BIT[i]=0;
    }
    return 0;
}
