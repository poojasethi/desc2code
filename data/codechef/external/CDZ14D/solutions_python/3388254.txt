#include <stdio.h>
#include <vector>
#define ull unsigned long long
using namespace std;
void solve()
{
	int n,x,q;
	vector<int> prime;
	scanf("%d%d%d",&n,&x,&q);
	int nn = n/x;
	for (int i = 2; i*i <= nn; i++) {
		if (nn%i == 0) {
			prime.push_back(i);
			while (nn%i == 0) nn /= i;
		}
	}
	if (nn > 1) prime.push_back(nn);
	int sz = prime.size();
	while (q--) {
		int l,r;
		scanf("%d%d",&l,&r);
		if (n%x != 0) {
			printf("0\n");
		}
		else {
			int ans = 0;
			for (int i = 0; i < 1<<sz; i++) {
				int cx = x;
				for(int j=0; j < sz; j++) if((i>>j)&1) cx *= prime[j];
				int cur = r/cx-(l-1)/cx;
				int pa = __builtin_popcount(i);
				pa = pa&1;
				if(pa) ans -= cur;
				else ans += cur;
			}
			printf("%d\n", ans);
		}
	}
}
int main()
{
	int t;
	scanf("%d",&t);

	while (t--) {
		solve();
	}
	return 0;
}
