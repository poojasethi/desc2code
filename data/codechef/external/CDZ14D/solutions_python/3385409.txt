// AUTHOR : SIKANDER MAHAN
// sikander_nsit
// PLAGIARISM IS BAD

#include <vector>
#include <list>
#include <map>
#include <set>
#include <deque>
#include <stack>
#include <bitset>
#include <algorithm>
#include <functional>
#include <numeric>
#include <utility>
#include <sstream>
#include <iostream>
#include <iomanip>
#include <cstdio>
#include <cmath>
#include <cstdlib>
#include <ctime>
#include<string.h>
#define tr(c,it) for(typeof(c.begin()) it=c.begin();it!=c.end();++it)
#define all(c) c.begin(),c.end()
#define mod 1000000007
#define itor(c) typeof(c.begin())
#define ll long long
#define vi vector<int>
#define vs vector<string>
#define si set<int>
#define msi multiset<int>
#define ii pair<int,int>
#define sii set<ii>
#define vii vector<ii>
#define vvi vector<vi>
#define pb push_back
#define mp make_pair

using namespace std;

int main()
{
    //ios::sync_with_stdio(false);
    //freopen("input.txt","r",stdin);
    //freopen("out.txt","w",stdout);
    ll t=0,i=0,j=0,n=0,m,k=0,num=0,temp=0,nx,ans2,ans1,prod,cnt,l,r,x;
    cin>>t;
    string str;
    ll p[1100];
    vector<ll> v;
    for(i=0;i<t;++i)
    {
        v.clear();
        cin>>n>>x>>m;
        nx=n;
        n/=x;
        bool sign[1100]={false};
        temp=n;
        ll sqrtn=sqrt(n);
        for(j=2;j<=sqrtn;++j)
        {
            if(temp%j==0)
            {
                v.pb(j);
                while(temp%j==0)
                    temp/=j;
            }
        }
        if(temp>1)
            v.pb(temp);
        num=1<<(v.size());
        for(j=0;j<num;++j)
        {
            cnt=0;
            k=0;
            temp=j;
            prod=1;
            while(temp>0)
            {
                if(temp&1)
                {
                    cnt=1-cnt;
                    prod*=v[k];
                }
                ++k;
                temp=temp>>1;
            }
            p[j]=prod;
            if(cnt)
                sign[j]=true;
        }
        n=nx;
        nx=n/x;
        for(j=0;j<m;++j)
        {
            cin>>l>>r;
            --l;
            l/=x;
            r/=x;
            if(n%x)
            {
                cout<<"0\n";
                continue;
            }
            ans1=ans2=0;
            for(k=0;k<num;++k)
            {
                if(sign[k])
                {
                    ans2-=r/p[k];
                    ans1-=l/p[k];
                }
                else
                {
                    ans2+=r/p[k];
                    ans1+=l/p[k];
                }
            }
            cout<<ans2-ans1<<endl;
        }
    }
	return 0;
}
