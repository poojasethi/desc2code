#pragma comment(linker, "/STACK:102400000,102400000")
#include <iostream>
#include <stdio.h>
#include <algorithm>
#include <string.h>
#include <vector>
#include <map>
#include <queue>
#include <set>
#include <cmath>
#include <fstream>
#include <assert.h>
#include <complex>
using namespace std;
#define vi vector<int>
#define pii pair<int,int>
#define pb push_back
#define mp make_pair
#define all(x) x.begin(),x.end()
#define inf 1000000007
#define mod 1000000007
#define x first
#define y second
#define pi acos(-1.0)
#define DBG(x) cerr<<(#x)<<"="<<x<<"\n";
#define FOREACH(it,x) for(__typeof(x.begin()) it=x.begin();it!=x.end();it++)
#define ull unsigned long long
#define ll long long
#define N 100010

int d[N],vis[N],dp[N],sz[N],a[N],p[N],f[N];
vi g[N],h[N];
void dfs(int u,int fa){
    sz[u]=1;
    dp[u]=d[u];
    for(int i=0;i<g[u].size();i++){
        int j=g[u][i];
        if(j==fa)continue;
        d[j]=d[u]+1;
        dfs(j,u);
        sz[u]+=sz[j];
        dp[u]=max(dp[u],dp[j]);
    }
    h[d[u]].pb(u);
}
int main()
{
    //freopen("1.txt","w",stdout);
    int T,i,j,k,ca=0,m,n;
    scanf("%d",&T);
    while(T--){
        scanf("%d",&n);
        for(i=1;i<=n;i++)g[i].clear(),vis[i]=0,h[i-1].clear();
        for(i=1;i<n;i++){
            scanf("%d%d",&j,&k);
            g[j].pb(k);g[k].pb(j);
        }
        scanf("%d",&m);
        for(i=0;i<m;i++)scanf("%d",&j),j--,vis[j]=1,a[i]=j;
        dfs(1,0);
        sort(a,a+m);
        for(i=n-1;i>=0;i--)if(vis[i]){
            for(j=0;j<h[i].size();j++){
                int u=h[i][j];
                if(dp[u]>=a[m-1]){
                    f[u]=sz[u];
                }
                else{
                    int x=lower_bound(a,a+m,dp[u]+1)-a;
                    int y=p[a[x]];
                    f[u]=sz[u]+f[y];
                }
            }
            int ans=inf;
            for(j=0;j<h[i].size();j++){
                int u=h[i][j];
                if(ans>f[u])ans=f[u],p[i]=u;
            }
        }
        printf("%d\n",f[p[a[0]]]);
    }
    return 0;
}