#include <bits/stdc++.h>
#define pb push_back
#define vi vector<long long>
#define ss second
#define ff first
#define pii pair<long long, long long>
#define dow(j) (1LL << j)

using namespace std;

int mks[200105][20], mini[200105][20];
int b[200105], a[200105];
int inf=1e9;

int main()
{
    for(int i=0; i<200105; i++)
        for(int j=0; j<20; j++)
            mini[i][j]=200100;
    for(int i=0; i<200105; i++)
        a[i]=inf;
    int n; cin>>n;
    for(int i=1; i<=n; i++)
        cin>>b[i], a[i]=b[i];
    for(int i=1; i<=n; i++)
        mks[i][0]=mini[i][0]=i;
    for(int j=1; dow(j)<=n; j++)
        for(int i=1; i<=n; i++)
        {
            mks[i][j]=b[mks[i][j-1]]>b[mks[i+dow(j-1)][j-1]]
            ? mks[i][j-1] : mks[i+dow(j-1)][j-1];
            mini[i][j]=a[mini[i][j-1]]<a[mini[i+dow(j-1)][j-1]]
            ? mini[i][j-1] : mini[i+dow(j-1)][j-1];
        }
    int q; cin>>q;
    cout<<setprecision(1)<<fixed;
    while(q--)
    {
        int l,r; cin>>l>>r;
        l++; r++;
        int k=log2(r-l+1);
        int kmin=min(b[mini[l][k]],b[mini[r-dow(k)+1][k]]);
        int bshin=max(b[mks[l][k]],b[mks[r-dow(k)+1][k]]);
        //cout<<b[mini[1][0]]<<" "<<kmin<<" "<<bshin<<" ";
        int ans=0;
        k=log2(l-1);
        if(l>1)
            ans+=max(b[mks[1][k]],b[mks[l-1-dow(k)+1][k]]);
        k=log2(n-r);
        if(r<n)
            ans=max(ans,max(b[mks[r+1][k]],b[mks[n-dow(k)+1][k]]));
        ans+=kmin;
        long double ansi=ans;
        if(kmin+(bshin-kmin)*0.5>ansi)
            ansi=kmin+(bshin-kmin)*0.5;
        cout<<ansi<<endl;
    }
}
