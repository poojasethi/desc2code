// winter is coming!
// never say I 
// Â© All rights reserved
// Author:Vineet Shah 
#define AIR 2074
#include<bits/stdc++.h>
//coz using iostream is too mainstream
#define rep(i,start,lim) for(i=start;i<=lim;i++)
#define wasnt_it_amazing 0
#define read(x) scanf("%lld",&x)
#define readchar(c) scanf(" %c",&c)
using namespace std;
long long n,m,x,y,i,a[100005],st[400005],st2[400005];
bool st3[400005],st4[400005];
void construct(long long low,long long high,long long pos)
{
	if(low==high)
	{
		st[pos]=a[low],st2[pos]=a[low],st3[pos]=true,st4[pos]=true;
		return;
	}
	long long mid=(high+low)/2;
	construct(low,mid,2*pos+1);
	construct(mid+1,high,2*pos+2);
	st[pos]=st[2*pos+1]+st[2*pos+2];
	st2[pos]=max(st2[2*pos+1],st2[2*pos+2]);
	st3[pos]=(a[mid]<=a[mid+1] && st3[2*pos+1] && st3[2*pos+2]);
	st4[pos]=(a[mid]>=a[mid+1] && st4[2*pos+1] && st4[2*pos+2]);
}
long long getsum(long long low,long long high,long long pos)
{
	if(x<=low && y>=high)
		return st[pos];
	if(x>high||y<low)
		return 0;
	long long mid=(high+low)/2;
	return getsum(low,mid,2*pos+1)+getsum(mid+1,high,2*pos+2);
}
void update(long long low,long long high,long long pos)
{
	if(x<low||x>high) return;
	if(low==high)
	{
		st[pos]=a[low];
		st2[pos]=a[low];
		return;
	}
	long long mid=(low+high)/2;
	update(low,mid,2*pos+1),update(mid+1,high,2*pos+2);
	st2[pos]=max(st2[2*pos+1],st2[2*pos+2]);
	st[pos]=st[2*pos+1]+st[2*pos+2];
	st3[pos]=(st3[2*pos+1]&&st3[2*pos+2]&&a[mid]<=a[mid+1]);
	st4[pos]=(st4[2*pos+1]&&st4[2*pos+2]&&a[mid]>=a[mid+1]);
}
long long maxquery(int low,int high,int pos)
{
	if(x<=low && y>=high)
		return st2[pos];
	if(x>high||y<low)
		return 0;
	long long mid=(low+high)/2;
	return max(maxquery(low,mid,2*pos+1),maxquery(mid+1,high,2*pos+2));
}
bool checkinc(long long low,long long high,long long pos)
{
	if(x<=low && y>=high)
		return st3[pos];
	if(x>high||y<low)
		return 1;
	long long mid=(low+high)/2;	
	return (checkinc(low,mid,2*pos+1)&&checkinc(mid+1,high,2*pos+2)&&(a[mid]<=a[mid+1]||mid<x||mid+1<x||mid>y||mid+1>y));
}
bool checkdec(long long low,long long high,long long pos)
{
	if(x<=low && y>=high)
		return st4[pos];
	if(x>high||y<low)
		return 1;
	long long mid=(low+high)/2;	
	return (checkdec(low,mid,2*pos+1)&&checkdec(mid+1,high,2*pos+2)&&(a[mid]>=a[mid+1]||mid<x||mid+1<x||mid>y||mid+1>y));
}
int main()
{
	read(n);read(m);
	char ch;
	rep(i,0,n-1) read(a[i]);
	construct(0,n-1,0);
	while(m--)
	{
		readchar(ch);read(x);read(y);
		if(ch=='U')
			--x,a[x]=y,update(0,n-1,0);
		else if(ch=='S')
			--x,--y,printf("%lld\n",getsum(0,n-1,0));
		else if(ch=='M')
			--x,--y,printf("%lld\n",maxquery(0,n-1,0));	
		else if(ch=='I')
			--x,--y,printf("%lld\n",(long long)checkinc(0,n-1,0));
		else
			--x,--y,printf("%lld\n",(long long)checkdec(0,n-1,0));
	}
	return wasnt_it_amazing;
}
//mast reh