#include <bits/stdc++.h>
using namespace std;
const int maxn = 1e5+10;
int t,n,m,k,id[maxn],cnt[maxn],test,r[maxn],c[maxn],l,ans,iid[maxn];
int getr(int x){
    if (id[x]!=test){
        id[x]=test;cnt[x]=1;r[x]=x;
    }
    return (x==r[x])?x:r[x]=getr(r[x]);
}
int main(){
    scanf("%d",&t);
    for (test=1; test<=t; test++){
        scanf("%d%d%d",&n,&m,&k);l=ans=0;
        for (int uu,vv,u,v,i=1; i<=m; i++){
            scanf("%d%d",&u,&v);
            uu=getr(u);vv=getr(v);
            if (uu!=vv){
                r[uu]=vv;
                cnt[vv]+=cnt[uu];
            }
        }
        for (int u,i=1; i<=n; i++){
            u=getr(i);
            if (iid[u]!=test){
                iid[u]=test;
                c[++l]=cnt[u];
            }
        }
        sort(c+1,c+l+1,greater<int>());
        for (int i=1; i<=min(l,k); i++) ans+=c[i];
        printf("%d\n",ans);
    }
}
