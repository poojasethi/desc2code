#include <stdio.h>
 
 
int minimum(int a,int b)
{
	return a<b?a:b;
}
 
 
int main()
{
	int t;
	scanf("%d",&t);
	int dash = 1000000;
	
	int n;
	
	int arr[60][60];
	
	int dist[60][60];
	
	int x,y,temp;
	
	char str[60];
	int i,j,k;
	
	int max;
	
	while(t--)
	{
		scanf("%d",&n);
		
		for(x=0;x<n;x++)
		{
			scanf("%s",str);
			for(y=0;y<n;y++)
			{
				if(str[y]>='0' && str[y]<='9')
				{
					arr[x][y] = str[y] - '0';
				}
				else if(str[y]>='a' && str[y]<='z')
				{
					arr[x][y] = 10 + str[y] - 'a';
				}
				else if(str[y]>='A' && str[y]<='Z')
				{
					arr[x][y] = 36 + str[y] - 'A';
				}
				else if(str[y] == '-')
				{
					arr[x][y] = dash;
				}
			}
		}
		
		
		for(k=0;k<n;k++)
		{
			for(i=0;i<n;i++)
			{
				for(j=0;j<n;j++)
				{
				    arr[i][j]=minimum(arr[i][j],arr[i][k]+arr[k][j]);
				}
			}
		}
		
		max = 0;
		
		for(x=0;x<n;x++)
		{
			for(y=0;y<n;y++)
			{
				if(arr[x][y]>max)
					max = arr[x][y];
			}
		}
		
		if(max == dash)
		{
			printf("-1\n");
		}
		else
		{
			printf("%d\n",max);
		}
		
		
		
	}
	return 0;
} 