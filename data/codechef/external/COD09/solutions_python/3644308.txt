#include<vector>
#include<cstring>
#include<algorithm>
#include<stdio.h>
#include<climits>
#include<set>
#include<cmath>
#include<list>
#include<bitset>
#include<map>
#include<iostream>
#include<queue>
#define test(t) while(t--)
#define s(n) scanf("%d",&n)
#define sl(n) scanf("%lld",&n)
 
#define p(n) printf("%d\n",n)
#define rep(i,a,n) for(i=a;i<=n;i++)
#define vi vector<int>
#define vii vector< vector<int> >
#define vpii vector< pair<int,int> >
#define mii map<int,int>
#define pb push_back
#define inf 1000000000LL
#define mp make_pair
#define imax (int) 1000000007
//#define inf 100000000
#define ill unsigned long long
#define gc getchar_unlocked
using namespace std;
int main()
{
	char str[51][51];
int dp[52][52];
	int tmp;
	int n;
	int t;
	s(t);
	while(t--)
	{
	s(n);
	int i,j;
	for(i=0;i<n;++i)
	{
		
		for(j=0;j<n;++j)
		{
			scanf(" %c",&str[i][j]);
			tmp=(int)str[i][j];
			if(tmp>=48 && tmp<=57)
			{
				dp[i][j]=tmp-48;
			}
			else if(tmp>=65 && tmp<=90)
			{
				dp[i][j]=tmp-29;
			}
			else if(tmp>=97 && tmp<=122)
			{
				dp[i][j]=tmp-87;
			}
			else
			{
				dp[i][j]=INT_MAX;
			}
		}
	}
/*	for(i=0;i<n;++i)
	{
		for(j=0;j<n;++j)
		{
			cout<<str[i][j];
		}
		cout<<"\n";
	}*/
	int k;
	for(k=0;k<n;++k)
	{
		for(i=0;i<n;++i)
		{
			for(j=0;j<n;++j)
			{
				if(dp[i][k]!=INT_MAX && dp[k][j]!=INT_MAX && i!=j)
				{
					dp[i][j]=min(dp[i][j],dp[i][k]+dp[k][j]);
				}
			}
		}
	}
/*	for(i=0;i<n;++i)
	{
		for(j=0;j<n;++j)
		{
			cout<<dp[i][j]<<" ";
		}
		cout<<"\n";
	}*/
int ans;
	ans=0;
	for(i=0;i<n;++i)
	{
		for(j=0;j<n;++j)
		{
			//cout<<dp[i][j];
			if(i!=j)
			{
			ans=max(ans,dp[i][j]);
		    }
		}
		
	}
	if(ans==INT_MAX)
	printf("-1\n");
	else
	printf("%d\n",ans);
   }
} 