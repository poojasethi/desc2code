#include<bits/stdc++.h>
using namespace std;

typedef long long ll;
typedef pair<int, int> pi;
typedef pair<ll, ll> pl;

ll x, MOD;

ll mul(ll a, ll b){
    a %= MOD;
    b %= MOD;
    ll ret = 0;
    while(b > 0){
        if(b & 1) {
            ret += a;
            ret %= MOD;
        }
        b >>= 1;
        a <<= 1;
        a %= MOD;
    }
    return ret;
}

/*long long pw (ll p){
    if (!p) return 1;
    ll ret = pw(p/2);
    if (p&1) return mul(mul(ret, ret), x);
    return mul(ret, ret);
}*/

pl Solve (ll m){
    if (!m)
        return pl(1, 1);
    ll p = m/2;
    pl ans = Solve(p);
    ll curPow1 = ans.second;
    ll curPow = mul(curPow1, curPow1);
    if(m & 1){
        curPow = mul(curPow, x);
    }
    ll nextPow = mul(curPow, x);
    ll pans = mul(ans.first, mul(curPow1, x));


    if (!(m&1)) {
        return pl(((ans.first + pans)%MOD - nextPow + MOD)%MOD, curPow);
    }
    return pl((ans.first + pans)%MOD, curPow);
}

int main() {
#ifndef ONLINE_JUDGE
    freopen("in.in", "r", stdin);
#endif
    //double S = clock();
    int T;
    cin >> T;
    while (T --){
        ll m;
        cin >> x >> m >> MOD;
        //x--, m--;
        x %= MOD;
        //Solve(m);
        cout << Solve(m).first << endl;
    }
    //cout << (clock() - S) / CLOCKS_PER_SEC << endl;
    return 0;
}

