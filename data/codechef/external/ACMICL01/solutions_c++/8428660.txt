#include<bits/stdc++.h>
#define itn int
using namespace std;
typedef long long ll;
ll powmod(ll a,ll b,ll mod) {ll res=1;if(a>=mod)a%=mod;for(;b;b>>=1){if(b&1)res=res*a;if(res>=mod)res%=mod;a=a*a;if(a>=mod)a%=mod;}return res;}
ll gcd(ll a , ll b){return b==0?a:gcd(b,a%b); }
int main()
{
	ios_base::sync_with_stdio(false);cin.tie(0);
	ll t,a,b,p,g,s,A,B;
	cin>>t;
	while(t--)
	{
		cin>>p>>g;
		cin>>a>>b;
		A=powmod(g,a,p);
		s=powmod(A,b,p);
		cout<<s<<endl;
	}
}
