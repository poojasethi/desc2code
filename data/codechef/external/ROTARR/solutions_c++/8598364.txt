#include<bits/stdc++.h>
using namespace std;
int a[100005];
int cat[320][100005];
int lazy[320];
int main()
{
	int n,q;
	scanf("%d%d",&n,&q);
	int b=sqrt(n)+1;
	for(int i=0;i<n;i++)
	scanf("%d",&a[i]);
	int j=0;
	for(int i=0;i<n;i++)
	{
		if(i%b==0&&i)
		++j;
		cat[j][a[i]]++;
	}
	while(q--)
	{
		int t,l,r,x;
		scanf("%d%d%d%d",&t,&l,&r,&x);
		int bl=l/b;
		int br=r/b;
		if(t==1)
		{
	       for(int i=l;i<=r;i++)
	       {
	       	 if(i%b==0&&i!=l)
	       	 break;
	       	 cat[bl][a[i]]--;
	       	 a[i]=a[i]+x;
	       	 if(a[i]>=n)
	       	 a[i]-=n;
	       	 cat[bl][a[i]]++;
	       }
	       for(int i=bl+1;i<br;i++)
	       {
	       	lazy[i]=lazy[i]+x;
	       	if(lazy[i]>=n)
	       	lazy[i]-=n;
	       }
	       if(br>bl)
	       {
	       	for(int i=br*b;i<=r;i++)
	       {
	       cat[br][a[i]]--;
	       	 a[i]=a[i]+x;
	       	 if(a[i]>=n)
	       	 a[i]-=n;
	       	 cat[br][a[i]]++;
	       }
	       }
		}
		else
		{
			int ans=0;
			int z=x-lazy[bl];
			if(z<0)
			z+=n;
			for(int i=l;i<=r;i++)
			{
				if(i!=l&&i%b==0)
				break;
				if(a[i]==z)
				ans++;
			}
			for(int i=bl+1;i<br;i++)
			{
				z=x-lazy[i];
				if(z<0)
				z+=n;
				ans+=cat[i][z];
			}
			if(bl<br)
			{
				z=x-lazy[br];
				if(z<0)
				z+=n;
				for(int i=br*b;i<=r;i++)
				{
					if(a[i]==z)
					ans++;
					
				}
			}
			printf("%d\n",ans);
		}
	}
}