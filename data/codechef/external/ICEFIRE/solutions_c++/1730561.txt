#include<iostream>
using namespace std;
int a[110][110][110];
int fun(int base,int pow,int modu)
{
    if(pow==0)
    return 1;
    else if(pow%2==0)
    {
        int x=(fun(base,pow/2,modu))%modu;
        return x*x%modu;
    }
    else
    {
        int x=(fun(base,pow/2,modu)%modu);
        return (x*x%modu)*base%modu;
    }
}
int main()
{
    int t;
    cin>>t;
    while(t--)
    {
        char input[110][110];
        int n,m,p,b[110][110];
        cin>>n>>m;
        int c1,c2;
        c1=-1;c2=1;
        for(int i=0;i<n;i++)
        {
            for(int j=0;j<m;j++)
            {
                cin>>input[i][j];
                if(input[i][j]=='F')
                {
                    b[i][j]=c1--;
                }
                if(input[i][j]=='I')
                {
                    b[i][j]=c2++;
                }
            }

        }
        cin>>p;
        if(c2==1)
        cout<<"1"<<endl;
        else
        {
            for(int i=0;i<n;i++)
            {
                for(int j=0;j<m;j++)
                {
                    if(b[i][j]>0)
                    b[i][j]=fun(b[i][j],(i+j),p);
                    else
                    b[i][j]=-fun((-b[i][j]),(i+j),p);
                    a[0][i][j]=b[i][j];
                }
            }
            for(int i=1;i<n;i++)
            {
                for(int j=0;j<n-i;j++)
                {
                    for(int k=0;k<m;k++)
                    {
                        a[i][j][k]=a[i-1][j][k]+b[j+i][k];
                    }
                }
            }

            int ans,max=0;
            for(int i=0;i<n;i++)
            {
                for(int j=0;j<n-i;j++)
                {
                    int currsum=0,x=0;
                    for(int k=0;k<m;k++)
                    {
                        currsum+=a[i][j][k];
                        if(currsum>max)
                        {
                            max=currsum;
                            ans=(i+1)*(k-x+1);
                        }
                        else if(currsum==max)
                        {
                            if((i+1)*(k-x+1)>ans)
                            ans=(i+1)*(k-x+1);
                        }
                        else if(currsum<0)
                        {
                            x=k+1;
                            currsum=0;
                        }
                    }
                }
            }
            cout<<ans<<endl;
        }
    }
    return 0;
}
