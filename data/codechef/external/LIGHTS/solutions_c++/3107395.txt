#include<cstdio>
#include<cstdlib>
#include<cstring>
#include<algorithm>
#include<iostream>
#include<vector>
#include<list>
#include<set>
#include<deque>
#include<cmath>
#include<map>
#include<queue>
#include<cassert>
#include<numeric>
#define eprintf(...) fprintf(stderr, __VA_ARGS__)
#define FOR(i,j,k,l) for(((i)=(j));((i)<(k));((i)+=(l)))
#define REP(i,n) for((i)=0;(i)<(n);(i)++)
#define ABS(x) (((x)>=0)?((x)):(-(x)))
#define SWAP(x,y) do{x^=y;y^=x;x^=y;}while(0)
#define MIN(a,b) (((a)<(b))?(a):(b))
#define MAX(a,b) (((a)>(b))?(a):(b))
#define VLL vector<long long int>
#define VI vector<int>
#define PB push_back
#define POB pop_back
#define PII pair<int, int>
#define PLL pair<long long int,long long int>
#define VPII vector<pair<int, int> >
#define VPLL vector<PLL>
#define SI(x) scanf("%d",&(x))
#define SLL(x) scanf("%lld",&(x))
#define PI (3.141592654)
typedef long long int ll;
typedef long double ld;
 
#define MOD (1000000007)
#define FEQ(x,y) (ABS((x)-(y))<0.000002)
using namespace std;
void precompute(){
  int i,j,k;
  
}
int main(){
  ll i,j,k,x,y,z,n,m;
  ll nin,inum;
  precompute();
  scanf("%lld",&nin);
  FOR(inum, 0,nin,1){
    //each test case
    SLL(n);SLL(m);
	SLL(k);
	VI rc(n,0);
	ll tot=0;
	REP(i,n){
		scanf("%*[ \n\r\t\f]");
		REP(j,m){
			char c=getchar();
			if(c=='.'){
				rc[i]++;
			}else rc[i]--,tot++;
		}
	}
	sort(rc.begin(),rc.end());
	reverse(rc.begin(),rc.end());
	ll ans=0;
	int pos=0;int flag=0;
	REP(i,min(n,k)){
		if(rc[i]>0){
			ans+=rc[i];
			rc[i]=-rc[i];
			pos++;
		}else{
			break;
		}
	}

			int leftv=k-pos;
			if(!(leftv&1));
			else{
				flag=1;
			}
	int xx=*max_element(rc.begin(),rc.end());
	if(!flag)xx=0;
	printf("%lld\n",ans+tot+xx);
  }
  
  return 0;
}
