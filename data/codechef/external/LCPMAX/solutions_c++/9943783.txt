#include<bits/stdc++.h>
using namespace std;
#define f first
#define s second
#define mp make_pair
#define pb push_back
#define pii pair<int,int>
#define ll long long
#define mod 1000000007LL
#define all(v) v.begin(),v.end()
#define inf 1000000000
string sa[1000111];
string sb[1000111];
int mna[1000111][11];
int mnb[1000111][11];

ll c[2][1000111][15];
ll c1[2][1000111][15];
ll ca[2][15],cb[2][15];
int my[2000];
ll pw[1000111];
ll pw1[1000111];


int main()
{
    ll t;
    pw[0]=1LL;
    for(int i=1; i<=1000000; i++)
        pw[i]=pw[i-1]*37;

    pw1[0]=1LL;
    for(int i=1; i<=1000000; i++)
        pw1[i]=pw1[i-1]*41;
    scanf("%lld",&t);
    while(t--)
    {
        string a,b;
        int i,j,k,l,n,q;
        scanf("%d %d",&n,&q);
        cin>>a>>b;
        sa[n]="abcdefghij";
        for(i=0; i<n; i++)
            sa[i]="",sb[i]="";
        for(i=n-1; i>=0; i--)
        {
            for(j=0; j<10; j++)
                if(sa[i+1][j]==a[i])
                    break;
            sa[i]=a[i]+sa[i+1].substr(0,j)+sa[i+1].substr(j+1,9-j);
        }
        for(i=0; i<10; i++)
            mna[n][i]=n;
        for(i=n-1; i>=0; i--)
        {
            for(j=0; j<10; j++)
                mna[i][j]=mna[i+1][j];
            mna[i][a[i]-'a']=i;
        }
        for(i=0; i<10; i++)
            mnb[n][i]=n;
        for(i=n-1; i>=0; i--)
        {
            for(j=0; j<10; j++)
                mnb[i][j]=mnb[i+1][j];
            mnb[i][b[i]-'a']=i;
        }

        sb[n]="abcdefghij";
        for(i=n-1; i>=0; i--)
        {
            for(j=0; j<10; j++)
                if(sb[i+1][j]==b[i])
                    break;
            sb[i]=b[i]+sb[i+1].substr(0,j)+sb[i+1].substr(j+1,9-j);
        }
//        for(i=0;i<n;i++)
//            cout<<sa[i]<<endl;
//        for(i=0;i<n;i++)
//            cout<<sb[i]<<endl;
        for(i=0; i<10; i++)
            c[0][0][i]=0LL;
        c[0][0][a[0]-'a']=1LL;
        for(i=1; i<n; i++)
        {
            for(j=0; j<10; j++)
                c[0][i][j]=c[0][i-1][j]*37;
            c[0][i][a[i]-'a']++;
        }
        for(i=0; i<10; i++)
            c1[0][0][i]=0LL;
        c1[0][0][b[0]-'a']=1LL;
        for(i=1; i<n; i++)
        {
            for(j=0; j<10; j++)
                c1[0][i][j]=c1[0][i-1][j]*37;
            c1[0][i][b[i]-'a']++;
        }
        for(i=0; i<10; i++)
            c[1][0][i]=0LL;
        c[1][0][a[0]-'a']=1LL;
        for(i=1; i<n; i++)
        {
            for(j=0; j<10; j++)
                c[1][i][j]=c[1][i-1][j]*41;
            c[1][i][a[i]-'a']++;
        }
        for(i=0; i<10; i++)
            c1[1][0][i]=0LL;
        c1[1][0][b[0]-'a']=1LL;
        for(i=1; i<n; i++)
        {
            for(j=0; j<10; j++)
                c1[1][i][j]=c1[1][i-1][j]*41;
            c1[1][i][b[i]-'a']++;
        }
//        for(i=0;i<n;i++)
//        {
//            for(j=0;j<10;j++)
//                printf("%lld ",c1[i][j]);
//            printf("\n");
//        }
        while(q--)
        {
            int l,r;
            scanf("%d %d",&l,&r);
            l--;
            r--;
            for(i=0; i<10; i++)
                my[i]=i;
            for(i=0; i<10; i++)
                my[sa[l][i]-'a']=sb[r][i]-'a';
            int l1=1,r1=min(n-l,n-r);
            int ans=1;
            while(l1<=r1)
            {
                int mid=(l1+r1)/2;
                int f=0;
                //cout<<mid<<endl;
                for(i=0; i<10; i++)
                    ca[0][i]=c[0][l+mid-1][i];
                if(l!=0)
                    for(i=0; i<10; i++)
                        ca[0][i]-=(c[0][l-1][i]*pw[mid]);
                for(i=0; i<10; i++)
                    cb[0][i]=c1[0][r+mid-1][i];
                if(r!=0)
                    for(i=0; i<10; i++)
                        cb[0][i]-=(c1[0][r-1][i]*pw[mid]);

                for(i=0; i<10; i++)
                    ca[1][i]=c[1][l+mid-1][i];
                if(l!=0)
                    for(i=0; i<10; i++)
                        ca[1][i]-=(c[1][l-1][i]*pw1[mid]);
                for(i=0; i<10; i++)
                    cb[1][i]=c1[1][r+mid-1][i];
                if(r!=0)
                    for(i=0; i<10; i++)
                        cb[1][i]-=(c1[1][r-1][i]*pw1[mid]);


//                for(i=0;i<10;i++)
//                    printf("%lld ",ca[i]);
//                printf("\n");
//                for(i=0;i<10;i++)
//                    printf("%lld ",cb[i]);
//                printf("\n");


                ll ans1=0LL;
                for(i=0; i<10; i++)
                    ans1+=(ca[0][i]*(my[i]+1));
                ll ans2=0LL;
                for(i=0; i<10; i++)
                    ans2+=(cb[0][i]*(i+1));
                ll ans11=0LL;
                for(i=0; i<10; i++)
                    ans1+=(ca[1][i]*(my[i]+1));
                ll ans21=0LL;
                for(i=0; i<10; i++)
                    ans2+=(cb[1][i]*(i+1));

                //cout<<ans1<<" "<<ans2<<endl;
                if(ans1==ans2&&ans11==ans21)
                    ans=max(ans,mid),l1=mid+1;
                else
                    r1=mid-1;
            }
            vector<int>v1;
            printf("%d ",ans);
            for(i=0; i<10; i++)
                if(mnb[r][i]>=r+ans)
                    v1.pb(i);
            j=0;
            for(i=0; i<10; i++)
                if(mna[l][i]>=l+ans)
                {
                    printf("%c",'a'+v1[j]);
                    j++;
                }
                else
                    printf("%c",'a'+my[i]);
            printf("\n");
        }
    }
    return 0;
}
