#include <cstdio>
#include <cstdlib>
#include <algorithm>
#include <queue>
#include <cmath>
#include <cstring>
#include <iostream>
#include <stack>
#include <map>
#include <vector>
#include <utility>
#include <set>

#define MOD (1000000007)
#define MAXINT 1e9
#define EPS (1e-9)
#define mp   make_pair
#define pb   push_back
#define fi   first
#define se   second
#define pii  pair<int,int> 
#define pll  pair<long long,long long> 

using namespace std;
typedef long long int ll;

ll work(ll l,ll r,ll p)
{
	ll i,ans=0;
	for(i=l;i<=r;i++)
	{
		if((i*i*i)%p==1)
			ans++;
	}
	return ans;
}

int main()
{
	ll test,a,b,p,x,y,i,ans;
	pair<ll,ll> f,s;
	cin>>test;
	while(test--)
	{
		cin>>a>>b>>p;
		x=a/p;
		y=a%p;
		f=mp(x,y);
		x=b/p;
		y=b%p;
		s=mp(x,y);
		if(p==1)	{cout<<0<<endl;continue;}
		if(f.fi==s.fi)
			ans=work(f.se,s.se,p);
		else
			ans=work(f.se,p-1,p)+(work(0,p-1,p)*(s.fi-f.fi-1))+work(0,s.se,p);
		cout<<ans<<endl;
	}
	return 0;
}