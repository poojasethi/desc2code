#include <cstdio>
#include <cstring>
#include <algorithm>
using namespace std;
 
typedef long long ll;
const int N = 100005;
 
int t, n;
ll a[N];
 
struct Node {
    ll v;
    int id;
    Node() {}
    Node (ll v, int id) {
        this->v = v;
        this->id = id;
    }
} S[N];
 
int left[N], right[N];
 
int main() {
    scanf("%d", &t);
    while (t--) {
        scanf("%d", &n);
        for (int i = 1; i <= n; i++)
            scanf("%lld", &a[i]);
        S[0].id = 0;
        int top = 0;
        for (int i = 1; i <= n; i++) {
            while (top && S[top].v > a[i]) top--;
            left[i] = S[top].id;
            S[++top] = Node(a[i], i);
        }
        S[0].id = n + 1;
        top = 0;
        for (int i = n; i >= 1; i--) {
            while (top && S[top].v >= a[i]) top--;
            right[i] = S[top].id;
            S[++top] = Node(a[i], i);
        }
        ll ans = 0;
        for (int i = 1; i <= n; i++)
            ans += (ll)(i - left[i]) * (right[i] - i) * a[i];
        printf("%lld\n", ans);
    }
    return 0;
}
 