#include <cstdio>
#include <cstring>
#include <algorithm>
#include <cmath>
#include <cstdlib>
using namespace std;
typedef long long ll;
const int INF = 0x3f3f3f3f;
const int N = 1e5 + 10;
struct Node {
	int id;
	ll v;
	Node() {}
	Node(int _id, ll _v) {
		this->id = _id;
		this->v = _v;
	}
}st[N];
ll a[N], left[N], right[N];
int main() {
	int T, n;
	scanf("%d", &T);
	while(T--) {
		scanf("%d", &n);
		for(int i = 1; i <= n; i++)
			scanf("%lld", &a[i]);
		int top = 0;
		st[0] = Node(0, 0);
		for(int i = 1; i <= n; i++) {
			while(top && st[top].v > a[i])
				top--;
			left[i] = st[top].id;
			st[++top] = Node(i, a[i]);
		}
		st[0].id = n+1;
		top = 0;
		for(int i = n; i >= 1; i--) {
			while(top && st[top].v >= a[i])
				top--;
			right[i] = st[top].id;
			st[++top] = Node(i, a[i]);
		}
		ll ans = 0;
		for(int i = 1; i <= n; i++) {
			ans += (ll)(right[i]-i) * (i-left[i]) * (a[i]);
		}
		printf("%lld\n", ans);
	}
	return 0;
}