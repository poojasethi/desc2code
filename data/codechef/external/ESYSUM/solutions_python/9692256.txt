#include <bits/stdc++.h>
using namespace std;

#define ll unsigned long long
#define dd double
#define ff first
#define ss second
#define pb(x) push_back(x)
#define mp(x,y) make_pair(x,y)
#define vi vector<ll>
#define pii pair<ll,ll>
#define vpi vector<pair<ll,ll> >
#define reset(a,b) memset(a,b,sizeof(a))
#define modu 1000000007
#define inf INT_MAX
#define fastio ios_base::sync_with_stdio(0);cin.tie(NULL);cout.tie(NULL)

const ll modulo=274877906944ULL;
ll has[1000004];

int main(){
    fastio;
    ll t;
    cin>>t;
    while(t--){
        register ll a,d,x,n,i,j,k,p,q,l,sum=0;
        cin>>a>>d>>n>>x;
        has[0]=1;
        for(i=1;i<=n;i++){
            has[i]=(has[i-1]*x)%modulo;
        }
        for(i=0;i<=n;i++){
            p=(((a+(i*d)%modulo)%modulo)*(has[n-i]))%modulo;
            sum=(sum+p)%modulo;
        }
        cout<<sum<<endl;
    }
    return 0;
}
//11545686822
