#include <iostream>
#define ll long long int
#define fix 274877906944
 
using namespace std;
 
 ll X[1000005];
 
int main() {
	// your code goes here
	ios_base::sync_with_stdio(false);
	cin.tie(0),cout.tie(0);
	register unsigned ll n,a,d,x,sum;
	long i;
	int t;
	cin>>t;
    while(t--)
    {
       cin>>a>>d>>n>>x;
       sum=0;
       X[0]=1;
       for(i=1;i<=n+1;i++)
	   X[i]=(X[i-1]%fix*x%fix)%fix;
       for(i=0;i<=n;i++)
       {
           sum=((sum%fix)+(((a%fix+((i%fix)*(d%fix))%fix)%fix)%fix*X[n-i])%fix)%fix;
       }
       cout<<sum%fix<<"\n";
    }
	return 0;
} 
