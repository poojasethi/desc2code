#include<bits/stdc++.h>
using namespace std;
#define ll long long
ll a[1003][1003],dp1[10003][1003],dp2[1003][1003];
int main()
{
	int i,j,k,n,m,p;
	cin>>n>>m>>p;
	p=-p;
	for(i=0;i<=n+1;i++)
	for(j=0;j<=m+1;j++)
	{
		dp1[i][j]=-1e9;
		dp2[i][j]=-1e9;
	}
	
	for(int i=1;i<=n;i++)
	{
		for(int j=1;j<=m;j++)
		cin>>a[i][j];
	}
	
	dp1[1][1]=a[1][1];
	
	for(j=2;j<=m;j++)
	dp1[1][j]=dp1[1][j-1]+a[1][j];
	
	for(i=2;i<=n;i++)
	dp1[i][1]=dp1[i-1][1]+a[i][1];
	
	for(int i=2;i<=n;i++)
	{
		for(int j=2;j<=m;j++)
		{
			dp1[i][j]=max(dp1[i-1][j],dp1[i][j-1]) +a[i][j];
		}
	}
	
	dp2[n][m]=a[n][m];
	for(j=m-1;j>=1;j--)
	dp2[n][j]=dp2[n][j+1]+a[n][j];
	
	for(i=n-1;i>=1;i--)
	dp2[i][m]=dp2[i+1][m]+a[i][m];
	
	for(int i=n-1;i>=1;i--)
	{
		for(int j=m-1;j>=1;j--)
		{
			dp2[i][j]=max(dp2[i+1][j],dp2[i][j+1]) +a[i][j];
		}
	}
/*	cout<<endl;
	for(i=1;i<=n;i++)
	{
		for(j=1;j<=m;j++)
		cout<<dp1[i][j]<<" ";
		cout<<endl;
	}
		cout<<endl;
	for(i=1;i<=n;i++)
	{
		for(j=1;j<=m;j++)
		cout<<dp2[i][j]<<" ";
		cout<<endl;
	}
		cout<<endl;
*/		
	
	ll mx=dp2[1][1];
	//cout<<"ans="<<ans<<endl;
	for(i=2;i<=n;++i)
    {
        for(j=2;j<=m;++j)
        {
           
 
            if(j>=2 && i>=2) mx = max(mx,dp1[i][j-1]+a[i-1][j]+dp2[i][j]+p); // go up and come back
            if(j>=2 && i>=2 && j<m) mx = max(mx,dp1[i][j-1]+a[i][j]+a[i-1][j]+dp2[i-1][j+1]+p);// go up then right
             
            if(i>=2 && j>=2) mx = max(mx,dp1[i-1][j]+a[i][j-1]+dp2[i][j]+p);// go left and come back
            if(i>=2 && j>=2 && i<n) mx = max(mx,dp1[i-1][j]+a[i][j]+a[i][j-1]+dp2[i+1][j-1]+p); // go left then go down
             
            if(j>=2 &&i>=1&& i<n) mx = max(mx,dp1[i-1][j]+a[i][j]+a[i][j+1]+dp2[i+1][j]+p);//come right and go back
            
            if(j>=2 && i<n && j<m) mx = max(mx,dp1[i][j]+a[i+1][j]+dp2[i][j+1]+p);//come down and go back
            
           
        }
    }
	cout<<mx<<endl;
}