#include<bits/stdc++.h>
using namespace std;
#define fast cin.sync_with_stdio(0);cin.tie(0)
#define pii pair<int,int>
#define ff first
#define ss second
#define mp make_pair
#define pb push_back
#define INF 99999999
#define N 1005
#define ll long long
#define llu unsigned long long 
#define MOD 1000000007
#define gcd __gcd
#define fill(A,v) memset(A,v,sizeof(A))
#define all(x) (x).begin(), (x).end()
ll dp1[N][N];
ll dp2[N][N];
ll arr[N][N];
ll ans[N][N];
ll max(ll a,ll b)
{
	return a>b?a:b;
}	
int main() {
	int n,m,p,i,j;
	ll maxi=-100000000000000000;
	scanf("%d%d%d",&n,&m,&p);
	for(i=0;i<1005;i++)
	  for(j=0;j<1005;j++)
	    dp1[i][j]=-1000000000000000;
	for(i=1;i<=n;i++)
	  for(j=1;j<=m;j++)
	    scanf("%lld",&arr[i][j]);
	dp1[n][m]=arr[n][m];
	for(i=n-1;i>=1;i--)
	{
	  dp1[i][m]=arr[i][m]+dp1[i+1][m];
	}  
	for(i=m-1;i>=1;i--)
	{
	  dp1[n][i]=arr[n][i]+dp1[n][i+1];
	}  
	for(i=n-1;i>=1;i--)
	{
		for(j=m-1;j>=1;j--)
		{
			dp1[i][j]=arr[i][j]+max(dp1[i][j+1],dp1[i+1][j]);
			
		}
	}
	dp2[1][1]=arr[1][1];
	for(i=2;i<=n;i++)
	{
	  dp2[i][1]=arr[i][1]+dp2[i-1][1];
	} 
	 for(i=2;i<=m;i++)
	 {
	   dp2[1][i]=arr[1][i]+dp2[1][i-1];
	 } 
	 
	 for(i=2;i<=n;i++)
	 {
	 	for(j=2;j<=m;j++)
	 	{
	 		dp2[i][j]=arr[i][j]+max(dp2[i-1][j],dp2[i][j-1]);
	 	}
	 }
	 for(i=1;i<=n;i++)
	 {
	 	for(j=1;j<=m;j++)
	 	{
	 		ans[i][j]=dp1[i][j]+dp2[i][j]-arr[i][j];
	 		if(i-1>=1)
	 		{
	 		   if(j-1>=1)
	 		    ans[i][j]=max(ans[i][j],dp2[i][j-1]+arr[i][j]+arr[i-1][j]-p+max(dp1[i-1][j+1],max(dp1[i+1][j],dp1[i][j+1])));
	 		    
	 		    ans[i][j]=max(ans[i][j],dp2[i-1][j]+arr[i][j]-p+max(dp1[i-1][j+1],max(dp1[i+1][j],dp1[i][j+1])));
	 		  
	 		}   
	 		if(j-1>=1)
	 		{
	 			if(i-1>=1)
	 		   ans[i][j]=max(ans[i][j],dp2[i-1][j]+arr[i][j]+arr[i][j-1]-p+max(dp1[i+1][j-1],max(dp1[i][j+1],dp1[i+1][j])));
	 		   //if(i==3&&j==2)
	 		     //cout<<dp2[i-1][j]<<" "<<arr[i][j]<<" "<<arr[i][j-1]<<" "<<max(dp1[i+1][j-1],dp1[i][j+1])<<"\n";
	 		   ans[i][j]=max(ans[i][j],dp2[i][j-1]+arr[i][j]-p+max(dp1[i+1][j-1],max(dp1[i][j+1],dp1[i+1][j])));
	 		}	     
	 	}
	 }
	 for(i=1;i<=n;i++)
	 {
	   for(j=1;j<=m;j++)
	   {
	   	  //printf("%lld ",ans[i][j]);
	     maxi=max(maxi,ans[i][j]);
	   }
	   //printf("\n");
	 }  
	 printf("%lld\n",maxi);    
	return 0;
}