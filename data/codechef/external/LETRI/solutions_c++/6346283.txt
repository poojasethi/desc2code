#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <math.h>
#include <assert.h>
long long fun(long long x){
    long long s=0;
    while(x){
        s=s+x%10;
        x = x/10;
    }
    if(s>9)
        s=fun(s);
    return s;
}
int gcd(int a,int b){
    if(a%b==0)
        return b;
    else
        return gcd(b,a%b);
}
int main(){
    int t;
    scanf("%d",&t);
    while(t--){
        long long a,b,p,c,i;
        scanf("%lld %lld %lld %lld",&a,&b,&c,&p);
        long long x=a%9,ans=1,count;
        while(b>0){
            if(b%2==1) ans=(ans*x)%9;
                ans=(ans*ans)%9;
            b/=2;
        }
        p += fun(ans);           
        long long j=1,k,l,m;
        x = p/c; x--;       
        ans = x+1;x--; 
        for(i=2*c;i<=p;i+=c){
             l = j+1;
             k = (x)/l;  l=0;  
             
             if(l==0){
                 k=0;
                 for(m=i+c;m<=p;m+=c){
                     if(gcd(i,m)!=c)
                         k++;
                 }
             }
             ans += x-k;
             x--;
             j++;   
                
        }
          printf("%d\n",ans);     
    }
    return 0;
} 