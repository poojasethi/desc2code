#include <bits/stdc++.h>
#define _ ios_base::sync_with_stdio(false);cin.tie(0);
using namespace std;
#define pb push_back
#define pob pop_back
#define pf push_front
#define pof pop_front
#define mp make_pair
#define all(a) a.begin(),a.end()
#define bitcnt(x) __builtin_popcountll(x)
#define MOD 1000000007
#define MOD2 100000
#define MAXN 100002
#define BLOCK 800
#define BASE 31
typedef unsigned long long int uint64;
typedef long long int int64;
 
struct Query{
	int l,r,id;
};
vector<Query>v;

bool cmp(Query a,Query b){
	if((a.l/BLOCK)!=(b.l/BLOCK))
	return (a.l/BLOCK)<(b.l/BLOCK);
	return a.r<b.r;
}
int BIT[100006];
int a[100005];
int64 ans=0;
int k;
int64 store[100006];

void upd(int x,int val){
	for(int i=x;i<=100002;i+=i&(-i))
	BIT[i]+=val;
}

int64 query(int x){
	if(x<=0)
	return 0;
	x=min(x,100001);
	int64  ret=0;
	
	while(x){
		ret+=BIT[x];
		x-=x&(-x);
	}
	
	return ret;
}

void add(int x){
	ans+=query(x+k)-query(x-k-1);
	upd(x,1);
}

void remov(int x){
	upd(x,-1);
	ans-=query(x+k)-query(x-k-1);
}

int main(){
	int n,i,q;
	cin>>n>>q>>k;
	
	for(i=1;i<=n;i++)
	scanf("%d",&a[i]);
	Query tmp;
	
	for(i=0;i<q;i++){
		scanf("%d%d",&tmp.l,&tmp.r);
		tmp.id=i;
		v.pb(tmp);
	}
	
	sort(all(v),cmp);
	int curl=1,curr=0;
	for(i=0;i<q;i++){
		tmp=v[i];
		
		while(curr<tmp.r){
			curr++;
			add(a[curr]);
		}
		
		while(curr>tmp.r){
			remov(a[curr]);
			curr--;
		}
		
		while(curl>tmp.l){
			curl--;
			add(a[curl]);
		}
		
		while(curl<tmp.l){
			remov(a[curl]);
			curl++;
		}
		store[tmp.id]=ans;
	}
	for(i=0;i<q;i++)
	printf("%lld\n",store[i]);
	return 0;
}
