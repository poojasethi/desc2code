#include<bits/stdc++.h>

using namespace std;

#define LL long long int
#define sd(x) scanf("%d", &x)
#define MP make_pair
#define PB push_back
#define vi vector<int>
#define F first
#define S second
#define INF 2000000000
#define MOD 1000000007
#define D double
#define LD long double

#define N 2123456

LL a[N], b[N], c[N];

inline void f(LL a[N], LL b[N], int s, int p){
	if(p == 0){
		a[s] *= b[s];
		a[s] %= MOD;
		return;
	}
	int i, j;
	for(i = 0; i < (1<<(p - 1)); i++){
		j = s + i + (1<<(p - 1));
		a[j] += a[i + s];
		if(a[j] >= MOD){
			a[j] -= MOD;
		}
		b[j] += b[i + s];
		if(b[j] >= MOD){
			b[j] -= MOD;
		}
	}
	f(a, b, s, p - 1);
	f(a, b, s + (1<<(p - 1)), p - 1);
	for(i = 0; i < (1<<(p - 1)); i++){
		j = s + i + (1<<(p - 1));
		a[j] -= a[i + s];
		if(a[j] < 0){
			a[j] += MOD;
		}
	}
}

int main(){
	int n, i, j, k;
	LL ans = 0;
	sd(n);
	for(i = 0; i < (1<<n); i++){
		sd(j);
		a[i] = j;
	}
	for(i = 0; i < (1<<n); i++){
		sd(j);
		b[i] = j;
	}
	for(i = 0; i < (1<<n); i++){
		sd(j);
		c[i] = j;
	}
	f(a, b, 0, n);
	f(a, c, 0, n);
	for(i = 0; i < (1<<n); i++){
		j = i;
		k = 0;
		while(j > 0){
			if(j & 1){
				k ++;
			}
			j >>= 1;
		}
		ans += a[i] * (1<<k);
		ans %= MOD;
	}
	cout<<ans<<endl;
}
