#include <stdio.h>
#include <stdlib.h>
#include <string.h>
using namespace std;

int Power(int a,int b,int p)
{
	int ans=1;
	for(;b;b>>=1,a=(long long)a*a%p)if(b&1)ans=(long long)ans*a%p;
	return ans;
}

int n,m,i,j,k,Z,P,D,A,S;
int ans[16],sum;
char s[10005];

int calc(int l,int r)
{
	if(l==r)
	{
		if(s[l]=='Z')return Z;
		if(s[l]=='P')return P;
		if(s[l]=='D')return D;
		if(s[l]=='A')return A;
	}
	int now=-1,num=-1,opt;
	bool flag;
	for(int i=l;i<=r;++i)
	{
		if(s[i]=='!')flag=true,++i;
		else flag=false;
		if(s[i]=='(')
		{
			int j,k=1;
			for(j=i+1;k;++j)
			{
				if(s[j]=='(')++k;
				if(s[j]==')')--k;
			}
			num=calc(i+1,j-2);
			i=j-1;
		}
		else
		{
			if(s[i]=='v')opt=1;
			if(s[i]=='^')opt=2;
			if(s[i]=='\\')opt=3;
			if(s[i]=='Z')num=Z;
			if(s[i]=='P')num=P;
			if(s[i]=='D')num=D;
			if(s[i]=='A')num=A;
		}
		if(num!=-1)
		{
			if(flag)num=65535-num;
			if(now==-1)now=num;
			else
			{
				if(opt==1)now|=num;
				if(opt==2)now&=num;
				if(opt==3)now-=now&num;
			}
			num=-1;
		}
	}
	return now;
}

#define p 1000003

int main()
{
	for(i=0;i<16;++i)
	{
		if(i&1)Z|=1<<i;
		if(i&2)P|=1<<i;
		if(i&4)D|=1<<i;
		if(i&8)A|=1<<i;
	}
	scanf("%d",&n);
	ans[0] =Power(2,Power(2,n,p-1),p);       //    
	ans[1] =Power(2,Power(2,n,p-1)+p-2,p);   //Z   
	ans[2] =Power(2,Power(2,n,p-1)+p-2,p);   // P  
	ans[3] =Power(2,Power(2,n,p-1)+p-3,p);   //ZP  
	ans[4] =Power(2,Power(2,n-1,p-1),p);     //  D 
	ans[5] =Power(2,Power(2,n-1,p-1)+p-2,p); //Z D 
	ans[6] =Power(2,Power(2,n-1,p-1)+p-2,p); // PD 
	ans[7] =Power(2,Power(2,n-1,p-1)+p-2,p); //ZPD 
	ans[8] =Power(2,n+1,p);                  //   A
	ans[9] =Power(2,n,p);                    //Z  A
	ans[10]=Power(2,n,p);                    // P A
	ans[11]=Power(2,n-1,p);                  //ZP A
	ans[12]=Power(2,n,p);                    //  DA
	ans[13]=Power(2,n-1,p);                  //Z DA
	ans[14]=Power(2,n-1,p);                  // PDA
	ans[15]=Power(2,n-1,p);                  //ZPDA
	for(i=15;i>=0;--i)
	for(j=i+1;j<=15;++j)
	if((i&j)==i)
	ans[i]=(ans[i]+p-ans[j])%p;
	scanf("%d",&m);
	for(;m;--m)
	{
		scanf("%s",s+1);sum=0;
		S=calc(1,strlen(s+1));
		for(i=0;i<16;++i)
		if(S&(1<<i))
		sum=(sum+ans[i])%p;
		printf("%d\n",sum);
	}
}