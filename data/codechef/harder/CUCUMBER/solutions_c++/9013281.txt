#include <stdio.h>
#include <stdlib.h>
#include <algorithm>
using namespace std;

int T,n,m,i,j,k,l,x,ans;
unsigned int S,P,A;
long long Q[65],Qc[8005];
char s[105];

int main()
{
	scanf("%d",&T);
	for(;T;--T)
	{
		scanf("%d%d",&n,&m);
		for(i=1;i<=m;++i)
		{
			for(j=0;j<n;++j)Q[j]=1ll<<n;
			scanf("%s",s+1);
			if(s[3]=='w')
			{
				for(j=0;j<n;++j)
				for(k=0;k<n;++k)
				{
					scanf("%d",&x);
					if(x&1)Q[j]|=1ll<<k;
				}
			}
			else
			{
				scanf("%u%u%u",&S,&P,&A);
				for(j=0;j<n;++j)
				for(k=0;k<n;++k)
				{
					if(((S/4096)%100+1)&1)Q[j]|=1ll<<k;
					S=S*P+A;
				}
			}
			Qc[i]=0;
			for(j=k=0;j<n;++j,++k)
			{
				for(;k<=n&&(Q[j]&(1ll<<k))==0;++k)
				{
					for(l=j+1;l<n;++l)if(Q[l]&(1ll<<k))break;
					if(l<n){swap(Q[j],Q[l]);break;}
				}
				if(k>n)break;
				for(l=0;l<n;++l)if(l!=j&&Q[l]&(1ll<<k))Q[l]^=Q[j];
			}
			if(j<n)continue;
			for(k=0;k<n;++k)if((Q[k]&(1ll<<k))==0)break;
			for(j=0;j<k;++j)if(Q[j]&(1ll<<k))Qc[i]|=1ll<<j;
			Qc[i]|=1ll<<k;
		}
		ans=0;
		for(i=1;i<=m;++i)
		for(j=i+1;j<=m;++j)
		if(__builtin_popcountll(Qc[i]&Qc[j])&1)
		++ans;
		if(n==1)ans=m*(m-1)/2-ans;
		printf("%d\n",ans);
	}
}