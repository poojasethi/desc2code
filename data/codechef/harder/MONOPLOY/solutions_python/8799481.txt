#include <stdio.h>
#include <stdlib.h>
#include <algorithm>
#include <time.h>
#include <iostream>
using namespace std;

int T,n,m,i,j,k,u,v;
int l[100005],r[100005],fa[100005],size[100005],deep[100005],st[100005],en[100005];
int son[100005],next[200005],ed[200005],tot;
long long sum[100005],sum2[100005],ans;
bool visit[100005];
char opt;

inline bool top(int p){return (!fa[p])||(l[fa[p]]!=p&&r[fa[p]]!=p);}

inline void zig(int x)
{
	int y=fa[x],z=fa[y];
	if(l[z]==y)l[z]=x;else if(r[z]==y)r[z]=x;
	fa[x]=z,fa[y]=x,fa[r[x]]=y;
	l[y]=r[x],r[x]=y;
}

inline void zag(int x)
{
	int y=fa[x],z=fa[y];
	if(l[z]==y)l[z]=x;else if(r[z]==y)r[z]=x;
	fa[x]=z,fa[y]=x,fa[l[x]]=y;
	r[y]=l[x];l[x]=y;
}
inline void splay(int x)
{
	int y,z;
	while(!top(x))
	{
		y=fa[x],z=fa[y];
		if(!top(y))
		{
			if(l[z]==y){if(l[y]==x)zig(y),zig(x);else zag(x),zig(x);}
			else{if(l[y]==x)zig(x),zag(x);else zag(y),zag(x);}
		}
		else{if(l[y]==x)zig(x);else zag(x);}
	}
}

int access(int x)
{
	int i,k,y=0;
	for(;x;y=x,x=fa[x])
	{
		splay(x);
		if(r[x])
		{
			for(k=r[x];l[k];k=l[k]);
			for(i=st[k];i<=n;i+=i&-i)++sum[i],sum2[i]-=st[k]-1;
			for(i=en[k]+1;i<=n;i+=i&-i)--sum[i],sum2[i]+=en[k];
		}
		r[x]=y;
		if(y)
		{
			for(k=y;l[k];k=l[k]);
			for(i=st[k];i<=n;i+=i&-i)--sum[i],sum2[i]+=st[k]-1;
			for(i=en[k]+1;i<=n;i+=i&-i)++sum[i],sum2[i]-=en[k];
		}
	}
	return y;
}

void dfs(int p)
{
	st[p]=++tot;
	l[p]=r[p]=0;sum[p]=sum2[p]=0;size[p]=1;
	visit[p]=true;
	for(int i=son[p];i;i=next[i])
	if(!visit[ed[i]])
	{
		fa[ed[i]]=p;
		deep[ed[i]]=deep[p]+1;
		dfs(ed[i]);
		size[p]+=size[ed[i]];
	}
	son[p]=0;
	visit[p]=false;
	en[p]=tot;
}

int main()
{
	scanf("%d",&T);
	for(;T;--T)
	{
		scanf("%d",&n);tot=0;
		for(i=1;i<n;++i)
		{
			scanf("%d%d",&u,&v);++u;++v;
			++tot;next[tot]=son[u];son[u]=tot;ed[tot]=v;
			++tot;next[tot]=son[v];son[v]=tot;ed[tot]=u;
		}
		tot=0;deep[1]=1;fa[1]=0;dfs(1);
		for(i=1;i<=n;++i)
		for(j=st[i];j<=n;j+=j&-j)
		sum2[j]+=deep[i];
		scanf("%d",&m);
		for(;m;--m)
		{
			for(opt=getchar();opt!='q'&&opt!='O';opt=getchar());
			if(opt=='O')
			{
				scanf("%d",&u);++u;
				access(u);
			}
			else
			{
				scanf("%d",&u);ans=0;++u;
				for(i=en[u];i;i-=i&-i)ans+=en[u]*sum[i]+sum2[i];
				for(i=st[u]-1;i;i-=i&-i)ans-=(st[u]-1)*sum[i]+sum2[i];
				printf("%.10lf\n",(double)ans/size[u]-1);
			}
		}
	}
}