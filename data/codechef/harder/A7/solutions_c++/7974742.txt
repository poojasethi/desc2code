#include <cstdio>
#include <iostream>
#include <vector>
#include <string>
#include <cctype>
#include <cstring>
#include <cstdlib>
#include <set>
#include <map>
#include <queue>
#include <utility>
#include <functional>
#include <algorithm>
#include <numeric>
#include <bitset>
#include <cmath>
#include <sstream>
#include <complex>
using namespace std;
 
#define pb push_back
#define mp make_pair
#define pii pair<int,int>
 
#define fo(i,n) for(int i=0; i < (n) ; ++i)
#define FO(i,a,b) for(int i=a;i<=(b);++i)
#define ALL(v) (v).begin(),(v).end()
#define SORT(v) sort(ALL(v))
#define REV(v) reverse(ALL(v))
#define UNIQ(v) (v).erase(unique(ALL(v)),(v).end())
 
#define VDebug(x)  {fo(i,(x).size()) cout<<(x)[i]<<" ";cout<<endl;}
#define VVDebug(x) {fo(j,(x).size()) VDebug(x[j])}
				     
typedef istringstream iss;
typedef ostringstream oss;
typedef long long int lint;
typedef complex<double> point;
				     
typedef vector<int> VI;
typedef vector<string> VS;
typedef vector<VI> VVI;
typedef vector<VS> VVS;
				     
const char eof = -123;
 
void printBits(unsigned int x,int end = 32,int start = 0){for(int i = end-1;i>=start;i--) if(x & (1<<i)) cout<<1<<" "; else cout<<0<<" ";}
int readInt(){	int x;if(scanf("%d",&x) != 1) return eof;return x;}
char readChar() { char c; if(scanf("%c",&c) != 1) return eof; return c;}
lint readLL(){lint x; if(cin>>x) return x; return eof;}
double readDouble(){double f;if(scanf("%lf",&f) == 1)return f;return eof;}
 
int X1[5000], Y1[5000], X2[5000], Y2[5000];
int A1[5000], B1[5000], A2[5000], B2[5000];
int segX[5000][1100];
int segY[5000][1100];
 
#define DOSORT 1
 
#ifdef DOSORT
#define mp4(a,b,c,d) mp(mp(a,b), mp(c,d))
#define X first
#define Y second
bool cmp(pair<pair<int,int>, pair<int,int> >  A, pair<pair<int,int>, pair<int,int> >  B){
	return (A.X.X < B.X.X);
}
#undef X
#undef Y
#endif
 
vector<pair<pair<int,int>, pair<int,int> > >VP;
main()
{
	int n = readInt();
	int m = readInt();
	fo(i,n){
		X1[i] = readInt();
		Y1[i] = readInt();
		X2[i] = readInt();
		Y2[i] = readInt();
		if(X1[i] == X2[i] && Y1[i] > Y2[i]) swap(Y1[i], Y2[i]); //x1 == x2 --> y1 <= y2
		if(X1[i] > X2[i]){
			swap(X1[i], X2[i]);
			swap(Y1[i], Y2[i]);
		} // x1 <= x2 holds always
 
#ifdef DOSORT
		VP.pb(mp4(X1[i], Y1[i], X2[i], Y2[i]));
#endif		
		A1[i] = X1[i], A2[i] = X2[i], B1[i] = Y1[i], B2[i] = Y2[i];
		if(B1[i] == B2[i] && A1[i] > A2[i]) swap(A1[i], A2[i]); //b1 == b2 --> a1 <= a2;
		if(B1[i] > B2[i]){
			swap(B1[i], B2[i]);
			swap(A1[i], A2[i]);
		} // b1 <= b2 holds always
	}
 
#ifdef DOSORT
#define X first
#define Y second
	sort(VP.begin(),VP.end(),cmp); fo(i,n) {
		X1[i] = VP[i].X.X, Y1[i] = VP[i].X.Y , X2[i] = VP[i].Y.X, Y2[i] = VP[i].Y.Y;
		A1[i] = X1[i], A2[i] = X2[i], B1[i] = Y1[i], B2[i] = Y2[i];
		if(B1[i] == B2[i] && A1[i] > A2[i]) swap(A1[i], A2[i]); //b1 == b2 --> a1 <= a2;
		if(B1[i] > B2[i]){
			swap(B1[i], B2[i]);
			swap(A1[i], A2[i]);
		} // b1 <= b2 holds always
	}
#undef X
#undef Y
#endif
 
	fo(i,n){
		for(int x=-20;x<=1043;x++){
			if(X2[i] == X1[i]) continue;
			segY[i][x+20] = Y1[i] + (Y2[i] - Y1[i])* (x - X1[i])/(X2[i] - X1[i]) ;
		}
		for(int y=-20;y<=1043;y++){
			if(Y2[i] == Y1[i]) continue;
			segX[i][y+20] = X1[i] + (X2[i] - X1[i])*(y - Y1[i])/(Y2[i] - Y1[i]);
		}
	}
	int result = 0;
	fo(t,m){
		int x = readInt();
		int y = readInt();
		int l = readInt();
		x ^= result; y ^= result;
		int a = x-l, c = x + l, b = y -l, d = y + l;
		
		int ret = 0;
		int end = upper_bound(X1, X1 + n, c) - X1;
		fo(k,min(n,end+1)){
			if(X2[k] < a || X1[k] > c || B2[k] < b || B1[k] > d){
			}
			else if(X1[k] == X2[k] || Y1[k] == Y2[k]) ret++;
			else if(Y1[k] < Y2[k]){
				//going up 
				if( segY[k][a + 20] <= d 
				    && segY[k][c + 20] >= b)
				ret++;
			}
			else if(Y1[k] > Y2[k]){
				//going down
				if(segY[k][a + 20] >= b
				   && segY[k][c + 20] <= d)
				ret++;
			}
		}
		result = ret;
	}
	cout<<result<<endl;
}
 