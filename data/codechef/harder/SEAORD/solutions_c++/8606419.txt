#include <ctime>
#include <cstdio>
#include <cstring>
#include <cstdlib>
#include <algorithm>
using namespace std;

#define n	100005
#define For(i,a,b)	for(int i=a;i<=b;i++)

int		T,N,Ans,A[n],B[n],X[n],Y[n],TA[n],TB[n];

bool	Work(int*A,int*B,int*X,int*Y,int*TA,int*TB){
		int TimA=0,TimB=0,j=1;
		for (int i=1;i<=N;i++){
			TA[X[i]]=TimA;	TimA+=A[X[i]];
			for (;j<=N&&Y[j]!=X[i]&&TimB+B[Y[j]]<=TimA;j++)
				TB[Y[j]]=TimB,TimB+=B[Y[j]];
			if	(j<=N&&Y[j]==X[i])	TimB=TimA;
		}
		return	j>N;
}

int		main(){
		scanf("%d",&T);	srand(time(0));
		for (;T--;)	{
			scanf("%d",&N);	int SA=0,SB=0,SC=0;
			For(i,1,N)	scanf("%d%d",&A[i],&B[i]),SA+=A[i],SB+=B[i],SC=max(SC,A[i]+B[i]);
			Ans=max(SA,max(SB,SC));

			if	(SA<=SC&&SB<=SC){
				int ID=0,now=0;
				For(i,1,N)	if	(A[i]+B[i]==SC)	ID=i;

				TA[ID]=0;	now=A[ID];
				For(i,1,N)	if	(i!=ID)	TA[i]=now,now+=A[i];
				TB[ID]=A[ID];	now=0;
				For(i,1,N)	if	(i!=ID)	TB[i]=now,now+=B[i];
			}	else	{
				For(i,1,N)	X[i]=Y[i]=i;
				for (;;){
					random_shuffle(X+1,X+N+1);
					random_shuffle(Y+1,Y+N+1);
					if	(SA>=SB&&Work(A,B,X,Y,TA,TB))	break;
					if	(SA<SB&&Work(B,A,Y,X,TB,TA))	break;
				}
			}

			printf("%d\n",Ans);
			For(i,1,N)	printf("%d %d\n",TA[i],TB[i]);
		}
}