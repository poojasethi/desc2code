#include <cstdio>
#include <algorithm>
#include <ctime>
#define rep(i,x,y) for(int i=x;i<=y;i++)
using namespace std;
int a[200010],b[200010],x[200010],y[200010],t1[200010],t2[200010],back[200010];
int main()
{
	int T;
	scanf("%d",&T);
	while(T--)
	{
		int n,m1=0,m2=0,m0=0,tem;
		scanf("%d",&n);
		rep(i,1,n)
		{
			scanf("%d%d",&a[i],&b[i]);
			if(a[i]+b[i]>m0)
			{
				m0=a[i]+b[i];
				tem=i;
			}
			m1+=a[i];
			m2+=b[i];
		}
		if(m0>=max(m1,m2))
		{
			t1[tem]=0;
			t2[tem]=a[tem];
			int x2=0,x1=a[tem];
			rep(i,1,n)
				if(i!=tem)
				{
					t1[i]=x1;
					t2[i]=x2;
					x1+=a[i];
					x2+=b[i];
				}
		}
		else
		{
			if(m1<m2)
				rep(i,1,n)
					swap(a[i],b[i]);
			rep(i,1,n)
				x[i]=y[i]=i;
			while(true)
			{
				random_shuffle(x+1,x+1+n);
				random_shuffle(y+1,y+1+n);
				int now=0,tem=max(m1,m2);
				rep(i,1,n)
				{
					t1[x[i]]=now;
					now+=a[x[i]];
					back[x[i]]=i;
				}
				now=0;
				rep(i,1,n)
				{
					if(t1[y[i]]+a[y[i]]>now&&now+b[y[i]]>t1[y[i]])now=t1[y[i]]+a[y[i]];
					t2[y[i]]=now;
					now+=b[y[i]];
				}
				if(t2[y[n]]+b[y[n]]<=tem)break;
			}
			if(m1<m2)
				rep(i,1,n)
					swap(t1[i],t2[i]);
		}
		printf("%d\n",max(max(m1,m2),m0));
		rep(i,1,n)
			printf("%d %d\n",t1[i],t2[i]);
	}
}