#include <stdio.h>
#include <stdlib.h>
#include <algorithm>
using namespace std;

int T,n,i,j,k,sumA,sumB,maxAB;
int A[10005],B[10005],tA[10005],tB[10005],idA[10005],idB[10005];
bool flag;

int main()
{
	scanf("%d",&T);
	for(;T;--T)
	{
		scanf("%d",&n);
		sumA=sumB=maxAB=0;
		for(i=1;i<=n;++i)
		{
			scanf("%d%d",&A[i],&B[i]);
			sumA+=A[i];sumB+=B[i];
			if(A[i]+B[i]>maxAB)maxAB=A[i]+B[i];
		}
		if(maxAB>=sumA&&maxAB>=sumB)
		{
			printf("%d\n",maxAB);
			for(i=1;i<=n;++i)if(A[i]+B[i]==maxAB)k=i;
			sumA=A[k];sumB=0;
			for(i=1;i<=n;++i)
			if(i==k)printf("0 %d\n",A[k]);
			else printf("%d %d\n",sumA,sumB),sumA+=A[i],sumB+=B[i];
			continue;
		}
		if(sumA<sumB)
		{
			flag=true;
			swap(sumA,sumB);
			for(i=1;i<=n;++i)swap(A[i],B[i]);
		}else flag=false;
		printf("%d\n",sumA);
		for(i=1;i<=n;++i)idA[i]=idB[i]=i;
		for(;;)
		{
			sumA=sumB=0;
			random_shuffle(idA+1,idA+n+1);
			random_shuffle(idB+1,idB+n+1);
			for(i=k=1;i<=n;++i)
			{
				tA[idA[i]]=sumA;sumA+=A[idA[i]];
				for(;k<=n&&sumB+B[idB[k]]<=sumA&&idB[k]!=idA[i];++k)tB[idB[k]]=sumB,sumB+=B[idB[k]];
				if(idB[k]==idA[i])sumB=sumA;
			}
			if(k>n)break;
		}
		if(flag)for(i=1;i<=n;++i)swap(tA[i],tB[i]);
		for(i=1;i<=n;++i)printf("%d %d\n",tA[i],tB[i]);
	}
}