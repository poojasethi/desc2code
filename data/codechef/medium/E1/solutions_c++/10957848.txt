#include <bits/stdc++.h>

using namespace std;
int a[1000][1000];
int dp[1000][1000];
int n;
int func(int x,int y)
{
	if (x == (n-1) && y == (n-1))
		return a[x][y];
	if (x >= n) {
		return 0;		
	}
	if (y >= n)
		return 0;
	if (dp[x][y] != -1)
		return dp[x][y];
//	cout << "auyush";
	int k1 = 0;
	int k2 = 0;
	int k3 = 0;
	int k4 = 0;
//	int temp = a[x][y];
//	a[x][y] = 0;
	if ((x+2) < n && (y+1) < n)
		k1 = func(x+2,y+1);
	if ((x-2) >= 0 && (y+1) < n)
		k2 = func(x-2,y+1);
	if ((y+2) < n && (x+1) < n)
		k3 = func(x+1,y+2);
	if ((y+2) < n && (x-1) >= 0)
		k4 = func(x-1,y+2);
//	a[x][y] = temp;
	//cout << k1 << " " << k2 << " "  << k3 << " " << k4 << endl;
	dp[x][y] = a[x][y]+max(max(k1,k2),max(k3,k4));
	return dp[x][y];
}
int main()
{
	int t;
	scanf("%d",&t);
	while (t--)
	{
		scanf("%d",&n);
		vector<string> gg;
		int x,y;
		string s;
		for (int i = 0; i < n; i++)
		{
			cin >> s;
		//	cout << s << endl;
			gg.push_back(s);
		}
		for (int i = 0; i < n; i++)
		{
			for (int j = 0; j < n; j++)
			{
				dp[i][j] = -1;
				if (gg[i][j] == 'P')
				{
					a[i][j] = 1;
				}
				else
				{
					a[i][j] = 0;
					if (gg[i][j] == 'K')
					{
						x = i;
						y = j;
					}
				}
			}
		}
	/*	for (int i = 0; i < n; i++)
		{
			for (int j = 0; j < n; j++)
			{
				printf("%d",a[i][j]);
			}
			printf("\n");
		}*/
		int ans = func(x,y);
		printf("%d\n",ans);
	}
	return 0;
}