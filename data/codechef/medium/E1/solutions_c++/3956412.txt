#include<iostream>
#include<stdio.h>
#include<cstring>
#include<string>
 
using namespace std;
 
int find_max(int a,int b,int c,int d)
{
	int max=a;
	if(max<b)
		max=b;
	if(max<c)
		max=c;
	if(max<d)
		max=d;
	return max;
}
int main()
{
	 int t,n,row,col;
	 bool flag;
	 scanf("%d",&t);
	 while(t--)
	 {
	 	scanf("%d",&n);
	 	flag=true;
	 	string c[n];
	 	int a[n+4][n+4];
	 	for(int i=0;i<n;i++)
	 	{
	 		cin>>c[i];
	 		if(flag)
	 		{
	 			for(int j=0;j<n;j++)
	 			if(c[i][j]=='K')
	 			{
	 				row=i;
	 				col=j;
	 				flag=false;
	 			}
	 		}	
	 	}
 
	 	for(int i=0;i<n+4;i++)
	 	for(int j=0;j<n+4;j++)
	 		a[i][j]=0;
 
	 	int max=0,I,J,t;
	 	flag=false;
	 	for(int j=n-1;j>=0;j--)
	 	{
	 		for(int i=0;i<n;i++)
	 		{
	 			I=i+2;
	 			J=j+2;
	 			t=find_max(a[I-2][J+1],a[I-1][J+2],a[I+2][J+1],a[I+1][J+2]);
	 			if(c[i][j]=='P')
	 			{	
	 				a[I][J]=1+t;
					if(a[I][J]>max)
					max=a[I][J];	 			
	 			}
	 			else
	 				a[I][J]=t;
	 			if(c[i][j]=='K')
	 			{
	 				flag=true;
	 				a[I][J]=t;
	 				break;
	 			}
 
	 		}
	 		if(flag)
	 				break;
	 	// 	for(int i=0;i<n+4;i++){
	 	// for(int j=0;j<n+4;j++)
	 	// 	cout<<a[i][j]<<" ";cout<<endl;}
	 	// 	cout<<endl;
	 	}
 
	 	printf("%d\n",a[row+2][col+2]);
 
	 }
 
}