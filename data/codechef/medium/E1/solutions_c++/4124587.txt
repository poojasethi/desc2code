#include<iostream>

using namespace std;

int main()
{
	int t;
	cin>>t;
	
	while(t--)
	{
		int n;
		cin>>n;
		
		char chess[n+1][n+1];
		int bin[n+1][n+1];
		
		int row=0,col=0,i,j;
		for(i=0;i<n;i++)
		{
//			cout<<"Enter string "<<i+1<<endl;
			for(j=0;j<n;j++)
			{
			
				char ch;
				cin>>ch;
				chess[i][j]=ch;
				
				if(ch=='P')
				bin[i][j]=1;
				else
				bin[i][j]=0;
				
				if(ch=='K')
				{
					row=i;
					col=j;
				}
			}
		}
/*				
		for(i=0;i<n;i++)
		{
			for(j=0;j<n;j++)
			{
				cout<<bin[i][j]<<" ";
			}
			cout<<endl;
		}
		
		cout<<endl;

*/
		for(j=n-1;j>col;j--)
		{
			int max=0;
			for(i=0;i<n;i++)
			{
		//		if(bin[i][j]==1)
		//		{
					if(i-2>=0&&j+1<n)
					{
//						cout<<"Found"<<endl;
						max=bin[i-2][j+1];
//						cout<<"max is "<<max<<endl;
					}
					if(i-1>=0&&j+2<n)
					{
//						cout<<"Found"<<endl;
						if(max<bin[i-1][j+2])
						{
							max=bin[i-1][j+2];
						}
//						cout<<"max is "<<max<<endl;
					}
					if(i+1<n&&j+2<n)
					{
//						cout<<"Found"<<endl;
						if(max<bin[i+1][j+2])
						{
							max=bin[i+1][j+2];
						}
//						cout<<"max is "<<max<<endl;
					}
					if(i+2<n&&j+1<n)
					{
//						cout<<"Found"<<endl;
						if(max<bin[i+2][j+1])
						{
							max=bin[i+2][j+1];
						}
//						cout<<"max is "<<max<<endl;
					}
//					cout<<"max is "<<max<<endl;
					bin[i][j]=bin[i][j]+max;
		//		}
		//		if(chess[i][j]=='K')
		//		{
		//			cout<<bin[i][j]<<en
		//		}
				
//				cout<<"bin[i][j] is "<<bin[i][j]<<endl;
			}
		}
/*		
		for(i=0;i<n;i++)
		{
			for(j=0;j<n;j++)
			{
				cout<<bin[i][j]<<" ";
			}
			cout<<endl;
		}
*/		
		i=row;
		int max=0;
		j=col;
		
		if(i-2>=0&&j+1<n)
					{
//						cout<<"Found"<<endl;
						max=bin[i-2][j+1];
//						cout<<"max is "<<max<<endl;
					}
					if(i-1>=0&&j+2<n)
					{
//						cout<<"Found"<<endl;
						if(max<bin[i-1][j+2])
						{
							max=bin[i-1][j+2];
						}
//						cout<<"max is "<<max<<endl;
					}
					if(i+1<n&&j+2<n)
					{
//						cout<<"Found"<<endl;
						if(max<bin[i+1][j+2])
						{
							max=bin[i+1][j+2];
						}
//						cout<<"max is "<<max<<endl;
					}
					if(i+2<n&&j+1<n)
					{
//						cout<<"Found"<<endl;
						if(max<bin[i+2][j+1])
						{
							max=bin[i+2][j+1];
						}
//						cout<<"max is "<<max<<endl;
					}			
		cout<<max<<endl;
	}
}