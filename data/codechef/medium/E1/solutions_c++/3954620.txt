#include <iostream>
#include <cstring>
#include <algorithm>

using namespace std;

int main()
{
    int t;
    cin >> t;
    while(t--)
    {
        int i,j,n;
        cin >> n;
        int x,y;//of knight
        int input[n][n];
        int chances[n][n];
        int pawnNum=0;

        for(i=0;i<n;i++)
        {
            for(j=0;j<n;j++)
            {
                input[i][j]=0;
                chances[i][j]=0;
            }
        }



        for(i=0;i<n;i++)
        {
            string str;
            cin >> str;
            for(j=0;j<n;j++)
            {
                if(str[j]=='K')
                {
                    x=i;
                    y=j;
                }
                if(str[j]=='P')
                {
                    input[i][j]=1;
                    pawnNum++;
                }
            }
        }

        /*
        for(i=0;i<n;i++)
        {
            for(j=0;j<n;j++)
                cout << input[i][j] <<" ";
            cout << "\n";
        }
        */

        for(i=0;i<n;i++)
            chances[i][n-1]=0;

        for(j=n-2;j>=0;j--)
        {
            for(i=n-1;i>=0;i--)
            {
                int max1=0,max2=0,max3=0,max4=0;
                if(j+2<n && i+1<n)
                {
                    max1=chances[i+1][j+2];
                    if(input[i+1][j+2]==1)
                        max1++;
                }
                if(j+2<n && i-1>=0)
                {
                    max2=chances[i-1][j+2];
                    if(input[i-1][j+2]==1)
                        max2++;
                }
                if(j+1<n && i+2<n)
                {
                    max3=chances[i+2][j+1];
                    if(input[i+2][j+1]==1)
                        max3++;
                }
                if(j+1<n && i-2>=0)
                {
                    max4=chances[i-2][j+1];
                    if(input[i-2][j+1]==1)
                        max4++;
                }
                chances[i][j]=max(max4,max(max3,max(max1,max2)));
            }
        }

        /*
        for(i=0;i<n;i++)
        {
            for(j=0;j<n;j++)
            {
                cout << chances[i][j] << " ";
            }
            cout << "\n";
        }
        */
        cout << chances[x][y] << "\n";
    }

}
