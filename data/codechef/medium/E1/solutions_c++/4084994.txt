#include<stdio.h>
#include<iostream>
#include<sstream>
#include<math.h>
#include<string.h>
using namespace std;

    int dp[1005][1005];
    int v[1005][1005];
    int n;
    int recursion(int a, int b)
    {
    if (a>=n || a<0 || b>=n || b<0) {
    return 0;
    }
    int& best=dp[a][b];
    if (best!=-1)
    return best;

    best=v[a][b]+max(max(recursion(a+1, b+2), recursion(a+2, b+1)), max(recursion(a-1, b+2), recursion(a-2, b+1)));
    return best;
    }

    int main()
    {
    int t, i, j, a, b;
    char c, str[1001];
    scanf("%d", &t);
    while(t--)
    {
    scanf("%d", &n);
    for (i=0; i<n; i++)
    {
        scanf("%s", str);
        for (j=0; j<n; j++)
            {
                dp[i][j]=-1;
                c=str[j];
                if (c=='.')
                {
                    v[i][j]=0;
                }
                else if (c=='K')
                {
                    v[i][j]=0;
                    a=i;
                    b=j;
                }
                else
                {
                    v[i][j]=1;
                }
            }
        }
    printf("%d\n",recursion(a,b));
    }
    return 0;
    }
