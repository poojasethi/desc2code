//#include<conio.h>
#include<stdio.h>
#include<cstring>
#include<iostream>
#include<cstdlib>
#include<algorithm>
#include<vector>
#include<sstream>
#include<climits>
#include<math.h>
#include<utility>
#include<cstdlib>
#include<queue>
#include<functional>
using namespace std;
int n;
/*struct name
{
       int x;
       int y;
};*/
/*bool isvalid(int a, int b)
{
     if(a<n&&b<n&&a>=0&&b>=0)
     return true;
     return false;
}*/
char str[1007][1007];                    
int main ()
{
    int t,i,j,out=0;
   int vstd[1007][1007],max1;
    scanf("%d",&t);
    while(t--)
    {
              out=0;
             //memset(vstd,-1,sizeof(pawn));
              scanf("%d",&n);
              for(i=0;i<n;i++)
              {
                              for(j=0;j<n;j++)
                              {
                                              cin>>str[i][j];
                                              if(j==n-1)
                                              {
                                                        if(str[i][j]=='P')
                                                        vstd[i][j]=1;
                                                        else
                                                        vstd[i][j]=0;
                                              }
                                              else
                                              vstd[i][j]=-1;
                              }
              }
              //max1=0;
              for(i=n-2;i>=0;i--)
              {
                              for(j=0;j<n;j++)
                              {
                                              max1=0;
                                              
                                              //max1=1;
                                              if(j+2>=0&&j+2<n&&i+1>=0&&i+1<n)
                                              //{                   //cout<<j+2<<i-1<<" "<<vstd[j+2][i-1]<<endl;1=1;
                                                                  max1=max(vstd[j+2][i+1],max1);
                                                                  //else 
                                                                  
                                                                  //cout<<max1<<endl;
                                              //}
                                              //max1=0;
                                              if(j-2>=0&&j-2<n&&i+1>=0&&i+1<n)
                                             // {                   //cout<<j+2<<i-1<<" "<<vstd[j+2][i-1]<<endl;
                                                                   max1=max(vstd[j-2][i+1],max1);
                                              //}
                                              //max1=0;
                                              //if(isvalid(j+1,i+2))
                                              if(j+1>=0&&j+1<n&&i+2>=0&&i+2<n)
                                              //{                   //cout<<j+2<<i-1<<" "<<vstd[j+2][i-1]<<endl;
                                                                 max1=max(vstd[j+1][i+2],max1);
                                              //}
                                              //max1=0;
                                              if(j-1>=0&&j-1<n&&i+2>=0&&i+2<n)
                                              //{                   //cout<<j+2<<i-1<<" "<<vstd[j+2][i-1]<<endl;
                                                                   max1=max(vstd[j-1][i+2],max1);
                                              //}
                                              if(str[j][i]=='K')                                 
                                              {
                                                                printf("%d\n",max1);
                                                                out=1;
                                                                //vstd[j-1][i-2]=max(max1+vstd[j][i],vstd[j-1][i-2]);
                                                                break;
                                              }
                                              //if(str[j][i]=='P')
                                              vstd[j][i]=max1+(str[j][i]=='P');
                                              //else
                                              //vstd[j][i]=max1;
                              }
                               if(out==1)
                               break;
              }
              //cout<<vstd[temp1][temp2]<<endl;
              //cout<<<<endl;
    }
    //getch();
    return 0;
}
                       
                              
              
