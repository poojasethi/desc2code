#include <iostream>
#include <cstdio>
#include <set>
#include <vector>
#include <cstring>

using namespace std;

int n;
char board[1000][1001];
int memo[1000][1000];

int foo(int x,int y)
{
    if(x>=n)
    {
        return 0;
    }
    if(y>=n)
    {
        return 0;
    }
    if(y<0)
    {
        return 0;
    }
    if(memo[y][x]>0)
    {
        return memo[y][x];
    }
    int m1,m2,m3,m4;
    m1=foo(x+1,y+2);
    m2=foo(x+1,y-2);
    m3=foo(x+2,y+1);
    m4=foo(x+2,y-1);
    if(m1>m2)
    {
        m2=m1;
    }
    if(m2>m3)
    {
        m3=m2;
    }
    if(m3>m4)
    {
        m4=m3;
    }
    memo[y][x]=m4+(board[y][x]=='P'?1:0);
    return memo[y][x];
}

int main()
{
    bool found;
    int t,kx,ky;
    scanf("%d",&t);
    for(int i=0;i<t;++i)
    {
        scanf("%d",&n);
        for(int j=0;j<n;++j)
        {
            for(int k=0;k<n;++k)
            {
                memo[j][k]=0;
            }
        }
        found=false;
        for(int j=0;j<n;++j)
        {
            scanf("%s",board[j]);
            for(int k=0;(k<n)&&(!found);++k)
            {
                if(board[j][k]=='K')
                {
                    kx=k;
                    ky=j;
                    found=true;
                }
            }
        }
        printf("%d\n",foo(kx,ky));
    }
    return 0;
}
