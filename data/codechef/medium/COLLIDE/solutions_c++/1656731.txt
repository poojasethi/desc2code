
#include <string>
#include <stdlib.h>
#ifndef ONLINE_JUDGE
#include <windows.h>
#endif

const int L = 'L',
		  R = 'R',
		  U = 'U',
		  D = 'D';

class Asteroid {
public:
	short x, y;
	char dir;
};

Asteroid ast[2012];

int ex, ey;
int edir;
int numAst;

bool haveCollision;
double minTime;

void collision(double t) {

	if (t < 0.0)
		t = -t;

	haveCollision = true;

	if (t < minTime)
		minTime = t;
}

void simulate() {

	haveCollision = false;
	minTime = 9999999999.0;
	int dx;

	Asteroid* asta = ast;

	for (int a = 0; a < numAst; a++, asta++) {

		if (edir == asta->dir)		// moving same direction, no collision ever
			continue;
		
		if (ex == asta->x) {

			if (edir == U && asta->dir == D) {			// earth going up, asteroid going down

				if (ey < asta->y)	
					collision((asta->y - ey) / 2.0);
			}
			else if (edir == D && asta->dir == U) {	// earth going down, asteroid going up

				if (ey > asta->y)	
					collision((ey - asta->y) / 2.0);
			}
		}
		else if (ey == asta->y) {
			if (edir == L && asta->dir == R) {			// earth going left, asteroid going right

				if (ex > asta->x)	
					collision((ex - asta->x) / 2.0);
			}
			else if (edir == R && asta->dir == L) {	// earth going right, asteroid going left

				if (ex < asta->x)	
					collision((asta->x - ex) / 2.0);
			}
		}
		else if ((edir == U || edir == D) && (asta->dir == L || asta->dir == R))	{		// earth going up or down, asteroid going left or right
			dx = (asta->dir == L ? asta->x - ex : ex - asta->x);
			if (dx >= 0) {
				if (dx == (edir == U ? asta->y - ey : ey - asta->y))
					collision(dx);
			}
		}
		else if ((edir == L || edir == R) && (asta->dir == U || asta->dir == D)) {		// earth going left or right, asteroid going up or down
			dx = (edir == L ? ex - asta->x : asta->x - ex);
			if (dx >= 0) {
				if (dx == (asta->dir == U ? ey - asta->y : asta->y - ey))
					collision(dx);
			}
		}
	}


}


int main(int argc, char *argv[])
{	
#ifndef ONLINE_JUDGE
	freopen ("COLLIDE.txt","r",stdin);
	DWORD startTime = GetTickCount();
#endif

	int numTestCases;
	scanf("%d", &numTestCases);

	for (int c = 0; c < numTestCases; c++) {

		scanf("%d %d %c", &ex, &ey, &edir);
		scanf("%d", &numAst);

		for (int a = 0; a < numAst; a++) {
			scanf("%d %d %c", &ast[a].x, &ast[a].y, &ast[a].dir);
		}

		simulate();
		if (!haveCollision)
			printf("SAFE\n");
		else
			printf("%.1f\n", minTime);
	}

#ifndef ONLINE_JUDGE
	DWORD elapsed = GetTickCount() - startTime;
	printf("\ntime = %d", elapsed);
	fclose (stdin);	
#endif
}
