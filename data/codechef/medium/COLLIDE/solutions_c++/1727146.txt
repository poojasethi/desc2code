#include<iostream>
#include<stdio.h>
using namespace std;
int t,n,xa,ya,xe,ye;
double min_;
char ad,ed;
int main()
{
	scanf("%d",&t);
	while(t--)
	{
		scanf("%d%d",&xe,&ye);min_=999999999;
		cin>>ed;
		scanf("%d",&n);
		while(n--)
		{
			scanf("%d%d",&xa,&ya);
			cin>>ad;
			if(ad == ed) continue;
			if(ed == 'U')
			{
				if(ad == 'L')
				{
					if((xa-xe)==(ya-ye) && xa>xe)
					if((xa-xe) < min_) min_=(xa-xe);
				}
				else if(ad == 'D')
				{
					if(ye<ya && xa==xe)
					if((ya-ye)/2 < min_) min_ = (double)(ya-ye)/2.0;
				}
				else
				{
					if((xe-xa)==(ya-ye) && xe>xa)
					if((xe-xa) < min_) min_=(xe-xa);
				}
			}
			else if(ed == 'L')
			{
				if(ad == 'U')
				{
					if((xe-xa)==(ye-ya) && (xe-xa) > 0)
					if((xe-xa) < min_) min_=(xe-xa);
				}
				else if(ad == 'D')
				{
					if((xe-xa)==(ya-ye) && (xe-xa) > 0)
					if((xe-xa) < min_) min_=(xe-xa);
				}
				else
				{
					if(xe>xa && ya==ye)
					if((xe-xa)/2 < min_) min_ = (double)(xe-xa)/2.0;
				}
			}
			else if(ed == 'D')
			{
				if(ad == 'L')
				{
					if((xa-xe)==(ye-ya) && (xa-xe) > 0)
					if((xa-xe) < min_) min_=(xa-xe);
				}
				else if(ad == 'U')
				{
					if(ye>ya && xa==xe)
					if((ye-ya)/2 < min_) min_ = (double)(ye-ya)/2.0;
				}
				else
				{
					if((xe-xa)==(ye-ya) && (xe-xa) > 0)
					if((xe-xa) < min_) min_=(xe-xa);
				}
			}
			else
			{
				if(ad == 'L')
				{
					if(xa>xe && ye==ya)
					if((xa-xe)/2 < min_) min_ = (double)(xa-xe)/2.0;
				}
				else if(ad == 'D')
				{
					if((xa-xe)==(ya-ye) && (xa-xe) > 0)
					if((xa-xe) < min_) min_=(xa-xe);
				}
				else
				{
					if((xa-xe)==(ye-ya) && (xa-xe) > 0)
					if((xa-xe) < min_) min_=(xa-xe);
				}
			}
		}
		if(min_==999999999) printf("SAFE\n");
		else printf("%.1f\n",min_);
	}
	return 0;
}