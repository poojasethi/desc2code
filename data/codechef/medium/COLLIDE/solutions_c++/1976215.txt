#include<stdio.h>

int main()
{
    int t=0;
    scanf("%d",&t);

    while(t--)
    {

        float ex=0,ey=0,arx[3000],ary[3000],delx[3000],dely[3000],edelx=0,edely=0,ct[3000],minct=0;
        bool coll=false;
        int n=0,i=0,j=0;
        char edir[5],adir[5];
        scanf("%f%f%s",&ex,&ey,&edir);
        switch(edir[0])
        {
            case 'R': {edelx=1;edely=0; break;}
            case 'L': {edelx=-1;edely=0; break;}
            case 'U': {edelx=0;edely=1; break;}
            case 'D': {edelx=0;edely=-1; break;}
        };
        scanf("%d",&n);
        for(i=0;i<n;i++)
        {
            scanf("%f%f%s",&arx[i],&ary[i],&adir);
            switch(adir[0])
        {
            case 'R': {delx[i]=1;dely[i]=0; break;}
            case 'L': {delx[i]=-1;dely[i]=0; break;}
            case 'U': {delx[i]=0;dely[i]=1; break;}
            case 'D': {delx[i]=0;dely[i]=-1; break;}
        };
        }
        for(i=0;i<n;i++)
        {  float tx=0,ty=0;
           if(edelx!=delx[i])
            tx=(arx[i]-ex)/(edelx-delx[i]);
           if(edely!=dely[i])
            ty=(ary[i]-ey)/(edely-dely[i]);
            if(tx>0&&ty>0&&tx==ty)
            {
                ct[j++]=tx;
                coll=true;

            }
            else if(edely==0&&dely[i]==0&&ary[i]==ey&&tx>0)
            {
                ct[j++]=tx;
                coll=true;

            }
            else if(edelx==0&&delx[i]==0&&arx[i]==ex&&ty>0)
            {
                 ct[j++]=ty;
                coll=true;

            }
        }
        if(!coll)
            printf("SAFE\n");
            else{
                minct=ct[0];
                for(i=0;i<j;i++)
                    if(ct[i]<=minct)
                    minct=ct[i];
                printf("%.1f\n",minct);
            }


    }



    return 0;
}
