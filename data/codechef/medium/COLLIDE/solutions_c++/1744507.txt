#include <cstdlib>
#include <cstdio>
#include <limits>
#include <iostream>

using namespace std;

char de;
int xe, ye;

void normalize(int& x, int& y, char& c)
{
  switch (de)
  {
    case 'R':
    {
      int tmp=x;
      x = -y;
      y = tmp;
      if (c=='D') c = 'R';
      else if (c=='L') c = 'D';
      else c = 'L'; // c == 'U'
    }
    break;
    case 'D':
    {
      x = -x;
      y = -y;
      if (c=='U') c = 'D';
      else if (c=='L') c = 'R';
      else c = 'L'; // c == 'R'
    }
    break;
    case 'L':
    {
      int tmp=x;
      x = y;
      y = -tmp;
      if (c=='D') c = 'L';
      else if (c=='R') c = 'D';
      else c = 'R'; // c == 'U'
    }
    break;
    default:
    break;
  }
}

int main()
{
  unsigned int t, n;
  scanf("%u", &t);

  while (t-->0)
  {
    
//    cerr << "t=" << t << '\n';

    scanf("%d %d %c", &xe, &ye, &de);

//    cerr << "Exyd=" << xe << ' ' << ye << ' ' << de << '\n';

    int time=numeric_limits<int>::max();
    bool safe=true, demi=false;

    scanf("%u", &n);
    while (n-->0)
    {
      int x, y;
      char d;
      scanf("%d %d %c", &x, &y, &d);

//      cerr << "n=" << n << '\n';
//      cerr << "xyd=" << x << ' ' << y << ' ' << d << '\n';
      if (d!=de && time>0)
      {
        x -= xe;
        y -= ye;
        normalize(x,y,d);
        switch (d)
        {
         case 'D':
          if (x==0 && y>=0 && y/2 < time)
          {
              time = y/2;
              if (y%2!=0) demi = true;
              safe = false;
          }
          break;
         case 'R':
          if (x <= 0 && x == -y && -x < time)
          {
            time = -x;
            demi = false;
            safe = false;
          }
          break;
         case 'L':
          if (x >=0 && x == y && x < time)
          {
            time = x;
            demi = false;
            safe = false;
          }
          break;
         default:
          break;
        }
      }
      else if (x==xe && y==ye)
      {
        time = 0;
        demi = false;
        safe = false;
      }

//      cerr << "xyd=" << x << ' ' << y << ' ' << d << '\n';
//      cerr << time << ' ' << demi << '\n';
    }

    if (safe) printf("SAFE\n");
    else 
    {
      if (demi) printf("%d.5\n",time);
      else printf("%d.0\n",time);
    }
  }
}