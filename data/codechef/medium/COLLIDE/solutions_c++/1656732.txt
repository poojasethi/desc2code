
#include <string>
#include <stdlib.h>
#ifndef ONLINE_JUDGE
#include <windows.h>
#endif

const int L = 'L',
		  R = 'R',
		  U = 'U',
		  D = 'D';

class Asteroid {
public:
	short x, y;
	char dir;
};

Asteroid ast[2012];

int ex, ey;
int edir;
int numAst;

bool haveCollision;
double minTime;

void collision(double t) {

	if (t < 0.0)
		t = -t;

	haveCollision = true;

	if (t < minTime)
		minTime = t;
}

void simulate() {

	haveCollision = false;
	minTime = 9999999999.0;
	int dx;
	short ax, ay;
	char adir;

	for (int a = 0; a < numAst; a++) {

		if (edir == ast[a].dir)		// moving same direction, no collision ever
			continue;

		ax = ast[a].x;
		ay = ast[a].y;
		adir = ast[a].dir;
		
		if (ex == ax) {

			if (edir == U && adir == D) {			// earth going up, asteroid going down

				if (ey < ay)	
					collision((ay - ey) / 2.0);
			}
			else if (edir == D && adir == U) {		// earth going down, asteroid going up

				if (ey > ay)	
					collision((ey - ay) / 2.0);
			}
		}
		else if (ey == ay) {
			if (edir == L && adir == R) {			// earth going left, asteroid going right

				if (ex > ax)	
					collision((ex - ax) / 2.0);
			}
			else if (edir == R && adir == L) {		// earth going right, asteroid going left

				if (ex < ax)	
					collision((ax - ex) / 2.0);
			}
		}
		else if ((edir == U || edir == D) && (adir == L || adir == R))	{		// earth going up or down, asteroid going left or right
			dx = (adir == L ? ax - ex : ex - ax);
			if (dx >= 0) {
				if (dx == (edir == U ? ay - ey : ey - ay))
					collision(dx);
			}
		}
		else if ((edir == L || edir == R) && (adir == U || adir == D)) {		// earth going left or right, asteroid going up or down
			dx = (edir == L ? ex - ax : ax - ex);
			if (dx >= 0) {
				if (dx == (adir == U ? ey - ay : ay - ey))
					collision(dx);
			}
		}
	}


}


int main(int argc, char *argv[])
{	
#ifndef ONLINE_JUDGE
	freopen ("COLLIDE.txt","r",stdin);
	DWORD startTime = GetTickCount();
#endif

	int numTestCases;
	scanf("%d", &numTestCases);

	for (int c = 0; c < numTestCases; c++) {

		scanf("%d %d %c", &ex, &ey, &edir);
		scanf("%d", &numAst);

		for (int a = 0; a < numAst; a++) {
			scanf("%d %d %c", &ast[a].x, &ast[a].y, &ast[a].dir);
		}

		simulate();
		if (!haveCollision)
			printf("SAFE\n");
		else
			printf("%.1f\n", minTime);
	}

#ifndef ONLINE_JUDGE
	DWORD elapsed = GetTickCount() - startTime;
	printf("\ntime = %d", elapsed);
	fclose (stdin);	
#endif
}
