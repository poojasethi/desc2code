#include <algorithm>
#include <cstdio>
#include <cstdlib>
#include <cstring>
#include <cctype>
#include <cmath>
#include <string>
#include <iostream>
#include <list>
#include <vector>
#include <stack>
#include <queue>
#include <map>


#define LL long long int
#define MAX 5005
using namespace std;

int ib[MAX],c[MAX];
string a[MAX],b[MAX];

int main()
{
	int t,i,j,k,n,tot,idx;
	string x,y;
	map <string,int> mp1,mp2;
	map <string,int> :: iterator it;
	scanf("%d",&t);
	while(t--)
	{
		scanf("%d",&n);
		tot=idx=0;
		mp1.clear(),mp2.clear();
		memset(ib,0,n*sizeof(int));

		for(i=0;i<n-1;i++)
		{
			cin >> a[i] >> b[i];
			scanf("%d$",&c[i]);
			tot+=c[i];
			x=a[i],y=b[i];
			if(mp1.find(x) == mp1.end())	mp1[x]=idx++;
			if(mp1.find(y) == mp1.end())	mp1[y]=idx++;
			mp2[x]=i;
			ib[mp1[y]]++; 
		}
		
		for(it=mp1.begin();it!=mp1.end();it++)
			if(!ib[it->second])
			{
				x=it->first;
				break;
			}
		
		while(mp2.find(x) != mp2.end())
		{
			j=mp2[x];
			cout << a[j] << " " << b[j] << " " << c[j] << "$\n";
			//printf("%s %s %d$\n",a[j],b[j],c[j]);
			x=b[j];
		}
		printf("%d$\n",tot);
	}
	return 0;
}