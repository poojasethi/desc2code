#include<iostream>
#include<cstdio>
#include<set>
#include<map>
#include<string>
#include<cstring>

using namespace std;

struct city
{
	char from[51],to[51];
	int cost;
}a[5001],e;

long long int ans;

int main()
{
	int t,n,i,j;
	char ex;
	scanf("%d",&t);
	while(t--)
	{
		ans=0;
		scanf("%d\n",&n);
		set<string> s1;
		set<string> s2;
		
		for(i=0;i<n-1;i++)
		{
			scanf("%s %s %d%c\n",a[i].from,a[i].to,&a[i].cost,&ex);
			s1.insert(a[i].from);
			s2.insert(a[i].to);
			ans+=a[i].cost;
		}
		
		set<string> s3(s1);
		set<string>::iterator it1=s1.begin();
		set<string>::iterator it2=s2.begin();
		set<string>::iterator it3=s3.begin();
/*		
		for(i=0;i<s1.size();i++)
		{
			cout<<*it1<<" ";
			it1++;
		}
		printf("\n");
		
		for(i=0;i<s2.size();i++)
		{
			cout<<*it2<<" ";
			it2++;
		}
		printf("\n");

		for(i=0;i<s3.size();i++)
		{
			cout<<*it3<<" ";
			it3++;
		}
		printf("\n\n");
*/
		
		set<string>::iterator it,it8;
		it8=s1.begin();
		for(i=0;i<s1.size();i++)
		{
			it=s2.find(*it8);
			if(it==s2.end())
			{
				break;
			}
			it8++;
		}
		
		map<string,int> m1;
		
		for(i=0;i<n-1;i++)
		{
			m1[a[i].from]=i;
		}
		
		for(i=0;i<n-1;i++)
		{
			e=a[m1[*it8]];
			printf("%s %s %d$\n",e.from,e.to,e.cost);
			it8=s1.find(e.to);
		}
		printf("%lld$\n",ans);
	}
	return 0;
}
