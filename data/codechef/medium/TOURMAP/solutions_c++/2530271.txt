    #include<stdio.h>
    #include<iostream>
    #include<map>
    #include<cstring>

using namespace std;
    int main()
    {
    struct tour
    {

    int pay;
    string a;
    string b;

    }city[5000];

     int t,i,n;
     long long int sum;
     char s1[51],s2[51];
     bool visited[5000];

    scanf("%d",&t);

  while(t--)
  {
      scanf("%d",&n);
      sum=0;
      memset(visited,false,sizeof(visited));

      map<string,int> ref;
      map<string,int> :: iterator it;

      for(i=0;i<n-1;i++)
      {
          scanf("%s%s%d$",s1,s2,&city[i].pay);

          city[i].a=s1;
          city[i].b=s2;
          ref[city[i].a]=i;
          sum+=city[i].pay;

      }

      for(i=0;i<n-1;i++)
      {
          it=ref.find(city[i].b);
          if(it!=ref.end())
          visited[it->second]=true;
      }
      for(i=0;i<n-1;i++)
      {
          if(visited[i]==false)
          break;
      }
      n--;
      while(n--)
      {
          printf("%s %s %d$\n",city[i].a.c_str(),city[i].b.c_str(),city[i].pay);//converts string to a char* pointer
          i=ref[city[i].b];
      }
     printf("%lld$\n",sum);
  }

    return 0;
    }
