#include<iostream>
#include<cstring>
#include<cstdio>
using namespace std;
int t,n,i,sum,f,k1,k2,d[10002];
char a[5001][51],b[5001][51],front[51],back[51],c[50001][51];

int convert()
{
    int l,s;
    l=strlen(c[i]);
    s=0;
    for(int j=0;j<(l-1);j++)
    {
      s=(s*10)+(c[i][j]-'0');
    }
    return s;
}
int main()
{

    cin>>t;
    while(t--)
    {
        sum=0;
        cin>>n;
        for(i=0;i<n-1;i++)
        {
            cin>>a[i]>>b[i]>>c[i];

            sum+=convert();
        }


        strcpy(front,a[0]);
        strcpy(back,b[0]);
        k1=5000;
        k2=5000;
        while(1)
        {
            f=0;
           for(i=1;i<n;i++)
        {
            if(strcmp(b[i],front)==0)
        {
            strcpy(front,a[i]);
            d[--k1]=i;
            f=1;
        }
        }
        if(f==0)
            break;
        }

        while(1)
        {
            f=0;
           for(i=1;i<n;i++)
        {
            if(strcmp(a[i],back)==0)
        {
            strcpy(back,b[i]);
            d[++k2]=i;
            f=1;
        }
        }
        if(f==0)
            break;
        }

        for(i=k1;i<=k2;i++)
        {
            cout<<a[d[i]]<<" "<<b[d[i]]<<" "<<c[d[i]]<<endl;
        }
        cout<<sum<<'$'<<endl;
    }
}
