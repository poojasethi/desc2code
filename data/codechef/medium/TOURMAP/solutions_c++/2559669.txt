#include <vector>
#include <list>
#include <map>
#include <set>
#include <deque>
#include <stack>
#include <bitset>
#include <algorithm>
#include <functional>
#include <numeric>
#include <utility>
#include <sstream>
#include <iostream>
#include <iomanip>
#include <cstdio>
#include <cmath>
#include <cstdlib>
#include <ctime>
#include<string>
 
using namespace std;
typedef long long int LLD;
 
map<string,int> city;
map<string,int>::iterator it,ennd;
 
map<string,string> pairs,cost; 
 
int main() {
    
    int t,n,m,tot,i,sum,j,len;
    string a,b,c,start,last,amt;
    char ch;
    cin>>t;
    while(t--)
    {
        cin>>n;
        tot = 0;
        for(i=0;i<n-1;i++)
        {
            cin>>a>>b>>amt;
            city[a]--;
            city[b]++;
           
            pairs[a] = b;
            cost[a] = amt;
            len = amt.size();
            sum = 0;
            //cout<<amt<<endl;
            for(j = 0; j <= len-2; j++)
            {
                 sum = (sum * 10) + (int)(amt.at(j)-'0');
                            }
                            
                            tot = tot + sum;
                 //          cout<<sum<<endl;
            
        }
        
        it = city.begin();
        ennd = city.end();
        
        for(it;it!=ennd;it++)
        {
            //cout<<it->first<<" "<<it->second<<endl;
            if(it->second == -1)
            start = it->first;
            
            if(it->second == 1)
            last = it->first;
        }
        
        //cout<<start<<" "<<last<<endl;
        
        while(start != last)
        {
            cout<<start<<" "<<pairs[start]<<" "<<cost[start]<<endl;
            start = pairs[start];
        }
        
        cout<<tot<<"$"<<endl;
        
        city.clear();
        pairs.clear();
    }
    
    
    return 0;
} 