#include <iostream>
#include <cstdio>
#include <map>
#include <utility>
#include <string>
using namespace std;
 
int main() {
  int t, n, c;
  string a, b;
  char b1[55], b2[55];
  scanf("%d",&t);
  while(t--) {
    map<string,int> ftc;
    map<string,string> ft, ftr;
    scanf("%d",&n);
    int sum = 0;
    for(int i=0;i<(n-1);++i) {
      scanf("%s%s%d$",b1, b2, &c);
      a = b1; b = b2;
      sum += c;
      ftc[a] = c;
      ft[a] = b;
      ftr[b] = a;
    }
//     if(n>1) {
      map<string,string>::iterator it = ftr.begin();
      a = it->second;
      while(ftr.find(a)!=ftr.end()) a=ftr[a];
      do {
	b = ft[a];
	printf("%s %s %d$\n",a.c_str(),b.c_str(),ftc[a]);
	a = b;
      } while(ft.find(a) != ft.end());
//     }
    printf("%d$\n",sum);
  }
  return 0;
}
