#include <iostream>
#include <cstdlib>
#include <string>
#include <map>
using namespace std;
int main()
{

    int t,n,i,ans,id;
    map<string,int> aid,bid;
    map<string,int>::iterator it;
    string a[5001],b[5001];
    int cost[5001];
    scanf("%d",&t);
    while(t--)
    {
              scanf("%d",&n);
              ans=0;
              aid.clear();
              bid.clear();
              for(i=0;i<n-1;i++)
              {
                       cin>>a[i]>>b[i];
                       scanf("%d$",&cost[i]);
                       aid[a[i]]=i+1;
                       bid[b[i]]=i+1;
                       cost[i+1]=cost[i];
                       ans += cost[i+1];

              }

              for(it=aid.begin();bid[it->first]>0;it++)
              {
              }
              id=it->second;
              while(id)
              {
                    cout<<a[id-1]<<" "<<b[id-1]<<" "<<cost[id-1]<<"$"<<endl;
                     id=aid[b[id-1]];
              }
              printf("%d$\n",ans);
    }
    return 0;
}

