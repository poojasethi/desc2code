#include <iostream>
#include <cstring>
#include <string>
#include <map>
#include <cstdio>
#include <cassert>
using namespace std;
char a[5005][52], b[5005][52];
int c[5005];
int ar[5005];
int main()
{   int t;
    cin>>t;
    while(t-->0)
    {   int n;
        cin>>n;
        map<string ,int > all;
        map<string ,int> frommap;
        all.clear();
        frommap.clear();
         memset(ar, 0, n*sizeof(int));
        string source,dest;int param;
        int total=0;int ct=0;
        for(int i=0;i<n-1;i++)
        {    assert(scanf("%s%s%d$",a[i],b[i],&c[i])==3);
            //scanf("%s%s%d$",&source,&dest,&param);

            source=a[i];
            dest=b[i];
            param=c[i];
            total+=param;
            if(all.find(source)==all.end())
                {all[source]=ct;ct++;}

             if(all.find(dest)==all.end())
                {all[dest]=ct;ct++;}
            frommap[source]=i;
            ar[all[dest]]++;


        }




        string str;

        for( map<string, int>::iterator it=all.begin();it!=all.end();it++)
        {
            if(ar[it->second]==0)
              {str= it->first;
            break;}
        }

        int id;
        while(frommap.find(str)!=frommap.end()) {
             id = frommap[str];
             printf("%s %s %d$\n", a[id], b[id], c[id]);

            str = b[id];
        }

      printf("%d$\n", total);





    }













}
