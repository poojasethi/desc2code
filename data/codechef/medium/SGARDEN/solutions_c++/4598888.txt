#include<stdio.h>
#include<math.h>
using namespace std;
#define mod 1000000007
#define max 100005
#define maximum(a,b) ((a > b) ? a : b)
int band[max],cycl[max],maxpow[max];
int main()
{
    int cases;
    scanf("%d",&cases);
    while(cases--)
    {
        int num;
        scanf("%d",&num);
        for(int i=1; i<= num; i++)
            scanf("%d",&band[i]);
        int start,nxt,mov,temp;
        long long ans;
        //find the length of cycles
        int i = 1,j = 0, k = num;
        while(k > 0)
        {
            while(band[i] == 0)
                i++;
            start = i;
            nxt = band[start];
            mov = 1;
            k--;
            while(start != nxt)
            {
                temp = nxt;
                nxt = band[nxt];
                band[temp] = 0;
                mov++;
                k--;
            }
            i = start+1;
            band[start] = 0;
            cycl[j++] = mov;
        }
        //now find the lcm
        for(i=1; i<max-1; i++)
            maxpow[i] = 0;
        for(i=0; i<j; i++)
        {
            temp = cycl[i];
            for(k=2; k*k<=cycl[i]; k++)
            {
                mov=0;
                while(temp%k == 0)
                {
                    temp = temp/k;
                    mov++;
                }
                if(mov)
                    maxpow[k] = maximum(maxpow[k],mov);
            }
            if(temp > 1)
                maxpow[temp] = maximum(maxpow[temp],1);
        }
        ans = 1;
        for(i=2; i<max-2; i++)
        {
            temp = pow(i,maxpow[i]);
            ans = (long long)ans * temp % mod;
        }
        printf("%lld\n",ans);
    }
    return 0;
}
