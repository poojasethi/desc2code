#include<iostream>
#include<map>
#include<cstdio>
using namespace std;
int n,a[500][500],cracked[500][500],i,j,k,l,t;
long long int count1;
bool prime[10000015];
void dfs(int x,int y,int sign)
{
    if(x<1||x>n||y<1||y>n)
        return;
    if(a[x][y]%2!=sign||cracked[x][y]==1||prime[a[x][y]]==true)
            return;
    cracked[x][y]=1;
    dfs(x-1,y,sign);
    dfs(x+1,y,sign);
    dfs(x,y+1,sign);
    dfs(x,y-1,sign);
}
int main()
{

    map<int,int> distinct1;
    //map<int,int> distinct2;
    for(i=2;i<10000000;i++)
    {
        prime[i]=true;
    }
    prime[0]=false;
    prime[1]=false;
    for(i=2;i<10000005;i++)
    {
        if(prime[i]==false)
            continue;
        for(j=2*i;j<10000005;j+=i)
        {
            prime[j]=false;
        }
    }
    k=0;
    for(i=1;i<10000000;i++)
    {
        if(prime[i]==true)
        {
            distinct1[i]=k++;
        }
       /* else if(i%2!=0)
        {
            distinct2[i]=l++;
        }*/
    }
    /*for(long int i=2;i<100;i++)
    {
        cout<<distinct1[i]<<endl;
    }*/
    scanf("%d",&t);
    while(t--)
    {
        count1=0;
        scanf("%d",&n);
        for(i=1;i<=n;i++)
        {
           for(j=1;j<=n;j++)
               {
                   scanf("%d",&a[i][j]);
                   cracked[i][j]=0;
               }
       }

         for(i=1;i<=n;i++)
         {
             for(j=1;j<=n;j++)
             {
                 if(cracked[i][j]==1)
                    continue;
                 if(prime[a[i][j]]==false)
                 {
                     if(a[i][j]%2==0)
                     {
                            count1=count1+(a[i][j]/2);
                         dfs(i,j,0);
                     }
                     else
                     {
                       count1+=((a[i][j]+3)/2);
                       dfs(i,j,1);
                     }
                 }
                 else
                 {
                     count1+=distinct1[a[i][j]];
                 }
                 //cout<<count1<<endl;
                 //cout<<i<<" "<<j<<endl;
             }
         }
         printf("%lld\n",count1);
    }
}
