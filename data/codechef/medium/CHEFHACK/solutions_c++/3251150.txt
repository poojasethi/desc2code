#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <limits.h>

#define LL long long
#define ULL unsigned long long
#ifndef ONLINE_JUDGE
	#define buffer_size 1000
	#define siz1 10
	#define siz2 100
	#define siz3 1000
#else
	#define buffer_size 200000000
	#define siz1 351
	#define siz2 626000
	#define siz3 10000000
#endif
#define _T for(;!((*ez1>='0'&&*ez1<='9')||*ez1=='-');ez1++);if(*ez1=='-'){wq1=-1;ez1++;}while(1){char c=*ez1;if(c<=32)return wq2*wq1;wq2=(wq2<<1)+(wq2<<3)+c-'0';ez1++;}

char pq1[buffer_size];
char *ez1;

int sint(){int wq1=1,wq2=0;_T}
long slong(){long wq1=1,wq2=0;_T}
LL sLL(){LL wq1=1,wq2=0;_T}
ULL sULL(){ULL wq1=1,wq2=0;_T}
int sstring(char ziel[]){char *ez2=ziel;for(;ez1<pq1+buffer_size&&*ez1<33;ez1++);for(;ez1<pq1+buffer_size&&*ez1>32;*ez2++=*ez1++);*ez2='\0';return ez1<pq1+buffer_size;}

#define _A for(i=0;i<n;i++)for(j=0;j<n;j++)

int n;
int e[siz3];
int a[siz1][siz1];
int z1[]={-1,1,0,0}, z2[]={0,0,1,-1};
int o[siz1][siz1];
char f[siz2];

void F(int x, int x1, int y1)
{
int i, x2, y2;
for(i=0; i<4; i++)
	{
	x2=x1+z1[i];
	y2=y1+z2[i];
	if(x2<0||y2<0||x2==n||y2==n) continue;
	if(o[x2][y2]==1) continue;
	if((a[x2][y2]&1)==x)
		{
		o[x2][y2]=1;
		F(x,x2,y2);
		}
	}
}

void losen()
{
int i, j;
LL r=0;
n=sint();
memset(o,0,sizeof(o));
_A
	{
	a[i][j]=sint();
	if(e[a[i][j]])
		{
		r+=e[a[i][j]]-1;
		o[i][j]=1;
		}
	}
_A
	if(o[i][j]!=1)
		{
		o[i][j]=1;
		if(a[i][j]%2==0)
			{
			r+=(a[i][j]+1)/2;
			F(0,i,j);
			}
		else
			{
			r+=1+(a[i][j]+1)/2;
			F(1,i,j);
			}
		}
printf("%lld\n",r);
}

int main()
{
int fall, i, j, q=0;
memset(f,255,sizeof(f));
memset(e,0,sizeof(e));
if(fread(pq1,1,sizeof(pq1),stdin));
ez1=pq1;
f[0]=0xFE;
for(i=1; i<3165; i++)
	if(f[i>>3]&(1<<(i&7)))
		for(j=3*i+1; j<siz3/2; j+=2*i+1)
			f[j>>3]&=~(1<<(j&7));
e[2]=++q;
for(i=3; i<siz3; i+=2)
	if((f[(i)>>4]&(1<<(((i)>>1)&7)))) e[i]=++q;
for(fall=sint(); fall--; losen());
return 0;
}
