#include<iostream>
#include<stdio.h>

using namespace std;
int arr[101][3];
float check[101];

float circuit(float b,int n)
{
    for(int i=1;i<=n;i++)
    {
            if(arr[i][0]==0)
            check[i]=b;
            else if(arr[i][0]==1)
                 check[i]=1-(1-check[arr[i][1]])*(1-check[arr[i][2]]);
            else if(arr[i][0]==2)
                 check[i]=check[arr[i][1]]*check[arr[i][2]];
    }
    return check[n];
}


int main()
{
    int T,n,v,i,a,b;
    float val,l,mid,r,ans=0.50000;
    scanf("%d",&T);
    while(T--)
    {
              scanf("\n%d",&n);
              for(i=1;i<=n;i++)
              {
                     scanf("%d",&v);
                     if(v!=0)
                     {
                           scanf("%d %d",&a,&b);
                           arr[i][1]=a;
                           arr[i][2]=b;
                     }
                     arr[i][0]=v;         
              }
              l = ans;
              mid = 0;
              r = 1;
              val = -1;
              int count = 0;
             while(val != ans)
              {
                                    count++;
                                    if(l == r || l == mid)
                                    break;
                   if(val < 0)
                   {
                    l = ans;
                    mid = 0;
                    r = 1;
                   }
                   else if(val < ans)
                   {
                        mid = l;
                        l = (l+r)/2;
                    }
                    else if(val > ans)
                    {
                         r=l;
                         l=(l+mid)/2;
                    }
                    val=circuit(l,n);
              }
              printf("%0.5f\n",l);
    }
    return 0;
}
