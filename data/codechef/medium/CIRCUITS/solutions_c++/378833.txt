#include<iostream>
#define FOR(i,a,b) for(i=a;i<=b;i++)
using namespace std;
int a[101][3];
float p1[101],p2[101],p3[101];
void calfunc1(int n,float val)
{ 
     int i=0;
      FOR(i,1,n)
      {
       if(a[i][0]==0)
        p1[i]=val; 
        else if(a[i][0]==1)
             p1[i]=p1[a[i][1]]+p1[a[i][2]]-p1[a[i][1]]*p1[a[i][2]];
        else if(a[i][0]==2)
          p1[i]=p1[a[i][1]]*p1[a[i][2]];
        
        }
     p1[n]=p1[n]-0.50000000;
 }
 void calfunc2(int n,float val)
{
      int i=0;
      FOR(i,1,n)
      {
       if(a[i][0]==0)
        p2[i]=val; 
        else if(a[i][0]==1)
             p2[i]=p2[a[i][1]]+p2[a[i][2]]-p2[a[i][1]]*p2[a[i][2]];
        else if(a[i][0]==2)
          p2[i]=p2[a[i][1]]*p2[a[i][2]];   
       }
     p2[n]=p2[n]-0.50000000;
 }
void calfunc3(int n,float val)
{    
      int i=0;
      FOR(i,1,n)
      {
       if(a[i][0]==0)
        p3[i]=val; 
        else if(a[i][0]==1)
             p3[i]=p3[a[i][1]]+p3[a[i][2]]-p3[a[i][1]]*p3[a[i][2]];
        else if(a[i][0]==2)
          p3[i]=p3[a[i][1]]*p3[a[i][2]];
        
      }
     p3[n]=p3[n]-0.50000000;
 } 
 void calp(int n)
 {
      int i;
      float c=0.00000,pc=1.0;
      calfunc1(n,0.0);
      calfunc2(n,1.0);
      
      while(1)
      {  pc=c;
         c=((p1[1]*p2[n])-(p2[1]*p1[n]))/(p2[n]-p1[n]); 
         calfunc3(n,c);
         if(c==pc)
         break;    
         if(p3[n]*p1[n]>=0)
           calfunc1(n,c);
          
         else
             calfunc2(n,c);
          
      }
      if(p3[n]*p1[n]>=0)
           printf("%1.5f\n",p1[1]);
      else
           printf("%1.5f\n",p2[1]);
              
  }
 
int main()
{
    int t,n,i;
    scanf("%d",&t);
    while(t--)
    {
     int x,y,z;
     i=1;
     scanf("%d",&n);
     while(i<=n)
     {
       scanf("%d",&x);
       if(x==0)
       {
          a[i][0]=x;
        }
      else if(x==1 || x==2)
      {
           scanf("%d %d",&y,&z);
           a[i][0]=x;
           a[i][1]=y;
           a[i][2]=z;
           }
           
         i++;  
    }
    if(n==1)
    printf("%1.5f\n",0.50000000);
    else
    calp(n);
  }
    return 0;
}