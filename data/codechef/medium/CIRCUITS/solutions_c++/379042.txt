#include <cstdio>

int const max_n = 100;

int n, type[max_n], prev[max_n][2];
double prob[max_n];

double calc(double p){
    for(int i = 0; i < n; ++i)
        switch(type[i]){
            case 0:
                prob[i] = p;
                break;
            case 1:
                prob[i] = 1 - (1 - prob[prev[i][0]])*(1 - prob[prev[i][1]]);
                break;
            case 2:
                prob[i] = prob[prev[i][0]] * prob[prev[i][1]];
        }

    return prob[n-1];
}

double const eps = 1e-10;
void doit(){
    scanf("%d", &n);
    for(int i = 0; i < n; ++i){
        scanf("%d", type + i);
        if(type[i]){
            scanf("%d%d", prev[i]+0, prev[i]+1);
            --prev[i][0], --prev[i][1];
        }
    }

    double x = 0.0, y = 1.0, m, p;
    while(x + eps < y){
        m = (x + y) * 0.5;
        p = calc(m);
        if(p < 0.5) x = m;
        else y = m;
    }

    printf("%.5lf\n", m);
}

int main(){
    int t; scanf("%d", &t);
    while(t--) doit();
    return 0;
}
