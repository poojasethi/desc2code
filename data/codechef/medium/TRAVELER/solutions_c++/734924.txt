#include <vector>
#include <list>
#include <map>
#include <set>
#include <queue>
#include <algorithm>
#include <sstream>
#include <iostream>
#include <cstdio>
#include <cmath>
#include <cstdlib>
#include <cstring>

using namespace std;

#define f(i, a, b) for(int i = a; i < b; i++)
#define rep(i, n) f(i, 0, n)

typedef long long ll;
typedef pair<int, int> pii;

map<string, int> id;
int weight[55][55];
int viz[55];
string path[55];

int main() {
  memset(weight, -1, sizeof(weight));
  int n; cin >> n;
  rep(i, n) {
    string s; cin >> s;
    id[s] = i;
  }
  int m; cin >> m;
  rep(i, m) {
    string s, t;
    cin >> s >> t;
    cin >>weight[id[s]][id[t]];
  }
  int q; cin >> q;
  rep(i, q) {
    int k; cin >> k;
    rep(j, k) cin >> path[j];
    int res = 0;
    memset(viz, 0, sizeof(viz));
    rep(j, k) if(!id.count(path[j])) {
      res = -1;
      break;
    }
    else if(viz[id[path[j]]]) {
      res = -1;
      break;
    }
    else {
      viz[id[path[j]]] = 1;
    }
    if(res != -1) {
      rep(j, k - 1) {
	int w = weight[id[path[j]]][id[path[j + 1]]];
	if(w == -1) {
	  res = -1;
	  break;
	}
	else res += w;
      }
    }
    if(res == -1) cout << "ERROR" << endl;
    else cout << res << endl;
  }
}
